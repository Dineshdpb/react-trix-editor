{"ast":null,"code":"import _wrapNativeSuper2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";\nimport _toArray2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toArray.js\";\nimport _createForOfIteratorHelper2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _get2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _assertThisInitialized2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _slicedToArray2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _toConsumableArray2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _inherits2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _classCallCheck2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass2 from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\n/*\nTrix 2.0.0-alpha.0\nCopyright © 2022 Basecamp, LLC\n */\nvar name = \"trix\";\nvar version = \"2.0.0-alpha.0\";\nvar description = \"A rich text editor for everyday writing\";\nvar main = \"dist/trix.umd.js\";\nvar module = \"dist/trix.js\";\nvar style = \"dist/trix.css\";\nvar files = [\"dist/*.css\", \"dist/*.js\"];\nvar repository = {\n  type: \"git\",\n  url: \"git+https://github.com/basecamp/trix.git\"\n};\nvar keywords = [\"rich text\", \"wysiwyg\", \"editor\"];\nvar author = \"Basecamp, LLC\";\nvar license = \"MIT\";\nvar bugs = {\n  url: \"https://github.com/basecamp/trix/issues\"\n};\nvar homepage = \"https://trix-editor.org/\";\nvar devDependencies = {\n  \"@babel/core\": \"^7.16.0\",\n  \"@babel/preset-env\": \"^7.16.4\",\n  \"@rollup/plugin-babel\": \"^5.3.0\",\n  \"@rollup/plugin-json\": \"^4.1.0\",\n  \"babel-eslint\": \"^10.1.0\",\n  eslint: \"^7.32.0\",\n  esm: \"^3.2.25\",\n  karma: \"5.0.2\",\n  \"karma-chrome-launcher\": \"3.1.0\",\n  \"karma-qunit\": \"^4.1.2\",\n  \"karma-sauce-launcher\": \"^4.3.6\",\n  \"node-sass\": \"^6.0.1\",\n  qunit: \"2.9.3\",\n  rangy: \"^1.3.0\",\n  rollup: \"^2.56.3\",\n  \"rollup-plugin-commonjs\": \"^10.1.0\",\n  \"rollup-plugin-includepaths\": \"^0.2.4\",\n  \"rollup-plugin-node-resolve\": \"^5.2.0\",\n  \"rollup-plugin-terser\": \"^7.0.2\",\n  svgo: \"^2.8.0\"\n};\nvar scripts = {\n  \"build-css\": \"node-sass --functions=./assets/trix/stylesheets/functions assets/trix.scss dist/trix.css\",\n  \"build-js\": \"rollup -c\",\n  \"build-assets\": \"cp -f assets/*.html dist/\",\n  build: \"yarn run build-js && yarn run build-css && yarn run build-assets\",\n  watch: \"rollup -c -w\",\n  lint: \"eslint .\",\n  pretest: \"yarn run lint && yarn run build\",\n  test: \"karma start\",\n  postversion: \"git push && git push --tags\",\n  release: \"yarn test && npm adduser && yarn version && npm publish\"\n};\nvar dependencies = {};\nvar _package = {\n  name: name,\n  version: version,\n  description: description,\n  main: main,\n  module: module,\n  style: style,\n  files: files,\n  repository: repository,\n  keywords: keywords,\n  author: author,\n  license: license,\n  bugs: bugs,\n  homepage: homepage,\n  devDependencies: devDependencies,\n  scripts: scripts,\n  dependencies: dependencies\n};\nvar attachmentSelector = \"[data-trix-attachment]\";\nvar attachments = {\n  preview: {\n    presentation: \"gallery\",\n    caption: {\n      name: true,\n      size: true\n    }\n  },\n  file: {\n    caption: {\n      size: true\n    }\n  }\n};\nvar attributes = {\n  default: {\n    tagName: \"div\",\n    parse: false\n  },\n  quote: {\n    tagName: \"blockquote\",\n    nestable: true\n  },\n  heading1: {\n    tagName: \"h1\",\n    terminal: true,\n    breakOnReturn: true,\n    group: false\n  },\n  code: {\n    tagName: \"pre\",\n    terminal: true,\n    text: {\n      plaintext: true\n    }\n  },\n  bulletList: {\n    tagName: \"ul\",\n    parse: false\n  },\n  bullet: {\n    tagName: \"li\",\n    listAttribute: \"bulletList\",\n    group: false,\n    nestable: true,\n    test: function test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n  },\n  numberList: {\n    tagName: \"ol\",\n    parse: false\n  },\n  number: {\n    tagName: \"li\",\n    listAttribute: \"numberList\",\n    group: false,\n    nestable: true,\n    test: function test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n  },\n  attachmentGallery: {\n    tagName: \"div\",\n    exclusive: true,\n    terminal: true,\n    parse: false,\n    group: false\n  }\n};\n\nvar tagName$1 = function tagName$1(element) {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\n\nvar browser$1 = {\n  // Android emits composition events when moving the cursor through existing text\n  // Introduced in Chrome 65: https://bugs.chromium.org/p/chromium/issues/detail?id=764439#c9\n  composesExistingText: /Android.*Chrome/.test(navigator.userAgent),\n  // IE 11 activates resizing handles on editable elements that have \"layout\"\n  forcesObjectResizing: /Trident.*rv:11/.test(navigator.userAgent),\n  // https://www.w3.org/TR/input-events-1/ + https://www.w3.org/TR/input-events-2/\n  supportsInputEvents: function () {\n    if (typeof InputEvent === \"undefined\") {\n      return false;\n    }\n\n    for (var _i2 = 0, _arr2 = [\"data\", \"getTargetRanges\", \"inputType\"]; _i2 < _arr2.length; _i2++) {\n      var property = _arr2[_i2];\n\n      if (!(property in InputEvent.prototype)) {\n        return false;\n      }\n    }\n\n    return true;\n  }()\n};\nvar css$3 = {\n  attachment: \"attachment\",\n  attachmentCaption: \"attachment__caption\",\n  attachmentCaptionEditor: \"attachment__caption-editor\",\n  attachmentMetadata: \"attachment__metadata\",\n  attachmentMetadataContainer: \"attachment__metadata-container\",\n  attachmentName: \"attachment__name\",\n  attachmentProgress: \"attachment__progress\",\n  attachmentSize: \"attachment__size\",\n  attachmentToolbar: \"attachment__toolbar\",\n  attachmentGallery: \"attachment-gallery\"\n};\nvar lang$1 = {\n  attachFiles: \"Attach Files\",\n  bold: \"Bold\",\n  bullets: \"Bullets\",\n  byte: \"Byte\",\n  bytes: \"Bytes\",\n  captionPlaceholder: \"Add a caption…\",\n  code: \"Code\",\n  heading1: \"Heading\",\n  indent: \"Increase Level\",\n  italic: \"Italic\",\n  link: \"Link\",\n  numbers: \"Numbers\",\n  outdent: \"Decrease Level\",\n  quote: \"Quote\",\n  redo: \"Redo\",\n  remove: \"Remove\",\n  strike: \"Strikethrough\",\n  undo: \"Undo\",\n  unlink: \"Unlink\",\n  url: \"URL\",\n  urlPlaceholder: \"Enter a URL…\",\n  GB: \"GB\",\n  KB: \"KB\",\n  MB: \"MB\",\n  PB: \"PB\",\n  TB: \"TB\"\n};\n/* eslint-disable\n    no-case-declarations,\n*/\n\nvar sizes = [lang$1.bytes, lang$1.KB, lang$1.MB, lang$1.GB, lang$1.TB, lang$1.PB];\nvar fileSize = {\n  prefix: \"IEC\",\n  precision: 2,\n  formatter: function formatter(number) {\n    switch (number) {\n      case 0:\n        return \"0 \".concat(lang$1.bytes);\n\n      case 1:\n        return \"1 \".concat(lang$1.byte);\n\n      default:\n        var base;\n\n        if (this.prefix === \"SI\") {\n          base = 1000;\n        } else if (this.prefix === \"IEC\") {\n          base = 1024;\n        }\n\n        var exp = Math.floor(Math.log(number) / Math.log(base));\n        var humanSize = number / Math.pow(base, exp);\n        var string = humanSize.toFixed(this.precision);\n        var withoutInsignificantZeros = string.replace(/0*$/, \"\").replace(/\\.$/, \"\");\n        return \"\".concat(withoutInsignificantZeros, \" \").concat(sizes[exp]);\n    }\n  }\n};\nvar ZERO_WIDTH_SPACE = \"\\uFEFF\";\nvar NON_BREAKING_SPACE = \"\\xA0\";\nvar OBJECT_REPLACEMENT_CHARACTER = \"\\uFFFC\";\n\nvar extend = function extend(properties) {\n  for (var key in properties) {\n    var value = properties[key];\n    this[key] = value;\n  }\n\n  return this;\n};\n\nvar html = document.documentElement;\nvar match = html.matches;\n\nvar handleEvent = function handleEvent(eventName) {\n  var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      onElement = _ref2.onElement,\n      matchingSelector = _ref2.matchingSelector,\n      withCallback = _ref2.withCallback,\n      inPhase = _ref2.inPhase,\n      preventDefault = _ref2.preventDefault,\n      times = _ref2.times;\n\n  var element = onElement ? onElement : html;\n  var selector = matchingSelector;\n  var useCapture = inPhase === \"capturing\";\n\n  var handler = function handler(event) {\n    if (times != null && --times === 0) {\n      handler.destroy();\n    }\n\n    var target = findClosestElementFromNode(event.target, {\n      matchingSelector: selector\n    });\n\n    if (target != null) {\n      withCallback === null || withCallback === void 0 ? void 0 : withCallback.call(target, event, target);\n\n      if (preventDefault) {\n        event.preventDefault();\n      }\n    }\n  };\n\n  handler.destroy = function () {\n    return element.removeEventListener(eventName, handler, useCapture);\n  };\n\n  element.addEventListener(eventName, handler, useCapture);\n  return handler;\n};\n\nvar handleEventOnce = function handleEventOnce(eventName) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  options.times = 1;\n  return handleEvent(eventName, options);\n};\n\nvar triggerEvent = function triggerEvent(eventName) {\n  var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      onElement = _ref3.onElement,\n      bubbles = _ref3.bubbles,\n      cancelable = _ref3.cancelable,\n      attributes = _ref3.attributes;\n\n  var element = onElement != null ? onElement : html;\n  bubbles = bubbles !== false;\n  cancelable = cancelable !== false;\n  var event = document.createEvent(\"Events\");\n  event.initEvent(eventName, bubbles, cancelable);\n\n  if (attributes != null) {\n    extend.call(event, attributes);\n  }\n\n  return element.dispatchEvent(event);\n};\n\nvar elementMatchesSelector = function elementMatchesSelector(element, selector) {\n  if ((element === null || element === void 0 ? void 0 : element.nodeType) === 1) {\n    return match.call(element, selector);\n  }\n};\n\nvar findClosestElementFromNode = function findClosestElementFromNode(node) {\n  var _ref4 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      matchingSelector = _ref4.matchingSelector,\n      untilNode = _ref4.untilNode;\n\n  while (node && node.nodeType !== Node.ELEMENT_NODE) {\n    node = node.parentNode;\n  }\n\n  if (node == null) {\n    return;\n  }\n\n  if (matchingSelector != null) {\n    if (node.closest && untilNode == null) {\n      return node.closest(matchingSelector);\n    } else {\n      while (node && node !== untilNode) {\n        if (elementMatchesSelector(node, matchingSelector)) {\n          return node;\n        }\n\n        node = node.parentNode;\n      }\n    }\n  } else {\n    return node;\n  }\n};\n\nvar findInnerElement = function findInnerElement(element) {\n  while ((_element = element) !== null && _element !== void 0 && _element.firstElementChild) {\n    var _element;\n\n    element = element.firstElementChild;\n  }\n\n  return element;\n};\n\nvar innerElementIsActive = function innerElementIsActive(element) {\n  return document.activeElement !== element && elementContainsNode(element, document.activeElement);\n};\n\nvar elementContainsNode = function elementContainsNode(element, node) {\n  if (!element || !node) {\n    return;\n  }\n\n  while (node) {\n    if (node === element) {\n      return true;\n    }\n\n    node = node.parentNode;\n  }\n};\n\nvar findNodeFromContainerAndOffset = function findNodeFromContainerAndOffset(container, offset) {\n  if (!container) {\n    return;\n  }\n\n  if (container.nodeType === Node.TEXT_NODE) {\n    return container;\n  } else if (offset === 0) {\n    return container.firstChild != null ? container.firstChild : container;\n  } else {\n    return container.childNodes.item(offset - 1);\n  }\n};\n\nvar findElementFromContainerAndOffset = function findElementFromContainerAndOffset(container, offset) {\n  var node = findNodeFromContainerAndOffset(container, offset);\n  return findClosestElementFromNode(node);\n};\n\nvar findChildIndexOfNode = function findChildIndexOfNode(node) {\n  var _node;\n\n  if (!((_node = node) !== null && _node !== void 0 && _node.parentNode)) {\n    return;\n  }\n\n  var childIndex = 0;\n  node = node.previousSibling;\n\n  while (node) {\n    childIndex++;\n    node = node.previousSibling;\n  }\n\n  return childIndex;\n};\n\nvar removeNode = function removeNode(node) {\n  var _node$parentNode;\n\n  return node === null || node === void 0 ? void 0 : (_node$parentNode = node.parentNode) === null || _node$parentNode === void 0 ? void 0 : _node$parentNode.removeChild(node);\n};\n\nvar walkTree = function walkTree(tree) {\n  var _ref5 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      onlyNodesOfType = _ref5.onlyNodesOfType,\n      usingFilter = _ref5.usingFilter,\n      expandEntityReferences = _ref5.expandEntityReferences;\n\n  var whatToShow = function () {\n    switch (onlyNodesOfType) {\n      case \"element\":\n        return NodeFilter.SHOW_ELEMENT;\n\n      case \"text\":\n        return NodeFilter.SHOW_TEXT;\n\n      case \"comment\":\n        return NodeFilter.SHOW_COMMENT;\n\n      default:\n        return NodeFilter.SHOW_ALL;\n    }\n  }();\n\n  return document.createTreeWalker(tree, whatToShow, usingFilter != null ? usingFilter : null, expandEntityReferences === true);\n};\n\nvar tagName = function tagName(element) {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\n\nvar makeElement = function makeElement(tag) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var key, value;\n\n  if (typeof tag === \"object\") {\n    options = tag;\n    tag = options.tagName;\n  } else {\n    options = {\n      attributes: options\n    };\n  }\n\n  var element = document.createElement(tag);\n\n  if (options.editable != null) {\n    if (options.attributes == null) {\n      options.attributes = {};\n    }\n\n    options.attributes.contenteditable = options.editable;\n  }\n\n  if (options.attributes) {\n    for (key in options.attributes) {\n      value = options.attributes[key];\n      element.setAttribute(key, value);\n    }\n  }\n\n  if (options.style) {\n    for (key in options.style) {\n      value = options.style[key];\n      element.style[key] = value;\n    }\n  }\n\n  if (options.data) {\n    for (key in options.data) {\n      value = options.data[key];\n      element.dataset[key] = value;\n    }\n  }\n\n  if (options.className) {\n    options.className.split(\" \").forEach(function (className) {\n      element.classList.add(className);\n    });\n  }\n\n  if (options.textContent) {\n    element.textContent = options.textContent;\n  }\n\n  if (options.childNodes) {\n    [].concat(options.childNodes).forEach(function (childNode) {\n      element.appendChild(childNode);\n    });\n  }\n\n  return element;\n};\n\nvar blockTagNames = undefined;\n\nvar getBlockTagNames = function getBlockTagNames() {\n  if (blockTagNames != null) {\n    return blockTagNames;\n  }\n\n  blockTagNames = [];\n\n  for (var key in attributes) {\n    var attributes$1 = attributes[key];\n\n    if (attributes$1.tagName) {\n      blockTagNames.push(attributes$1.tagName);\n    }\n  }\n\n  return blockTagNames;\n};\n\nvar nodeIsBlockContainer = function nodeIsBlockContainer(node) {\n  return nodeIsBlockStartComment(node === null || node === void 0 ? void 0 : node.firstChild);\n};\n\nvar nodeProbablyIsBlockContainer = function nodeProbablyIsBlockContainer(node) {\n  return getBlockTagNames().includes(tagName(node)) && !getBlockTagNames().includes(tagName(node.firstChild));\n};\n\nvar nodeIsBlockStart = function nodeIsBlockStart(node) {\n  var _ref6 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    strict: true\n  },\n      strict = _ref6.strict;\n\n  if (strict) {\n    return nodeIsBlockStartComment(node);\n  } else {\n    return nodeIsBlockStartComment(node) || !nodeIsBlockStartComment(node.firstChild) && nodeProbablyIsBlockContainer(node);\n  }\n};\n\nvar nodeIsBlockStartComment = function nodeIsBlockStartComment(node) {\n  return nodeIsCommentNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"block\";\n};\n\nvar nodeIsCommentNode = function nodeIsCommentNode(node) {\n  return (node === null || node === void 0 ? void 0 : node.nodeType) === Node.COMMENT_NODE;\n};\n\nvar nodeIsCursorTarget = function nodeIsCursorTarget(node) {\n  var _ref7 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      name = _ref7.name;\n\n  if (!node) {\n    return;\n  }\n\n  if (nodeIsTextNode(node)) {\n    if (node.data === ZERO_WIDTH_SPACE) {\n      if (name) {\n        return node.parentNode.dataset.trixCursorTarget === name;\n      } else {\n        return true;\n      }\n    }\n  } else {\n    return nodeIsCursorTarget(node.firstChild);\n  }\n};\n\nvar nodeIsAttachmentElement = function nodeIsAttachmentElement(node) {\n  return elementMatchesSelector(node, attachmentSelector);\n};\n\nvar nodeIsEmptyTextNode = function nodeIsEmptyTextNode(node) {\n  return nodeIsTextNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"\";\n};\n\nvar nodeIsTextNode = function nodeIsTextNode(node) {\n  return (node === null || node === void 0 ? void 0 : node.nodeType) === Node.TEXT_NODE;\n};\n\nvar input = {\n  level2Enabled: true,\n  getLevel: function getLevel() {\n    if (this.level2Enabled && browser$1.supportsInputEvents) {\n      return 2;\n    } else {\n      return 0;\n    }\n  },\n  pickFiles: function pickFiles(callback) {\n    var input = makeElement(\"input\", {\n      type: \"file\",\n      multiple: true,\n      hidden: true,\n      id: this.fileInputId\n    });\n    input.addEventListener(\"change\", function () {\n      callback(input.files);\n      removeNode(input);\n    });\n    removeNode(document.getElementById(this.fileInputId));\n    document.body.appendChild(input);\n    input.click();\n  }\n};\nvar keyNames$2 = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"return\",\n  27: \"escape\",\n  37: \"left\",\n  39: \"right\",\n  46: \"delete\",\n  68: \"d\",\n  72: \"h\",\n  79: \"o\"\n};\nvar textAttributes = {\n  bold: {\n    tagName: \"strong\",\n    inheritable: true,\n    parser: function parser(element) {\n      var style = window.getComputedStyle(element);\n      return style.fontWeight === \"bold\" || style.fontWeight >= 600;\n    }\n  },\n  italic: {\n    tagName: \"em\",\n    inheritable: true,\n    parser: function parser(element) {\n      var style = window.getComputedStyle(element);\n      return style.fontStyle === \"italic\";\n    }\n  },\n  href: {\n    groupTagName: \"a\",\n    parser: function parser(element) {\n      var matchingSelector = \"a:not(\".concat(attachmentSelector, \")\");\n      var link = element.closest(matchingSelector);\n\n      if (link) {\n        return link.getAttribute(\"href\");\n      }\n    }\n  },\n  strike: {\n    tagName: \"del\",\n    inheritable: true\n  },\n  frozen: {\n    style: {\n      backgroundColor: \"highlight\"\n    }\n  }\n};\nvar toolbar = {\n  getDefaultHTML: function getDefaultHTML() {\n    return \"<div class=\\\"trix-button-row\\\">\\n      <span class=\\\"trix-button-group trix-button-group--text-tools\\\" data-trix-button-group=\\\"text-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bold\\\" data-trix-attribute=\\\"bold\\\" data-trix-key=\\\"b\\\" title=\\\"\".concat(lang$1.bold, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bold, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-italic\\\" data-trix-attribute=\\\"italic\\\" data-trix-key=\\\"i\\\" title=\\\"\").concat(lang$1.italic, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.italic, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-strike\\\" data-trix-attribute=\\\"strike\\\" title=\\\"\").concat(lang$1.strike, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.strike, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-link\\\" data-trix-attribute=\\\"href\\\" data-trix-action=\\\"link\\\" data-trix-key=\\\"k\\\" title=\\\"\").concat(lang$1.link, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.link, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--block-tools\\\" data-trix-button-group=\\\"block-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-heading-1\\\" data-trix-attribute=\\\"heading1\\\" title=\\\"\").concat(lang$1.heading1, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.heading1, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-quote\\\" data-trix-attribute=\\\"quote\\\" title=\\\"\").concat(lang$1.quote, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.quote, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-code\\\" data-trix-attribute=\\\"code\\\" title=\\\"\").concat(lang$1.code, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.code, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bullet-list\\\" data-trix-attribute=\\\"bullet\\\" title=\\\"\").concat(lang$1.bullets, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bullets, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-number-list\\\" data-trix-attribute=\\\"number\\\" title=\\\"\").concat(lang$1.numbers, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.numbers, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-decrease-nesting-level\\\" data-trix-action=\\\"decreaseNestingLevel\\\" title=\\\"\").concat(lang$1.outdent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.outdent, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-increase-nesting-level\\\" data-trix-action=\\\"increaseNestingLevel\\\" title=\\\"\").concat(lang$1.indent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.indent, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--file-tools\\\" data-trix-button-group=\\\"file-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-attach\\\" data-trix-action=\\\"attachFiles\\\" title=\\\"\").concat(lang$1.attachFiles, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.attachFiles, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group-spacer\\\"></span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--history-tools\\\" data-trix-button-group=\\\"history-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-undo\\\" data-trix-action=\\\"undo\\\" data-trix-key=\\\"z\\\" title=\\\"\").concat(lang$1.undo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.undo, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-redo\\\" data-trix-action=\\\"redo\\\" data-trix-key=\\\"shift+z\\\" title=\\\"\").concat(lang$1.redo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.redo, \"</button>\\n      </span>\\n    </div>\\n\\n    <div class=\\\"trix-dialogs\\\" data-trix-dialogs>\\n      <div class=\\\"trix-dialog trix-dialog--link\\\" data-trix-dialog=\\\"href\\\" data-trix-dialog-attribute=\\\"href\\\">\\n        <div class=\\\"trix-dialog__link-fields\\\">\\n          <input type=\\\"url\\\" name=\\\"href\\\" class=\\\"trix-input trix-input--dialog\\\" placeholder=\\\"\").concat(lang$1.urlPlaceholder, \"\\\" aria-label=\\\"\").concat(lang$1.url, \"\\\" required data-trix-input>\\n          <div class=\\\"trix-button-group\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.link, \"\\\" data-trix-method=\\\"setAttribute\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.unlink, \"\\\" data-trix-method=\\\"removeAttribute\\\">\\n          </div>\\n        </div>\\n      </div>\\n    </div>\");\n  }\n};\nvar undoInterval = 5000;\nvar config = {\n  attachments: attachments,\n  blockAttributes: attributes,\n  browser: browser$1,\n  css: css$3,\n  fileSize: fileSize,\n  input: input,\n  keyNames: keyNames$2,\n  lang: lang$1,\n  textAttributes: textAttributes,\n  toolbar: toolbar,\n  undoInterval: undoInterval\n};\n\nfunction _asyncIterator(iterable) {\n  var method,\n      async,\n      sync,\n      retry = 2;\n\n  if (typeof Symbol !== \"undefined\") {\n    async = Symbol.asyncIterator;\n    sync = Symbol.iterator;\n  }\n\n  while (retry--) {\n    if (async && (method = iterable[async]) != null) {\n      return method.call(iterable);\n    }\n\n    if (sync && (method = iterable[sync]) != null) {\n      return new AsyncFromSyncIterator(method.call(iterable));\n    }\n\n    async = \"@@asyncIterator\";\n    sync = \"@@iterator\";\n  }\n\n  throw new TypeError(\"Object is not async iterable\");\n}\n\nfunction AsyncFromSyncIterator(s) {\n  AsyncFromSyncIterator = function AsyncFromSyncIterator(s) {\n    this.s = s;\n    this.n = s.next;\n  };\n\n  AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function next() {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    return: function _return(value) {\n      var ret = this.s.return;\n\n      if (ret === undefined) {\n        return Promise.resolve({\n          value: value,\n          done: true\n        });\n      }\n\n      return AsyncFromSyncIteratorContinuation(ret.apply(this.s, arguments));\n    },\n    throw: function _throw(value) {\n      var thr = this.s.return;\n      if (thr === undefined) return Promise.reject(value);\n      return AsyncFromSyncIteratorContinuation(thr.apply(this.s, arguments));\n    }\n  };\n\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) {\n      return Promise.reject(new TypeError(r + \" is not an object.\"));\n    }\n\n    var done = r.done;\n    return Promise.resolve(r.value).then(function (value) {\n      return {\n        value: value,\n        done: done\n      };\n    });\n  }\n\n  return new AsyncFromSyncIterator(s);\n}\n\nvar REACT_ELEMENT_TYPE;\n\nfunction _jsx(type, props, key, children) {\n  if (!REACT_ELEMENT_TYPE) {\n    REACT_ELEMENT_TYPE = typeof Symbol === \"function\" && Symbol[\"for\"] && Symbol[\"for\"](\"react.element\") || 0xeac7;\n  }\n\n  var defaultProps = type && type.defaultProps;\n  var childrenLength = arguments.length - 3;\n\n  if (!props && childrenLength !== 0) {\n    props = {\n      children: void 0\n    };\n  }\n\n  if (childrenLength === 1) {\n    props.children = children;\n  } else if (childrenLength > 1) {\n    var childArray = new Array(childrenLength);\n\n    for (var i = 0; i < childrenLength; i++) {\n      childArray[i] = arguments[i + 3];\n    }\n\n    props.children = childArray;\n  }\n\n  if (props && defaultProps) {\n    for (var propName in defaultProps) {\n      if (props[propName] === void 0) {\n        props[propName] = defaultProps[propName];\n      }\n    }\n  } else if (!props) {\n    props = defaultProps || {};\n  }\n\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key === undefined ? null : \"\" + key,\n    ref: null,\n    props: props,\n    _owner: null\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _wrapRegExp() {\n  _wrapRegExp = function _wrapRegExp(re, groups) {\n    return new BabelRegExp(re, undefined, groups);\n  };\n\n  var _super = RegExp.prototype;\n\n  var _groups = new WeakMap();\n\n  function BabelRegExp(re, flags, groups) {\n    var _this = new RegExp(re, flags);\n\n    _groups.set(_this, groups || _groups.get(re));\n\n    return _setPrototypeOf(_this, BabelRegExp.prototype);\n  }\n\n  _inherits(BabelRegExp, RegExp);\n\n  BabelRegExp.prototype.exec = function (str) {\n    var result = _super.exec.call(this, str);\n\n    if (result) result.groups = buildGroups(result, this);\n    return result;\n  };\n\n  BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n    if (typeof substitution === \"string\") {\n      var groups = _groups.get(this);\n\n      return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n        return \"$\" + groups[name];\n      }));\n    } else if (typeof substitution === \"function\") {\n      var _this = this;\n\n      return _super[Symbol.replace].call(this, str, function () {\n        var args = arguments;\n\n        if (typeof args[args.length - 1] !== \"object\") {\n          args = [].slice.call(args);\n          args.push(buildGroups(args, _this));\n        }\n\n        return substitution.apply(this, args);\n      });\n    } else {\n      return _super[Symbol.replace].call(this, str, substitution);\n    }\n  };\n\n  function buildGroups(result, re) {\n    var g = _groups.get(re);\n\n    return Object.keys(g).reduce(function (groups, name) {\n      groups[name] = result[g[name]];\n      return groups;\n    }, Object.create(null));\n  }\n\n  return _wrapRegExp.apply(this, arguments);\n}\n\nfunction _AwaitValue(value) {\n  this.wrapped = value;\n}\n\nfunction _AsyncGenerator(gen) {\n  var front, back;\n\n  function send(key, arg) {\n    return new Promise(function (resolve, reject) {\n      var request = {\n        key: key,\n        arg: arg,\n        resolve: resolve,\n        reject: reject,\n        next: null\n      };\n\n      if (back) {\n        back = back.next = request;\n      } else {\n        front = back = request;\n        resume(key, arg);\n      }\n    });\n  }\n\n  function resume(key, arg) {\n    try {\n      var result = gen[key](arg);\n      var value = result.value;\n      var wrappedAwait = value instanceof _AwaitValue;\n      Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n        if (wrappedAwait) {\n          resume(key === \"return\" ? \"return\" : \"next\", arg);\n          return;\n        }\n\n        settle(result.done ? \"return\" : \"normal\", arg);\n      }, function (err) {\n        resume(\"throw\", err);\n      });\n    } catch (err) {\n      settle(\"throw\", err);\n    }\n  }\n\n  function settle(type, value) {\n    switch (type) {\n      case \"return\":\n        front.resolve({\n          value: value,\n          done: true\n        });\n        break;\n\n      case \"throw\":\n        front.reject(value);\n        break;\n\n      default:\n        front.resolve({\n          value: value,\n          done: false\n        });\n        break;\n    }\n\n    front = front.next;\n\n    if (front) {\n      resume(front.key, front.arg);\n    } else {\n      back = null;\n    }\n  }\n\n  this._invoke = send;\n\n  if (typeof gen.return !== \"function\") {\n    this.return = undefined;\n  }\n}\n\n_AsyncGenerator.prototype[typeof Symbol === \"function\" && Symbol.asyncIterator || \"@@asyncIterator\"] = function () {\n  return this;\n};\n\n_AsyncGenerator.prototype.next = function (arg) {\n  return this._invoke(\"next\", arg);\n};\n\n_AsyncGenerator.prototype.throw = function (arg) {\n  return this._invoke(\"throw\", arg);\n};\n\n_AsyncGenerator.prototype.return = function (arg) {\n  return this._invoke(\"return\", arg);\n};\n\nfunction _wrapAsyncGenerator(fn) {\n  return function () {\n    return new _AsyncGenerator(fn.apply(this, arguments));\n  };\n}\n\nfunction _awaitAsyncGenerator(value) {\n  return new _AwaitValue(value);\n}\n\nfunction _asyncGeneratorDelegate(inner, awaitWrap) {\n  var iter = {},\n      waiting = false;\n\n  function pump(key, value) {\n    waiting = true;\n    value = new Promise(function (resolve) {\n      resolve(inner[key](value));\n    });\n    return {\n      done: false,\n      value: awaitWrap(value)\n    };\n  }\n\n  ;\n\n  iter[typeof Symbol !== \"undefined\" && Symbol.iterator || \"@@iterator\"] = function () {\n    return this;\n  };\n\n  iter.next = function (value) {\n    if (waiting) {\n      waiting = false;\n      return value;\n    }\n\n    return pump(\"next\", value);\n  };\n\n  if (typeof inner.throw === \"function\") {\n    iter.throw = function (value) {\n      if (waiting) {\n        waiting = false;\n        throw value;\n      }\n\n      return pump(\"throw\", value);\n    };\n  }\n\n  if (typeof inner.return === \"function\") {\n    iter.return = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump(\"return\", value);\n    };\n  }\n\n  return iter;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineEnumerableProperties(obj, descs) {\n  for (var key in descs) {\n    var desc = descs[key];\n    desc.configurable = desc.enumerable = true;\n    if (\"value\" in desc) desc.writable = true;\n    Object.defineProperty(obj, key, desc);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n    for (var i = 0; i < objectSymbols.length; i++) {\n      var sym = objectSymbols[i];\n      var desc = descs[sym];\n      desc.configurable = desc.enumerable = true;\n      if (\"value\" in desc) desc.writable = true;\n      Object.defineProperty(obj, sym, desc);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? Object(arguments[i]) : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys.push.apply(ownKeys, Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !_isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return _setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nfunction _instanceof(left, right) {\n  if (right != null && typeof Symbol !== \"undefined\" && right[Symbol.hasInstance]) {\n    return !!right[Symbol.hasInstance](left);\n  } else {\n    return left instanceof right;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _newArrowCheck(innerThis, boundThis) {\n  if (innerThis !== boundThis) {\n    throw new TypeError(\"Cannot instantiate an arrow function\");\n  }\n}\n\nfunction _objectDestructuringEmpty(obj) {\n  if (obj == null) throw new TypeError(\"Cannot destructure undefined\");\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction set(target, property, value, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.set) {\n    set = Reflect.set;\n  } else {\n    set = function set(target, property, value, receiver) {\n      var base = _superPropBase(target, property);\n\n      var desc;\n\n      if (base) {\n        desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.set) {\n          desc.set.call(receiver, value);\n          return true;\n        } else if (!desc.writable) {\n          return false;\n        }\n      }\n\n      desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n      if (desc) {\n        if (!desc.writable) {\n          return false;\n        }\n\n        desc.value = value;\n        Object.defineProperty(receiver, property, desc);\n      } else {\n        _defineProperty(receiver, property, value);\n      }\n\n      return true;\n    };\n  }\n\n  return set(target, property, value, receiver);\n}\n\nfunction _set(target, property, value, receiver, isStrict) {\n  var s = set(target, property, value, receiver || target);\n\n  if (!s && isStrict) {\n    throw new Error('failed to set property');\n  }\n\n  return value;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}\n\nfunction _taggedTemplateLiteralLoose(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  strings.raw = raw;\n  return strings;\n}\n\nfunction _readOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nfunction _writeOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is write-only\");\n}\n\nfunction _classNameTDZError(name) {\n  throw new Error(\"Class \\\"\" + name + \"\\\" cannot be referenced in computed property keys.\");\n}\n\nfunction _temporalUndefined() {}\n\nfunction _tdz(name) {\n  throw new ReferenceError(name + \" is not defined - temporal dead zone\");\n}\n\nfunction _temporalRef(val, name) {\n  return val === _temporalUndefined ? _tdz(name) : val;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _slicedToArrayLoose(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _maybeArrayLike(next, arr, i) {\n  if (arr && !Array.isArray(arr) && typeof arr.length === \"number\") {\n    var len = arr.length;\n    return _arrayLikeToArray(arr, i !== void 0 && i < len ? i : len);\n  }\n\n  return next(arr, i);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _iterableToArrayLimitLoose(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n\n  for (_i = _i.call(arr), _step; !(_step = _i.next()).done;) {\n    _arr.push(_step.value);\n\n    if (i && _arr.length === i) break;\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e2) {\n          throw _e2;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e3) {\n      didErr = true;\n      err = _e3;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _skipFirstGeneratorNext(fn) {\n  return function () {\n    var it = fn.apply(this, arguments);\n    it.next();\n    return it;\n  };\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.');\n}\n\nfunction _initializerDefineProperty(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar id$2 = 0;\n\nfunction _classPrivateFieldLooseKey(name) {\n  return \"__private_\" + id$2++ + \"_\" + name;\n}\n\nfunction _classPrivateFieldLooseBase(receiver, privateKey) {\n  if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n    throw new TypeError(\"attempted to use private field on non-instance\");\n  }\n\n  return receiver;\n}\n\nfunction _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classPrivateFieldDestructureSet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) {\n  if (!privateMap.has(receiver)) {\n    throw new TypeError(\"attempted to \" + action + \" private field on non-instance\");\n  }\n\n  return privateMap.get(receiver);\n}\n\nfunction _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  return method;\n}\n\nfunction _classStaticPrivateMethodSet() {\n  throw new TypeError(\"attempted to set read only static private field\");\n}\n\nfunction _classApplyDescriptorGet(receiver, descriptor) {\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) {\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n}\n\nfunction _classApplyDescriptorDestructureSet(receiver, descriptor) {\n  if (descriptor.set) {\n    if (!(\"__destrObj\" in descriptor)) {\n      descriptor.__destrObj = {\n        set value(v) {\n          descriptor.set.call(receiver, v);\n        }\n\n      };\n    }\n\n    return descriptor.__destrObj;\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    return descriptor;\n  }\n}\n\nfunction _classStaticPrivateFieldDestructureSet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classCheckPrivateStaticAccess(receiver, classConstructor) {\n  if (receiver !== classConstructor) {\n    throw new TypeError(\"Private static access of wrong provenance\");\n  }\n}\n\nfunction _classCheckPrivateStaticFieldDescriptor(descriptor, action) {\n  if (descriptor === undefined) {\n    throw new TypeError(\"attempted to \" + action + \" private static field before its declaration\");\n  }\n}\n\nfunction _decorate(decorators, factory, superClass, mixins) {\n  var api = _getDecoratorsApi();\n\n  if (mixins) {\n    for (var i = 0; i < mixins.length; i++) {\n      api = mixins[i](api);\n    }\n  }\n\n  var r = factory(function initialize(O) {\n    api.initializeInstanceElements(O, decorated.elements);\n  }, superClass);\n  var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n  api.initializeClassElements(r.F, decorated.elements);\n  return api.runClassFinishers(r.F, decorated.finishers);\n}\n\nfunction _getDecoratorsApi() {\n  _getDecoratorsApi = function _getDecoratorsApi() {\n    return api;\n  };\n\n  var api = {\n    elementsDefinitionOrder: [[\"method\"], [\"field\"]],\n    initializeInstanceElements: function initializeInstanceElements(O, elements) {\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          if (element.kind === kind && element.placement === \"own\") {\n            this.defineClassElement(O, element);\n          }\n        }, this);\n      }, this);\n    },\n    initializeClassElements: function initializeClassElements(F, elements) {\n      var proto = F.prototype;\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          var placement = element.placement;\n\n          if (element.kind === kind && (placement === \"static\" || placement === \"prototype\")) {\n            var receiver = placement === \"static\" ? F : proto;\n            this.defineClassElement(receiver, element);\n          }\n        }, this);\n      }, this);\n    },\n    defineClassElement: function defineClassElement(receiver, element) {\n      var descriptor = element.descriptor;\n\n      if (element.kind === \"field\") {\n        var initializer = element.initializer;\n        descriptor = {\n          enumerable: descriptor.enumerable,\n          writable: descriptor.writable,\n          configurable: descriptor.configurable,\n          value: initializer === void 0 ? void 0 : initializer.call(receiver)\n        };\n      }\n\n      Object.defineProperty(receiver, element.key, descriptor);\n    },\n    decorateClass: function decorateClass(elements, decorators) {\n      var newElements = [];\n      var finishers = [];\n      var placements = {\n        static: [],\n        prototype: [],\n        own: []\n      };\n      elements.forEach(function (element) {\n        this.addElementPlacement(element, placements);\n      }, this);\n      elements.forEach(function (element) {\n        if (!_hasDecorators(element)) return newElements.push(element);\n        var elementFinishersExtras = this.decorateElement(element, placements);\n        newElements.push(elementFinishersExtras.element);\n        newElements.push.apply(newElements, elementFinishersExtras.extras);\n        finishers.push.apply(finishers, elementFinishersExtras.finishers);\n      }, this);\n\n      if (!decorators) {\n        return {\n          elements: newElements,\n          finishers: finishers\n        };\n      }\n\n      var result = this.decorateConstructor(newElements, decorators);\n      finishers.push.apply(finishers, result.finishers);\n      result.finishers = finishers;\n      return result;\n    },\n    addElementPlacement: function addElementPlacement(element, placements, silent) {\n      var keys = placements[element.placement];\n\n      if (!silent && keys.indexOf(element.key) !== -1) {\n        throw new TypeError(\"Duplicated element (\" + element.key + \")\");\n      }\n\n      keys.push(element.key);\n    },\n    decorateElement: function decorateElement(element, placements) {\n      var extras = [];\n      var finishers = [];\n\n      for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n        var keys = placements[element.placement];\n        keys.splice(keys.indexOf(element.key), 1);\n        var elementObject = this.fromElementDescriptor(element);\n        var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n        element = elementFinisherExtras.element;\n        this.addElementPlacement(element, placements);\n\n        if (elementFinisherExtras.finisher) {\n          finishers.push(elementFinisherExtras.finisher);\n        }\n\n        var newExtras = elementFinisherExtras.extras;\n\n        if (newExtras) {\n          for (var j = 0; j < newExtras.length; j++) {\n            this.addElementPlacement(newExtras[j], placements);\n          }\n\n          extras.push.apply(extras, newExtras);\n        }\n      }\n\n      return {\n        element: element,\n        finishers: finishers,\n        extras: extras\n      };\n    },\n    decorateConstructor: function decorateConstructor(elements, decorators) {\n      var finishers = [];\n\n      for (var i = decorators.length - 1; i >= 0; i--) {\n        var obj = this.fromClassDescriptor(elements);\n        var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n        if (elementsAndFinisher.finisher !== undefined) {\n          finishers.push(elementsAndFinisher.finisher);\n        }\n\n        if (elementsAndFinisher.elements !== undefined) {\n          elements = elementsAndFinisher.elements;\n\n          for (var j = 0; j < elements.length - 1; j++) {\n            for (var k = j + 1; k < elements.length; k++) {\n              if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                throw new TypeError(\"Duplicated element (\" + elements[j].key + \")\");\n              }\n            }\n          }\n        }\n      }\n\n      return {\n        elements: elements,\n        finishers: finishers\n      };\n    },\n    fromElementDescriptor: function fromElementDescriptor(element) {\n      var obj = {\n        kind: element.kind,\n        key: element.key,\n        placement: element.placement,\n        descriptor: element.descriptor\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      if (element.kind === \"field\") obj.initializer = element.initializer;\n      return obj;\n    },\n    toElementDescriptors: function toElementDescriptors(elementObjects) {\n      if (elementObjects === undefined) return;\n      return _toArray(elementObjects).map(function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n        this.disallowProperty(elementObject, \"finisher\", \"An element descriptor\");\n        this.disallowProperty(elementObject, \"extras\", \"An element descriptor\");\n        return element;\n      }, this);\n    },\n    toElementDescriptor: function toElementDescriptor(elementObject) {\n      var kind = String(elementObject.kind);\n\n      if (kind !== \"method\" && kind !== \"field\") {\n        throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n      }\n\n      var key = _toPropertyKey(elementObject.key);\n\n      var placement = String(elementObject.placement);\n\n      if (placement !== \"static\" && placement !== \"prototype\" && placement !== \"own\") {\n        throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n      }\n\n      var descriptor = elementObject.descriptor;\n      this.disallowProperty(elementObject, \"elements\", \"An element descriptor\");\n      var element = {\n        kind: kind,\n        key: key,\n        placement: placement,\n        descriptor: Object.assign({}, descriptor)\n      };\n\n      if (kind !== \"field\") {\n        this.disallowProperty(elementObject, \"initializer\", \"A method descriptor\");\n      } else {\n        this.disallowProperty(descriptor, \"get\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"set\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"value\", \"The property descriptor of a field descriptor\");\n        element.initializer = elementObject.initializer;\n      }\n\n      return element;\n    },\n    toElementFinisherExtras: function toElementFinisherExtras(elementObject) {\n      var element = this.toElementDescriptor(elementObject);\n\n      var finisher = _optionalCallableProperty(elementObject, \"finisher\");\n\n      var extras = this.toElementDescriptors(elementObject.extras);\n      return {\n        element: element,\n        finisher: finisher,\n        extras: extras\n      };\n    },\n    fromClassDescriptor: function fromClassDescriptor(elements) {\n      var obj = {\n        kind: \"class\",\n        elements: elements.map(this.fromElementDescriptor, this)\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      return obj;\n    },\n    toClassDescriptor: function toClassDescriptor(obj) {\n      var kind = String(obj.kind);\n\n      if (kind !== \"class\") {\n        throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n      }\n\n      this.disallowProperty(obj, \"key\", \"A class descriptor\");\n      this.disallowProperty(obj, \"placement\", \"A class descriptor\");\n      this.disallowProperty(obj, \"descriptor\", \"A class descriptor\");\n      this.disallowProperty(obj, \"initializer\", \"A class descriptor\");\n      this.disallowProperty(obj, \"extras\", \"A class descriptor\");\n\n      var finisher = _optionalCallableProperty(obj, \"finisher\");\n\n      var elements = this.toElementDescriptors(obj.elements);\n      return {\n        elements: elements,\n        finisher: finisher\n      };\n    },\n    runClassFinishers: function runClassFinishers(constructor, finishers) {\n      for (var i = 0; i < finishers.length; i++) {\n        var newConstructor = (0, finishers[i])(constructor);\n\n        if (newConstructor !== undefined) {\n          if (typeof newConstructor !== \"function\") {\n            throw new TypeError(\"Finishers must return a constructor.\");\n          }\n\n          constructor = newConstructor;\n        }\n      }\n\n      return constructor;\n    },\n    disallowProperty: function disallowProperty(obj, name, objectType) {\n      if (obj[name] !== undefined) {\n        throw new TypeError(objectType + \" can't have a .\" + name + \" property.\");\n      }\n    }\n  };\n  return api;\n}\n\nfunction _createElementDescriptor(def) {\n  var key = _toPropertyKey(def.key);\n\n  var descriptor;\n\n  if (def.kind === \"method\") {\n    descriptor = {\n      value: def.value,\n      writable: true,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"get\") {\n    descriptor = {\n      get: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"set\") {\n    descriptor = {\n      set: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"field\") {\n    descriptor = {\n      configurable: true,\n      writable: true,\n      enumerable: true\n    };\n  }\n\n  var element = {\n    kind: def.kind === \"field\" ? \"field\" : \"method\",\n    key: key,\n    placement: def.static ? \"static\" : def.kind === \"field\" ? \"own\" : \"prototype\",\n    descriptor: descriptor\n  };\n  if (def.decorators) element.decorators = def.decorators;\n  if (def.kind === \"field\") element.initializer = def.value;\n  return element;\n}\n\nfunction _coalesceGetterSetter(element, other) {\n  if (element.descriptor.get !== undefined) {\n    other.descriptor.get = element.descriptor.get;\n  } else {\n    other.descriptor.set = element.descriptor.set;\n  }\n}\n\nfunction _coalesceClassElements(elements) {\n  var newElements = [];\n\n  var isSameElement = function isSameElement(other) {\n    return other.kind === \"method\" && other.key === element.key && other.placement === element.placement;\n  };\n\n  for (var i = 0; i < elements.length; i++) {\n    var element = elements[i];\n    var other;\n\n    if (element.kind === \"method\" && (other = newElements.find(isSameElement))) {\n      if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n        if (_hasDecorators(element) || _hasDecorators(other)) {\n          throw new ReferenceError(\"Duplicated methods (\" + element.key + \") can't be decorated.\");\n        }\n\n        other.descriptor = element.descriptor;\n      } else {\n        if (_hasDecorators(element)) {\n          if (_hasDecorators(other)) {\n            throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + \"the same property (\" + element.key + \").\");\n          }\n\n          other.decorators = element.decorators;\n        }\n\n        _coalesceGetterSetter(element, other);\n      }\n    } else {\n      newElements.push(element);\n    }\n  }\n\n  return newElements;\n}\n\nfunction _hasDecorators(element) {\n  return element.decorators && element.decorators.length;\n}\n\nfunction _isDataDescriptor(desc) {\n  return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n}\n\nfunction _optionalCallableProperty(obj, name) {\n  var value = obj[name];\n\n  if (value !== undefined && typeof value !== \"function\") {\n    throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n  }\n\n  return value;\n}\n\nfunction _classPrivateMethodGet(receiver, privateSet, fn) {\n  if (!privateSet.has(receiver)) {\n    throw new TypeError(\"attempted to get private field on non-instance\");\n  }\n\n  return fn;\n}\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) {\n  if (privateCollection.has(obj)) {\n    throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n  }\n}\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) {\n  _checkPrivateRedeclaration(obj, privateMap);\n\n  privateMap.set(obj, value);\n}\n\nfunction _classPrivateMethodInitSpec(obj, privateSet) {\n  _checkPrivateRedeclaration(obj, privateSet);\n\n  privateSet.add(obj);\n}\n\nfunction _classPrivateMethodSet() {\n  throw new TypeError(\"attempted to reassign private method\");\n}\n\nvar BasicObject = /*#__PURE__*/function () {\n  function BasicObject() {\n    _classCallCheck2(this, BasicObject);\n  }\n\n  _createClass2(BasicObject, null, [{\n    key: \"proxyMethod\",\n    value: function proxyMethod(expression) {\n      var _parseProxyMethodExpr = parseProxyMethodExpression(expression),\n          name = _parseProxyMethodExpr.name,\n          toMethod = _parseProxyMethodExpr.toMethod,\n          toProperty = _parseProxyMethodExpr.toProperty,\n          optional = _parseProxyMethodExpr.optional;\n\n      this.prototype[name] = function () {\n        var subject;\n        var object;\n\n        if (toMethod) {\n          if (optional) {\n            var _this$toMethod;\n\n            object = (_this$toMethod = this[toMethod]) === null || _this$toMethod === void 0 ? void 0 : _this$toMethod.call(this);\n          } else {\n            object = this[toMethod]();\n          }\n        } else if (toProperty) {\n          object = this[toProperty];\n        }\n\n        if (optional) {\n          var _object;\n\n          subject = (_object = object) === null || _object === void 0 ? void 0 : _object[name];\n\n          if (subject) {\n            return apply.call(subject, object, arguments);\n          }\n        } else {\n          subject = object[name];\n          return apply.call(subject, object, arguments);\n        }\n      };\n    }\n  }]);\n\n  return BasicObject;\n}();\n\nvar parseProxyMethodExpression = function parseProxyMethodExpression(expression) {\n  var match = expression.match(proxyMethodExpressionPattern);\n\n  if (!match) {\n    throw new Error(\"can't parse @proxyMethod expression: \".concat(expression));\n  }\n\n  var args = {\n    name: match[4]\n  };\n\n  if (match[2] != null) {\n    args.toMethod = match[1];\n  } else {\n    args.toProperty = match[1];\n  }\n\n  if (match[3] != null) {\n    args.optional = true;\n  }\n\n  return args;\n};\n\nvar apply = Function.prototype.apply;\nvar proxyMethodExpressionPattern = new RegExp(\"\\\n^\\\n(.+?)\\\n(\\\\(\\\\))?\\\n(\\\\?)?\\\n\\\\.\\\n(.+?)\\\n$\\\n\");\n\nvar _Array$from, _$codePointAt$1, _$1, _String$fromCodePoint;\n\nvar UTF16String = /*#__PURE__*/function (_BasicObject) {\n  _inherits2(UTF16String, _BasicObject);\n\n  var _super2 = _createSuper2(UTF16String);\n\n  function UTF16String(ucs2String, codepoints) {\n    var _this2;\n\n    _classCallCheck2(this, UTF16String);\n\n    _this2 = _super2.apply(this, arguments);\n    _this2.ucs2String = ucs2String;\n    _this2.codepoints = codepoints;\n    _this2.length = _this2.codepoints.length;\n    _this2.ucs2Length = _this2.ucs2String.length;\n    return _this2;\n  }\n\n  _createClass2(UTF16String, [{\n    key: \"offsetToUCS2Offset\",\n    value: function offsetToUCS2Offset(offset) {\n      return ucs2encode(this.codepoints.slice(0, Math.max(0, offset))).length;\n    }\n  }, {\n    key: \"offsetFromUCS2Offset\",\n    value: function offsetFromUCS2Offset(ucs2Offset) {\n      return ucs2decode(this.ucs2String.slice(0, Math.max(0, ucs2Offset))).length;\n    }\n  }, {\n    key: \"slice\",\n    value: function slice() {\n      var _this$codepoints;\n\n      return this.constructor.fromCodepoints((_this$codepoints = this.codepoints).slice.apply(_this$codepoints, arguments));\n    }\n  }, {\n    key: \"charAt\",\n    value: function charAt(offset) {\n      return this.slice(offset, offset + 1);\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(value) {\n      return this.constructor.box(value).ucs2String === this.ucs2String;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.ucs2String;\n    }\n  }, {\n    key: \"getCacheKey\",\n    value: function getCacheKey() {\n      return this.ucs2String;\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.ucs2String;\n    }\n  }], [{\n    key: \"box\",\n    value: function box() {\n      var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n\n      if (value instanceof this) {\n        return value;\n      } else {\n        return this.fromUCS2String(value === null || value === void 0 ? void 0 : value.toString());\n      }\n    }\n  }, {\n    key: \"fromUCS2String\",\n    value: function fromUCS2String(ucs2String) {\n      return new this(ucs2String, ucs2decode(ucs2String));\n    }\n  }, {\n    key: \"fromCodepoints\",\n    value: function fromCodepoints(codepoints) {\n      return new this(ucs2encode(codepoints), codepoints);\n    }\n  }]);\n\n  return UTF16String;\n}(BasicObject);\n\nvar hasArrayFrom = ((_Array$from = Array.from) === null || _Array$from === void 0 ? void 0 : _Array$from.call(Array, \"\\uD83D\\uDC7C\").length) === 1;\nvar hasStringCodePointAt$1 = ((_$codePointAt$1 = (_$1 = \" \").codePointAt) === null || _$codePointAt$1 === void 0 ? void 0 : _$codePointAt$1.call(_$1, 0)) != null;\nvar hasStringFromCodePoint = ((_String$fromCodePoint = String.fromCodePoint) === null || _String$fromCodePoint === void 0 ? void 0 : _String$fromCodePoint.call(String, 32, 128124)) === \" \\uD83D\\uDC7C\"; // UCS-2 conversion helpers ported from Mathias Bynens' Punycode.js:\n// https://github.com/bestiejs/punycode.js#punycodeucs2\n\nvar ucs2decode, ucs2encode; // Creates an array containing the numeric code points of each Unicode\n// character in the string. While JavaScript uses UCS-2 internally,\n// this function will convert a pair of surrogate halves (each of which\n// UCS-2 exposes as separate characters) into a single code point,\n// matching UTF-16.\n\nif (hasArrayFrom && hasStringCodePointAt$1) {\n  ucs2decode = function ucs2decode(string) {\n    return Array.from(string).map(function (char) {\n      return char.codePointAt(0);\n    });\n  };\n} else {\n  ucs2decode = function ucs2decode(string) {\n    var output = [];\n    var counter = 0;\n    var length = string.length;\n\n    while (counter < length) {\n      var value = string.charCodeAt(counter++);\n\n      if (0xd800 <= value && value <= 0xdbff && counter < length) {\n        // high surrogate, and there is a next character\n        var extra = string.charCodeAt(counter++);\n\n        if ((extra & 0xfc00) === 0xdc00) {\n          // low surrogate\n          value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n        } else {\n          // unmatched surrogate; only append this code unit, in case the\n          // next code unit is the high surrogate of a surrogate pair\n          counter--;\n        }\n      }\n\n      output.push(value);\n    }\n\n    return output;\n  };\n} // Creates a string based on an array of numeric code points.\n\n\nif (hasStringFromCodePoint) {\n  ucs2encode = function ucs2encode(array) {\n    return String.fromCodePoint.apply(String, _toConsumableArray2(Array.from(array || [])));\n  };\n} else {\n  ucs2encode = function ucs2encode(array) {\n    var characters = function () {\n      var result = [];\n      Array.from(array).forEach(function (value) {\n        var output = \"\";\n\n        if (value > 0xffff) {\n          value -= 0x10000;\n          output += String.fromCharCode(value >>> 10 & 0x3ff | 0xd800);\n          value = 0xdc00 | value & 0x3ff;\n        }\n\n        result.push(output + String.fromCharCode(value));\n      });\n      return result;\n    }();\n\n    return characters.join(\"\");\n  };\n}\n\nvar id$1 = 0;\n\nvar TrixObject = /*#__PURE__*/function (_BasicObject2) {\n  _inherits2(TrixObject, _BasicObject2);\n\n  var _super3 = _createSuper2(TrixObject);\n\n  function TrixObject() {\n    var _this3;\n\n    _classCallCheck2(this, TrixObject);\n\n    _this3 = _super3.apply(this, arguments);\n    _this3.id = ++id$1;\n    return _this3;\n  }\n\n  _createClass2(TrixObject, [{\n    key: \"hasSameConstructorAs\",\n    value: function hasSameConstructorAs(object) {\n      return this.constructor === (object === null || object === void 0 ? void 0 : object.constructor);\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(object) {\n      return this === object;\n    }\n  }, {\n    key: \"inspect\",\n    value: function inspect() {\n      var parts = [];\n      var contents = this.contentsForInspection() || {};\n\n      for (var key in contents) {\n        var value = contents[key];\n        parts.push(\"\".concat(key, \"=\").concat(value));\n      }\n\n      return \"#<\".concat(this.constructor.name, \":\").concat(this.id).concat(parts.length ? \" \".concat(parts.join(\", \")) : \"\", \">\");\n    }\n  }, {\n    key: \"contentsForInspection\",\n    value: function contentsForInspection() {}\n  }, {\n    key: \"toJSONString\",\n    value: function toJSONString() {\n      return JSON.stringify(this);\n    }\n  }, {\n    key: \"toUTF16String\",\n    value: function toUTF16String() {\n      return UTF16String.box(this);\n    }\n  }, {\n    key: \"getCacheKey\",\n    value: function getCacheKey() {\n      return this.id.toString();\n    }\n  }], [{\n    key: \"fromJSONString\",\n    value: function fromJSONString(jsonString) {\n      return this.fromJSON(JSON.parse(jsonString));\n    }\n  }]);\n\n  return TrixObject;\n}(BasicObject);\n/* eslint-disable\n    id-length,\n*/\n\n\nvar arraysAreEqual = function arraysAreEqual() {\n  var a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (var index = 0; index < a.length; index++) {\n    var value = a[index];\n\n    if (value !== b[index]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nvar arrayStartsWith = function arrayStartsWith() {\n  var a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return arraysAreEqual(a.slice(0, b.length), b);\n};\n\nvar spliceArray = function spliceArray(array) {\n  var result = array.slice(0);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  result.splice.apply(result, args);\n  return result;\n};\n\nvar summarizeArrayChange = function summarizeArrayChange() {\n  var oldArray = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var newArray = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  var added = [];\n  var removed = [];\n  var existingValues = new Set();\n  oldArray.forEach(function (value) {\n    existingValues.add(value);\n  });\n  var currentValues = new Set();\n  newArray.forEach(function (value) {\n    currentValues.add(value);\n\n    if (!existingValues.has(value)) {\n      added.push(value);\n    }\n  });\n  oldArray.forEach(function (value) {\n    if (!currentValues.has(value)) {\n      removed.push(value);\n    }\n  });\n  return {\n    added: added,\n    removed: removed\n  };\n};\n\nvar RTL_PATTERN = /[\\u05BE\\u05C0\\u05C3\\u05D0-\\u05EA\\u05F0-\\u05F4\\u061B\\u061F\\u0621-\\u063A\\u0640-\\u064A\\u066D\\u0671-\\u06B7\\u06BA-\\u06BE\\u06C0-\\u06CE\\u06D0-\\u06D5\\u06E5\\u06E6\\u200F\\u202B\\u202E\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE72\\uFE74\\uFE76-\\uFEFC]/;\n\nvar _getDirection = function () {\n  var input = makeElement(\"input\", {\n    dir: \"auto\",\n    name: \"x\",\n    dirName: \"x.dir\"\n  });\n  var form = makeElement(\"form\");\n  form.appendChild(input);\n\n  var supportsDirName = function () {\n    try {\n      return new FormData(form).has(input.dirName);\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  var supportsDirSelector = function () {\n    try {\n      return input.matches(\":dir(ltr),:dir(rtl)\");\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  if (supportsDirName) {\n    return function (string) {\n      input.value = string;\n      return new FormData(form).get(input.dirName);\n    };\n  } else if (supportsDirSelector) {\n    return function (string) {\n      input.value = string;\n\n      if (input.matches(\":dir(rtl)\")) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  } else {\n    return function (string) {\n      var char = string.trim().charAt(0);\n\n      if (RTL_PATTERN.test(char)) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  }\n}();\n\nvar allAttributeNames = null;\nvar blockAttributeNames = null;\nvar textAttributeNames = null;\nvar listAttributeNames = null;\n\nvar getAllAttributeNames = function getAllAttributeNames() {\n  if (!allAttributeNames) {\n    allAttributeNames = getTextAttributeNames().concat(getBlockAttributeNames());\n  }\n\n  return allAttributeNames;\n};\n\nvar getBlockConfig = function getBlockConfig(attributeName) {\n  return config.blockAttributes[attributeName];\n};\n\nvar getBlockAttributeNames = function getBlockAttributeNames() {\n  if (!blockAttributeNames) {\n    blockAttributeNames = Object.keys(config.blockAttributes);\n  }\n\n  return blockAttributeNames;\n};\n\nvar getTextConfig = function getTextConfig(attributeName) {\n  return config.textAttributes[attributeName];\n};\n\nvar getTextAttributeNames = function getTextAttributeNames() {\n  if (!textAttributeNames) {\n    textAttributeNames = Object.keys(config.textAttributes);\n  }\n\n  return textAttributeNames;\n};\n\nvar getListAttributeNames = function getListAttributeNames() {\n  if (!listAttributeNames) {\n    listAttributeNames = [];\n\n    for (var key in config.blockAttributes) {\n      var listAttribute = config.blockAttributes[key].listAttribute;\n\n      if (listAttribute != null) {\n        listAttributeNames.push(listAttribute);\n      }\n    }\n  }\n\n  return listAttributeNames;\n};\n/* eslint-disable\n*/\n\n\nvar installDefaultCSSForTagName = function installDefaultCSSForTagName(tagName, defaultCSS) {\n  var styleElement = insertStyleElementForTagName(tagName);\n  styleElement.textContent = defaultCSS.replace(/%t/g, tagName);\n};\n\nvar insertStyleElementForTagName = function insertStyleElementForTagName(tagName) {\n  var element = document.createElement(\"style\");\n  element.setAttribute(\"type\", \"text/css\");\n  element.setAttribute(\"data-tag-name\", tagName.toLowerCase());\n  var nonce = getCSPNonce();\n\n  if (nonce) {\n    element.setAttribute(\"nonce\", nonce);\n  }\n\n  document.head.insertBefore(element, document.head.firstChild);\n  return element;\n};\n\nvar getCSPNonce = function getCSPNonce() {\n  var element = getMetaElement(\"trix-csp-nonce\") || getMetaElement(\"csp-nonce\");\n\n  if (element) {\n    return element.getAttribute(\"content\");\n  }\n};\n\nvar getMetaElement = function getMetaElement(name) {\n  return document.head.querySelector(\"meta[name=\".concat(name, \"]\"));\n};\n\nvar testTransferData = {\n  \"application/x-trix-feature-detection\": \"test\"\n};\n\nvar dataTransferIsPlainText = function dataTransferIsPlainText(dataTransfer) {\n  var text = dataTransfer.getData(\"text/plain\");\n  var html = dataTransfer.getData(\"text/html\");\n\n  if (text && html) {\n    var _DOMParser$parseFromS = new DOMParser().parseFromString(html, \"text/html\"),\n        body = _DOMParser$parseFromS.body;\n\n    if (body.textContent === text) {\n      return !body.querySelector(\"*\");\n    }\n  } else {\n    return text === null || text === void 0 ? void 0 : text.length;\n  }\n};\n\nvar dataTransferIsWritable = function dataTransferIsWritable(dataTransfer) {\n  if (!(dataTransfer !== null && dataTransfer !== void 0 && dataTransfer.setData)) return false;\n\n  for (var key in testTransferData) {\n    var value = testTransferData[key];\n\n    try {\n      dataTransfer.setData(key, value);\n      if (!dataTransfer.getData(key) === value) return false;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nvar keyEventIsKeyboardCommand = function () {\n  if (/Mac|^iP/.test(navigator.platform)) {\n    return function (event) {\n      return event.metaKey;\n    };\n  } else {\n    return function (event) {\n      return event.ctrlKey;\n    };\n  }\n}();\n\nvar defer = function defer(fn) {\n  return setTimeout(fn, 1);\n};\n/* eslint-disable\n    id-length,\n*/\n\n\nvar copyObject = function copyObject() {\n  var object = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var result = {};\n\n  for (var key in object) {\n    var value = object[key];\n    result[key] = value;\n  }\n\n  return result;\n};\n\nvar objectsAreEqual = function objectsAreEqual() {\n  var a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (Object.keys(a).length !== Object.keys(b).length) {\n    return false;\n  }\n\n  for (var key in a) {\n    var value = a[key];\n\n    if (value !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nvar normalizeRange = function normalizeRange(range) {\n  if (range == null) return;\n\n  if (!Array.isArray(range)) {\n    range = [range, range];\n  }\n\n  return [copyValue(range[0]), copyValue(range[1] != null ? range[1] : range[0])];\n};\n\nvar rangeIsCollapsed = function rangeIsCollapsed(range) {\n  if (range == null) return;\n\n  var _normalizeRange = normalizeRange(range),\n      _normalizeRange2 = _slicedToArray2(_normalizeRange, 2),\n      start = _normalizeRange2[0],\n      end = _normalizeRange2[1];\n\n  return rangeValuesAreEqual(start, end);\n};\n\nvar rangesAreEqual = function rangesAreEqual(leftRange, rightRange) {\n  if (leftRange == null || rightRange == null) return;\n\n  var _normalizeRange3 = normalizeRange(leftRange),\n      _normalizeRange4 = _slicedToArray2(_normalizeRange3, 2),\n      leftStart = _normalizeRange4[0],\n      leftEnd = _normalizeRange4[1];\n\n  var _normalizeRange5 = normalizeRange(rightRange),\n      _normalizeRange6 = _slicedToArray2(_normalizeRange5, 2),\n      rightStart = _normalizeRange6[0],\n      rightEnd = _normalizeRange6[1];\n\n  return rangeValuesAreEqual(leftStart, rightStart) && rangeValuesAreEqual(leftEnd, rightEnd);\n};\n\nvar copyValue = function copyValue(value) {\n  if (typeof value === \"number\") {\n    return value;\n  } else {\n    return copyObject(value);\n  }\n};\n\nvar rangeValuesAreEqual = function rangeValuesAreEqual(left, right) {\n  if (typeof left === \"number\") {\n    return left === right;\n  } else {\n    return objectsAreEqual(left, right);\n  }\n};\n/* eslint-disable\n    id-length,\n*/\n\n\nvar SelectionChangeObserver = /*#__PURE__*/function (_BasicObject3) {\n  _inherits2(SelectionChangeObserver, _BasicObject3);\n\n  var _super4 = _createSuper2(SelectionChangeObserver);\n\n  function SelectionChangeObserver() {\n    var _this4;\n\n    _classCallCheck2(this, SelectionChangeObserver);\n\n    _this4 = _super4.apply(this, arguments);\n    _this4.update = _this4.update.bind(_assertThisInitialized2(_this4));\n    _this4.run = _this4.run.bind(_assertThisInitialized2(_this4));\n    _this4.selectionManagers = [];\n    return _this4;\n  }\n\n  _createClass2(SelectionChangeObserver, [{\n    key: \"start\",\n    value: function start() {\n      if (!this.started) {\n        this.started = true;\n\n        if (\"onselectionchange\" in document) {\n          return document.addEventListener(\"selectionchange\", this.update, true);\n        } else {\n          return this.run();\n        }\n      }\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      if (this.started) {\n        this.started = false;\n        return document.removeEventListener(\"selectionchange\", this.update, true);\n      }\n    }\n  }, {\n    key: \"registerSelectionManager\",\n    value: function registerSelectionManager(selectionManager) {\n      if (!this.selectionManagers.includes(selectionManager)) {\n        this.selectionManagers.push(selectionManager);\n        return this.start();\n      }\n    }\n  }, {\n    key: \"unregisterSelectionManager\",\n    value: function unregisterSelectionManager(selectionManager) {\n      this.selectionManagers = this.selectionManagers.filter(function (s) {\n        return s !== selectionManager;\n      });\n\n      if (this.selectionManagers.length === 0) {\n        return this.stop();\n      }\n    }\n  }, {\n    key: \"notifySelectionManagersOfSelectionChange\",\n    value: function notifySelectionManagersOfSelectionChange() {\n      return this.selectionManagers.map(function (selectionManager) {\n        return selectionManager.selectionDidChange();\n      });\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var domRange = getDOMRange();\n\n      if (!domRangesAreEqual(domRange, this.domRange)) {\n        this.domRange = domRange;\n        return this.notifySelectionManagersOfSelectionChange();\n      }\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.domRange = null;\n      return this.update();\n    } // Private\n\n  }, {\n    key: \"run\",\n    value: function run() {\n      if (this.started) {\n        this.update();\n        return requestAnimationFrame(this.run);\n      }\n    }\n  }]);\n\n  return SelectionChangeObserver;\n}(BasicObject);\n\nvar domRangesAreEqual = function domRangesAreEqual(left, right) {\n  return (left === null || left === void 0 ? void 0 : left.startContainer) === (right === null || right === void 0 ? void 0 : right.startContainer) && (left === null || left === void 0 ? void 0 : left.startOffset) === (right === null || right === void 0 ? void 0 : right.startOffset) && (left === null || left === void 0 ? void 0 : left.endContainer) === (right === null || right === void 0 ? void 0 : right.endContainer) && (left === null || left === void 0 ? void 0 : left.endOffset) === (right === null || right === void 0 ? void 0 : right.endOffset);\n};\n\nvar selectionChangeObserver = new SelectionChangeObserver();\n\nvar getDOMSelection = function getDOMSelection() {\n  var selection = window.getSelection();\n\n  if (selection.rangeCount > 0) {\n    return selection;\n  }\n};\n\nvar getDOMRange = function getDOMRange() {\n  var _getDOMSelection;\n\n  var domRange = (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.getRangeAt(0);\n\n  if (domRange) {\n    if (!domRangeIsPrivate(domRange)) {\n      return domRange;\n    }\n  }\n};\n\nvar setDOMRange = function setDOMRange(domRange) {\n  var selection = window.getSelection();\n  selection.removeAllRanges();\n  selection.addRange(domRange);\n  return selectionChangeObserver.update();\n}; // In Firefox, clicking certain <input> elements changes the selection to a\n// private element used to draw its UI. Attempting to access properties of those\n// elements throws an error.\n// https://bugzilla.mozilla.org/show_bug.cgi?id=208427\n\n\nvar domRangeIsPrivate = function domRangeIsPrivate(domRange) {\n  return nodeIsPrivate(domRange.startContainer) || nodeIsPrivate(domRange.endContainer);\n};\n\nvar nodeIsPrivate = function nodeIsPrivate(node) {\n  return !Object.getPrototypeOf(node);\n};\n/* eslint-disable\n    id-length,\n    no-useless-escape,\n*/\n\n\nvar normalizeSpaces = function normalizeSpaces(string) {\n  return string.replace(new RegExp(\"\".concat(ZERO_WIDTH_SPACE), \"g\"), \"\").replace(new RegExp(\"\".concat(NON_BREAKING_SPACE), \"g\"), \" \");\n};\n\nvar normalizeNewlines = function normalizeNewlines(string) {\n  return string.replace(/\\r\\n/g, \"\\n\");\n};\n\nvar breakableWhitespacePattern = new RegExp(\"[^\\\\S\".concat(NON_BREAKING_SPACE, \"]\"));\n\nvar squishBreakableWhitespace = function squishBreakableWhitespace(string) {\n  return string // Replace all breakable whitespace characters with a space\n  .replace(new RegExp(\"\".concat(breakableWhitespacePattern.source), \"g\"), \" \") // Replace two or more spaces with a single space\n  .replace(/\\ {2,}/g, \" \");\n};\n\nvar summarizeStringChange = function summarizeStringChange(oldString, newString) {\n  var added, removed;\n  oldString = UTF16String.box(oldString);\n  newString = UTF16String.box(newString);\n\n  if (newString.length < oldString.length) {\n    var _utf16StringDifferenc = utf16StringDifferences(oldString, newString);\n\n    var _utf16StringDifferenc2 = _slicedToArray2(_utf16StringDifferenc, 2);\n\n    removed = _utf16StringDifferenc2[0];\n    added = _utf16StringDifferenc2[1];\n  } else {\n    var _utf16StringDifferenc3 = utf16StringDifferences(newString, oldString);\n\n    var _utf16StringDifferenc4 = _slicedToArray2(_utf16StringDifferenc3, 2);\n\n    added = _utf16StringDifferenc4[0];\n    removed = _utf16StringDifferenc4[1];\n  }\n\n  return {\n    added: added,\n    removed: removed\n  };\n};\n\nvar utf16StringDifferences = function utf16StringDifferences(a, b) {\n  if (a.isEqualTo(b)) {\n    return [\"\", \"\"];\n  }\n\n  var diffA = utf16StringDifference(a, b);\n  var length = diffA.utf16String.length;\n  var diffB;\n\n  if (length) {\n    var offset = diffA.offset;\n    var codepoints = a.codepoints.slice(0, offset).concat(a.codepoints.slice(offset + length));\n    diffB = utf16StringDifference(b, UTF16String.fromCodepoints(codepoints));\n  } else {\n    diffB = utf16StringDifference(b, a);\n  }\n\n  return [diffA.utf16String.toString(), diffB.utf16String.toString()];\n};\n\nvar utf16StringDifference = function utf16StringDifference(a, b) {\n  var leftIndex = 0;\n  var rightIndexA = a.length;\n  var rightIndexB = b.length;\n\n  while (leftIndex < rightIndexA && a.charAt(leftIndex).isEqualTo(b.charAt(leftIndex))) {\n    leftIndex++;\n  }\n\n  while (rightIndexA > leftIndex + 1 && a.charAt(rightIndexA - 1).isEqualTo(b.charAt(rightIndexB - 1))) {\n    rightIndexA--;\n    rightIndexB--;\n  }\n\n  return {\n    utf16String: a.slice(leftIndex, rightIndexA),\n    offset: leftIndex\n  };\n};\n\nvar Hash = /*#__PURE__*/function (_TrixObject) {\n  _inherits2(Hash, _TrixObject);\n\n  var _super5 = _createSuper2(Hash);\n\n  function Hash() {\n    var _this5;\n\n    _classCallCheck2(this, Hash);\n\n    var values = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _this5 = _super5.apply(this, arguments);\n    _this5.values = copy(values);\n    return _this5;\n  }\n\n  _createClass2(Hash, [{\n    key: \"add\",\n    value: function add(key, value) {\n      return this.merge(object(key, value));\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(key) {\n      return new Hash(copy(this.values, key));\n    }\n  }, {\n    key: \"get\",\n    value: function get(key) {\n      return this.values[key];\n    }\n  }, {\n    key: \"has\",\n    value: function has(key) {\n      return key in this.values;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(values) {\n      return new Hash(_merge(this.values, unbox(values)));\n    }\n  }, {\n    key: \"slice\",\n    value: function slice(keys) {\n      var _this6 = this;\n\n      var values = {};\n      keys.forEach(function (key) {\n        if (_this6.has(key)) {\n          values[key] = _this6.values[key];\n        }\n      });\n      return new Hash(values);\n    }\n  }, {\n    key: \"getKeys\",\n    value: function getKeys() {\n      return Object.keys(this.values);\n    }\n  }, {\n    key: \"getKeysCommonToHash\",\n    value: function getKeysCommonToHash(hash) {\n      var _this7 = this;\n\n      hash = _box(hash);\n      return this.getKeys().filter(function (key) {\n        return _this7.values[key] === hash.values[key];\n      });\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(values) {\n      return arraysAreEqual(this.toArray(), _box(values).toArray());\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this.getKeys().length === 0;\n    }\n  }, {\n    key: \"toArray\",\n    value: function toArray() {\n      if (!this.array) {\n        var result = [];\n\n        for (var key in this.values) {\n          var value = this.values[key];\n          result.push(result.push(key, value));\n        }\n\n        this.array = result.slice(0);\n      }\n\n      return this.array;\n    }\n  }, {\n    key: \"toObject\",\n    value: function toObject() {\n      return copy(this.values);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.toObject();\n    }\n  }, {\n    key: \"contentsForInspection\",\n    value: function contentsForInspection() {\n      return {\n        values: JSON.stringify(this.values)\n      };\n    }\n  }], [{\n    key: \"fromCommonAttributesOfObjects\",\n    value: function fromCommonAttributesOfObjects() {\n      var objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n      if (!objects.length) {\n        return new this();\n      }\n\n      var hash = _box(objects[0]);\n\n      var keys = hash.getKeys();\n      objects.slice(1).forEach(function (object) {\n        keys = hash.getKeysCommonToHash(_box(object));\n        hash = hash.slice(keys);\n      });\n      return hash;\n    }\n  }, {\n    key: \"box\",\n    value: function box(values) {\n      return _box(values);\n    }\n  }]);\n\n  return Hash;\n}(TrixObject);\n\nvar object = function object(key, value) {\n  var result = {};\n  result[key] = value;\n  return result;\n};\n\nvar _merge = function _merge(object, values) {\n  var result = copy(object);\n\n  for (var key in values) {\n    var value = values[key];\n    result[key] = value;\n  }\n\n  return result;\n};\n\nvar copy = function copy(object, keyToRemove) {\n  var result = {};\n  var sortedKeys = Object.keys(object).sort();\n  sortedKeys.forEach(function (key) {\n    if (key !== keyToRemove) {\n      result[key] = object[key];\n    }\n  });\n  return result;\n};\n\nvar _box = function _box(object) {\n  if (object instanceof Hash) {\n    return object;\n  } else {\n    return new Hash(object);\n  }\n};\n\nvar unbox = function unbox(object) {\n  if (object instanceof Hash) {\n    return object.values;\n  } else {\n    return object;\n  }\n};\n\nvar Operation = /*#__PURE__*/function (_BasicObject4) {\n  _inherits2(Operation, _BasicObject4);\n\n  var _super6 = _createSuper2(Operation);\n\n  function Operation() {\n    _classCallCheck2(this, Operation);\n\n    return _super6.apply(this, arguments);\n  }\n\n  _createClass2(Operation, [{\n    key: \"isPerforming\",\n    value: function isPerforming() {\n      return this.performing === true;\n    }\n  }, {\n    key: \"hasPerformed\",\n    value: function hasPerformed() {\n      return this.performed === true;\n    }\n  }, {\n    key: \"hasSucceeded\",\n    value: function hasSucceeded() {\n      return this.performed && this.succeeded;\n    }\n  }, {\n    key: \"hasFailed\",\n    value: function hasFailed() {\n      return this.performed && !this.succeeded;\n    }\n  }, {\n    key: \"getPromise\",\n    value: function getPromise() {\n      var _this8 = this;\n\n      if (!this.promise) {\n        this.promise = new Promise(function (resolve, reject) {\n          _this8.performing = true;\n          return _this8.perform(function (succeeded, result) {\n            _this8.succeeded = succeeded;\n            _this8.performing = false;\n            _this8.performed = true;\n\n            if (_this8.succeeded) {\n              resolve(result);\n            } else {\n              reject(result);\n            }\n          });\n        });\n      }\n\n      return this.promise;\n    }\n  }, {\n    key: \"perform\",\n    value: function perform(callback) {\n      return callback(false);\n    }\n  }, {\n    key: \"release\",\n    value: function release() {\n      var _this$promise, _this$promise$cancel;\n\n      (_this$promise = this.promise) === null || _this$promise === void 0 ? void 0 : (_this$promise$cancel = _this$promise.cancel) === null || _this$promise$cancel === void 0 ? void 0 : _this$promise$cancel.call(_this$promise);\n      this.promise = null;\n      this.performing = null;\n      this.performed = null;\n      this.succeeded = null;\n    }\n  }]);\n\n  return Operation;\n}(BasicObject);\n\nOperation.proxyMethod(\"getPromise().then\");\nOperation.proxyMethod(\"getPromise().catch\");\n\nvar ImagePreloadOperation = /*#__PURE__*/function (_Operation) {\n  _inherits2(ImagePreloadOperation, _Operation);\n\n  var _super7 = _createSuper2(ImagePreloadOperation);\n\n  function ImagePreloadOperation(url) {\n    var _this9;\n\n    _classCallCheck2(this, ImagePreloadOperation);\n\n    _this9 = _super7.apply(this, arguments);\n    _this9.url = url;\n    return _this9;\n  }\n\n  _createClass2(ImagePreloadOperation, [{\n    key: \"perform\",\n    value: function perform(callback) {\n      var _this10 = this;\n\n      var image = new Image();\n\n      image.onload = function () {\n        image.width = _this10.width = image.naturalWidth;\n        image.height = _this10.height = image.naturalHeight;\n        return callback(true, image);\n      };\n\n      image.onerror = function () {\n        return callback(false);\n      };\n\n      image.src = this.url;\n    }\n  }]);\n\n  return ImagePreloadOperation;\n}(Operation);\n\nvar Attachment = /*#__PURE__*/function (_TrixObject2) {\n  _inherits2(Attachment, _TrixObject2);\n\n  var _super8 = _createSuper2(Attachment);\n\n  function Attachment() {\n    var _this11;\n\n    _classCallCheck2(this, Attachment);\n\n    var attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _this11 = _super8.call(this, attributes);\n    _this11.releaseFile = _this11.releaseFile.bind(_assertThisInitialized2(_this11));\n    _this11.attributes = Hash.box(attributes);\n\n    _this11.didChangeAttributes();\n\n    return _this11;\n  }\n\n  _createClass2(Attachment, [{\n    key: \"getAttribute\",\n    value: function getAttribute(attribute) {\n      return this.attributes.get(attribute);\n    }\n  }, {\n    key: \"hasAttribute\",\n    value: function hasAttribute(attribute) {\n      return this.attributes.has(attribute);\n    }\n  }, {\n    key: \"getAttributes\",\n    value: function getAttributes() {\n      return this.attributes.toObject();\n    }\n  }, {\n    key: \"setAttributes\",\n    value: function setAttributes() {\n      var attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var newAttributes = this.attributes.merge(attributes);\n\n      if (!this.attributes.isEqualTo(newAttributes)) {\n        var _this$previewDelegate, _this$previewDelegate2, _this$delegate, _this$delegate$attach;\n\n        this.attributes = newAttributes;\n        this.didChangeAttributes();\n        (_this$previewDelegate = this.previewDelegate) === null || _this$previewDelegate === void 0 ? void 0 : (_this$previewDelegate2 = _this$previewDelegate.attachmentDidChangeAttributes) === null || _this$previewDelegate2 === void 0 ? void 0 : _this$previewDelegate2.call(_this$previewDelegate, this);\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentDidChangeAttributes) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, this);\n      }\n    }\n  }, {\n    key: \"didChangeAttributes\",\n    value: function didChangeAttributes() {\n      if (this.isPreviewable()) {\n        return this.preloadURL();\n      }\n    }\n  }, {\n    key: \"isPending\",\n    value: function isPending() {\n      return this.file != null && !(this.getURL() || this.getHref());\n    }\n  }, {\n    key: \"isPreviewable\",\n    value: function isPreviewable() {\n      if (this.attributes.has(\"previewable\")) {\n        return this.attributes.get(\"previewable\");\n      } else {\n        return Attachment.previewablePattern.test(this.getContentType());\n      }\n    }\n  }, {\n    key: \"getType\",\n    value: function getType() {\n      if (this.hasContent()) {\n        return \"content\";\n      } else if (this.isPreviewable()) {\n        return \"preview\";\n      } else {\n        return \"file\";\n      }\n    }\n  }, {\n    key: \"getURL\",\n    value: function getURL() {\n      return this.attributes.get(\"url\");\n    }\n  }, {\n    key: \"getHref\",\n    value: function getHref() {\n      return this.attributes.get(\"href\");\n    }\n  }, {\n    key: \"getFilename\",\n    value: function getFilename() {\n      return this.attributes.get(\"filename\") || \"\";\n    }\n  }, {\n    key: \"getFilesize\",\n    value: function getFilesize() {\n      return this.attributes.get(\"filesize\");\n    }\n  }, {\n    key: \"getFormattedFilesize\",\n    value: function getFormattedFilesize() {\n      var filesize = this.attributes.get(\"filesize\");\n\n      if (typeof filesize === \"number\") {\n        return config.fileSize.formatter(filesize);\n      } else {\n        return \"\";\n      }\n    }\n  }, {\n    key: \"getExtension\",\n    value: function getExtension() {\n      var _this$getFilename$mat;\n\n      return (_this$getFilename$mat = this.getFilename().match(/\\.(\\w+)$/)) === null || _this$getFilename$mat === void 0 ? void 0 : _this$getFilename$mat[1].toLowerCase();\n    }\n  }, {\n    key: \"getContentType\",\n    value: function getContentType() {\n      return this.attributes.get(\"contentType\");\n    }\n  }, {\n    key: \"hasContent\",\n    value: function hasContent() {\n      return this.attributes.has(\"content\");\n    }\n  }, {\n    key: \"getContent\",\n    value: function getContent() {\n      return this.attributes.get(\"content\");\n    }\n  }, {\n    key: \"getWidth\",\n    value: function getWidth() {\n      return this.attributes.get(\"width\");\n    }\n  }, {\n    key: \"getHeight\",\n    value: function getHeight() {\n      return this.attributes.get(\"height\");\n    }\n  }, {\n    key: \"getFile\",\n    value: function getFile() {\n      return this.file;\n    }\n  }, {\n    key: \"setFile\",\n    value: function setFile(file) {\n      this.file = file;\n\n      if (this.isPreviewable()) {\n        return this.preloadFile();\n      }\n    }\n  }, {\n    key: \"releaseFile\",\n    value: function releaseFile() {\n      this.releasePreloadedFile();\n      this.file = null;\n    }\n  }, {\n    key: \"getUploadProgress\",\n    value: function getUploadProgress() {\n      return this.uploadProgress != null ? this.uploadProgress : 0;\n    }\n  }, {\n    key: \"setUploadProgress\",\n    value: function setUploadProgress(value) {\n      if (this.uploadProgress !== value) {\n        var _this$uploadProgressD, _this$uploadProgressD2;\n\n        this.uploadProgress = value;\n        return (_this$uploadProgressD = this.uploadProgressDelegate) === null || _this$uploadProgressD === void 0 ? void 0 : (_this$uploadProgressD2 = _this$uploadProgressD.attachmentDidChangeUploadProgress) === null || _this$uploadProgressD2 === void 0 ? void 0 : _this$uploadProgressD2.call(_this$uploadProgressD, this);\n      }\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.getAttributes();\n    }\n  }, {\n    key: \"getCacheKey\",\n    value: function getCacheKey() {\n      return [_get2(_getPrototypeOf2(Attachment.prototype), \"getCacheKey\", this).apply(this, arguments), this.attributes.getCacheKey(), this.getPreviewURL()].join(\"/\");\n    } // Previewable\n\n  }, {\n    key: \"getPreviewURL\",\n    value: function getPreviewURL() {\n      return this.previewURL || this.preloadingURL;\n    }\n  }, {\n    key: \"setPreviewURL\",\n    value: function setPreviewURL(url) {\n      if (url !== this.getPreviewURL()) {\n        var _this$previewDelegate3, _this$previewDelegate4, _this$delegate2, _this$delegate2$attac;\n\n        this.previewURL = url;\n        (_this$previewDelegate3 = this.previewDelegate) === null || _this$previewDelegate3 === void 0 ? void 0 : (_this$previewDelegate4 = _this$previewDelegate3.attachmentDidChangeAttributes) === null || _this$previewDelegate4 === void 0 ? void 0 : _this$previewDelegate4.call(_this$previewDelegate3, this);\n        return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentDidChangePreviewURL) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, this);\n      }\n    }\n  }, {\n    key: \"preloadURL\",\n    value: function preloadURL() {\n      return this.preload(this.getURL(), this.releaseFile);\n    }\n  }, {\n    key: \"preloadFile\",\n    value: function preloadFile() {\n      if (this.file) {\n        this.fileObjectURL = URL.createObjectURL(this.file);\n        return this.preload(this.fileObjectURL);\n      }\n    }\n  }, {\n    key: \"releasePreloadedFile\",\n    value: function releasePreloadedFile() {\n      if (this.fileObjectURL) {\n        URL.revokeObjectURL(this.fileObjectURL);\n        this.fileObjectURL = null;\n      }\n    }\n  }, {\n    key: \"preload\",\n    value: function preload(url, callback) {\n      var _this12 = this;\n\n      if (url && url !== this.getPreviewURL()) {\n        this.preloadingURL = url;\n        var operation = new ImagePreloadOperation(url);\n        return operation.then(function (_ref) {\n          var width = _ref.width,\n              height = _ref.height;\n\n          if (!_this12.getWidth() || !_this12.getHeight()) {\n            _this12.setAttributes({\n              width: width,\n              height: height\n            });\n          }\n\n          _this12.preloadingURL = null;\n\n          _this12.setPreviewURL(url);\n\n          return callback === null || callback === void 0 ? void 0 : callback();\n        }).catch(function () {\n          _this12.preloadingURL = null;\n          return callback === null || callback === void 0 ? void 0 : callback();\n        });\n      }\n    }\n  }], [{\n    key: \"attachmentForFile\",\n    value: function attachmentForFile(file) {\n      var attributes = this.attributesForFile(file);\n      var attachment = new this(attributes);\n      attachment.setFile(file);\n      return attachment;\n    }\n  }, {\n    key: \"attributesForFile\",\n    value: function attributesForFile(file) {\n      return new Hash({\n        filename: file.name,\n        filesize: file.size,\n        contentType: file.type\n      });\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function fromJSON(attachmentJSON) {\n      return new this(attachmentJSON);\n    }\n  }]);\n\n  return Attachment;\n}(TrixObject);\n\n_defineProperty(Attachment, \"previewablePattern\", /^image(\\/(gif|png|jpe?g)|$)/);\n\nvar ManagedAttachment = /*#__PURE__*/function (_BasicObject5) {\n  _inherits2(ManagedAttachment, _BasicObject5);\n\n  var _super9 = _createSuper2(ManagedAttachment);\n\n  function ManagedAttachment(attachmentManager, attachment) {\n    var _this13;\n\n    _classCallCheck2(this, ManagedAttachment);\n\n    _this13 = _super9.apply(this, arguments);\n    _this13.attachmentManager = attachmentManager;\n    _this13.attachment = attachment;\n    _this13.id = _this13.attachment.id;\n    _this13.file = _this13.attachment.file;\n    return _this13;\n  }\n\n  _createClass2(ManagedAttachment, [{\n    key: \"remove\",\n    value: function remove() {\n      return this.attachmentManager.requestRemovalOfAttachment(this.attachment);\n    }\n  }]);\n\n  return ManagedAttachment;\n}(BasicObject);\n\nManagedAttachment.proxyMethod(\"attachment.getAttribute\");\nManagedAttachment.proxyMethod(\"attachment.hasAttribute\");\nManagedAttachment.proxyMethod(\"attachment.setAttribute\");\nManagedAttachment.proxyMethod(\"attachment.getAttributes\");\nManagedAttachment.proxyMethod(\"attachment.setAttributes\");\nManagedAttachment.proxyMethod(\"attachment.isPending\");\nManagedAttachment.proxyMethod(\"attachment.isPreviewable\");\nManagedAttachment.proxyMethod(\"attachment.getURL\");\nManagedAttachment.proxyMethod(\"attachment.getHref\");\nManagedAttachment.proxyMethod(\"attachment.getFilename\");\nManagedAttachment.proxyMethod(\"attachment.getFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getFormattedFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getExtension\");\nManagedAttachment.proxyMethod(\"attachment.getContentType\");\nManagedAttachment.proxyMethod(\"attachment.getFile\");\nManagedAttachment.proxyMethod(\"attachment.setFile\");\nManagedAttachment.proxyMethod(\"attachment.releaseFile\");\nManagedAttachment.proxyMethod(\"attachment.getUploadProgress\");\nManagedAttachment.proxyMethod(\"attachment.setUploadProgress\");\n\nvar AttachmentManager = /*#__PURE__*/function (_BasicObject6) {\n  _inherits2(AttachmentManager, _BasicObject6);\n\n  var _super10 = _createSuper2(AttachmentManager);\n\n  function AttachmentManager() {\n    var _this14;\n\n    _classCallCheck2(this, AttachmentManager);\n\n    var attachments = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    _this14 = _super10.apply(this, arguments);\n    _this14.managedAttachments = {};\n    Array.from(attachments).forEach(function (attachment) {\n      _this14.manageAttachment(attachment);\n    });\n    return _this14;\n  }\n\n  _createClass2(AttachmentManager, [{\n    key: \"getAttachments\",\n    value: function getAttachments() {\n      var result = [];\n\n      for (var _id in this.managedAttachments) {\n        var attachment = this.managedAttachments[_id];\n        result.push(attachment);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"manageAttachment\",\n    value: function manageAttachment(attachment) {\n      if (!this.managedAttachments[attachment.id]) {\n        this.managedAttachments[attachment.id] = new ManagedAttachment(this, attachment);\n      }\n\n      return this.managedAttachments[attachment.id];\n    }\n  }, {\n    key: \"attachmentIsManaged\",\n    value: function attachmentIsManaged(attachment) {\n      return attachment.id in this.managedAttachments;\n    }\n  }, {\n    key: \"requestRemovalOfAttachment\",\n    value: function requestRemovalOfAttachment(attachment) {\n      if (this.attachmentIsManaged(attachment)) {\n        var _this$delegate, _this$delegate$attach;\n\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentManagerDidRequestRemovalOfAttachment) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, attachment);\n      }\n    }\n  }, {\n    key: \"unmanageAttachment\",\n    value: function unmanageAttachment(attachment) {\n      var managedAttachment = this.managedAttachments[attachment.id];\n      delete this.managedAttachments[attachment.id];\n      return managedAttachment;\n    }\n  }]);\n\n  return AttachmentManager;\n}(BasicObject);\n\nvar Piece = /*#__PURE__*/function (_TrixObject3) {\n  _inherits2(Piece, _TrixObject3);\n\n  var _super11 = _createSuper2(Piece);\n\n  function Piece(value) {\n    var _this15;\n\n    _classCallCheck2(this, Piece);\n\n    var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    _this15 = _super11.apply(this, arguments);\n    _this15.attributes = Hash.box(attributes);\n    return _this15;\n  }\n\n  _createClass2(Piece, [{\n    key: \"copyWithAttributes\",\n    value: function copyWithAttributes(attributes) {\n      return new this.constructor(this.getValue(), attributes);\n    }\n  }, {\n    key: \"copyWithAdditionalAttributes\",\n    value: function copyWithAdditionalAttributes(attributes) {\n      return this.copyWithAttributes(this.attributes.merge(attributes));\n    }\n  }, {\n    key: \"copyWithoutAttribute\",\n    value: function copyWithoutAttribute(attribute) {\n      return this.copyWithAttributes(this.attributes.remove(attribute));\n    }\n  }, {\n    key: \"copy\",\n    value: function copy() {\n      return this.copyWithAttributes(this.attributes);\n    }\n  }, {\n    key: \"getAttribute\",\n    value: function getAttribute(attribute) {\n      return this.attributes.get(attribute);\n    }\n  }, {\n    key: \"getAttributesHash\",\n    value: function getAttributesHash() {\n      return this.attributes;\n    }\n  }, {\n    key: \"getAttributes\",\n    value: function getAttributes() {\n      return this.attributes.toObject();\n    }\n  }, {\n    key: \"hasAttribute\",\n    value: function hasAttribute(attribute) {\n      return this.attributes.has(attribute);\n    }\n  }, {\n    key: \"hasSameStringValueAsPiece\",\n    value: function hasSameStringValueAsPiece(piece) {\n      return piece && this.toString() === piece.toString();\n    }\n  }, {\n    key: \"hasSameAttributesAsPiece\",\n    value: function hasSameAttributesAsPiece(piece) {\n      return piece && (this.attributes === piece.attributes || this.attributes.isEqualTo(piece.attributes));\n    }\n  }, {\n    key: \"isBlockBreak\",\n    value: function isBlockBreak() {\n      return false;\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(piece) {\n      return _get2(_getPrototypeOf2(Piece.prototype), \"isEqualTo\", this).apply(this, arguments) || this.hasSameConstructorAs(piece) && this.hasSameStringValueAsPiece(piece) && this.hasSameAttributesAsPiece(piece);\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this.length === 0;\n    }\n  }, {\n    key: \"isSerializable\",\n    value: function isSerializable() {\n      return true;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: this.constructor.type,\n        attributes: this.getAttributes()\n      };\n    }\n  }, {\n    key: \"contentsForInspection\",\n    value: function contentsForInspection() {\n      return {\n        type: this.constructor.type,\n        attributes: this.attributes.inspect()\n      };\n    } // Grouping\n\n  }, {\n    key: \"canBeGrouped\",\n    value: function canBeGrouped() {\n      return this.hasAttribute(\"href\");\n    }\n  }, {\n    key: \"canBeGroupedWith\",\n    value: function canBeGroupedWith(piece) {\n      return this.getAttribute(\"href\") === piece.getAttribute(\"href\");\n    } // Splittable\n\n  }, {\n    key: \"getLength\",\n    value: function getLength() {\n      return this.length;\n    }\n  }, {\n    key: \"canBeConsolidatedWith\",\n    value: function canBeConsolidatedWith(piece) {\n      return false;\n    }\n  }], [{\n    key: \"registerType\",\n    value: function registerType(type, constructor) {\n      constructor.type = type;\n      this.types[type] = constructor;\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function fromJSON(pieceJSON) {\n      var constructor = this.types[pieceJSON.type];\n\n      if (constructor) {\n        return constructor.fromJSON(pieceJSON);\n      }\n    }\n  }]);\n\n  return Piece;\n}(TrixObject);\n\n_defineProperty(Piece, \"types\", {});\n\nvar AttachmentPiece = /*#__PURE__*/function (_Piece) {\n  _inherits2(AttachmentPiece, _Piece);\n\n  var _super12 = _createSuper2(AttachmentPiece);\n\n  function AttachmentPiece(attachment) {\n    var _this16;\n\n    _classCallCheck2(this, AttachmentPiece);\n\n    _this16 = _super12.apply(this, arguments);\n    _this16.attachment = attachment;\n    _this16.length = 1;\n\n    _this16.ensureAttachmentExclusivelyHasAttribute(\"href\");\n\n    if (!_this16.attachment.hasContent()) {\n      _this16.removeProhibitedAttributes();\n    }\n\n    return _this16;\n  }\n\n  _createClass2(AttachmentPiece, [{\n    key: \"ensureAttachmentExclusivelyHasAttribute\",\n    value: function ensureAttachmentExclusivelyHasAttribute(attribute) {\n      if (this.hasAttribute(attribute)) {\n        if (!this.attachment.hasAttribute(attribute)) {\n          this.attachment.setAttributes(this.attributes.slice(attribute));\n        }\n\n        this.attributes = this.attributes.remove(attribute);\n      }\n    }\n  }, {\n    key: \"removeProhibitedAttributes\",\n    value: function removeProhibitedAttributes() {\n      var attributes = this.attributes.slice(AttachmentPiece.permittedAttributes);\n\n      if (!attributes.isEqualTo(this.attributes)) {\n        this.attributes = attributes;\n      }\n    }\n  }, {\n    key: \"getValue\",\n    value: function getValue() {\n      return this.attachment;\n    }\n  }, {\n    key: \"isSerializable\",\n    value: function isSerializable() {\n      return !this.attachment.isPending();\n    }\n  }, {\n    key: \"getCaption\",\n    value: function getCaption() {\n      return this.attributes.get(\"caption\") || \"\";\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(piece) {\n      var _piece$attachment;\n\n      return _get2(_getPrototypeOf2(AttachmentPiece.prototype), \"isEqualTo\", this).call(this, piece) && this.attachment.id === (piece === null || piece === void 0 ? void 0 : (_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id);\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return OBJECT_REPLACEMENT_CHARACTER;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      var json = _get2(_getPrototypeOf2(AttachmentPiece.prototype), \"toJSON\", this).apply(this, arguments);\n\n      json.attachment = this.attachment;\n      return json;\n    }\n  }, {\n    key: \"getCacheKey\",\n    value: function getCacheKey() {\n      return [_get2(_getPrototypeOf2(AttachmentPiece.prototype), \"getCacheKey\", this).apply(this, arguments), this.attachment.getCacheKey()].join(\"/\");\n    }\n  }, {\n    key: \"toConsole\",\n    value: function toConsole() {\n      return JSON.stringify(this.toString());\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(pieceJSON) {\n      return new this(Attachment.fromJSON(pieceJSON.attachment), pieceJSON.attributes);\n    }\n  }]);\n\n  return AttachmentPiece;\n}(Piece);\n\n_defineProperty(AttachmentPiece, \"permittedAttributes\", [\"caption\", \"presentation\"]);\n\nPiece.registerType(\"attachment\", AttachmentPiece);\n\nvar StringPiece = /*#__PURE__*/function (_Piece2) {\n  _inherits2(StringPiece, _Piece2);\n\n  var _super13 = _createSuper2(StringPiece);\n\n  function StringPiece(string) {\n    var _this17;\n\n    _classCallCheck2(this, StringPiece);\n\n    _this17 = _super13.apply(this, arguments);\n    _this17.string = normalizeNewlines(string);\n    _this17.length = _this17.string.length;\n    return _this17;\n  }\n\n  _createClass2(StringPiece, [{\n    key: \"getValue\",\n    value: function getValue() {\n      return this.string;\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.string.toString();\n    }\n  }, {\n    key: \"isBlockBreak\",\n    value: function isBlockBreak() {\n      return this.toString() === \"\\n\" && this.getAttribute(\"blockBreak\") === true;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      var result = _get2(_getPrototypeOf2(StringPiece.prototype), \"toJSON\", this).apply(this, arguments);\n\n      result.string = this.string;\n      return result;\n    } // Splittable\n\n  }, {\n    key: \"canBeConsolidatedWith\",\n    value: function canBeConsolidatedWith(piece) {\n      return piece && this.hasSameConstructorAs(piece) && this.hasSameAttributesAsPiece(piece);\n    }\n  }, {\n    key: \"consolidateWith\",\n    value: function consolidateWith(piece) {\n      return new this.constructor(this.toString() + piece.toString(), this.attributes);\n    }\n  }, {\n    key: \"splitAtOffset\",\n    value: function splitAtOffset(offset) {\n      var left, right;\n\n      if (offset === 0) {\n        left = null;\n        right = this;\n      } else if (offset === this.length) {\n        left = this;\n        right = null;\n      } else {\n        left = new this.constructor(this.string.slice(0, offset), this.attributes);\n        right = new this.constructor(this.string.slice(offset), this.attributes);\n      }\n\n      return [left, right];\n    }\n  }, {\n    key: \"toConsole\",\n    value: function toConsole() {\n      var string = this.string;\n\n      if (string.length > 15) {\n        string = string.slice(0, 14) + \"…\";\n      }\n\n      return JSON.stringify(string.toString());\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(pieceJSON) {\n      return new this(pieceJSON.string, pieceJSON.attributes);\n    }\n  }]);\n\n  return StringPiece;\n}(Piece);\n\nPiece.registerType(\"string\", StringPiece);\n/* eslint-disable\n    prefer-const,\n*/\n\nvar SplittableList = /*#__PURE__*/function (_TrixObject4) {\n  _inherits2(SplittableList, _TrixObject4);\n\n  var _super14 = _createSuper2(SplittableList);\n\n  function SplittableList() {\n    var _this18;\n\n    _classCallCheck2(this, SplittableList);\n\n    var objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    _this18 = _super14.apply(this, arguments);\n    _this18.objects = objects.slice(0);\n    _this18.length = _this18.objects.length;\n    return _this18;\n  }\n\n  _createClass2(SplittableList, [{\n    key: \"indexOf\",\n    value: function indexOf(object) {\n      return this.objects.indexOf(object);\n    }\n  }, {\n    key: \"splice\",\n    value: function splice() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return new this.constructor(spliceArray.apply(void 0, [this.objects].concat(args)));\n    }\n  }, {\n    key: \"eachObject\",\n    value: function eachObject(callback) {\n      return this.objects.map(function (object, index) {\n        return callback(object, index);\n      });\n    }\n  }, {\n    key: \"insertObjectAtIndex\",\n    value: function insertObjectAtIndex(object, index) {\n      return this.splice(index, 0, object);\n    }\n  }, {\n    key: \"insertSplittableListAtIndex\",\n    value: function insertSplittableListAtIndex(splittableList, index) {\n      return this.splice.apply(this, [index, 0].concat(_toConsumableArray2(splittableList.objects)));\n    }\n  }, {\n    key: \"insertSplittableListAtPosition\",\n    value: function insertSplittableListAtPosition(splittableList, position) {\n      var _this$splitObjectAtPo = this.splitObjectAtPosition(position),\n          _this$splitObjectAtPo2 = _slicedToArray2(_this$splitObjectAtPo, 2),\n          objects = _this$splitObjectAtPo2[0],\n          index = _this$splitObjectAtPo2[1];\n\n      return new this.constructor(objects).insertSplittableListAtIndex(splittableList, index);\n    }\n  }, {\n    key: \"editObjectAtIndex\",\n    value: function editObjectAtIndex(index, callback) {\n      return this.replaceObjectAtIndex(callback(this.objects[index]), index);\n    }\n  }, {\n    key: \"replaceObjectAtIndex\",\n    value: function replaceObjectAtIndex(object, index) {\n      return this.splice(index, 1, object);\n    }\n  }, {\n    key: \"removeObjectAtIndex\",\n    value: function removeObjectAtIndex(index) {\n      return this.splice(index, 1);\n    }\n  }, {\n    key: \"getObjectAtIndex\",\n    value: function getObjectAtIndex(index) {\n      return this.objects[index];\n    }\n  }, {\n    key: \"getSplittableListInRange\",\n    value: function getSplittableListInRange(range) {\n      var _this$splitObjectsAtR = this.splitObjectsAtRange(range),\n          _this$splitObjectsAtR2 = _slicedToArray2(_this$splitObjectsAtR, 3),\n          objects = _this$splitObjectsAtR2[0],\n          leftIndex = _this$splitObjectsAtR2[1],\n          rightIndex = _this$splitObjectsAtR2[2];\n\n      return new this.constructor(objects.slice(leftIndex, rightIndex + 1));\n    }\n  }, {\n    key: \"selectSplittableList\",\n    value: function selectSplittableList(test) {\n      var objects = this.objects.filter(function (object) {\n        return test(object);\n      });\n      return new this.constructor(objects);\n    }\n  }, {\n    key: \"removeObjectsInRange\",\n    value: function removeObjectsInRange(range) {\n      var _this$splitObjectsAtR3 = this.splitObjectsAtRange(range),\n          _this$splitObjectsAtR4 = _slicedToArray2(_this$splitObjectsAtR3, 3),\n          objects = _this$splitObjectsAtR4[0],\n          leftIndex = _this$splitObjectsAtR4[1],\n          rightIndex = _this$splitObjectsAtR4[2];\n\n      return new this.constructor(objects).splice(leftIndex, rightIndex - leftIndex + 1);\n    }\n  }, {\n    key: \"transformObjectsInRange\",\n    value: function transformObjectsInRange(range, transform) {\n      var _this$splitObjectsAtR5 = this.splitObjectsAtRange(range),\n          _this$splitObjectsAtR6 = _slicedToArray2(_this$splitObjectsAtR5, 3),\n          objects = _this$splitObjectsAtR6[0],\n          leftIndex = _this$splitObjectsAtR6[1],\n          rightIndex = _this$splitObjectsAtR6[2];\n\n      var transformedObjects = objects.map(function (object, index) {\n        return leftIndex <= index && index <= rightIndex ? transform(object) : object;\n      });\n      return new this.constructor(transformedObjects);\n    }\n  }, {\n    key: \"splitObjectsAtRange\",\n    value: function splitObjectsAtRange(range) {\n      var rightOuterIndex;\n\n      var _this$splitObjectAtPo3 = this.splitObjectAtPosition(startOfRange(range)),\n          _this$splitObjectAtPo4 = _slicedToArray2(_this$splitObjectAtPo3, 3),\n          objects = _this$splitObjectAtPo4[0],\n          leftInnerIndex = _this$splitObjectAtPo4[1],\n          offset = _this$splitObjectAtPo4[2];\n\n      var _this$constructor$spl = new this.constructor(objects).splitObjectAtPosition(endOfRange(range) + offset);\n\n      var _this$constructor$spl2 = _slicedToArray2(_this$constructor$spl, 2);\n\n      objects = _this$constructor$spl2[0];\n      rightOuterIndex = _this$constructor$spl2[1];\n      return [objects, leftInnerIndex, rightOuterIndex - 1];\n    }\n  }, {\n    key: \"getObjectAtPosition\",\n    value: function getObjectAtPosition(position) {\n      var _this$findIndexAndOff = this.findIndexAndOffsetAtPosition(position),\n          index = _this$findIndexAndOff.index;\n\n      return this.objects[index];\n    }\n  }, {\n    key: \"splitObjectAtPosition\",\n    value: function splitObjectAtPosition(position) {\n      var splitIndex, splitOffset;\n\n      var _this$findIndexAndOff2 = this.findIndexAndOffsetAtPosition(position),\n          index = _this$findIndexAndOff2.index,\n          offset = _this$findIndexAndOff2.offset;\n\n      var objects = this.objects.slice(0);\n\n      if (index != null) {\n        if (offset === 0) {\n          splitIndex = index;\n          splitOffset = 0;\n        } else {\n          var _object2 = this.getObjectAtIndex(index);\n\n          var _object2$splitAtOffse = _object2.splitAtOffset(offset),\n              _object2$splitAtOffse2 = _slicedToArray2(_object2$splitAtOffse, 2),\n              leftObject = _object2$splitAtOffse2[0],\n              rightObject = _object2$splitAtOffse2[1];\n\n          objects.splice(index, 1, leftObject, rightObject);\n          splitIndex = index + 1;\n          splitOffset = leftObject.getLength() - offset;\n        }\n      } else {\n        splitIndex = objects.length;\n        splitOffset = 0;\n      }\n\n      return [objects, splitIndex, splitOffset];\n    }\n  }, {\n    key: \"consolidate\",\n    value: function consolidate() {\n      var objects = [];\n      var pendingObject = this.objects[0];\n      this.objects.slice(1).forEach(function (object) {\n        var _pendingObject$canBeC, _pendingObject;\n\n        if ((_pendingObject$canBeC = (_pendingObject = pendingObject).canBeConsolidatedWith) !== null && _pendingObject$canBeC !== void 0 && _pendingObject$canBeC.call(_pendingObject, object)) {\n          pendingObject = pendingObject.consolidateWith(object);\n        } else {\n          objects.push(pendingObject);\n          pendingObject = object;\n        }\n      });\n\n      if (pendingObject) {\n        objects.push(pendingObject);\n      }\n\n      return new this.constructor(objects);\n    }\n  }, {\n    key: \"consolidateFromIndexToIndex\",\n    value: function consolidateFromIndexToIndex(startIndex, endIndex) {\n      var objects = this.objects.slice(0);\n      var objectsInRange = objects.slice(startIndex, endIndex + 1);\n      var consolidatedInRange = new this.constructor(objectsInRange).consolidate().toArray();\n      return this.splice.apply(this, [startIndex, objectsInRange.length].concat(_toConsumableArray2(consolidatedInRange)));\n    }\n  }, {\n    key: \"findIndexAndOffsetAtPosition\",\n    value: function findIndexAndOffsetAtPosition(position) {\n      var index;\n      var currentPosition = 0;\n\n      for (index = 0; index < this.objects.length; index++) {\n        var _object3 = this.objects[index];\n\n        var nextPosition = currentPosition + _object3.getLength();\n\n        if (currentPosition <= position && position < nextPosition) {\n          return {\n            index: index,\n            offset: position - currentPosition\n          };\n        }\n\n        currentPosition = nextPosition;\n      }\n\n      return {\n        index: null,\n        offset: null\n      };\n    }\n  }, {\n    key: \"findPositionAtIndexAndOffset\",\n    value: function findPositionAtIndexAndOffset(index, offset) {\n      var position = 0;\n\n      for (var currentIndex = 0; currentIndex < this.objects.length; currentIndex++) {\n        var _object4 = this.objects[currentIndex];\n\n        if (currentIndex < index) {\n          position += _object4.getLength();\n        } else if (currentIndex === index) {\n          position += offset;\n          break;\n        }\n      }\n\n      return position;\n    }\n  }, {\n    key: \"getEndPosition\",\n    value: function getEndPosition() {\n      var _this19 = this;\n\n      if (this.endPosition == null) {\n        this.endPosition = 0;\n        this.objects.forEach(function (object) {\n          return _this19.endPosition += object.getLength();\n        });\n      }\n\n      return this.endPosition;\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.objects.join(\"\");\n    }\n  }, {\n    key: \"toArray\",\n    value: function toArray() {\n      return this.objects.slice(0);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.toArray();\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(splittableList) {\n      return _get2(_getPrototypeOf2(SplittableList.prototype), \"isEqualTo\", this).apply(this, arguments) || objectArraysAreEqual(this.objects, splittableList === null || splittableList === void 0 ? void 0 : splittableList.objects);\n    }\n  }, {\n    key: \"contentsForInspection\",\n    value: function contentsForInspection() {\n      return {\n        objects: \"[\".concat(this.objects.map(function (object) {\n          return object.inspect();\n        }).join(\", \"), \"]\")\n      };\n    }\n  }], [{\n    key: \"box\",\n    value: function box(objects) {\n      if (objects instanceof this) {\n        return objects;\n      } else {\n        return new this(objects);\n      }\n    }\n  }]);\n\n  return SplittableList;\n}(TrixObject);\n\nvar objectArraysAreEqual = function objectArraysAreEqual(left) {\n  var right = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (left.length !== right.length) {\n    return false;\n  }\n\n  var result = true;\n\n  for (var index = 0; index < left.length; index++) {\n    var _object5 = left[index];\n\n    if (result && !_object5.isEqualTo(right[index])) {\n      result = false;\n    }\n  }\n\n  return result;\n};\n\nvar startOfRange = function startOfRange(range) {\n  return range[0];\n};\n\nvar endOfRange = function endOfRange(range) {\n  return range[1];\n};\n\nvar Text = /*#__PURE__*/function (_TrixObject5) {\n  _inherits2(Text, _TrixObject5);\n\n  var _super15 = _createSuper2(Text);\n\n  function Text() {\n    var _this20;\n\n    _classCallCheck2(this, Text);\n\n    var pieces = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    _this20 = _super15.apply(this, arguments);\n    var notEmpty = pieces.filter(function (piece) {\n      return !piece.isEmpty();\n    });\n    _this20.pieceList = new SplittableList(notEmpty);\n    return _this20;\n  }\n\n  _createClass2(Text, [{\n    key: \"copy\",\n    value: function copy() {\n      return this.copyWithPieceList(this.pieceList);\n    }\n  }, {\n    key: \"copyWithPieceList\",\n    value: function copyWithPieceList(pieceList) {\n      return new this.constructor(pieceList.consolidate().toArray());\n    }\n  }, {\n    key: \"copyUsingObjectMap\",\n    value: function copyUsingObjectMap(objectMap) {\n      var pieces = this.getPieces().map(function (piece) {\n        return objectMap.find(piece) || piece;\n      });\n      return new this.constructor(pieces);\n    }\n  }, {\n    key: \"appendText\",\n    value: function appendText(text) {\n      return this.insertTextAtPosition(text, this.getLength());\n    }\n  }, {\n    key: \"insertTextAtPosition\",\n    value: function insertTextAtPosition(text, position) {\n      return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(text.pieceList, position));\n    }\n  }, {\n    key: \"removeTextAtRange\",\n    value: function removeTextAtRange(range) {\n      return this.copyWithPieceList(this.pieceList.removeObjectsInRange(range));\n    }\n  }, {\n    key: \"replaceTextAtRange\",\n    value: function replaceTextAtRange(text, range) {\n      return this.removeTextAtRange(range).insertTextAtPosition(text, range[0]);\n    }\n  }, {\n    key: \"moveTextFromRangeToPosition\",\n    value: function moveTextFromRangeToPosition(range, position) {\n      if (range[0] <= position && position <= range[1]) return;\n      var text = this.getTextAtRange(range);\n      var length = text.getLength();\n\n      if (range[0] < position) {\n        position -= length;\n      }\n\n      return this.removeTextAtRange(range).insertTextAtPosition(text, position);\n    }\n  }, {\n    key: \"addAttributeAtRange\",\n    value: function addAttributeAtRange(attribute, value, range) {\n      var attributes = {};\n      attributes[attribute] = value;\n      return this.addAttributesAtRange(attributes, range);\n    }\n  }, {\n    key: \"addAttributesAtRange\",\n    value: function addAttributesAtRange(attributes, range) {\n      return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, function (piece) {\n        return piece.copyWithAdditionalAttributes(attributes);\n      }));\n    }\n  }, {\n    key: \"removeAttributeAtRange\",\n    value: function removeAttributeAtRange(attribute, range) {\n      return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, function (piece) {\n        return piece.copyWithoutAttribute(attribute);\n      }));\n    }\n  }, {\n    key: \"setAttributesAtRange\",\n    value: function setAttributesAtRange(attributes, range) {\n      return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, function (piece) {\n        return piece.copyWithAttributes(attributes);\n      }));\n    }\n  }, {\n    key: \"getAttributesAtPosition\",\n    value: function getAttributesAtPosition(position) {\n      var _this$pieceList$getOb;\n\n      return ((_this$pieceList$getOb = this.pieceList.getObjectAtPosition(position)) === null || _this$pieceList$getOb === void 0 ? void 0 : _this$pieceList$getOb.getAttributes()) || {};\n    }\n  }, {\n    key: \"getCommonAttributes\",\n    value: function getCommonAttributes() {\n      var objects = Array.from(this.pieceList.toArray()).map(function (piece) {\n        return piece.getAttributes();\n      });\n      return Hash.fromCommonAttributesOfObjects(objects).toObject();\n    }\n  }, {\n    key: \"getCommonAttributesAtRange\",\n    value: function getCommonAttributesAtRange(range) {\n      return this.getTextAtRange(range).getCommonAttributes() || {};\n    }\n  }, {\n    key: \"getExpandedRangeForAttributeAtOffset\",\n    value: function getExpandedRangeForAttributeAtOffset(attributeName, offset) {\n      var right;\n      var left = right = offset;\n      var length = this.getLength();\n\n      while (left > 0 && this.getCommonAttributesAtRange([left - 1, right])[attributeName]) {\n        left--;\n      }\n\n      while (right < length && this.getCommonAttributesAtRange([offset, right + 1])[attributeName]) {\n        right++;\n      }\n\n      return [left, right];\n    }\n  }, {\n    key: \"getTextAtRange\",\n    value: function getTextAtRange(range) {\n      return this.copyWithPieceList(this.pieceList.getSplittableListInRange(range));\n    }\n  }, {\n    key: \"getStringAtRange\",\n    value: function getStringAtRange(range) {\n      return this.pieceList.getSplittableListInRange(range).toString();\n    }\n  }, {\n    key: \"getStringAtPosition\",\n    value: function getStringAtPosition(position) {\n      return this.getStringAtRange([position, position + 1]);\n    }\n  }, {\n    key: \"startsWithString\",\n    value: function startsWithString(string) {\n      return this.getStringAtRange([0, string.length]) === string;\n    }\n  }, {\n    key: \"endsWithString\",\n    value: function endsWithString(string) {\n      var length = this.getLength();\n      return this.getStringAtRange([length - string.length, length]) === string;\n    }\n  }, {\n    key: \"getAttachmentPieces\",\n    value: function getAttachmentPieces() {\n      return this.pieceList.toArray().filter(function (piece) {\n        return !!piece.attachment;\n      });\n    }\n  }, {\n    key: \"getAttachments\",\n    value: function getAttachments() {\n      return this.getAttachmentPieces().map(function (piece) {\n        return piece.attachment;\n      });\n    }\n  }, {\n    key: \"getAttachmentAndPositionById\",\n    value: function getAttachmentAndPositionById(attachmentId) {\n      var position = 0;\n\n      var _iterator = _createForOfIteratorHelper2(this.pieceList.toArray()),\n          _step2;\n\n      try {\n        for (_iterator.s(); !(_step2 = _iterator.n()).done;) {\n          var piece = _step2.value;\n\n          var _piece$attachment;\n\n          if (((_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id) === attachmentId) {\n            return {\n              attachment: piece.attachment,\n              position: position\n            };\n          }\n\n          position += piece.length;\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return {\n        attachment: null,\n        position: null\n      };\n    }\n  }, {\n    key: \"getAttachmentById\",\n    value: function getAttachmentById(attachmentId) {\n      var _this$getAttachmentAn = this.getAttachmentAndPositionById(attachmentId),\n          attachment = _this$getAttachmentAn.attachment;\n\n      return attachment;\n    }\n  }, {\n    key: \"getRangeOfAttachment\",\n    value: function getRangeOfAttachment(attachment) {\n      var attachmentAndPosition = this.getAttachmentAndPositionById(attachment.id);\n      var position = attachmentAndPosition.position;\n      attachment = attachmentAndPosition.attachment;\n\n      if (attachment) {\n        return [position, position + 1];\n      }\n    }\n  }, {\n    key: \"updateAttributesForAttachment\",\n    value: function updateAttributesForAttachment(attributes, attachment) {\n      var range = this.getRangeOfAttachment(attachment);\n\n      if (range) {\n        return this.addAttributesAtRange(attributes, range);\n      } else {\n        return this;\n      }\n    }\n  }, {\n    key: \"getLength\",\n    value: function getLength() {\n      return this.pieceList.getEndPosition();\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this.getLength() === 0;\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(text) {\n      var _text$pieceList;\n\n      return _get2(_getPrototypeOf2(Text.prototype), \"isEqualTo\", this).call(this, text) || (text === null || text === void 0 ? void 0 : (_text$pieceList = text.pieceList) === null || _text$pieceList === void 0 ? void 0 : _text$pieceList.isEqualTo(this.pieceList));\n    }\n  }, {\n    key: \"isBlockBreak\",\n    value: function isBlockBreak() {\n      return this.getLength() === 1 && this.pieceList.getObjectAtIndex(0).isBlockBreak();\n    }\n  }, {\n    key: \"eachPiece\",\n    value: function eachPiece(callback) {\n      return this.pieceList.eachObject(callback);\n    }\n  }, {\n    key: \"getPieces\",\n    value: function getPieces() {\n      return this.pieceList.toArray();\n    }\n  }, {\n    key: \"getPieceAtPosition\",\n    value: function getPieceAtPosition(position) {\n      return this.pieceList.getObjectAtPosition(position);\n    }\n  }, {\n    key: \"contentsForInspection\",\n    value: function contentsForInspection() {\n      return {\n        pieceList: this.pieceList.inspect()\n      };\n    }\n  }, {\n    key: \"toSerializableText\",\n    value: function toSerializableText() {\n      var pieceList = this.pieceList.selectSplittableList(function (piece) {\n        return piece.isSerializable();\n      });\n      return this.copyWithPieceList(pieceList);\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.pieceList.toString();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.pieceList.toJSON();\n    }\n  }, {\n    key: \"toConsole\",\n    value: function toConsole() {\n      return JSON.stringify(this.pieceList.toArray().map(function (piece) {\n        return JSON.parse(piece.toConsole());\n      }));\n    } // BIDI\n\n  }, {\n    key: \"getDirection\",\n    value: function getDirection() {\n      return _getDirection(this.toString());\n    }\n  }, {\n    key: \"isRTL\",\n    value: function isRTL() {\n      return this.getDirection() === \"rtl\";\n    }\n  }], [{\n    key: \"textForAttachmentWithAttributes\",\n    value: function textForAttachmentWithAttributes(attachment, attributes) {\n      var piece = new AttachmentPiece(attachment, attributes);\n      return new this([piece]);\n    }\n  }, {\n    key: \"textForStringWithAttributes\",\n    value: function textForStringWithAttributes(string, attributes) {\n      var piece = new StringPiece(string, attributes);\n      return new this([piece]);\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function fromJSON(textJSON) {\n      var pieces = Array.from(textJSON).map(function (pieceJSON) {\n        return Piece.fromJSON(pieceJSON);\n      });\n      return new this(pieces);\n    }\n  }]);\n\n  return Text;\n}(TrixObject);\n\nvar Block = /*#__PURE__*/function (_TrixObject6) {\n  _inherits2(Block, _TrixObject6);\n\n  var _super16 = _createSuper2(Block);\n\n  function Block(text, attributes) {\n    var _this21;\n\n    _classCallCheck2(this, Block);\n\n    _this21 = _super16.apply(this, arguments);\n    _this21.text = applyBlockBreakToText(text || new Text());\n    _this21.attributes = attributes || [];\n    return _this21;\n  }\n\n  _createClass2(Block, [{\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return this.text.isBlockBreak();\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(block) {\n      if (_get2(_getPrototypeOf2(Block.prototype), \"isEqualTo\", this).call(this, block)) return true;\n      return this.text.isEqualTo(block === null || block === void 0 ? void 0 : block.text) && arraysAreEqual(this.attributes, block === null || block === void 0 ? void 0 : block.attributes);\n    }\n  }, {\n    key: \"copyWithText\",\n    value: function copyWithText(text) {\n      return new Block(text, this.attributes);\n    }\n  }, {\n    key: \"copyWithoutText\",\n    value: function copyWithoutText() {\n      return this.copyWithText(null);\n    }\n  }, {\n    key: \"copyWithAttributes\",\n    value: function copyWithAttributes(attributes) {\n      return new Block(this.text, attributes);\n    }\n  }, {\n    key: \"copyWithoutAttributes\",\n    value: function copyWithoutAttributes() {\n      return this.copyWithAttributes(null);\n    }\n  }, {\n    key: \"copyUsingObjectMap\",\n    value: function copyUsingObjectMap(objectMap) {\n      var mappedText = objectMap.find(this.text);\n\n      if (mappedText) {\n        return this.copyWithText(mappedText);\n      } else {\n        return this.copyWithText(this.text.copyUsingObjectMap(objectMap));\n      }\n    }\n  }, {\n    key: \"addAttribute\",\n    value: function addAttribute(attribute) {\n      var attributes = this.attributes.concat(expandAttribute(attribute));\n      return this.copyWithAttributes(attributes);\n    }\n  }, {\n    key: \"removeAttribute\",\n    value: function removeAttribute(attribute) {\n      var _getBlockConfig4 = getBlockConfig(attribute),\n          listAttribute = _getBlockConfig4.listAttribute;\n\n      var attributes = removeLastValue(removeLastValue(this.attributes, attribute), listAttribute);\n      return this.copyWithAttributes(attributes);\n    }\n  }, {\n    key: \"removeLastAttribute\",\n    value: function removeLastAttribute() {\n      return this.removeAttribute(this.getLastAttribute());\n    }\n  }, {\n    key: \"getLastAttribute\",\n    value: function getLastAttribute() {\n      return getLastElement(this.attributes);\n    }\n  }, {\n    key: \"getAttributes\",\n    value: function getAttributes() {\n      return this.attributes.slice(0);\n    }\n  }, {\n    key: \"getAttributeLevel\",\n    value: function getAttributeLevel() {\n      return this.attributes.length;\n    }\n  }, {\n    key: \"getAttributeAtLevel\",\n    value: function getAttributeAtLevel(level) {\n      return this.attributes[level - 1];\n    }\n  }, {\n    key: \"hasAttribute\",\n    value: function hasAttribute(attributeName) {\n      return this.attributes.includes(attributeName);\n    }\n  }, {\n    key: \"hasAttributes\",\n    value: function hasAttributes() {\n      return this.getAttributeLevel() > 0;\n    }\n  }, {\n    key: \"getLastNestableAttribute\",\n    value: function getLastNestableAttribute() {\n      return getLastElement(this.getNestableAttributes());\n    }\n  }, {\n    key: \"getNestableAttributes\",\n    value: function getNestableAttributes() {\n      return this.attributes.filter(function (attribute) {\n        return getBlockConfig(attribute).nestable;\n      });\n    }\n  }, {\n    key: \"getNestingLevel\",\n    value: function getNestingLevel() {\n      return this.getNestableAttributes().length;\n    }\n  }, {\n    key: \"decreaseNestingLevel\",\n    value: function decreaseNestingLevel() {\n      var attribute = this.getLastNestableAttribute();\n\n      if (attribute) {\n        return this.removeAttribute(attribute);\n      } else {\n        return this;\n      }\n    }\n  }, {\n    key: \"increaseNestingLevel\",\n    value: function increaseNestingLevel() {\n      var attribute = this.getLastNestableAttribute();\n\n      if (attribute) {\n        var index = this.attributes.lastIndexOf(attribute);\n\n        var _attributes = spliceArray.apply(void 0, [this.attributes, index + 1, 0].concat(_toConsumableArray2(expandAttribute(attribute))));\n\n        return this.copyWithAttributes(_attributes);\n      } else {\n        return this;\n      }\n    }\n  }, {\n    key: \"getListItemAttributes\",\n    value: function getListItemAttributes() {\n      return this.attributes.filter(function (attribute) {\n        return getBlockConfig(attribute).listAttribute;\n      });\n    }\n  }, {\n    key: \"isListItem\",\n    value: function isListItem() {\n      var _getBlockConfig;\n\n      return (_getBlockConfig = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.listAttribute;\n    }\n  }, {\n    key: \"isTerminalBlock\",\n    value: function isTerminalBlock() {\n      var _getBlockConfig2;\n\n      return (_getBlockConfig2 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig2 === void 0 ? void 0 : _getBlockConfig2.terminal;\n    }\n  }, {\n    key: \"breaksOnReturn\",\n    value: function breaksOnReturn() {\n      var _getBlockConfig3;\n\n      return (_getBlockConfig3 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig3 === void 0 ? void 0 : _getBlockConfig3.breakOnReturn;\n    }\n  }, {\n    key: \"findLineBreakInDirectionFromPosition\",\n    value: function findLineBreakInDirectionFromPosition(direction, position) {\n      var string = this.toString();\n      var result;\n\n      switch (direction) {\n        case \"forward\":\n          result = string.indexOf(\"\\n\", position);\n          break;\n\n        case \"backward\":\n          result = string.slice(0, position).lastIndexOf(\"\\n\");\n      }\n\n      if (result !== -1) {\n        return result;\n      }\n    }\n  }, {\n    key: \"contentsForInspection\",\n    value: function contentsForInspection() {\n      return {\n        text: this.text.inspect(),\n        attributes: this.attributes\n      };\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.text.toString();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        text: this.text,\n        attributes: this.attributes\n      };\n    } // BIDI\n\n  }, {\n    key: \"getDirection\",\n    value: function getDirection() {\n      return this.text.getDirection();\n    }\n  }, {\n    key: \"isRTL\",\n    value: function isRTL() {\n      return this.text.isRTL();\n    } // Splittable\n\n  }, {\n    key: \"getLength\",\n    value: function getLength() {\n      return this.text.getLength();\n    }\n  }, {\n    key: \"canBeConsolidatedWith\",\n    value: function canBeConsolidatedWith(block) {\n      return !this.hasAttributes() && !block.hasAttributes() && this.getDirection() === block.getDirection();\n    }\n  }, {\n    key: \"consolidateWith\",\n    value: function consolidateWith(block) {\n      var newlineText = Text.textForStringWithAttributes(\"\\n\");\n      var text = this.getTextWithoutBlockBreak().appendText(newlineText);\n      return this.copyWithText(text.appendText(block.text));\n    }\n  }, {\n    key: \"splitAtOffset\",\n    value: function splitAtOffset(offset) {\n      var left, right;\n\n      if (offset === 0) {\n        left = null;\n        right = this;\n      } else if (offset === this.getLength()) {\n        left = this;\n        right = null;\n      } else {\n        left = this.copyWithText(this.text.getTextAtRange([0, offset]));\n        right = this.copyWithText(this.text.getTextAtRange([offset, this.getLength()]));\n      }\n\n      return [left, right];\n    }\n  }, {\n    key: \"getBlockBreakPosition\",\n    value: function getBlockBreakPosition() {\n      return this.text.getLength() - 1;\n    }\n  }, {\n    key: \"getTextWithoutBlockBreak\",\n    value: function getTextWithoutBlockBreak() {\n      if (textEndsInBlockBreak(this.text)) {\n        return this.text.getTextAtRange([0, this.getBlockBreakPosition()]);\n      } else {\n        return this.text.copy();\n      }\n    } // Grouping\n\n  }, {\n    key: \"canBeGrouped\",\n    value: function canBeGrouped(depth) {\n      return this.attributes[depth];\n    }\n  }, {\n    key: \"canBeGroupedWith\",\n    value: function canBeGroupedWith(otherBlock, depth) {\n      var otherAttributes = otherBlock.getAttributes();\n      var otherAttribute = otherAttributes[depth];\n      var attribute = this.attributes[depth];\n      return attribute === otherAttribute && !(getBlockConfig(attribute).group === false && !getListAttributeNames().includes(otherAttributes[depth + 1])) && (this.getDirection() === otherBlock.getDirection() || otherBlock.isEmpty());\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(blockJSON) {\n      var text = Text.fromJSON(blockJSON.text);\n      return new this(text, blockJSON.attributes);\n    }\n  }]);\n\n  return Block;\n}(TrixObject); // Block breaks\n\n\nvar applyBlockBreakToText = function applyBlockBreakToText(text) {\n  text = unmarkExistingInnerBlockBreaksInText(text);\n  text = addBlockBreakToText(text);\n  return text;\n};\n\nvar unmarkExistingInnerBlockBreaksInText = function unmarkExistingInnerBlockBreaksInText(text) {\n  var modified = false;\n  var pieces = text.getPieces();\n  var innerPieces = pieces.slice(0, pieces.length - 1);\n  var lastPiece = pieces[pieces.length - 1];\n  if (!lastPiece) return text;\n  innerPieces = innerPieces.map(function (piece) {\n    if (piece.isBlockBreak()) {\n      modified = true;\n      return unmarkBlockBreakPiece(piece);\n    } else {\n      return piece;\n    }\n  });\n\n  if (modified) {\n    return new Text([].concat(_toConsumableArray2(innerPieces), [lastPiece]));\n  } else {\n    return text;\n  }\n};\n\nvar blockBreakText = Text.textForStringWithAttributes(\"\\n\", {\n  blockBreak: true\n});\n\nvar addBlockBreakToText = function addBlockBreakToText(text) {\n  if (textEndsInBlockBreak(text)) {\n    return text;\n  } else {\n    return text.appendText(blockBreakText);\n  }\n};\n\nvar textEndsInBlockBreak = function textEndsInBlockBreak(text) {\n  var length = text.getLength();\n\n  if (length === 0) {\n    return false;\n  }\n\n  var endText = text.getTextAtRange([length - 1, length]);\n  return endText.isBlockBreak();\n};\n\nvar unmarkBlockBreakPiece = function unmarkBlockBreakPiece(piece) {\n  return piece.copyWithoutAttribute(\"blockBreak\");\n}; // Attributes\n\n\nvar expandAttribute = function expandAttribute(attribute) {\n  var _getBlockConfig5 = getBlockConfig(attribute),\n      listAttribute = _getBlockConfig5.listAttribute;\n\n  if (listAttribute) {\n    return [listAttribute, attribute];\n  } else {\n    return [attribute];\n  }\n}; // Array helpers\n\n\nvar getLastElement = function getLastElement(array) {\n  return array.slice(-1)[0];\n};\n\nvar removeLastValue = function removeLastValue(array, value) {\n  var index = array.lastIndexOf(value);\n\n  if (index === -1) {\n    return array;\n  } else {\n    return spliceArray(array, index, 1);\n  }\n};\n\nvar ObjectMap = /*#__PURE__*/function (_BasicObject7) {\n  _inherits2(ObjectMap, _BasicObject7);\n\n  var _super17 = _createSuper2(ObjectMap);\n\n  function ObjectMap() {\n    var _this22;\n\n    _classCallCheck2(this, ObjectMap);\n\n    var objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    _this22 = _super17.apply(this, arguments);\n    _this22.objects = {};\n    Array.from(objects).forEach(function (object) {\n      var hash = JSON.stringify(object);\n\n      if (_this22.objects[hash] == null) {\n        _this22.objects[hash] = object;\n      }\n    });\n    return _this22;\n  }\n\n  _createClass2(ObjectMap, [{\n    key: \"find\",\n    value: function find(object) {\n      var hash = JSON.stringify(object);\n      return this.objects[hash];\n    }\n  }]);\n\n  return ObjectMap;\n}(BasicObject);\n\nvar Document = /*#__PURE__*/function (_TrixObject7) {\n  _inherits2(Document, _TrixObject7);\n\n  var _super18 = _createSuper2(Document);\n\n  function Document() {\n    var _this23;\n\n    _classCallCheck2(this, Document);\n\n    var blocks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    _this23 = _super18.apply(this, arguments);\n\n    if (blocks.length === 0) {\n      blocks = [new Block()];\n    }\n\n    _this23.blockList = SplittableList.box(blocks);\n    return _this23;\n  }\n\n  _createClass2(Document, [{\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      var block = this.getBlockAtIndex(0);\n      return this.blockList.length === 1 && block.isEmpty() && !block.hasAttributes();\n    }\n  }, {\n    key: \"copy\",\n    value: function copy() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var blocks = options.consolidateBlocks ? this.blockList.consolidate().toArray() : this.blockList.toArray();\n      return new this.constructor(blocks);\n    }\n  }, {\n    key: \"copyUsingObjectsFromDocument\",\n    value: function copyUsingObjectsFromDocument(sourceDocument) {\n      var objectMap = new ObjectMap(sourceDocument.getObjects());\n      return this.copyUsingObjectMap(objectMap);\n    }\n  }, {\n    key: \"copyUsingObjectMap\",\n    value: function copyUsingObjectMap(objectMap) {\n      var blocks = this.getBlocks().map(function (block) {\n        var mappedBlock = objectMap.find(block);\n        return mappedBlock || block.copyUsingObjectMap(objectMap);\n      });\n      return new this.constructor(blocks);\n    }\n  }, {\n    key: \"copyWithBaseBlockAttributes\",\n    value: function copyWithBaseBlockAttributes() {\n      var blockAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var blocks = this.getBlocks().map(function (block) {\n        var attributes = blockAttributes.concat(block.getAttributes());\n        return block.copyWithAttributes(attributes);\n      });\n      return new this.constructor(blocks);\n    }\n  }, {\n    key: \"replaceBlock\",\n    value: function replaceBlock(oldBlock, newBlock) {\n      var index = this.blockList.indexOf(oldBlock);\n\n      if (index === -1) {\n        return this;\n      }\n\n      return new this.constructor(this.blockList.replaceObjectAtIndex(newBlock, index));\n    }\n  }, {\n    key: \"insertDocumentAtRange\",\n    value: function insertDocumentAtRange(document, range) {\n      var blockList = document.blockList;\n      range = normalizeRange(range);\n\n      var _range = range,\n          _range2 = _slicedToArray2(_range, 1),\n          position = _range2[0];\n\n      var _this$locationFromPos = this.locationFromPosition(position),\n          index = _this$locationFromPos.index,\n          offset = _this$locationFromPos.offset;\n\n      var result = this;\n      var block = this.getBlockAtPosition(position);\n\n      if (rangeIsCollapsed(range) && block.isEmpty() && !block.hasAttributes()) {\n        result = new this.constructor(result.blockList.removeObjectAtIndex(index));\n      } else if (block.getBlockBreakPosition() === offset) {\n        position++;\n      }\n\n      result = result.removeTextAtRange(range);\n      return new this.constructor(result.blockList.insertSplittableListAtPosition(blockList, position));\n    }\n  }, {\n    key: \"mergeDocumentAtRange\",\n    value: function mergeDocumentAtRange(document, range) {\n      var formattedDocument, result;\n      range = normalizeRange(range);\n\n      var _range3 = range,\n          _range4 = _slicedToArray2(_range3, 1),\n          startPosition = _range4[0];\n\n      var startLocation = this.locationFromPosition(startPosition);\n      var blockAttributes = this.getBlockAtIndex(startLocation.index).getAttributes();\n      var baseBlockAttributes = document.getBaseBlockAttributes();\n      var trailingBlockAttributes = blockAttributes.slice(-baseBlockAttributes.length);\n\n      if (arraysAreEqual(baseBlockAttributes, trailingBlockAttributes)) {\n        var leadingBlockAttributes = blockAttributes.slice(0, -baseBlockAttributes.length);\n        formattedDocument = document.copyWithBaseBlockAttributes(leadingBlockAttributes);\n      } else {\n        formattedDocument = document.copy({\n          consolidateBlocks: true\n        }).copyWithBaseBlockAttributes(blockAttributes);\n      }\n\n      var blockCount = formattedDocument.getBlockCount();\n      var firstBlock = formattedDocument.getBlockAtIndex(0);\n\n      if (arraysAreEqual(blockAttributes, firstBlock.getAttributes())) {\n        var firstText = firstBlock.getTextWithoutBlockBreak();\n        result = this.insertTextAtRange(firstText, range);\n\n        if (blockCount > 1) {\n          formattedDocument = new this.constructor(formattedDocument.getBlocks().slice(1));\n          var position = startPosition + firstText.getLength();\n          result = result.insertDocumentAtRange(formattedDocument, position);\n        }\n      } else {\n        result = this.insertDocumentAtRange(formattedDocument, range);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"insertTextAtRange\",\n    value: function insertTextAtRange(text, range) {\n      range = normalizeRange(range);\n\n      var _range5 = range,\n          _range6 = _slicedToArray2(_range5, 1),\n          startPosition = _range6[0];\n\n      var _this$locationFromPos2 = this.locationFromPosition(startPosition),\n          index = _this$locationFromPos2.index,\n          offset = _this$locationFromPos2.offset;\n\n      var document = this.removeTextAtRange(range);\n      return new this.constructor(document.blockList.editObjectAtIndex(index, function (block) {\n        return block.copyWithText(block.text.insertTextAtPosition(text, offset));\n      }));\n    }\n  }, {\n    key: \"removeTextAtRange\",\n    value: function removeTextAtRange(range) {\n      var blocks;\n      range = normalizeRange(range);\n\n      var _range7 = range,\n          _range8 = _slicedToArray2(_range7, 2),\n          leftPosition = _range8[0],\n          rightPosition = _range8[1];\n\n      if (rangeIsCollapsed(range)) {\n        return this;\n      }\n\n      var _Array$from2 = Array.from(this.locationRangeFromRange(range)),\n          _Array$from3 = _slicedToArray2(_Array$from2, 2),\n          leftLocation = _Array$from3[0],\n          rightLocation = _Array$from3[1];\n\n      var leftIndex = leftLocation.index;\n      var leftOffset = leftLocation.offset;\n      var leftBlock = this.getBlockAtIndex(leftIndex);\n      var rightIndex = rightLocation.index;\n      var rightOffset = rightLocation.offset;\n      var rightBlock = this.getBlockAtIndex(rightIndex);\n      var removeRightNewline = rightPosition - leftPosition === 1 && leftBlock.getBlockBreakPosition() === leftOffset && rightBlock.getBlockBreakPosition() !== rightOffset && rightBlock.text.getStringAtPosition(rightOffset) === \"\\n\";\n\n      if (removeRightNewline) {\n        blocks = this.blockList.editObjectAtIndex(rightIndex, function (block) {\n          return block.copyWithText(block.text.removeTextAtRange([rightOffset, rightOffset + 1]));\n        });\n      } else {\n        var block;\n        var leftText = leftBlock.text.getTextAtRange([0, leftOffset]);\n        var rightText = rightBlock.text.getTextAtRange([rightOffset, rightBlock.getLength()]);\n        var text = leftText.appendText(rightText);\n        var removingLeftBlock = leftIndex !== rightIndex && leftOffset === 0;\n        var useRightBlock = removingLeftBlock && leftBlock.getAttributeLevel() >= rightBlock.getAttributeLevel();\n\n        if (useRightBlock) {\n          block = rightBlock.copyWithText(text);\n        } else {\n          block = leftBlock.copyWithText(text);\n        }\n\n        var affectedBlockCount = rightIndex + 1 - leftIndex;\n        blocks = this.blockList.splice(leftIndex, affectedBlockCount, block);\n      }\n\n      return new this.constructor(blocks);\n    }\n  }, {\n    key: \"moveTextFromRangeToPosition\",\n    value: function moveTextFromRangeToPosition(range, position) {\n      var text;\n      range = normalizeRange(range);\n\n      var _range9 = range,\n          _range10 = _slicedToArray2(_range9, 2),\n          startPosition = _range10[0],\n          endPosition = _range10[1];\n\n      if (startPosition <= position && position <= endPosition) {\n        return this;\n      }\n\n      var document = this.getDocumentAtRange(range);\n      var result = this.removeTextAtRange(range);\n      var movingRightward = startPosition < position;\n\n      if (movingRightward) {\n        position -= document.getLength();\n      }\n\n      var _document$getBlocks = document.getBlocks(),\n          _document$getBlocks2 = _toArray2(_document$getBlocks),\n          firstBlock = _document$getBlocks2[0],\n          blocks = _document$getBlocks2.slice(1);\n\n      if (blocks.length === 0) {\n        text = firstBlock.getTextWithoutBlockBreak();\n\n        if (movingRightward) {\n          position += 1;\n        }\n      } else {\n        text = firstBlock.text;\n      }\n\n      result = result.insertTextAtRange(text, position);\n\n      if (blocks.length === 0) {\n        return result;\n      }\n\n      document = new this.constructor(blocks);\n      position += text.getLength();\n      return result.insertDocumentAtRange(document, position);\n    }\n  }, {\n    key: \"addAttributeAtRange\",\n    value: function addAttributeAtRange(attribute, value, range) {\n      var blockList = this.blockList;\n      this.eachBlockAtRange(range, function (block, textRange, index) {\n        return blockList = blockList.editObjectAtIndex(index, function () {\n          if (getBlockConfig(attribute)) {\n            return block.addAttribute(attribute, value);\n          } else {\n            if (textRange[0] === textRange[1]) {\n              return block;\n            } else {\n              return block.copyWithText(block.text.addAttributeAtRange(attribute, value, textRange));\n            }\n          }\n        });\n      });\n      return new this.constructor(blockList);\n    }\n  }, {\n    key: \"addAttribute\",\n    value: function addAttribute(attribute, value) {\n      var blockList = this.blockList;\n      this.eachBlock(function (block, index) {\n        return blockList = blockList.editObjectAtIndex(index, function () {\n          return block.addAttribute(attribute, value);\n        });\n      });\n      return new this.constructor(blockList);\n    }\n  }, {\n    key: \"removeAttributeAtRange\",\n    value: function removeAttributeAtRange(attribute, range) {\n      var blockList = this.blockList;\n      this.eachBlockAtRange(range, function (block, textRange, index) {\n        if (getBlockConfig(attribute)) {\n          blockList = blockList.editObjectAtIndex(index, function () {\n            return block.removeAttribute(attribute);\n          });\n        } else if (textRange[0] !== textRange[1]) {\n          blockList = blockList.editObjectAtIndex(index, function () {\n            return block.copyWithText(block.text.removeAttributeAtRange(attribute, textRange));\n          });\n        }\n      });\n      return new this.constructor(blockList);\n    }\n  }, {\n    key: \"updateAttributesForAttachment\",\n    value: function updateAttributesForAttachment(attributes, attachment) {\n      var range = this.getRangeOfAttachment(attachment);\n\n      var _Array$from4 = Array.from(range),\n          _Array$from5 = _slicedToArray2(_Array$from4, 1),\n          startPosition = _Array$from5[0];\n\n      var _this$locationFromPos3 = this.locationFromPosition(startPosition),\n          index = _this$locationFromPos3.index;\n\n      var text = this.getTextAtIndex(index);\n      return new this.constructor(this.blockList.editObjectAtIndex(index, function (block) {\n        return block.copyWithText(text.updateAttributesForAttachment(attributes, attachment));\n      }));\n    }\n  }, {\n    key: \"removeAttributeForAttachment\",\n    value: function removeAttributeForAttachment(attribute, attachment) {\n      var range = this.getRangeOfAttachment(attachment);\n      return this.removeAttributeAtRange(attribute, range);\n    }\n  }, {\n    key: \"insertBlockBreakAtRange\",\n    value: function insertBlockBreakAtRange(range) {\n      var blocks;\n      range = normalizeRange(range);\n\n      var _range11 = range,\n          _range12 = _slicedToArray2(_range11, 1),\n          startPosition = _range12[0];\n\n      var _this$locationFromPos4 = this.locationFromPosition(startPosition),\n          offset = _this$locationFromPos4.offset;\n\n      var document = this.removeTextAtRange(range);\n\n      if (offset === 0) {\n        blocks = [new Block()];\n      }\n\n      return new this.constructor(document.blockList.insertSplittableListAtPosition(new SplittableList(blocks), startPosition));\n    }\n  }, {\n    key: \"applyBlockAttributeAtRange\",\n    value: function applyBlockAttributeAtRange(attributeName, value, range) {\n      var expanded = this.expandRangeToLineBreaksAndSplitBlocks(range);\n      var document = expanded.document;\n      range = expanded.range;\n      var blockConfig = getBlockConfig(attributeName);\n\n      if (blockConfig.listAttribute) {\n        document = document.removeLastListAttributeAtRange(range, {\n          exceptAttributeName: attributeName\n        });\n        var converted = document.convertLineBreaksToBlockBreaksInRange(range);\n        document = converted.document;\n        range = converted.range;\n      } else if (blockConfig.exclusive) {\n        document = document.removeBlockAttributesAtRange(range);\n      } else if (blockConfig.terminal) {\n        document = document.removeLastTerminalAttributeAtRange(range);\n      } else {\n        document = document.consolidateBlocksAtRange(range);\n      }\n\n      return document.addAttributeAtRange(attributeName, value, range);\n    }\n  }, {\n    key: \"removeLastListAttributeAtRange\",\n    value: function removeLastListAttributeAtRange(range) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var blockList = this.blockList;\n      this.eachBlockAtRange(range, function (block, textRange, index) {\n        var lastAttributeName = block.getLastAttribute();\n\n        if (!lastAttributeName) {\n          return;\n        }\n\n        if (!getBlockConfig(lastAttributeName).listAttribute) {\n          return;\n        }\n\n        if (lastAttributeName === options.exceptAttributeName) {\n          return;\n        }\n\n        blockList = blockList.editObjectAtIndex(index, function () {\n          return block.removeAttribute(lastAttributeName);\n        });\n      });\n      return new this.constructor(blockList);\n    }\n  }, {\n    key: \"removeLastTerminalAttributeAtRange\",\n    value: function removeLastTerminalAttributeAtRange(range) {\n      var blockList = this.blockList;\n      this.eachBlockAtRange(range, function (block, textRange, index) {\n        var lastAttributeName = block.getLastAttribute();\n\n        if (!lastAttributeName) {\n          return;\n        }\n\n        if (!getBlockConfig(lastAttributeName).terminal) {\n          return;\n        }\n\n        blockList = blockList.editObjectAtIndex(index, function () {\n          return block.removeAttribute(lastAttributeName);\n        });\n      });\n      return new this.constructor(blockList);\n    }\n  }, {\n    key: \"removeBlockAttributesAtRange\",\n    value: function removeBlockAttributesAtRange(range) {\n      var blockList = this.blockList;\n      this.eachBlockAtRange(range, function (block, textRange, index) {\n        if (block.hasAttributes()) {\n          blockList = blockList.editObjectAtIndex(index, function () {\n            return block.copyWithoutAttributes();\n          });\n        }\n      });\n      return new this.constructor(blockList);\n    }\n  }, {\n    key: \"expandRangeToLineBreaksAndSplitBlocks\",\n    value: function expandRangeToLineBreaksAndSplitBlocks(range) {\n      var position;\n      range = normalizeRange(range);\n\n      var _range13 = range,\n          _range14 = _slicedToArray2(_range13, 2),\n          startPosition = _range14[0],\n          endPosition = _range14[1];\n\n      var startLocation = this.locationFromPosition(startPosition);\n      var endLocation = this.locationFromPosition(endPosition);\n      var document = this;\n      var startBlock = document.getBlockAtIndex(startLocation.index);\n      startLocation.offset = startBlock.findLineBreakInDirectionFromPosition(\"backward\", startLocation.offset);\n\n      if (startLocation.offset != null) {\n        position = document.positionFromLocation(startLocation);\n        document = document.insertBlockBreakAtRange([position, position + 1]);\n        endLocation.index += 1;\n        endLocation.offset -= document.getBlockAtIndex(startLocation.index).getLength();\n        startLocation.index += 1;\n      }\n\n      startLocation.offset = 0;\n\n      if (endLocation.offset === 0 && endLocation.index > startLocation.index) {\n        endLocation.index -= 1;\n        endLocation.offset = document.getBlockAtIndex(endLocation.index).getBlockBreakPosition();\n      } else {\n        var endBlock = document.getBlockAtIndex(endLocation.index);\n\n        if (endBlock.text.getStringAtRange([endLocation.offset - 1, endLocation.offset]) === \"\\n\") {\n          endLocation.offset -= 1;\n        } else {\n          endLocation.offset = endBlock.findLineBreakInDirectionFromPosition(\"forward\", endLocation.offset);\n        }\n\n        if (endLocation.offset !== endBlock.getBlockBreakPosition()) {\n          position = document.positionFromLocation(endLocation);\n          document = document.insertBlockBreakAtRange([position, position + 1]);\n        }\n      }\n\n      startPosition = document.positionFromLocation(startLocation);\n      endPosition = document.positionFromLocation(endLocation);\n      range = normalizeRange([startPosition, endPosition]);\n      return {\n        document: document,\n        range: range\n      };\n    }\n  }, {\n    key: \"convertLineBreaksToBlockBreaksInRange\",\n    value: function convertLineBreaksToBlockBreaksInRange(range) {\n      range = normalizeRange(range);\n\n      var _range15 = range,\n          _range16 = _slicedToArray2(_range15, 1),\n          position = _range16[0];\n\n      var string = this.getStringAtRange(range).slice(0, -1);\n      var document = this;\n      string.replace(/.*?\\n/g, function (match) {\n        position += match.length;\n        document = document.insertBlockBreakAtRange([position - 1, position]);\n      });\n      return {\n        document: document,\n        range: range\n      };\n    }\n  }, {\n    key: \"consolidateBlocksAtRange\",\n    value: function consolidateBlocksAtRange(range) {\n      range = normalizeRange(range);\n\n      var _range17 = range,\n          _range18 = _slicedToArray2(_range17, 2),\n          startPosition = _range18[0],\n          endPosition = _range18[1];\n\n      var startIndex = this.locationFromPosition(startPosition).index;\n      var endIndex = this.locationFromPosition(endPosition).index;\n      return new this.constructor(this.blockList.consolidateFromIndexToIndex(startIndex, endIndex));\n    }\n  }, {\n    key: \"getDocumentAtRange\",\n    value: function getDocumentAtRange(range) {\n      range = normalizeRange(range);\n      var blocks = this.blockList.getSplittableListInRange(range).toArray();\n      return new this.constructor(blocks);\n    }\n  }, {\n    key: \"getStringAtRange\",\n    value: function getStringAtRange(range) {\n      var endIndex;\n      var array = range = normalizeRange(range),\n          endPosition = array[array.length - 1];\n\n      if (endPosition !== this.getLength()) {\n        endIndex = -1;\n      }\n\n      return this.getDocumentAtRange(range).toString().slice(0, endIndex);\n    }\n  }, {\n    key: \"getBlockAtIndex\",\n    value: function getBlockAtIndex(index) {\n      return this.blockList.getObjectAtIndex(index);\n    }\n  }, {\n    key: \"getBlockAtPosition\",\n    value: function getBlockAtPosition(position) {\n      var _this$locationFromPos5 = this.locationFromPosition(position),\n          index = _this$locationFromPos5.index;\n\n      return this.getBlockAtIndex(index);\n    }\n  }, {\n    key: \"getTextAtIndex\",\n    value: function getTextAtIndex(index) {\n      var _this$getBlockAtIndex;\n\n      return (_this$getBlockAtIndex = this.getBlockAtIndex(index)) === null || _this$getBlockAtIndex === void 0 ? void 0 : _this$getBlockAtIndex.text;\n    }\n  }, {\n    key: \"getTextAtPosition\",\n    value: function getTextAtPosition(position) {\n      var _this$locationFromPos6 = this.locationFromPosition(position),\n          index = _this$locationFromPos6.index;\n\n      return this.getTextAtIndex(index);\n    }\n  }, {\n    key: \"getPieceAtPosition\",\n    value: function getPieceAtPosition(position) {\n      var _this$locationFromPos7 = this.locationFromPosition(position),\n          index = _this$locationFromPos7.index,\n          offset = _this$locationFromPos7.offset;\n\n      return this.getTextAtIndex(index).getPieceAtPosition(offset);\n    }\n  }, {\n    key: \"getCharacterAtPosition\",\n    value: function getCharacterAtPosition(position) {\n      var _this$locationFromPos8 = this.locationFromPosition(position),\n          index = _this$locationFromPos8.index,\n          offset = _this$locationFromPos8.offset;\n\n      return this.getTextAtIndex(index).getStringAtRange([offset, offset + 1]);\n    }\n  }, {\n    key: \"getLength\",\n    value: function getLength() {\n      return this.blockList.getEndPosition();\n    }\n  }, {\n    key: \"getBlocks\",\n    value: function getBlocks() {\n      return this.blockList.toArray();\n    }\n  }, {\n    key: \"getBlockCount\",\n    value: function getBlockCount() {\n      return this.blockList.length;\n    }\n  }, {\n    key: \"getEditCount\",\n    value: function getEditCount() {\n      return this.editCount;\n    }\n  }, {\n    key: \"eachBlock\",\n    value: function eachBlock(callback) {\n      return this.blockList.eachObject(callback);\n    }\n  }, {\n    key: \"eachBlockAtRange\",\n    value: function eachBlockAtRange(range, callback) {\n      var block, textRange;\n      range = normalizeRange(range);\n\n      var _range19 = range,\n          _range20 = _slicedToArray2(_range19, 2),\n          startPosition = _range20[0],\n          endPosition = _range20[1];\n\n      var startLocation = this.locationFromPosition(startPosition);\n      var endLocation = this.locationFromPosition(endPosition);\n\n      if (startLocation.index === endLocation.index) {\n        block = this.getBlockAtIndex(startLocation.index);\n        textRange = [startLocation.offset, endLocation.offset];\n        return callback(block, textRange, startLocation.index);\n      } else {\n        for (var index = startLocation.index; index <= endLocation.index; index++) {\n          block = this.getBlockAtIndex(index);\n\n          if (block) {\n            switch (index) {\n              case startLocation.index:\n                textRange = [startLocation.offset, block.text.getLength()];\n                break;\n\n              case endLocation.index:\n                textRange = [0, endLocation.offset];\n                break;\n\n              default:\n                textRange = [0, block.text.getLength()];\n            }\n\n            callback(block, textRange, index);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"getCommonAttributesAtRange\",\n    value: function getCommonAttributesAtRange(range) {\n      range = normalizeRange(range);\n\n      var _range21 = range,\n          _range22 = _slicedToArray2(_range21, 1),\n          startPosition = _range22[0];\n\n      if (rangeIsCollapsed(range)) {\n        return this.getCommonAttributesAtPosition(startPosition);\n      } else {\n        var _textAttributes = [];\n        var blockAttributes = [];\n        this.eachBlockAtRange(range, function (block, textRange) {\n          if (textRange[0] !== textRange[1]) {\n            _textAttributes.push(block.text.getCommonAttributesAtRange(textRange));\n\n            return blockAttributes.push(attributesForBlock(block));\n          }\n        });\n        return Hash.fromCommonAttributesOfObjects(_textAttributes).merge(Hash.fromCommonAttributesOfObjects(blockAttributes)).toObject();\n      }\n    }\n  }, {\n    key: \"getCommonAttributesAtPosition\",\n    value: function getCommonAttributesAtPosition(position) {\n      var key, value;\n\n      var _this$locationFromPos9 = this.locationFromPosition(position),\n          index = _this$locationFromPos9.index,\n          offset = _this$locationFromPos9.offset;\n\n      var block = this.getBlockAtIndex(index);\n\n      if (!block) {\n        return {};\n      }\n\n      var commonAttributes = attributesForBlock(block);\n      var attributes = block.text.getAttributesAtPosition(offset);\n      var attributesLeft = block.text.getAttributesAtPosition(offset - 1);\n      var inheritableAttributes = Object.keys(config.textAttributes).filter(function (key) {\n        return config.textAttributes[key].inheritable;\n      });\n\n      for (key in attributesLeft) {\n        value = attributesLeft[key];\n\n        if (value === attributes[key] || inheritableAttributes.includes(key)) {\n          commonAttributes[key] = value;\n        }\n      }\n\n      return commonAttributes;\n    }\n  }, {\n    key: \"getRangeOfCommonAttributeAtPosition\",\n    value: function getRangeOfCommonAttributeAtPosition(attributeName, position) {\n      var _this$locationFromPos10 = this.locationFromPosition(position),\n          index = _this$locationFromPos10.index,\n          offset = _this$locationFromPos10.offset;\n\n      var text = this.getTextAtIndex(index);\n\n      var _Array$from6 = Array.from(text.getExpandedRangeForAttributeAtOffset(attributeName, offset)),\n          _Array$from7 = _slicedToArray2(_Array$from6, 2),\n          startOffset = _Array$from7[0],\n          endOffset = _Array$from7[1];\n\n      var start = this.positionFromLocation({\n        index: index,\n        offset: startOffset\n      });\n      var end = this.positionFromLocation({\n        index: index,\n        offset: endOffset\n      });\n      return normalizeRange([start, end]);\n    }\n  }, {\n    key: \"getBaseBlockAttributes\",\n    value: function getBaseBlockAttributes() {\n      var _this24 = this;\n\n      var baseBlockAttributes = this.getBlockAtIndex(0).getAttributes();\n\n      var _loop = function _loop(blockIndex) {\n        var blockAttributes = _this24.getBlockAtIndex(blockIndex).getAttributes();\n\n        var lastAttributeIndex = Math.min(baseBlockAttributes.length, blockAttributes.length);\n\n        baseBlockAttributes = function () {\n          var result = [];\n\n          for (var index = 0; index < lastAttributeIndex; index++) {\n            if (blockAttributes[index] !== baseBlockAttributes[index]) {\n              break;\n            }\n\n            result.push(blockAttributes[index]);\n          }\n\n          return result;\n        }();\n      };\n\n      for (var blockIndex = 1; blockIndex < this.getBlockCount(); blockIndex++) {\n        _loop(blockIndex);\n      }\n\n      return baseBlockAttributes;\n    }\n  }, {\n    key: \"getAttachmentById\",\n    value: function getAttachmentById(attachmentId) {\n      var _iterator2 = _createForOfIteratorHelper2(this.getAttachments()),\n          _step3;\n\n      try {\n        for (_iterator2.s(); !(_step3 = _iterator2.n()).done;) {\n          var attachment = _step3.value;\n\n          if (attachment.id === attachmentId) {\n            return attachment;\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n  }, {\n    key: \"getAttachmentPieces\",\n    value: function getAttachmentPieces() {\n      var attachmentPieces = [];\n      this.blockList.eachObject(function (_ref) {\n        var text = _ref.text;\n        return attachmentPieces = attachmentPieces.concat(text.getAttachmentPieces());\n      });\n      return attachmentPieces;\n    }\n  }, {\n    key: \"getAttachments\",\n    value: function getAttachments() {\n      return this.getAttachmentPieces().map(function (piece) {\n        return piece.attachment;\n      });\n    }\n  }, {\n    key: \"getRangeOfAttachment\",\n    value: function getRangeOfAttachment(attachment) {\n      var position = 0;\n      var iterable = this.blockList.toArray();\n\n      for (var index = 0; index < iterable.length; index++) {\n        var text = iterable[index].text;\n        var textRange = text.getRangeOfAttachment(attachment);\n\n        if (textRange) {\n          return normalizeRange([position + textRange[0], position + textRange[1]]);\n        }\n\n        position += text.getLength();\n      }\n    }\n  }, {\n    key: \"getLocationRangeOfAttachment\",\n    value: function getLocationRangeOfAttachment(attachment) {\n      var range = this.getRangeOfAttachment(attachment);\n      return this.locationRangeFromRange(range);\n    }\n  }, {\n    key: \"getAttachmentPieceForAttachment\",\n    value: function getAttachmentPieceForAttachment(attachment) {\n      var _iterator3 = _createForOfIteratorHelper2(this.getAttachmentPieces()),\n          _step4;\n\n      try {\n        for (_iterator3.s(); !(_step4 = _iterator3.n()).done;) {\n          var piece = _step4.value;\n\n          if (piece.attachment === attachment) {\n            return piece;\n          }\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }, {\n    key: \"findRangesForBlockAttribute\",\n    value: function findRangesForBlockAttribute(attributeName) {\n      var position = 0;\n      var ranges = [];\n      this.getBlocks().forEach(function (block) {\n        var length = block.getLength();\n\n        if (block.hasAttribute(attributeName)) {\n          ranges.push([position, position + length]);\n        }\n\n        position += length;\n      });\n      return ranges;\n    }\n  }, {\n    key: \"findRangesForTextAttribute\",\n    value: function findRangesForTextAttribute(attributeName) {\n      var _ref8 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          withValue = _ref8.withValue;\n\n      var position = 0;\n      var range = [];\n      var ranges = [];\n\n      var match = function match(piece) {\n        if (withValue) {\n          return piece.getAttribute(attributeName) === withValue;\n        } else {\n          return piece.hasAttribute(attributeName);\n        }\n      };\n\n      this.getPieces().forEach(function (piece) {\n        var length = piece.getLength();\n\n        if (match(piece)) {\n          if (range[1] === position) {\n            range[1] = position + length;\n          } else {\n            ranges.push(range = [position, position + length]);\n          }\n        }\n\n        position += length;\n      });\n      return ranges;\n    }\n  }, {\n    key: \"locationFromPosition\",\n    value: function locationFromPosition(position) {\n      var location = this.blockList.findIndexAndOffsetAtPosition(Math.max(0, position));\n\n      if (location.index != null) {\n        return location;\n      } else {\n        var blocks = this.getBlocks();\n        return {\n          index: blocks.length - 1,\n          offset: blocks[blocks.length - 1].getLength()\n        };\n      }\n    }\n  }, {\n    key: \"positionFromLocation\",\n    value: function positionFromLocation(location) {\n      return this.blockList.findPositionAtIndexAndOffset(location.index, location.offset);\n    }\n  }, {\n    key: \"locationRangeFromPosition\",\n    value: function locationRangeFromPosition(position) {\n      return normalizeRange(this.locationFromPosition(position));\n    }\n  }, {\n    key: \"locationRangeFromRange\",\n    value: function locationRangeFromRange(range) {\n      range = normalizeRange(range);\n      if (!range) return;\n\n      var _Array$from8 = Array.from(range),\n          _Array$from9 = _slicedToArray2(_Array$from8, 2),\n          startPosition = _Array$from9[0],\n          endPosition = _Array$from9[1];\n\n      var startLocation = this.locationFromPosition(startPosition);\n      var endLocation = this.locationFromPosition(endPosition);\n      return normalizeRange([startLocation, endLocation]);\n    }\n  }, {\n    key: \"rangeFromLocationRange\",\n    value: function rangeFromLocationRange(locationRange) {\n      var rightPosition;\n      locationRange = normalizeRange(locationRange);\n      var leftPosition = this.positionFromLocation(locationRange[0]);\n\n      if (!rangeIsCollapsed(locationRange)) {\n        rightPosition = this.positionFromLocation(locationRange[1]);\n      }\n\n      return normalizeRange([leftPosition, rightPosition]);\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(document) {\n      return this.blockList.isEqualTo(document === null || document === void 0 ? void 0 : document.blockList);\n    }\n  }, {\n    key: \"getTexts\",\n    value: function getTexts() {\n      return this.getBlocks().map(function (block) {\n        return block.text;\n      });\n    }\n  }, {\n    key: \"getPieces\",\n    value: function getPieces() {\n      var pieces = [];\n      Array.from(this.getTexts()).forEach(function (text) {\n        pieces.push.apply(pieces, _toConsumableArray2(Array.from(text.getPieces() || [])));\n      });\n      return pieces;\n    }\n  }, {\n    key: \"getObjects\",\n    value: function getObjects() {\n      return this.getBlocks().concat(this.getTexts()).concat(this.getPieces());\n    }\n  }, {\n    key: \"toSerializableDocument\",\n    value: function toSerializableDocument() {\n      var blocks = [];\n      this.blockList.eachObject(function (block) {\n        return blocks.push(block.copyWithText(block.text.toSerializableText()));\n      });\n      return new this.constructor(blocks);\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.blockList.toString();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.blockList.toJSON();\n    }\n  }, {\n    key: \"toConsole\",\n    value: function toConsole() {\n      return JSON.stringify(this.blockList.toArray()).map(function (block) {\n        return JSON.parse(block.text.toConsole());\n      });\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(documentJSON) {\n      var blocks = Array.from(documentJSON).map(function (blockJSON) {\n        return Block.fromJSON(blockJSON);\n      });\n      return new this(blocks);\n    }\n  }, {\n    key: \"fromString\",\n    value: function fromString(string, textAttributes) {\n      var text = Text.textForStringWithAttributes(string, textAttributes);\n      return new this([new Block(text)]);\n    }\n  }]);\n\n  return Document;\n}(TrixObject);\n\nvar attributesForBlock = function attributesForBlock(block) {\n  var attributes = {};\n  var attributeName = block.getLastAttribute();\n\n  if (attributeName) {\n    attributes[attributeName] = true;\n  }\n\n  return attributes;\n};\n\nvar DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height class\".split(\" \");\nvar DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \");\nvar DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe\".split(\" \");\n\nvar HTMLSanitizer = /*#__PURE__*/function (_BasicObject8) {\n  _inherits2(HTMLSanitizer, _BasicObject8);\n\n  var _super19 = _createSuper2(HTMLSanitizer);\n\n  function HTMLSanitizer(html) {\n    var _this25;\n\n    _classCallCheck2(this, HTMLSanitizer);\n\n    var _ref9 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        allowedAttributes = _ref9.allowedAttributes,\n        forbiddenProtocols = _ref9.forbiddenProtocols,\n        forbiddenElements = _ref9.forbiddenElements;\n\n    _this25 = _super19.apply(this, arguments);\n    _this25.allowedAttributes = allowedAttributes || DEFAULT_ALLOWED_ATTRIBUTES;\n    _this25.forbiddenProtocols = forbiddenProtocols || DEFAULT_FORBIDDEN_PROTOCOLS;\n    _this25.forbiddenElements = forbiddenElements || DEFAULT_FORBIDDEN_ELEMENTS;\n    _this25.body = createBodyElementForHTML(html);\n    return _this25;\n  }\n\n  _createClass2(HTMLSanitizer, [{\n    key: \"sanitize\",\n    value: function sanitize() {\n      this.sanitizeElements();\n      return this.normalizeListElementNesting();\n    }\n  }, {\n    key: \"getHTML\",\n    value: function getHTML() {\n      return this.body.innerHTML;\n    }\n  }, {\n    key: \"getBody\",\n    value: function getBody() {\n      return this.body;\n    } // Private\n\n  }, {\n    key: \"sanitizeElements\",\n    value: function sanitizeElements() {\n      var walker = walkTree(this.body);\n      var nodesToRemove = [];\n\n      while (walker.nextNode()) {\n        var node = walker.currentNode;\n\n        switch (node.nodeType) {\n          case Node.ELEMENT_NODE:\n            if (this.elementIsRemovable(node)) {\n              nodesToRemove.push(node);\n            } else {\n              this.sanitizeElement(node);\n            }\n\n            break;\n\n          case Node.COMMENT_NODE:\n            nodesToRemove.push(node);\n            break;\n        }\n      }\n\n      nodesToRemove.forEach(function (node) {\n        return removeNode(node);\n      });\n      return this.body;\n    }\n  }, {\n    key: \"sanitizeElement\",\n    value: function sanitizeElement(element) {\n      var _this26 = this;\n\n      if (element.hasAttribute(\"href\")) {\n        if (this.forbiddenProtocols.includes(element.protocol)) {\n          element.removeAttribute(\"href\");\n        }\n      }\n\n      Array.from(element.attributes).forEach(function (_ref) {\n        var name = _ref.name;\n\n        if (!_this26.allowedAttributes.includes(name) && name.indexOf(\"data-trix\") !== 0) {\n          element.removeAttribute(name);\n        }\n      });\n      return element;\n    }\n  }, {\n    key: \"normalizeListElementNesting\",\n    value: function normalizeListElementNesting() {\n      Array.from(this.body.querySelectorAll(\"ul,ol\")).forEach(function (listElement) {\n        var previousElement = listElement.previousElementSibling;\n\n        if (previousElement) {\n          if (tagName(previousElement) === \"li\") {\n            previousElement.appendChild(listElement);\n          }\n        }\n      });\n      return this.body;\n    }\n  }, {\n    key: \"elementIsRemovable\",\n    value: function elementIsRemovable(element) {\n      if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n      return this.elementIsForbidden(element) || this.elementIsntSerializable(element);\n    }\n  }, {\n    key: \"elementIsForbidden\",\n    value: function elementIsForbidden(element) {\n      return this.forbiddenElements.includes(tagName(element));\n    }\n  }, {\n    key: \"elementIsntSerializable\",\n    value: function elementIsntSerializable(element) {\n      return element.getAttribute(\"data-trix-serialize\") === \"false\" && !nodeIsAttachmentElement(element);\n    }\n  }], [{\n    key: \"sanitize\",\n    value: function sanitize(html, options) {\n      var sanitizer = new this(html, options);\n      sanitizer.sanitize();\n      return sanitizer;\n    }\n  }]);\n\n  return HTMLSanitizer;\n}(BasicObject);\n\nvar createBodyElementForHTML = function createBodyElementForHTML() {\n  var html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\"; // Remove everything after </html>\n\n  html = html.replace(/<\\/html[^>]*>[^]*$/i, \"</html>\");\n  var doc = document.implementation.createHTMLDocument(\"\");\n  doc.documentElement.innerHTML = html;\n  Array.from(doc.head.querySelectorAll(\"style\")).forEach(function (element) {\n    doc.body.appendChild(element);\n  });\n  return doc.body;\n};\n/* eslint-disable\n    no-case-declarations,\n    no-irregular-whitespace,\n*/\n\n\nvar pieceForString = function pieceForString(string) {\n  var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var type = \"string\";\n  string = normalizeSpaces(string);\n  return {\n    string: string,\n    attributes: attributes,\n    type: type\n  };\n};\n\nvar pieceForAttachment = function pieceForAttachment(attachment) {\n  var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var type = \"attachment\";\n  return {\n    attachment: attachment,\n    attributes: attributes,\n    type: type\n  };\n};\n\nvar blockForAttributes = function blockForAttributes() {\n  var attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var text = [];\n  return {\n    text: text,\n    attributes: attributes\n  };\n};\n\nvar parseTrixDataAttribute = function parseTrixDataAttribute(element, name) {\n  try {\n    return JSON.parse(element.getAttribute(\"data-trix-\".concat(name)));\n  } catch (error) {\n    return {};\n  }\n};\n\nvar getImageDimensions = function getImageDimensions(element) {\n  var width = element.getAttribute(\"width\");\n  var height = element.getAttribute(\"height\");\n  var dimensions = {};\n\n  if (width) {\n    dimensions.width = parseInt(width, 10);\n  }\n\n  if (height) {\n    dimensions.height = parseInt(height, 10);\n  }\n\n  return dimensions;\n};\n\nvar HTMLParser = /*#__PURE__*/function (_BasicObject9) {\n  _inherits2(HTMLParser, _BasicObject9);\n\n  var _super20 = _createSuper2(HTMLParser);\n\n  function HTMLParser(html) {\n    var _this27;\n\n    _classCallCheck2(this, HTMLParser);\n\n    var _ref10 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        referenceElement = _ref10.referenceElement;\n\n    _this27 = _super20.apply(this, arguments);\n    _this27.html = html;\n    _this27.referenceElement = referenceElement;\n    _this27.blocks = [];\n    _this27.blockElements = [];\n    _this27.processedElements = [];\n    return _this27;\n  }\n\n  _createClass2(HTMLParser, [{\n    key: \"getDocument\",\n    value: function getDocument() {\n      return Document.fromJSON(this.blocks);\n    } // HTML parsing\n\n  }, {\n    key: \"parse\",\n    value: function parse() {\n      try {\n        this.createHiddenContainer();\n\n        var _html = HTMLSanitizer.sanitize(this.html).getHTML();\n\n        this.containerElement.innerHTML = _html;\n        var walker = walkTree(this.containerElement, {\n          usingFilter: nodeFilter\n        });\n\n        while (walker.nextNode()) {\n          this.processNode(walker.currentNode);\n        }\n\n        return this.translateBlockElementMarginsToNewlines();\n      } finally {\n        this.removeHiddenContainer();\n      }\n    }\n  }, {\n    key: \"createHiddenContainer\",\n    value: function createHiddenContainer() {\n      if (this.referenceElement) {\n        this.containerElement = this.referenceElement.cloneNode(false);\n        this.containerElement.removeAttribute(\"id\");\n        this.containerElement.setAttribute(\"data-trix-internal\", \"\");\n        this.containerElement.style.display = \"none\";\n        return this.referenceElement.parentNode.insertBefore(this.containerElement, this.referenceElement.nextSibling);\n      } else {\n        this.containerElement = makeElement({\n          tagName: \"div\",\n          style: {\n            display: \"none\"\n          }\n        });\n        return document.body.appendChild(this.containerElement);\n      }\n    }\n  }, {\n    key: \"removeHiddenContainer\",\n    value: function removeHiddenContainer() {\n      return removeNode(this.containerElement);\n    }\n  }, {\n    key: \"processNode\",\n    value: function processNode(node) {\n      switch (node.nodeType) {\n        case Node.TEXT_NODE:\n          if (!this.isInsignificantTextNode(node)) {\n            this.appendBlockForTextNode(node);\n            return this.processTextNode(node);\n          }\n\n          break;\n\n        case Node.ELEMENT_NODE:\n          this.appendBlockForElement(node);\n          return this.processElement(node);\n      }\n    }\n  }, {\n    key: \"appendBlockForTextNode\",\n    value: function appendBlockForTextNode(node) {\n      var element = node.parentNode;\n\n      if (element === this.currentBlockElement && this.isBlockElement(node.previousSibling)) {\n        return this.appendStringWithAttributes(\"\\n\");\n      } else if (element === this.containerElement || this.isBlockElement(element)) {\n        var _this$currentBlock;\n\n        var _attributes2 = this.getBlockAttributes(element);\n\n        if (!arraysAreEqual(_attributes2, (_this$currentBlock = this.currentBlock) === null || _this$currentBlock === void 0 ? void 0 : _this$currentBlock.attributes)) {\n          this.currentBlock = this.appendBlockForAttributesWithElement(_attributes2, element);\n          this.currentBlockElement = element;\n        }\n      }\n    }\n  }, {\n    key: \"appendBlockForElement\",\n    value: function appendBlockForElement(element) {\n      var elementIsBlockElement = this.isBlockElement(element);\n      var currentBlockContainsElement = elementContainsNode(this.currentBlockElement, element);\n\n      if (elementIsBlockElement && !this.isBlockElement(element.firstChild)) {\n        if (!this.isInsignificantTextNode(element.firstChild) || !this.isBlockElement(element.firstElementChild)) {\n          var _attributes3 = this.getBlockAttributes(element);\n\n          if (element.firstChild) {\n            if (!(currentBlockContainsElement && arraysAreEqual(_attributes3, this.currentBlock.attributes))) {\n              this.currentBlock = this.appendBlockForAttributesWithElement(_attributes3, element);\n              this.currentBlockElement = element;\n            } else {\n              return this.appendStringWithAttributes(\"\\n\");\n            }\n          }\n        }\n      } else if (this.currentBlockElement && !currentBlockContainsElement && !elementIsBlockElement) {\n        var parentBlockElement = this.findParentBlockElement(element);\n\n        if (parentBlockElement) {\n          return this.appendBlockForElement(parentBlockElement);\n        } else {\n          this.currentBlock = this.appendEmptyBlock();\n          this.currentBlockElement = null;\n        }\n      }\n    }\n  }, {\n    key: \"findParentBlockElement\",\n    value: function findParentBlockElement(element) {\n      var parentElement = element.parentElement;\n\n      while (parentElement && parentElement !== this.containerElement) {\n        if (this.isBlockElement(parentElement) && this.blockElements.includes(parentElement)) {\n          return parentElement;\n        } else {\n          parentElement = parentElement.parentElement;\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"processTextNode\",\n    value: function processTextNode(node) {\n      var string = node.data;\n\n      if (!elementCanDisplayPreformattedText(node.parentNode)) {\n        var _node$previousSibling;\n\n        string = squishBreakableWhitespace(string);\n\n        if (stringEndsWithWhitespace((_node$previousSibling = node.previousSibling) === null || _node$previousSibling === void 0 ? void 0 : _node$previousSibling.textContent)) {\n          string = leftTrimBreakableWhitespace(string);\n        }\n      }\n\n      return this.appendStringWithAttributes(string, this.getTextAttributes(node.parentNode));\n    }\n  }, {\n    key: \"processElement\",\n    value: function processElement(element) {\n      var attributes;\n\n      if (nodeIsAttachmentElement(element)) {\n        attributes = parseTrixDataAttribute(element, \"attachment\");\n\n        if (Object.keys(attributes).length) {\n          var _textAttributes2 = this.getTextAttributes(element);\n\n          this.appendAttachmentWithAttributes(attributes, _textAttributes2); // We have everything we need so avoid processing inner nodes\n\n          element.innerHTML = \"\";\n        }\n\n        return this.processedElements.push(element);\n      } else {\n        switch (tagName(element)) {\n          case \"br\":\n            if (!this.isExtraBR(element) && !this.isBlockElement(element.nextSibling)) {\n              this.appendStringWithAttributes(\"\\n\", this.getTextAttributes(element));\n            }\n\n            return this.processedElements.push(element);\n\n          case \"img\":\n            attributes = {\n              url: element.getAttribute(\"src\"),\n              contentType: \"image\"\n            };\n\n            var _object6 = getImageDimensions(element);\n\n            for (var key in _object6) {\n              var value = _object6[key];\n              attributes[key] = value;\n            }\n\n            this.appendAttachmentWithAttributes(attributes, this.getTextAttributes(element));\n            return this.processedElements.push(element);\n\n          case \"tr\":\n            if (element.parentNode.firstChild !== element) {\n              return this.appendStringWithAttributes(\"\\n\");\n            }\n\n            break;\n\n          case \"td\":\n            if (element.parentNode.firstChild !== element) {\n              return this.appendStringWithAttributes(\" | \");\n            }\n\n            break;\n        }\n      }\n    } // Document construction\n\n  }, {\n    key: \"appendBlockForAttributesWithElement\",\n    value: function appendBlockForAttributesWithElement(attributes, element) {\n      this.blockElements.push(element);\n      var block = blockForAttributes(attributes);\n      this.blocks.push(block);\n      return block;\n    }\n  }, {\n    key: \"appendEmptyBlock\",\n    value: function appendEmptyBlock() {\n      return this.appendBlockForAttributesWithElement([], null);\n    }\n  }, {\n    key: \"appendStringWithAttributes\",\n    value: function appendStringWithAttributes(string, attributes) {\n      return this.appendPiece(pieceForString(string, attributes));\n    }\n  }, {\n    key: \"appendAttachmentWithAttributes\",\n    value: function appendAttachmentWithAttributes(attachment, attributes) {\n      return this.appendPiece(pieceForAttachment(attachment, attributes));\n    }\n  }, {\n    key: \"appendPiece\",\n    value: function appendPiece(piece) {\n      if (this.blocks.length === 0) {\n        this.appendEmptyBlock();\n      }\n\n      return this.blocks[this.blocks.length - 1].text.push(piece);\n    }\n  }, {\n    key: \"appendStringToTextAtIndex\",\n    value: function appendStringToTextAtIndex(string, index) {\n      var text = this.blocks[index].text;\n      var piece = text[text.length - 1];\n\n      if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n        piece.string += string;\n      } else {\n        return text.push(pieceForString(string));\n      }\n    }\n  }, {\n    key: \"prependStringToTextAtIndex\",\n    value: function prependStringToTextAtIndex(string, index) {\n      var text = this.blocks[index].text;\n      var piece = text[0];\n\n      if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n        piece.string = string + piece.string;\n      } else {\n        return text.unshift(pieceForString(string));\n      }\n    } // Attribute parsing\n\n  }, {\n    key: \"getTextAttributes\",\n    value: function getTextAttributes(element) {\n      var value;\n      var attributes = {};\n\n      for (var attribute in config.textAttributes) {\n        var configAttr = config.textAttributes[attribute];\n\n        if (configAttr.tagName && findClosestElementFromNode(element, {\n          matchingSelector: configAttr.tagName,\n          untilNode: this.containerElement\n        })) {\n          attributes[attribute] = true;\n        } else if (configAttr.parser) {\n          value = configAttr.parser(element);\n\n          if (value) {\n            var attributeInheritedFromBlock = false;\n\n            var _iterator4 = _createForOfIteratorHelper2(this.findBlockElementAncestors(element)),\n                _step5;\n\n            try {\n              for (_iterator4.s(); !(_step5 = _iterator4.n()).done;) {\n                var blockElement = _step5.value;\n\n                if (configAttr.parser(blockElement) === value) {\n                  attributeInheritedFromBlock = true;\n                  break;\n                }\n              }\n            } catch (err) {\n              _iterator4.e(err);\n            } finally {\n              _iterator4.f();\n            }\n\n            if (!attributeInheritedFromBlock) {\n              attributes[attribute] = value;\n            }\n          }\n        } else if (configAttr.styleProperty) {\n          value = element.style[configAttr.styleProperty];\n\n          if (value) {\n            attributes[attribute] = value;\n          }\n        }\n      }\n\n      if (nodeIsAttachmentElement(element)) {\n        var _object7 = parseTrixDataAttribute(element, \"attributes\");\n\n        for (var key in _object7) {\n          value = _object7[key];\n          attributes[key] = value;\n        }\n      }\n\n      return attributes;\n    }\n  }, {\n    key: \"getBlockAttributes\",\n    value: function getBlockAttributes(element) {\n      var attributes = [];\n\n      while (element && element !== this.containerElement) {\n        for (var attribute in config.blockAttributes) {\n          var attrConfig = config.blockAttributes[attribute];\n\n          if (attrConfig.parse !== false) {\n            if (tagName(element) === attrConfig.tagName) {\n              var _attrConfig$test;\n\n              if ((_attrConfig$test = attrConfig.test) !== null && _attrConfig$test !== void 0 && _attrConfig$test.call(attrConfig, element) || !attrConfig.test) {\n                attributes.push(attribute);\n\n                if (attrConfig.listAttribute) {\n                  attributes.push(attrConfig.listAttribute);\n                }\n              }\n            }\n          }\n        }\n\n        element = element.parentNode;\n      }\n\n      return attributes.reverse();\n    }\n  }, {\n    key: \"findBlockElementAncestors\",\n    value: function findBlockElementAncestors(element) {\n      var ancestors = [];\n\n      while (element && element !== this.containerElement) {\n        var tag = tagName(element);\n\n        if (getBlockTagNames().includes(tag)) {\n          ancestors.push(element);\n        }\n\n        element = element.parentNode;\n      }\n\n      return ancestors;\n    } // Element inspection\n\n  }, {\n    key: \"isBlockElement\",\n    value: function isBlockElement(element) {\n      if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n      if (nodeIsAttachmentElement(element)) return;\n      if (findClosestElementFromNode(element, {\n        matchingSelector: \"td\",\n        untilNode: this.containerElement\n      })) return;\n      return getBlockTagNames().includes(tagName(element)) || window.getComputedStyle(element).display === \"block\";\n    }\n  }, {\n    key: \"isInsignificantTextNode\",\n    value: function isInsignificantTextNode(node) {\n      if ((node === null || node === void 0 ? void 0 : node.nodeType) !== Node.TEXT_NODE) return;\n      if (!stringIsAllBreakableWhitespace(node.data)) return;\n      var parentNode = node.parentNode,\n          previousSibling = node.previousSibling,\n          nextSibling = node.nextSibling;\n      if (nodeEndsWithNonWhitespace(parentNode.previousSibling) && !this.isBlockElement(parentNode.previousSibling)) return;\n      if (elementCanDisplayPreformattedText(parentNode)) return;\n      return !previousSibling || this.isBlockElement(previousSibling) || !nextSibling || this.isBlockElement(nextSibling);\n    }\n  }, {\n    key: \"isExtraBR\",\n    value: function isExtraBR(element) {\n      return tagName(element) === \"br\" && this.isBlockElement(element.parentNode) && element.parentNode.lastChild === element;\n    } // Margin translation\n\n  }, {\n    key: \"translateBlockElementMarginsToNewlines\",\n    value: function translateBlockElementMarginsToNewlines() {\n      var defaultMargin = this.getMarginOfDefaultBlockElement();\n\n      for (var index = 0; index < this.blocks.length; index++) {\n        var margin = this.getMarginOfBlockElementAtIndex(index);\n\n        if (margin) {\n          if (margin.top > defaultMargin.top * 2) {\n            this.prependStringToTextAtIndex(\"\\n\", index);\n          }\n\n          if (margin.bottom > defaultMargin.bottom * 2) {\n            this.appendStringToTextAtIndex(\"\\n\", index);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"getMarginOfBlockElementAtIndex\",\n    value: function getMarginOfBlockElementAtIndex(index) {\n      var element = this.blockElements[index];\n\n      if (element) {\n        if (element.textContent) {\n          if (!getBlockTagNames().includes(tagName(element)) && !this.processedElements.includes(element)) {\n            return getBlockElementMargin(element);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"getMarginOfDefaultBlockElement\",\n    value: function getMarginOfDefaultBlockElement() {\n      var element = makeElement(config.blockAttributes.default.tagName);\n      this.containerElement.appendChild(element);\n      return getBlockElementMargin(element);\n    }\n  }], [{\n    key: \"parse\",\n    value: function parse(html, options) {\n      var parser = new this(html, options);\n      parser.parse();\n      return parser;\n    }\n  }]);\n\n  return HTMLParser;\n}(BasicObject); // Helpers\n\n\nvar elementCanDisplayPreformattedText = function elementCanDisplayPreformattedText(element) {\n  var _window$getComputedSt = window.getComputedStyle(element),\n      whiteSpace = _window$getComputedSt.whiteSpace;\n\n  return [\"pre\", \"pre-wrap\", \"pre-line\"].includes(whiteSpace);\n};\n\nvar nodeEndsWithNonWhitespace = function nodeEndsWithNonWhitespace(node) {\n  return node && !stringEndsWithWhitespace(node.textContent);\n};\n\nvar getBlockElementMargin = function getBlockElementMargin(element) {\n  var style = window.getComputedStyle(element);\n\n  if (style.display === \"block\") {\n    return {\n      top: parseInt(style.marginTop),\n      bottom: parseInt(style.marginBottom)\n    };\n  }\n};\n\nvar nodeFilter = function nodeFilter(node) {\n  if (tagName(node) === \"style\") {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n}; // Whitespace\n\n\nvar leftTrimBreakableWhitespace = function leftTrimBreakableWhitespace(string) {\n  return string.replace(new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"+\")), \"\");\n};\n\nvar stringIsAllBreakableWhitespace = function stringIsAllBreakableWhitespace(string) {\n  return new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"*$\")).test(string);\n};\n\nvar stringEndsWithWhitespace = function stringEndsWithWhitespace(string) {\n  return /\\s$/.test(string);\n};\n\nvar LineBreakInsertion = /*#__PURE__*/function () {\n  function LineBreakInsertion(composition) {\n    _classCallCheck2(this, LineBreakInsertion);\n\n    this.composition = composition;\n    this.document = this.composition.document;\n    var selectedRange = this.composition.getSelectedRange();\n    this.startPosition = selectedRange[0];\n    this.endPosition = selectedRange[1];\n    this.startLocation = this.document.locationFromPosition(this.startPosition);\n    this.endLocation = this.document.locationFromPosition(this.endPosition);\n    this.block = this.document.getBlockAtIndex(this.endLocation.index);\n    this.breaksOnReturn = this.block.breaksOnReturn();\n    this.previousCharacter = this.block.text.getStringAtPosition(this.endLocation.offset - 1);\n    this.nextCharacter = this.block.text.getStringAtPosition(this.endLocation.offset);\n  }\n\n  _createClass2(LineBreakInsertion, [{\n    key: \"shouldInsertBlockBreak\",\n    value: function shouldInsertBlockBreak() {\n      if (this.block.hasAttributes() && this.block.isListItem() && !this.block.isEmpty()) {\n        return this.startLocation.offset !== 0;\n      } else {\n        return this.breaksOnReturn && this.nextCharacter !== \"\\n\";\n      }\n    }\n  }, {\n    key: \"shouldBreakFormattedBlock\",\n    value: function shouldBreakFormattedBlock() {\n      return this.block.hasAttributes() && !this.block.isListItem() && (this.breaksOnReturn && this.nextCharacter === \"\\n\" || this.previousCharacter === \"\\n\");\n    }\n  }, {\n    key: \"shouldDecreaseListLevel\",\n    value: function shouldDecreaseListLevel() {\n      return this.block.hasAttributes() && this.block.isListItem() && this.block.isEmpty();\n    }\n  }, {\n    key: \"shouldPrependListItem\",\n    value: function shouldPrependListItem() {\n      return this.block.isListItem() && this.startLocation.offset === 0 && !this.block.isEmpty();\n    }\n  }, {\n    key: \"shouldRemoveLastBlockAttribute\",\n    value: function shouldRemoveLastBlockAttribute() {\n      return this.block.hasAttributes() && !this.block.isListItem() && this.block.isEmpty();\n    }\n  }]);\n\n  return LineBreakInsertion;\n}();\n\nvar PLACEHOLDER = \" \";\n\nvar Composition = /*#__PURE__*/function (_BasicObject10) {\n  _inherits2(Composition, _BasicObject10);\n\n  var _super21 = _createSuper2(Composition);\n\n  function Composition() {\n    var _this28;\n\n    _classCallCheck2(this, Composition);\n\n    _this28 = _super21.apply(this, arguments);\n    _this28.document = new Document();\n    _this28.attachments = [];\n    _this28.currentAttributes = {};\n    _this28.revision = 0;\n    return _this28;\n  }\n\n  _createClass2(Composition, [{\n    key: \"setDocument\",\n    value: function setDocument(document) {\n      if (!document.isEqualTo(this.document)) {\n        var _this$delegate, _this$delegate$compos;\n\n        this.document = document;\n        this.refreshAttachments();\n        this.revision++;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionDidChangeDocument) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate, document);\n      }\n    } // Snapshots\n\n  }, {\n    key: \"getSnapshot\",\n    value: function getSnapshot() {\n      return {\n        document: this.document,\n        selectedRange: this.getSelectedRange()\n      };\n    }\n  }, {\n    key: \"loadSnapshot\",\n    value: function loadSnapshot(_ref) {\n      var _this$delegate2, _this$delegate2$compo, _this$delegate3, _this$delegate3$compo;\n\n      var document = _ref.document,\n          selectedRange = _ref.selectedRange;\n      (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionWillLoadSnapshot) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n      this.setDocument(document != null ? document : new Document());\n      this.setSelection(selectedRange != null ? selectedRange : [0, 0]);\n      return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionDidLoadSnapshot) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3);\n    } // Responder protocol\n\n  }, {\n    key: \"insertText\",\n    value: function insertText(text) {\n      var _ref11 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        updatePosition: true\n      },\n          updatePosition = _ref11.updatePosition;\n\n      var selectedRange = this.getSelectedRange();\n      this.setDocument(this.document.insertTextAtRange(text, selectedRange));\n      var startPosition = selectedRange[0];\n      var endPosition = startPosition + text.getLength();\n\n      if (updatePosition) {\n        this.setSelection(endPosition);\n      }\n\n      return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n    }\n  }, {\n    key: \"insertBlock\",\n    value: function insertBlock() {\n      var block = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Block();\n      var document = new Document([block]);\n      return this.insertDocument(document);\n    }\n  }, {\n    key: \"insertDocument\",\n    value: function insertDocument() {\n      var document = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Document();\n      var selectedRange = this.getSelectedRange();\n      this.setDocument(this.document.insertDocumentAtRange(document, selectedRange));\n      var startPosition = selectedRange[0];\n      var endPosition = startPosition + document.getLength();\n      this.setSelection(endPosition);\n      return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n    }\n  }, {\n    key: \"insertString\",\n    value: function insertString(string, options) {\n      var attributes = this.getCurrentTextAttributes();\n      var text = Text.textForStringWithAttributes(string, attributes);\n      return this.insertText(text, options);\n    }\n  }, {\n    key: \"insertBlockBreak\",\n    value: function insertBlockBreak() {\n      var selectedRange = this.getSelectedRange();\n      this.setDocument(this.document.insertBlockBreakAtRange(selectedRange));\n      var startPosition = selectedRange[0];\n      var endPosition = startPosition + 1;\n      this.setSelection(endPosition);\n      return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n    }\n  }, {\n    key: \"insertLineBreak\",\n    value: function insertLineBreak() {\n      var insertion = new LineBreakInsertion(this);\n\n      if (insertion.shouldDecreaseListLevel()) {\n        this.decreaseListLevel();\n        return this.setSelection(insertion.startPosition);\n      } else if (insertion.shouldPrependListItem()) {\n        var _document3 = new Document([insertion.block.copyWithoutText()]);\n\n        return this.insertDocument(_document3);\n      } else if (insertion.shouldInsertBlockBreak()) {\n        return this.insertBlockBreak();\n      } else if (insertion.shouldRemoveLastBlockAttribute()) {\n        return this.removeLastBlockAttribute();\n      } else if (insertion.shouldBreakFormattedBlock()) {\n        return this.breakFormattedBlock(insertion);\n      } else {\n        return this.insertString(\"\\n\");\n      }\n    }\n  }, {\n    key: \"insertHTML\",\n    value: function insertHTML(html) {\n      var document = HTMLParser.parse(html).getDocument();\n      var selectedRange = this.getSelectedRange();\n      this.setDocument(this.document.mergeDocumentAtRange(document, selectedRange));\n      var startPosition = selectedRange[0];\n      var endPosition = startPosition + document.getLength() - 1;\n      this.setSelection(endPosition);\n      return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n    }\n  }, {\n    key: \"replaceHTML\",\n    value: function replaceHTML(html) {\n      var document = HTMLParser.parse(html).getDocument().copyUsingObjectsFromDocument(this.document);\n      var locationRange = this.getLocationRange({\n        strict: false\n      });\n      var selectedRange = this.document.rangeFromLocationRange(locationRange);\n      this.setDocument(document);\n      return this.setSelection(selectedRange);\n    }\n  }, {\n    key: \"insertFile\",\n    value: function insertFile(file) {\n      return this.insertFiles([file]);\n    }\n  }, {\n    key: \"insertFiles\",\n    value: function insertFiles(files) {\n      var _this29 = this;\n\n      var attachments = [];\n      Array.from(files).forEach(function (file) {\n        var _this$delegate4;\n\n        if ((_this$delegate4 = _this29.delegate) !== null && _this$delegate4 !== void 0 && _this$delegate4.compositionShouldAcceptFile(file)) {\n          var attachment = Attachment.attachmentForFile(file);\n          attachments.push(attachment);\n        }\n      });\n      return this.insertAttachments(attachments);\n    }\n  }, {\n    key: \"insertAttachment\",\n    value: function insertAttachment(attachment) {\n      return this.insertAttachments([attachment]);\n    }\n  }, {\n    key: \"insertAttachments\",\n    value: function insertAttachments(attachments) {\n      var _this30 = this;\n\n      var text = new Text();\n      Array.from(attachments).forEach(function (attachment) {\n        var _config$attachments$t;\n\n        var type = attachment.getType();\n        var presentation = (_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.presentation;\n\n        var attributes = _this30.getCurrentTextAttributes();\n\n        if (presentation) {\n          attributes.presentation = presentation;\n        }\n\n        var attachmentText = Text.textForAttachmentWithAttributes(attachment, attributes);\n        text = text.appendText(attachmentText);\n      });\n      return this.insertText(text);\n    }\n  }, {\n    key: \"shouldManageDeletingInDirection\",\n    value: function shouldManageDeletingInDirection(direction) {\n      var locationRange = this.getLocationRange();\n\n      if (rangeIsCollapsed(locationRange)) {\n        if (direction === \"backward\" && locationRange[0].offset === 0) {\n          return true;\n        }\n\n        if (this.shouldManageMovingCursorInDirection(direction)) {\n          return true;\n        }\n      } else {\n        if (locationRange[0].index !== locationRange[1].index) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"deleteInDirection\",\n    value: function deleteInDirection(direction) {\n      var _ref12 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          length = _ref12.length;\n\n      var attachment, deletingIntoPreviousBlock, selectionSpansBlocks;\n      var locationRange = this.getLocationRange();\n      var range = this.getSelectedRange();\n      var selectionIsCollapsed = rangeIsCollapsed(range);\n\n      if (selectionIsCollapsed) {\n        deletingIntoPreviousBlock = direction === \"backward\" && locationRange[0].offset === 0;\n      } else {\n        selectionSpansBlocks = locationRange[0].index !== locationRange[1].index;\n      }\n\n      if (deletingIntoPreviousBlock) {\n        if (this.canDecreaseBlockAttributeLevel()) {\n          var block = this.getBlock();\n\n          if (block.isListItem()) {\n            this.decreaseListLevel();\n          } else {\n            this.decreaseBlockAttributeLevel();\n          }\n\n          this.setSelection(range[0]);\n\n          if (block.isEmpty()) {\n            return false;\n          }\n        }\n      }\n\n      if (selectionIsCollapsed) {\n        range = this.getExpandedRangeInDirection(direction, {\n          length: length\n        });\n\n        if (direction === \"backward\") {\n          attachment = this.getAttachmentAtRange(range);\n        }\n      }\n\n      if (attachment) {\n        this.editAttachment(attachment);\n        return false;\n      } else {\n        this.setDocument(this.document.removeTextAtRange(range));\n        this.setSelection(range[0]);\n\n        if (deletingIntoPreviousBlock || selectionSpansBlocks) {\n          return false;\n        }\n      }\n    }\n  }, {\n    key: \"moveTextFromRange\",\n    value: function moveTextFromRange(range) {\n      var _Array$from10 = Array.from(this.getSelectedRange()),\n          _Array$from11 = _slicedToArray2(_Array$from10, 1),\n          position = _Array$from11[0];\n\n      this.setDocument(this.document.moveTextFromRangeToPosition(range, position));\n      return this.setSelection(position);\n    }\n  }, {\n    key: \"removeAttachment\",\n    value: function removeAttachment(attachment) {\n      var range = this.document.getRangeOfAttachment(attachment);\n\n      if (range) {\n        this.stopEditingAttachment();\n        this.setDocument(this.document.removeTextAtRange(range));\n        return this.setSelection(range[0]);\n      }\n    }\n  }, {\n    key: \"removeLastBlockAttribute\",\n    value: function removeLastBlockAttribute() {\n      var _Array$from12 = Array.from(this.getSelectedRange()),\n          _Array$from13 = _slicedToArray2(_Array$from12, 2),\n          startPosition = _Array$from13[0],\n          endPosition = _Array$from13[1];\n\n      var block = this.document.getBlockAtPosition(endPosition);\n      this.removeCurrentAttribute(block.getLastAttribute());\n      return this.setSelection(startPosition);\n    }\n  }, {\n    key: \"insertPlaceholder\",\n    value: function insertPlaceholder() {\n      this.placeholderPosition = this.getPosition();\n      return this.insertString(PLACEHOLDER);\n    }\n  }, {\n    key: \"selectPlaceholder\",\n    value: function selectPlaceholder() {\n      if (this.placeholderPosition != null) {\n        this.setSelectedRange([this.placeholderPosition, this.placeholderPosition + PLACEHOLDER.length]);\n        return this.getSelectedRange();\n      }\n    }\n  }, {\n    key: \"forgetPlaceholder\",\n    value: function forgetPlaceholder() {\n      this.placeholderPosition = null;\n    } // Current attributes\n\n  }, {\n    key: \"hasCurrentAttribute\",\n    value: function hasCurrentAttribute(attributeName) {\n      var value = this.currentAttributes[attributeName];\n      return value != null && value !== false;\n    }\n  }, {\n    key: \"toggleCurrentAttribute\",\n    value: function toggleCurrentAttribute(attributeName) {\n      var value = !this.currentAttributes[attributeName];\n\n      if (value) {\n        return this.setCurrentAttribute(attributeName, value);\n      } else {\n        return this.removeCurrentAttribute(attributeName);\n      }\n    }\n  }, {\n    key: \"canSetCurrentAttribute\",\n    value: function canSetCurrentAttribute(attributeName) {\n      if (getBlockConfig(attributeName)) {\n        return this.canSetCurrentBlockAttribute(attributeName);\n      } else {\n        return this.canSetCurrentTextAttribute(attributeName);\n      }\n    }\n  }, {\n    key: \"canSetCurrentTextAttribute\",\n    value: function canSetCurrentTextAttribute(attributeName) {\n      var document = this.getSelectedDocument();\n      if (!document) return;\n\n      for (var _i3 = 0, _Array$from14 = Array.from(document.getAttachments()); _i3 < _Array$from14.length; _i3++) {\n        var attachment = _Array$from14[_i3];\n\n        if (!attachment.hasContent()) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"canSetCurrentBlockAttribute\",\n    value: function canSetCurrentBlockAttribute(attributeName) {\n      var block = this.getBlock();\n      if (!block) return;\n      return !block.isTerminalBlock();\n    }\n  }, {\n    key: \"setCurrentAttribute\",\n    value: function setCurrentAttribute(attributeName, value) {\n      if (getBlockConfig(attributeName)) {\n        return this.setBlockAttribute(attributeName, value);\n      } else {\n        this.setTextAttribute(attributeName, value);\n        this.currentAttributes[attributeName] = value;\n        return this.notifyDelegateOfCurrentAttributesChange();\n      }\n    }\n  }, {\n    key: \"setTextAttribute\",\n    value: function setTextAttribute(attributeName, value) {\n      var selectedRange = this.getSelectedRange();\n      if (!selectedRange) return;\n\n      var _Array$from15 = Array.from(selectedRange),\n          _Array$from16 = _slicedToArray2(_Array$from15, 2),\n          startPosition = _Array$from16[0],\n          endPosition = _Array$from16[1];\n\n      if (startPosition === endPosition) {\n        if (attributeName === \"href\") {\n          var text = Text.textForStringWithAttributes(value, {\n            href: value\n          });\n          return this.insertText(text);\n        }\n      } else {\n        return this.setDocument(this.document.addAttributeAtRange(attributeName, value, selectedRange));\n      }\n    }\n  }, {\n    key: \"setBlockAttribute\",\n    value: function setBlockAttribute(attributeName, value) {\n      var selectedRange = this.getSelectedRange();\n\n      if (this.canSetCurrentAttribute(attributeName)) {\n        this.setDocument(this.document.applyBlockAttributeAtRange(attributeName, value, selectedRange));\n        return this.setSelection(selectedRange);\n      }\n    }\n  }, {\n    key: \"removeCurrentAttribute\",\n    value: function removeCurrentAttribute(attributeName) {\n      if (getBlockConfig(attributeName)) {\n        this.removeBlockAttribute(attributeName);\n        return this.updateCurrentAttributes();\n      } else {\n        this.removeTextAttribute(attributeName);\n        delete this.currentAttributes[attributeName];\n        return this.notifyDelegateOfCurrentAttributesChange();\n      }\n    }\n  }, {\n    key: \"removeTextAttribute\",\n    value: function removeTextAttribute(attributeName) {\n      var selectedRange = this.getSelectedRange();\n      if (!selectedRange) return;\n      return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n    }\n  }, {\n    key: \"removeBlockAttribute\",\n    value: function removeBlockAttribute(attributeName) {\n      var selectedRange = this.getSelectedRange();\n      if (!selectedRange) return;\n      return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n    }\n  }, {\n    key: \"canDecreaseNestingLevel\",\n    value: function canDecreaseNestingLevel() {\n      var _this$getBlock;\n\n      return ((_this$getBlock = this.getBlock()) === null || _this$getBlock === void 0 ? void 0 : _this$getBlock.getNestingLevel()) > 0;\n    }\n  }, {\n    key: \"canIncreaseNestingLevel\",\n    value: function canIncreaseNestingLevel() {\n      var _getBlockConfig;\n\n      var block = this.getBlock();\n      if (!block) return;\n\n      if ((_getBlockConfig = getBlockConfig(block.getLastNestableAttribute())) !== null && _getBlockConfig !== void 0 && _getBlockConfig.listAttribute) {\n        var previousBlock = this.getPreviousBlock();\n\n        if (previousBlock) {\n          return arrayStartsWith(previousBlock.getListItemAttributes(), block.getListItemAttributes());\n        }\n      } else {\n        return block.getNestingLevel() > 0;\n      }\n    }\n  }, {\n    key: \"decreaseNestingLevel\",\n    value: function decreaseNestingLevel() {\n      var block = this.getBlock();\n      if (!block) return;\n      return this.setDocument(this.document.replaceBlock(block, block.decreaseNestingLevel()));\n    }\n  }, {\n    key: \"increaseNestingLevel\",\n    value: function increaseNestingLevel() {\n      var block = this.getBlock();\n      if (!block) return;\n      return this.setDocument(this.document.replaceBlock(block, block.increaseNestingLevel()));\n    }\n  }, {\n    key: \"canDecreaseBlockAttributeLevel\",\n    value: function canDecreaseBlockAttributeLevel() {\n      var _this$getBlock2;\n\n      return ((_this$getBlock2 = this.getBlock()) === null || _this$getBlock2 === void 0 ? void 0 : _this$getBlock2.getAttributeLevel()) > 0;\n    }\n  }, {\n    key: \"decreaseBlockAttributeLevel\",\n    value: function decreaseBlockAttributeLevel() {\n      var _this$getBlock3;\n\n      var attribute = (_this$getBlock3 = this.getBlock()) === null || _this$getBlock3 === void 0 ? void 0 : _this$getBlock3.getLastAttribute();\n\n      if (attribute) {\n        return this.removeCurrentAttribute(attribute);\n      }\n    }\n  }, {\n    key: \"decreaseListLevel\",\n    value: function decreaseListLevel() {\n      var _Array$from17 = Array.from(this.getSelectedRange()),\n          _Array$from18 = _slicedToArray2(_Array$from17, 1),\n          startPosition = _Array$from18[0];\n\n      var _this$document$locati = this.document.locationFromPosition(startPosition),\n          index = _this$document$locati.index;\n\n      var endIndex = index;\n      var attributeLevel = this.getBlock().getAttributeLevel();\n      var block = this.document.getBlockAtIndex(endIndex + 1);\n\n      while (block) {\n        if (!block.isListItem() || block.getAttributeLevel() <= attributeLevel) {\n          break;\n        }\n\n        endIndex++;\n        block = this.document.getBlockAtIndex(endIndex + 1);\n      }\n\n      startPosition = this.document.positionFromLocation({\n        index: index,\n        offset: 0\n      });\n      var endPosition = this.document.positionFromLocation({\n        index: endIndex,\n        offset: 0\n      });\n      return this.setDocument(this.document.removeLastListAttributeAtRange([startPosition, endPosition]));\n    }\n  }, {\n    key: \"updateCurrentAttributes\",\n    value: function updateCurrentAttributes() {\n      var _this31 = this;\n\n      var selectedRange = this.getSelectedRange({\n        ignoreLock: true\n      });\n\n      if (selectedRange) {\n        var currentAttributes = this.document.getCommonAttributesAtRange(selectedRange);\n        Array.from(getAllAttributeNames()).forEach(function (attributeName) {\n          if (!currentAttributes[attributeName]) {\n            if (!_this31.canSetCurrentAttribute(attributeName)) {\n              currentAttributes[attributeName] = false;\n            }\n          }\n        });\n\n        if (!objectsAreEqual(currentAttributes, this.currentAttributes)) {\n          this.currentAttributes = currentAttributes;\n          return this.notifyDelegateOfCurrentAttributesChange();\n        }\n      }\n    }\n  }, {\n    key: \"getCurrentAttributes\",\n    value: function getCurrentAttributes() {\n      return extend.call({}, this.currentAttributes);\n    }\n  }, {\n    key: \"getCurrentTextAttributes\",\n    value: function getCurrentTextAttributes() {\n      var attributes = {};\n\n      for (var key in this.currentAttributes) {\n        var value = this.currentAttributes[key];\n\n        if (value !== false) {\n          if (getTextConfig(key)) {\n            attributes[key] = value;\n          }\n        }\n      }\n\n      return attributes;\n    } // Selection freezing\n\n  }, {\n    key: \"freezeSelection\",\n    value: function freezeSelection() {\n      return this.setCurrentAttribute(\"frozen\", true);\n    }\n  }, {\n    key: \"thawSelection\",\n    value: function thawSelection() {\n      return this.removeCurrentAttribute(\"frozen\");\n    }\n  }, {\n    key: \"hasFrozenSelection\",\n    value: function hasFrozenSelection() {\n      return this.hasCurrentAttribute(\"frozen\");\n    }\n  }, {\n    key: \"setSelection\",\n    value: function setSelection(selectedRange) {\n      var _this$delegate5;\n\n      var locationRange = this.document.locationRangeFromRange(selectedRange);\n      return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.compositionDidRequestChangingSelectionToLocationRange(locationRange);\n    }\n  }, {\n    key: \"getSelectedRange\",\n    value: function getSelectedRange() {\n      var locationRange = this.getLocationRange();\n\n      if (locationRange) {\n        return this.document.rangeFromLocationRange(locationRange);\n      }\n    }\n  }, {\n    key: \"setSelectedRange\",\n    value: function setSelectedRange(selectedRange) {\n      var locationRange = this.document.locationRangeFromRange(selectedRange);\n      return this.getSelectionManager().setLocationRange(locationRange);\n    }\n  }, {\n    key: \"getPosition\",\n    value: function getPosition() {\n      var locationRange = this.getLocationRange();\n\n      if (locationRange) {\n        return this.document.positionFromLocation(locationRange[0]);\n      }\n    }\n  }, {\n    key: \"getLocationRange\",\n    value: function getLocationRange(options) {\n      if (this.targetLocationRange) {\n        return this.targetLocationRange;\n      } else {\n        return this.getSelectionManager().getLocationRange(options) || normalizeRange({\n          index: 0,\n          offset: 0\n        });\n      }\n    }\n  }, {\n    key: \"withTargetLocationRange\",\n    value: function withTargetLocationRange(locationRange, fn) {\n      var result;\n      this.targetLocationRange = locationRange;\n\n      try {\n        result = fn();\n      } finally {\n        this.targetLocationRange = null;\n      }\n\n      return result;\n    }\n  }, {\n    key: \"withTargetRange\",\n    value: function withTargetRange(range, fn) {\n      var locationRange = this.document.locationRangeFromRange(range);\n      return this.withTargetLocationRange(locationRange, fn);\n    }\n  }, {\n    key: \"withTargetDOMRange\",\n    value: function withTargetDOMRange(domRange, fn) {\n      var locationRange = this.createLocationRangeFromDOMRange(domRange, {\n        strict: false\n      });\n      return this.withTargetLocationRange(locationRange, fn);\n    }\n  }, {\n    key: \"getExpandedRangeInDirection\",\n    value: function getExpandedRangeInDirection(direction) {\n      var _ref13 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          length = _ref13.length;\n\n      var _Array$from19 = Array.from(this.getSelectedRange()),\n          _Array$from20 = _slicedToArray2(_Array$from19, 2),\n          startPosition = _Array$from20[0],\n          endPosition = _Array$from20[1];\n\n      if (direction === \"backward\") {\n        if (length) {\n          startPosition -= length;\n        } else {\n          startPosition = this.translateUTF16PositionFromOffset(startPosition, -1);\n        }\n      } else {\n        if (length) {\n          endPosition += length;\n        } else {\n          endPosition = this.translateUTF16PositionFromOffset(endPosition, 1);\n        }\n      }\n\n      return normalizeRange([startPosition, endPosition]);\n    }\n  }, {\n    key: \"shouldManageMovingCursorInDirection\",\n    value: function shouldManageMovingCursorInDirection(direction) {\n      if (this.editingAttachment) {\n        return true;\n      }\n\n      var range = this.getExpandedRangeInDirection(direction);\n      return this.getAttachmentAtRange(range) != null;\n    }\n  }, {\n    key: \"moveCursorInDirection\",\n    value: function moveCursorInDirection(direction) {\n      var canEditAttachment, range;\n\n      if (this.editingAttachment) {\n        range = this.document.getRangeOfAttachment(this.editingAttachment);\n      } else {\n        var selectedRange = this.getSelectedRange();\n        range = this.getExpandedRangeInDirection(direction);\n        canEditAttachment = !rangesAreEqual(selectedRange, range);\n      }\n\n      if (direction === \"backward\") {\n        this.setSelectedRange(range[0]);\n      } else {\n        this.setSelectedRange(range[1]);\n      }\n\n      if (canEditAttachment) {\n        var attachment = this.getAttachmentAtRange(range);\n\n        if (attachment) {\n          return this.editAttachment(attachment);\n        }\n      }\n    }\n  }, {\n    key: \"expandSelectionInDirection\",\n    value: function expandSelectionInDirection(direction) {\n      var _ref14 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          length = _ref14.length;\n\n      var range = this.getExpandedRangeInDirection(direction, {\n        length: length\n      });\n      return this.setSelectedRange(range);\n    }\n  }, {\n    key: \"expandSelectionForEditing\",\n    value: function expandSelectionForEditing() {\n      if (this.hasCurrentAttribute(\"href\")) {\n        return this.expandSelectionAroundCommonAttribute(\"href\");\n      }\n    }\n  }, {\n    key: \"expandSelectionAroundCommonAttribute\",\n    value: function expandSelectionAroundCommonAttribute(attributeName) {\n      var position = this.getPosition();\n      var range = this.document.getRangeOfCommonAttributeAtPosition(attributeName, position);\n      return this.setSelectedRange(range);\n    }\n  }, {\n    key: \"selectionContainsAttachments\",\n    value: function selectionContainsAttachments() {\n      var _this$getSelectedAtta;\n\n      return ((_this$getSelectedAtta = this.getSelectedAttachments()) === null || _this$getSelectedAtta === void 0 ? void 0 : _this$getSelectedAtta.length) > 0;\n    }\n  }, {\n    key: \"selectionIsInCursorTarget\",\n    value: function selectionIsInCursorTarget() {\n      return this.editingAttachment || this.positionIsCursorTarget(this.getPosition());\n    }\n  }, {\n    key: \"positionIsCursorTarget\",\n    value: function positionIsCursorTarget(position) {\n      var location = this.document.locationFromPosition(position);\n\n      if (location) {\n        return this.locationIsCursorTarget(location);\n      }\n    }\n  }, {\n    key: \"positionIsBlockBreak\",\n    value: function positionIsBlockBreak(position) {\n      var _this$document$getPie;\n\n      return (_this$document$getPie = this.document.getPieceAtPosition(position)) === null || _this$document$getPie === void 0 ? void 0 : _this$document$getPie.isBlockBreak();\n    }\n  }, {\n    key: \"getSelectedDocument\",\n    value: function getSelectedDocument() {\n      var selectedRange = this.getSelectedRange();\n\n      if (selectedRange) {\n        return this.document.getDocumentAtRange(selectedRange);\n      }\n    }\n  }, {\n    key: \"getSelectedAttachments\",\n    value: function getSelectedAttachments() {\n      var _this$getSelectedDocu;\n\n      return (_this$getSelectedDocu = this.getSelectedDocument()) === null || _this$getSelectedDocu === void 0 ? void 0 : _this$getSelectedDocu.getAttachments();\n    } // Attachments\n\n  }, {\n    key: \"getAttachments\",\n    value: function getAttachments() {\n      return this.attachments.slice(0);\n    }\n  }, {\n    key: \"refreshAttachments\",\n    value: function refreshAttachments() {\n      var _this32 = this;\n\n      var attachments = this.document.getAttachments();\n\n      var _summarizeArrayChange = summarizeArrayChange(this.attachments, attachments),\n          added = _summarizeArrayChange.added,\n          removed = _summarizeArrayChange.removed;\n\n      this.attachments = attachments;\n      Array.from(removed).forEach(function (attachment) {\n        var _this$delegate6, _this$delegate6$compo;\n\n        attachment.delegate = null;\n        (_this$delegate6 = _this32.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionDidRemoveAttachment) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6, attachment);\n      });\n      return function () {\n        var result = [];\n        Array.from(added).forEach(function (attachment) {\n          var _this$delegate7, _this$delegate7$compo;\n\n          attachment.delegate = _this32;\n          result.push((_this$delegate7 = _this32.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionDidAddAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment));\n        });\n        return result;\n      }();\n    } // Attachment delegate\n\n  }, {\n    key: \"attachmentDidChangeAttributes\",\n    value: function attachmentDidChangeAttributes(attachment) {\n      var _this$delegate8, _this$delegate8$compo;\n\n      this.revision++;\n      return (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionDidEditAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n    }\n  }, {\n    key: \"attachmentDidChangePreviewURL\",\n    value: function attachmentDidChangePreviewURL(attachment) {\n      var _this$delegate9, _this$delegate9$compo;\n\n      this.revision++;\n      return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionDidChangeAttachmentPreviewURL) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n    } // Attachment editing\n\n  }, {\n    key: \"editAttachment\",\n    value: function editAttachment(attachment, options) {\n      var _this$delegate10, _this$delegate10$comp;\n\n      if (attachment === this.editingAttachment) return;\n      this.stopEditingAttachment();\n      this.editingAttachment = attachment;\n      return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionDidStartEditingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, this.editingAttachment, options);\n    }\n  }, {\n    key: \"stopEditingAttachment\",\n    value: function stopEditingAttachment() {\n      var _this$delegate11, _this$delegate11$comp;\n\n      if (!this.editingAttachment) return;\n      (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : (_this$delegate11$comp = _this$delegate11.compositionDidStopEditingAttachment) === null || _this$delegate11$comp === void 0 ? void 0 : _this$delegate11$comp.call(_this$delegate11, this.editingAttachment);\n      this.editingAttachment = null;\n    }\n  }, {\n    key: \"updateAttributesForAttachment\",\n    value: function updateAttributesForAttachment(attributes, attachment) {\n      return this.setDocument(this.document.updateAttributesForAttachment(attributes, attachment));\n    }\n  }, {\n    key: \"removeAttributeForAttachment\",\n    value: function removeAttributeForAttachment(attribute, attachment) {\n      return this.setDocument(this.document.removeAttributeForAttachment(attribute, attachment));\n    } // Private\n\n  }, {\n    key: \"breakFormattedBlock\",\n    value: function breakFormattedBlock(insertion) {\n      var document = insertion.document;\n      var block = insertion.block;\n      var position = insertion.startPosition;\n      var range = [position - 1, position];\n\n      if (block.getBlockBreakPosition() === insertion.startLocation.offset) {\n        if (block.breaksOnReturn() && insertion.nextCharacter === \"\\n\") {\n          position += 1;\n        } else {\n          document = document.removeTextAtRange(range);\n        }\n\n        range = [position, position];\n      } else if (insertion.nextCharacter === \"\\n\") {\n        if (insertion.previousCharacter === \"\\n\") {\n          range = [position - 1, position + 1];\n        } else {\n          range = [position, position + 1];\n          position += 1;\n        }\n      } else if (insertion.startLocation.offset - 1 !== 0) {\n        position += 1;\n      }\n\n      var newDocument = new Document([block.removeLastAttribute().copyWithoutText()]);\n      this.setDocument(document.insertDocumentAtRange(newDocument, range));\n      return this.setSelection(position);\n    }\n  }, {\n    key: \"getPreviousBlock\",\n    value: function getPreviousBlock() {\n      var locationRange = this.getLocationRange();\n\n      if (locationRange) {\n        var index = locationRange[0].index;\n\n        if (index > 0) {\n          return this.document.getBlockAtIndex(index - 1);\n        }\n      }\n    }\n  }, {\n    key: \"getBlock\",\n    value: function getBlock() {\n      var locationRange = this.getLocationRange();\n\n      if (locationRange) {\n        return this.document.getBlockAtIndex(locationRange[0].index);\n      }\n    }\n  }, {\n    key: \"getAttachmentAtRange\",\n    value: function getAttachmentAtRange(range) {\n      var document = this.document.getDocumentAtRange(range);\n\n      if (document.toString() === \"\".concat(OBJECT_REPLACEMENT_CHARACTER, \"\\n\")) {\n        return document.getAttachments()[0];\n      }\n    }\n  }, {\n    key: \"notifyDelegateOfCurrentAttributesChange\",\n    value: function notifyDelegateOfCurrentAttributesChange() {\n      var _this$delegate12, _this$delegate12$comp;\n\n      return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : (_this$delegate12$comp = _this$delegate12.compositionDidChangeCurrentAttributes) === null || _this$delegate12$comp === void 0 ? void 0 : _this$delegate12$comp.call(_this$delegate12, this.currentAttributes);\n    }\n  }, {\n    key: \"notifyDelegateOfInsertionAtRange\",\n    value: function notifyDelegateOfInsertionAtRange(range) {\n      var _this$delegate13, _this$delegate13$comp;\n\n      return (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : (_this$delegate13$comp = _this$delegate13.compositionDidPerformInsertionAtRange) === null || _this$delegate13$comp === void 0 ? void 0 : _this$delegate13$comp.call(_this$delegate13, range);\n    }\n  }, {\n    key: \"translateUTF16PositionFromOffset\",\n    value: function translateUTF16PositionFromOffset(position, offset) {\n      var utf16string = this.document.toUTF16String();\n      var utf16position = utf16string.offsetFromUCS2Offset(position);\n      return utf16string.offsetToUCS2Offset(utf16position + offset);\n    }\n  }]);\n\n  return Composition;\n}(BasicObject);\n\nComposition.proxyMethod(\"getSelectionManager().getPointRange\");\nComposition.proxyMethod(\"getSelectionManager().setLocationRangeFromPointRange\");\nComposition.proxyMethod(\"getSelectionManager().createLocationRangeFromDOMRange\");\nComposition.proxyMethod(\"getSelectionManager().locationIsCursorTarget\");\nComposition.proxyMethod(\"getSelectionManager().selectionIsExpanded\");\nComposition.proxyMethod(\"delegate?.getSelectionManager\");\n\nvar UndoManager = /*#__PURE__*/function (_BasicObject11) {\n  _inherits2(UndoManager, _BasicObject11);\n\n  var _super22 = _createSuper2(UndoManager);\n\n  function UndoManager(composition) {\n    var _this33;\n\n    _classCallCheck2(this, UndoManager);\n\n    _this33 = _super22.apply(this, arguments);\n    _this33.composition = composition;\n    _this33.undoEntries = [];\n    _this33.redoEntries = [];\n    return _this33;\n  }\n\n  _createClass2(UndoManager, [{\n    key: \"recordUndoEntry\",\n    value: function recordUndoEntry(description) {\n      var _ref15 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          context = _ref15.context,\n          consolidatable = _ref15.consolidatable;\n\n      var previousEntry = this.undoEntries.slice(-1)[0];\n\n      if (!consolidatable || !entryHasDescriptionAndContext(previousEntry, description, context)) {\n        var undoEntry = this.createEntry({\n          description: description,\n          context: context\n        });\n        this.undoEntries.push(undoEntry);\n        this.redoEntries = [];\n      }\n    }\n  }, {\n    key: \"undo\",\n    value: function undo() {\n      var undoEntry = this.undoEntries.pop();\n\n      if (undoEntry) {\n        var redoEntry = this.createEntry(undoEntry);\n        this.redoEntries.push(redoEntry);\n        return this.composition.loadSnapshot(undoEntry.snapshot);\n      }\n    }\n  }, {\n    key: \"redo\",\n    value: function redo() {\n      var redoEntry = this.redoEntries.pop();\n\n      if (redoEntry) {\n        var undoEntry = this.createEntry(redoEntry);\n        this.undoEntries.push(undoEntry);\n        return this.composition.loadSnapshot(redoEntry.snapshot);\n      }\n    }\n  }, {\n    key: \"canUndo\",\n    value: function canUndo() {\n      return this.undoEntries.length > 0;\n    }\n  }, {\n    key: \"canRedo\",\n    value: function canRedo() {\n      return this.redoEntries.length > 0;\n    } // Private\n\n  }, {\n    key: \"createEntry\",\n    value: function createEntry() {\n      var _ref16 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          description = _ref16.description,\n          context = _ref16.context;\n\n      return {\n        description: description === null || description === void 0 ? void 0 : description.toString(),\n        context: JSON.stringify(context),\n        snapshot: this.composition.getSnapshot()\n      };\n    }\n  }]);\n\n  return UndoManager;\n}(BasicObject);\n\nvar entryHasDescriptionAndContext = function entryHasDescriptionAndContext(entry, description, context) {\n  return (entry === null || entry === void 0 ? void 0 : entry.description) === (description === null || description === void 0 ? void 0 : description.toString()) && (entry === null || entry === void 0 ? void 0 : entry.context) === JSON.stringify(context);\n};\n\nvar attachmentGalleryFilter = function attachmentGalleryFilter(snapshot) {\n  var filter = new Filter(snapshot);\n  filter.perform();\n  return filter.getSnapshot();\n};\n\nvar BLOCK_ATTRIBUTE_NAME = \"attachmentGallery\";\nvar TEXT_ATTRIBUTE_NAME = \"presentation\";\nvar TEXT_ATTRIBUTE_VALUE = \"gallery\";\n\nvar Filter = /*#__PURE__*/function () {\n  function Filter(snapshot) {\n    _classCallCheck2(this, Filter);\n\n    this.document = snapshot.document;\n    this.selectedRange = snapshot.selectedRange;\n  }\n\n  _createClass2(Filter, [{\n    key: \"perform\",\n    value: function perform() {\n      this.removeBlockAttribute();\n      return this.applyBlockAttribute();\n    }\n  }, {\n    key: \"getSnapshot\",\n    value: function getSnapshot() {\n      return {\n        document: this.document,\n        selectedRange: this.selectedRange\n      };\n    } // Private\n\n  }, {\n    key: \"removeBlockAttribute\",\n    value: function removeBlockAttribute() {\n      var _this34 = this;\n\n      return this.findRangesOfBlocks().map(function (range) {\n        return _this34.document = _this34.document.removeAttributeAtRange(BLOCK_ATTRIBUTE_NAME, range);\n      });\n    }\n  }, {\n    key: \"applyBlockAttribute\",\n    value: function applyBlockAttribute() {\n      var _this35 = this;\n\n      var offset = 0;\n      this.findRangesOfPieces().forEach(function (range) {\n        if (range[1] - range[0] > 1) {\n          range[0] += offset;\n          range[1] += offset;\n\n          if (_this35.document.getCharacterAtPosition(range[1]) !== \"\\n\") {\n            _this35.document = _this35.document.insertBlockBreakAtRange(range[1]);\n\n            if (range[1] < _this35.selectedRange[1]) {\n              _this35.moveSelectedRangeForward();\n            }\n\n            range[1]++;\n            offset++;\n          }\n\n          if (range[0] !== 0) {\n            if (_this35.document.getCharacterAtPosition(range[0] - 1) !== \"\\n\") {\n              _this35.document = _this35.document.insertBlockBreakAtRange(range[0]);\n\n              if (range[0] < _this35.selectedRange[0]) {\n                _this35.moveSelectedRangeForward();\n              }\n\n              range[0]++;\n              offset++;\n            }\n          }\n\n          _this35.document = _this35.document.applyBlockAttributeAtRange(BLOCK_ATTRIBUTE_NAME, true, range);\n        }\n      });\n    }\n  }, {\n    key: \"findRangesOfBlocks\",\n    value: function findRangesOfBlocks() {\n      return this.document.findRangesForBlockAttribute(BLOCK_ATTRIBUTE_NAME);\n    }\n  }, {\n    key: \"findRangesOfPieces\",\n    value: function findRangesOfPieces() {\n      return this.document.findRangesForTextAttribute(TEXT_ATTRIBUTE_NAME, {\n        withValue: TEXT_ATTRIBUTE_VALUE\n      });\n    }\n  }, {\n    key: \"moveSelectedRangeForward\",\n    value: function moveSelectedRangeForward() {\n      this.selectedRange[0] += 1;\n      this.selectedRange[1] += 1;\n    }\n  }]);\n\n  return Filter;\n}();\n\nvar DEFAULT_FILTERS = [attachmentGalleryFilter];\n\nvar Editor = /*#__PURE__*/function () {\n  function Editor(composition, selectionManager, element) {\n    _classCallCheck2(this, Editor);\n\n    this.insertFiles = this.insertFiles.bind(this);\n    this.composition = composition;\n    this.selectionManager = selectionManager;\n    this.element = element;\n    this.undoManager = new UndoManager(this.composition);\n    this.filters = DEFAULT_FILTERS.slice(0);\n  }\n\n  _createClass2(Editor, [{\n    key: \"loadDocument\",\n    value: function loadDocument(document) {\n      return this.loadSnapshot({\n        document: document,\n        selectedRange: [0, 0]\n      });\n    }\n  }, {\n    key: \"loadHTML\",\n    value: function loadHTML() {\n      var html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n      var document = HTMLParser.parse(html, {\n        referenceElement: this.element\n      }).getDocument();\n      return this.loadDocument(document);\n    }\n  }, {\n    key: \"loadJSON\",\n    value: function loadJSON(_ref) {\n      var document = _ref.document,\n          selectedRange = _ref.selectedRange;\n      document = Document.fromJSON(document);\n      return this.loadSnapshot({\n        document: document,\n        selectedRange: selectedRange\n      });\n    }\n  }, {\n    key: \"loadSnapshot\",\n    value: function loadSnapshot(snapshot) {\n      this.undoManager = new UndoManager(this.composition);\n      return this.composition.loadSnapshot(snapshot);\n    }\n  }, {\n    key: \"getDocument\",\n    value: function getDocument() {\n      return this.composition.document;\n    }\n  }, {\n    key: \"getSelectedDocument\",\n    value: function getSelectedDocument() {\n      return this.composition.getSelectedDocument();\n    }\n  }, {\n    key: \"getSnapshot\",\n    value: function getSnapshot() {\n      return this.composition.getSnapshot();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.getSnapshot();\n    } // Document manipulation\n\n  }, {\n    key: \"deleteInDirection\",\n    value: function deleteInDirection(direction) {\n      return this.composition.deleteInDirection(direction);\n    }\n  }, {\n    key: \"insertAttachment\",\n    value: function insertAttachment(attachment) {\n      return this.composition.insertAttachment(attachment);\n    }\n  }, {\n    key: \"insertAttachments\",\n    value: function insertAttachments(attachments) {\n      return this.composition.insertAttachments(attachments);\n    }\n  }, {\n    key: \"insertDocument\",\n    value: function insertDocument(document) {\n      return this.composition.insertDocument(document);\n    }\n  }, {\n    key: \"insertFile\",\n    value: function insertFile(file) {\n      return this.composition.insertFile(file);\n    }\n  }, {\n    key: \"insertFiles\",\n    value: function insertFiles(files) {\n      return this.composition.insertFiles(files);\n    }\n  }, {\n    key: \"insertHTML\",\n    value: function insertHTML(html) {\n      return this.composition.insertHTML(html);\n    }\n  }, {\n    key: \"insertString\",\n    value: function insertString(string) {\n      return this.composition.insertString(string);\n    }\n  }, {\n    key: \"insertText\",\n    value: function insertText(text) {\n      return this.composition.insertText(text);\n    }\n  }, {\n    key: \"insertLineBreak\",\n    value: function insertLineBreak() {\n      return this.composition.insertLineBreak();\n    } // Selection\n\n  }, {\n    key: \"getSelectedRange\",\n    value: function getSelectedRange() {\n      return this.composition.getSelectedRange();\n    }\n  }, {\n    key: \"getPosition\",\n    value: function getPosition() {\n      return this.composition.getPosition();\n    }\n  }, {\n    key: \"getClientRectAtPosition\",\n    value: function getClientRectAtPosition(position) {\n      var locationRange = this.getDocument().locationRangeFromRange([position, position + 1]);\n      return this.selectionManager.getClientRectAtLocationRange(locationRange);\n    }\n  }, {\n    key: \"expandSelectionInDirection\",\n    value: function expandSelectionInDirection(direction) {\n      return this.composition.expandSelectionInDirection(direction);\n    }\n  }, {\n    key: \"moveCursorInDirection\",\n    value: function moveCursorInDirection(direction) {\n      return this.composition.moveCursorInDirection(direction);\n    }\n  }, {\n    key: \"setSelectedRange\",\n    value: function setSelectedRange(selectedRange) {\n      return this.composition.setSelectedRange(selectedRange);\n    } // Attributes\n\n  }, {\n    key: \"activateAttribute\",\n    value: function activateAttribute(name) {\n      var value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      return this.composition.setCurrentAttribute(name, value);\n    }\n  }, {\n    key: \"attributeIsActive\",\n    value: function attributeIsActive(name) {\n      return this.composition.hasCurrentAttribute(name);\n    }\n  }, {\n    key: \"canActivateAttribute\",\n    value: function canActivateAttribute(name) {\n      return this.composition.canSetCurrentAttribute(name);\n    }\n  }, {\n    key: \"deactivateAttribute\",\n    value: function deactivateAttribute(name) {\n      return this.composition.removeCurrentAttribute(name);\n    } // Nesting level\n\n  }, {\n    key: \"canDecreaseNestingLevel\",\n    value: function canDecreaseNestingLevel() {\n      return this.composition.canDecreaseNestingLevel();\n    }\n  }, {\n    key: \"canIncreaseNestingLevel\",\n    value: function canIncreaseNestingLevel() {\n      return this.composition.canIncreaseNestingLevel();\n    }\n  }, {\n    key: \"decreaseNestingLevel\",\n    value: function decreaseNestingLevel() {\n      if (this.canDecreaseNestingLevel()) {\n        return this.composition.decreaseNestingLevel();\n      }\n    }\n  }, {\n    key: \"increaseNestingLevel\",\n    value: function increaseNestingLevel() {\n      if (this.canIncreaseNestingLevel()) {\n        return this.composition.increaseNestingLevel();\n      }\n    } // Undo/redo\n\n  }, {\n    key: \"canRedo\",\n    value: function canRedo() {\n      return this.undoManager.canRedo();\n    }\n  }, {\n    key: \"canUndo\",\n    value: function canUndo() {\n      return this.undoManager.canUndo();\n    }\n  }, {\n    key: \"recordUndoEntry\",\n    value: function recordUndoEntry(description) {\n      var _ref17 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          context = _ref17.context,\n          consolidatable = _ref17.consolidatable;\n\n      return this.undoManager.recordUndoEntry(description, {\n        context: context,\n        consolidatable: consolidatable\n      });\n    }\n  }, {\n    key: \"redo\",\n    value: function redo() {\n      if (this.canRedo()) {\n        return this.undoManager.redo();\n      }\n    }\n  }, {\n    key: \"undo\",\n    value: function undo() {\n      if (this.canUndo()) {\n        return this.undoManager.undo();\n      }\n    }\n  }]);\n\n  return Editor;\n}();\n/* eslint-disable\n    no-var,\n    prefer-const,\n*/\n\n\nvar LocationMapper = /*#__PURE__*/function () {\n  function LocationMapper(element) {\n    _classCallCheck2(this, LocationMapper);\n\n    this.element = element;\n  }\n\n  _createClass2(LocationMapper, [{\n    key: \"findLocationFromContainerAndOffset\",\n    value: function findLocationFromContainerAndOffset(container, offset) {\n      var _ref18 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n        strict: true\n      },\n          strict = _ref18.strict;\n\n      var childIndex = 0;\n      var foundBlock = false;\n      var location = {\n        index: 0,\n        offset: 0\n      };\n      var attachmentElement = this.findAttachmentElementParentForNode(container);\n\n      if (attachmentElement) {\n        container = attachmentElement.parentNode;\n        offset = findChildIndexOfNode(attachmentElement);\n      }\n\n      var walker = walkTree(this.element, {\n        usingFilter: rejectAttachmentContents\n      });\n\n      while (walker.nextNode()) {\n        var node = walker.currentNode;\n\n        if (node === container && nodeIsTextNode(container)) {\n          if (!nodeIsCursorTarget(node)) {\n            location.offset += offset;\n          }\n\n          break;\n        } else {\n          if (node.parentNode === container) {\n            if (childIndex++ === offset) {\n              break;\n            }\n          } else if (!elementContainsNode(container, node)) {\n            if (childIndex > 0) {\n              break;\n            }\n          }\n\n          if (nodeIsBlockStart(node, {\n            strict: strict\n          })) {\n            if (foundBlock) {\n              location.index++;\n            }\n\n            location.offset = 0;\n            foundBlock = true;\n          } else {\n            location.offset += nodeLength(node);\n          }\n        }\n      }\n\n      return location;\n    }\n  }, {\n    key: \"findContainerAndOffsetFromLocation\",\n    value: function findContainerAndOffsetFromLocation(location) {\n      var container, offset;\n\n      if (location.index === 0 && location.offset === 0) {\n        container = this.element;\n        offset = 0;\n\n        while (container.firstChild) {\n          container = container.firstChild;\n\n          if (nodeIsBlockContainer(container)) {\n            offset = 1;\n            break;\n          }\n        }\n\n        return [container, offset];\n      }\n\n      var _this$findNodeAndOffs = this.findNodeAndOffsetFromLocation(location),\n          _this$findNodeAndOffs2 = _slicedToArray2(_this$findNodeAndOffs, 2),\n          node = _this$findNodeAndOffs2[0],\n          nodeOffset = _this$findNodeAndOffs2[1];\n\n      if (!node) return;\n\n      if (nodeIsTextNode(node)) {\n        if (nodeLength(node) === 0) {\n          container = node.parentNode.parentNode;\n          offset = findChildIndexOfNode(node.parentNode);\n\n          if (nodeIsCursorTarget(node, {\n            name: \"right\"\n          })) {\n            offset++;\n          }\n        } else {\n          container = node;\n          offset = location.offset - nodeOffset;\n        }\n      } else {\n        container = node.parentNode;\n\n        if (!nodeIsBlockStart(node.previousSibling)) {\n          if (!nodeIsBlockContainer(container)) {\n            while (node === container.lastChild) {\n              node = container;\n              container = container.parentNode;\n\n              if (nodeIsBlockContainer(container)) {\n                break;\n              }\n            }\n          }\n        }\n\n        offset = findChildIndexOfNode(node);\n\n        if (location.offset !== 0) {\n          offset++;\n        }\n      }\n\n      return [container, offset];\n    }\n  }, {\n    key: \"findNodeAndOffsetFromLocation\",\n    value: function findNodeAndOffsetFromLocation(location) {\n      var node, nodeOffset;\n      var offset = 0;\n\n      var _iterator5 = _createForOfIteratorHelper2(this.getSignificantNodesForIndex(location.index)),\n          _step6;\n\n      try {\n        for (_iterator5.s(); !(_step6 = _iterator5.n()).done;) {\n          var currentNode = _step6.value;\n          var length = nodeLength(currentNode);\n\n          if (location.offset <= offset + length) {\n            if (nodeIsTextNode(currentNode)) {\n              node = currentNode;\n              nodeOffset = offset;\n\n              if (location.offset === nodeOffset && nodeIsCursorTarget(node)) {\n                break;\n              }\n            } else if (!node) {\n              node = currentNode;\n              nodeOffset = offset;\n            }\n          }\n\n          offset += length;\n\n          if (offset > location.offset) {\n            break;\n          }\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n\n      return [node, nodeOffset];\n    } // Private\n\n  }, {\n    key: \"findAttachmentElementParentForNode\",\n    value: function findAttachmentElementParentForNode(node) {\n      while (node && node !== this.element) {\n        if (nodeIsAttachmentElement(node)) {\n          return node;\n        }\n\n        node = node.parentNode;\n      }\n    }\n  }, {\n    key: \"getSignificantNodesForIndex\",\n    value: function getSignificantNodesForIndex(index) {\n      var nodes = [];\n      var walker = walkTree(this.element, {\n        usingFilter: acceptSignificantNodes\n      });\n      var recordingNodes = false;\n\n      while (walker.nextNode()) {\n        var node = walker.currentNode;\n\n        if (nodeIsBlockStartComment(node)) {\n          var blockIndex;\n\n          if (blockIndex != null) {\n            blockIndex++;\n          } else {\n            blockIndex = 0;\n          }\n\n          if (blockIndex === index) {\n            recordingNodes = true;\n          } else if (recordingNodes) {\n            break;\n          }\n        } else if (recordingNodes) {\n          nodes.push(node);\n        }\n      }\n\n      return nodes;\n    }\n  }]);\n\n  return LocationMapper;\n}();\n\nvar nodeLength = function nodeLength(node) {\n  if (node.nodeType === Node.TEXT_NODE) {\n    if (nodeIsCursorTarget(node)) {\n      return 0;\n    } else {\n      var string = node.textContent;\n      return string.length;\n    }\n  } else if (tagName(node) === \"br\" || nodeIsAttachmentElement(node)) {\n    return 1;\n  } else {\n    return 0;\n  }\n};\n\nvar acceptSignificantNodes = function acceptSignificantNodes(node) {\n  if (rejectEmptyTextNodes(node) === NodeFilter.FILTER_ACCEPT) {\n    return rejectAttachmentContents(node);\n  } else {\n    return NodeFilter.FILTER_REJECT;\n  }\n};\n\nvar rejectEmptyTextNodes = function rejectEmptyTextNodes(node) {\n  if (nodeIsEmptyTextNode(node)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n\nvar rejectAttachmentContents = function rejectAttachmentContents(node) {\n  if (nodeIsAttachmentElement(node.parentNode)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n/* eslint-disable\n    id-length,\n    no-empty,\n*/\n\n\nvar PointMapper = /*#__PURE__*/function () {\n  function PointMapper() {\n    _classCallCheck2(this, PointMapper);\n  }\n\n  _createClass2(PointMapper, [{\n    key: \"createDOMRangeFromPoint\",\n    value: function createDOMRangeFromPoint(_ref) {\n      var x = _ref.x,\n          y = _ref.y;\n      var domRange;\n\n      if (document.caretPositionFromPoint) {\n        var _document$caretPositi = document.caretPositionFromPoint(x, y),\n            offsetNode = _document$caretPositi.offsetNode,\n            offset = _document$caretPositi.offset;\n\n        domRange = document.createRange();\n        domRange.setStart(offsetNode, offset);\n        return domRange;\n      } else if (document.caretRangeFromPoint) {\n        return document.caretRangeFromPoint(x, y);\n      } else if (document.body.createTextRange) {\n        var originalDOMRange = getDOMRange();\n\n        try {\n          // IE 11 throws \"Unspecified error\" when using moveToPoint\n          // during a drag-and-drop operation.\n          var textRange = document.body.createTextRange();\n          textRange.moveToPoint(x, y);\n          textRange.select();\n        } catch (error) {}\n\n        domRange = getDOMRange();\n        setDOMRange(originalDOMRange);\n        return domRange;\n      }\n    }\n  }, {\n    key: \"getClientRectsForDOMRange\",\n    value: function getClientRectsForDOMRange(domRange) {\n      var array = Array.from(domRange.getClientRects());\n      var start = array[0];\n      var end = array[array.length - 1];\n      return [start, end];\n    }\n  }]);\n\n  return PointMapper;\n}();\n/* eslint-disable\n*/\n\n\nvar SelectionManager = /*#__PURE__*/function (_BasicObject12) {\n  _inherits2(SelectionManager, _BasicObject12);\n\n  var _super23 = _createSuper2(SelectionManager);\n\n  function SelectionManager(element) {\n    var _this36;\n\n    _classCallCheck2(this, SelectionManager);\n\n    _this36 = _super23.apply(this, arguments);\n    _this36.didMouseDown = _this36.didMouseDown.bind(_assertThisInitialized2(_this36));\n    _this36.selectionDidChange = _this36.selectionDidChange.bind(_assertThisInitialized2(_this36));\n    _this36.element = element;\n    _this36.locationMapper = new LocationMapper(_this36.element);\n    _this36.pointMapper = new PointMapper();\n    _this36.lockCount = 0;\n    handleEvent(\"mousedown\", {\n      onElement: _this36.element,\n      withCallback: _this36.didMouseDown\n    });\n    return _this36;\n  }\n\n  _createClass2(SelectionManager, [{\n    key: \"getLocationRange\",\n    value: function getLocationRange() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      if (options.strict === false) {\n        return this.createLocationRangeFromDOMRange(getDOMRange());\n      } else if (options.ignoreLock) {\n        return this.currentLocationRange;\n      } else if (this.lockedLocationRange) {\n        return this.lockedLocationRange;\n      } else {\n        return this.currentLocationRange;\n      }\n    }\n  }, {\n    key: \"setLocationRange\",\n    value: function setLocationRange(locationRange) {\n      if (this.lockedLocationRange) return;\n      locationRange = normalizeRange(locationRange);\n      var domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n      if (domRange) {\n        setDOMRange(domRange);\n        this.updateCurrentLocationRange(locationRange);\n      }\n    }\n  }, {\n    key: \"setLocationRangeFromPointRange\",\n    value: function setLocationRangeFromPointRange(pointRange) {\n      pointRange = normalizeRange(pointRange);\n      var startLocation = this.getLocationAtPoint(pointRange[0]);\n      var endLocation = this.getLocationAtPoint(pointRange[1]);\n      this.setLocationRange([startLocation, endLocation]);\n    }\n  }, {\n    key: \"getClientRectAtLocationRange\",\n    value: function getClientRectAtLocationRange(locationRange) {\n      var domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n      if (domRange) {\n        return this.getClientRectsForDOMRange(domRange)[1];\n      }\n    }\n  }, {\n    key: \"locationIsCursorTarget\",\n    value: function locationIsCursorTarget(location) {\n      var node = Array.from(this.findNodeAndOffsetFromLocation(location))[0];\n      return nodeIsCursorTarget(node);\n    }\n  }, {\n    key: \"lock\",\n    value: function lock() {\n      if (this.lockCount++ === 0) {\n        this.updateCurrentLocationRange();\n        this.lockedLocationRange = this.getLocationRange();\n      }\n    }\n  }, {\n    key: \"unlock\",\n    value: function unlock() {\n      if (--this.lockCount === 0) {\n        var lockedLocationRange = this.lockedLocationRange;\n        this.lockedLocationRange = null;\n\n        if (lockedLocationRange != null) {\n          return this.setLocationRange(lockedLocationRange);\n        }\n      }\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      var _getDOMSelection;\n\n      return (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.removeAllRanges();\n    }\n  }, {\n    key: \"selectionIsCollapsed\",\n    value: function selectionIsCollapsed() {\n      var _getDOMRange;\n\n      return ((_getDOMRange = getDOMRange()) === null || _getDOMRange === void 0 ? void 0 : _getDOMRange.collapsed) === true;\n    }\n  }, {\n    key: \"selectionIsExpanded\",\n    value: function selectionIsExpanded() {\n      return !this.selectionIsCollapsed();\n    }\n  }, {\n    key: \"createLocationRangeFromDOMRange\",\n    value: function createLocationRangeFromDOMRange(domRange, options) {\n      if (domRange == null || !this.domRangeWithinElement(domRange)) return;\n      var start = this.findLocationFromContainerAndOffset(domRange.startContainer, domRange.startOffset, options);\n      if (!start) return;\n      var end = domRange.collapsed ? undefined : this.findLocationFromContainerAndOffset(domRange.endContainer, domRange.endOffset, options);\n      return normalizeRange([start, end]);\n    }\n  }, {\n    key: \"didMouseDown\",\n    value: function didMouseDown() {\n      return this.pauseTemporarily();\n    }\n  }, {\n    key: \"pauseTemporarily\",\n    value: function pauseTemporarily() {\n      var _this37 = this;\n\n      var resumeHandlers;\n      this.paused = true;\n\n      var resume = function resume() {\n        _this37.paused = false;\n        clearTimeout(resumeTimeout);\n        Array.from(resumeHandlers).forEach(function (handler) {\n          handler.destroy();\n        });\n\n        if (elementContainsNode(document, _this37.element)) {\n          return _this37.selectionDidChange();\n        }\n      };\n\n      var resumeTimeout = setTimeout(resume, 200);\n      resumeHandlers = [\"mousemove\", \"keydown\"].map(function (eventName) {\n        return handleEvent(eventName, {\n          onElement: document,\n          withCallback: resume\n        });\n      });\n    }\n  }, {\n    key: \"selectionDidChange\",\n    value: function selectionDidChange() {\n      if (!this.paused && !innerElementIsActive(this.element)) {\n        return this.updateCurrentLocationRange();\n      }\n    }\n  }, {\n    key: \"updateCurrentLocationRange\",\n    value: function updateCurrentLocationRange(locationRange) {\n      if (locationRange != null ? locationRange : locationRange = this.createLocationRangeFromDOMRange(getDOMRange())) {\n        if (!rangesAreEqual(locationRange, this.currentLocationRange)) {\n          var _this$delegate, _this$delegate$locati;\n\n          this.currentLocationRange = locationRange;\n          return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$locati = _this$delegate.locationRangeDidChange) === null || _this$delegate$locati === void 0 ? void 0 : _this$delegate$locati.call(_this$delegate, this.currentLocationRange.slice(0));\n        }\n      }\n    }\n  }, {\n    key: \"createDOMRangeFromLocationRange\",\n    value: function createDOMRangeFromLocationRange(locationRange) {\n      var rangeStart = this.findContainerAndOffsetFromLocation(locationRange[0]);\n      var rangeEnd = rangeIsCollapsed(locationRange) ? rangeStart : this.findContainerAndOffsetFromLocation(locationRange[1]) || rangeStart;\n\n      if (rangeStart != null && rangeEnd != null) {\n        var domRange = document.createRange();\n        domRange.setStart.apply(domRange, _toConsumableArray2(Array.from(rangeStart || [])));\n        domRange.setEnd.apply(domRange, _toConsumableArray2(Array.from(rangeEnd || [])));\n        return domRange;\n      }\n    }\n  }, {\n    key: \"getLocationAtPoint\",\n    value: function getLocationAtPoint(point) {\n      var domRange = this.createDOMRangeFromPoint(point);\n\n      if (domRange) {\n        var _this$createLocationR;\n\n        return (_this$createLocationR = this.createLocationRangeFromDOMRange(domRange)) === null || _this$createLocationR === void 0 ? void 0 : _this$createLocationR[0];\n      }\n    }\n  }, {\n    key: \"domRangeWithinElement\",\n    value: function domRangeWithinElement(domRange) {\n      if (domRange.collapsed) {\n        return elementContainsNode(this.element, domRange.startContainer);\n      } else {\n        return elementContainsNode(this.element, domRange.startContainer) && elementContainsNode(this.element, domRange.endContainer);\n      }\n    }\n  }]);\n\n  return SelectionManager;\n}(BasicObject);\n\nSelectionManager.proxyMethod(\"locationMapper.findLocationFromContainerAndOffset\");\nSelectionManager.proxyMethod(\"locationMapper.findContainerAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"locationMapper.findNodeAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"pointMapper.createDOMRangeFromPoint\");\nSelectionManager.proxyMethod(\"pointMapper.getClientRectsForDOMRange\");\nvar models = {\n  Attachment: Attachment,\n  AttachmentManager: AttachmentManager,\n  AttachmentPiece: AttachmentPiece,\n  Block: Block,\n  Composition: Composition,\n  Cocument: Document,\n  Editor: Editor,\n  HTMLParser: HTMLParser,\n  HTMLSanitizer: HTMLSanitizer,\n  LineBreakInsertion: LineBreakInsertion,\n  LocationMapper: LocationMapper,\n  ManagedAttachment: ManagedAttachment,\n  Piece: Piece,\n  PointMapper: PointMapper,\n  SelectionManager: SelectionManager,\n  SplittableList: SplittableList,\n  StringPiece: StringPiece,\n  Text: Text,\n  UndoManager: UndoManager\n};\nvar Trix = {\n  VERSION: version,\n  config: config\n};\nObject.assign(Trix, models);\nwindow.Trix = Trix;\n\nvar ObjectGroup = /*#__PURE__*/function () {\n  function ObjectGroup() {\n    _classCallCheck2(this, ObjectGroup);\n\n    var objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n    var _ref19 = arguments.length > 1 ? arguments[1] : undefined,\n        depth = _ref19.depth,\n        asTree = _ref19.asTree;\n\n    this.objects = objects;\n\n    if (asTree) {\n      this.depth = depth;\n      this.objects = this.constructor.groupObjects(this.objects, {\n        asTree: asTree,\n        depth: this.depth + 1\n      });\n    }\n  }\n\n  _createClass2(ObjectGroup, [{\n    key: \"getObjects\",\n    value: function getObjects() {\n      return this.objects;\n    }\n  }, {\n    key: \"getDepth\",\n    value: function getDepth() {\n      return this.depth;\n    }\n  }, {\n    key: \"getCacheKey\",\n    value: function getCacheKey() {\n      var keys = [\"objectGroup\"];\n      Array.from(this.getObjects()).forEach(function (object) {\n        keys.push(object.getCacheKey());\n      });\n      return keys.join(\"/\");\n    }\n  }], [{\n    key: \"groupObjects\",\n    value: function groupObjects() {\n      var _this38 = this;\n\n      var ungroupedObjects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n      var _ref20 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          depth = _ref20.depth,\n          asTree = _ref20.asTree;\n\n      var group;\n\n      if (asTree) {\n        if (depth == null) {\n          depth = 0;\n        }\n      }\n\n      var objects = [];\n      Array.from(ungroupedObjects).forEach(function (object) {\n        var _object$canBeGrouped2;\n\n        if (group) {\n          var _object$canBeGrouped, _group$canBeGroupedWi, _group;\n\n          if ((_object$canBeGrouped = object.canBeGrouped) !== null && _object$canBeGrouped !== void 0 && _object$canBeGrouped.call(object, depth) && (_group$canBeGroupedWi = (_group = group[group.length - 1]).canBeGroupedWith) !== null && _group$canBeGroupedWi !== void 0 && _group$canBeGroupedWi.call(_group, object, depth)) {\n            group.push(object);\n            return;\n          } else {\n            objects.push(new _this38(group, {\n              depth: depth,\n              asTree: asTree\n            }));\n            group = null;\n          }\n        }\n\n        if ((_object$canBeGrouped2 = object.canBeGrouped) !== null && _object$canBeGrouped2 !== void 0 && _object$canBeGrouped2.call(object, depth)) {\n          group = [object];\n        } else {\n          objects.push(object);\n        }\n      });\n\n      if (group) {\n        objects.push(new this(group, {\n          depth: depth,\n          asTree: asTree\n        }));\n      }\n\n      return objects;\n    }\n  }]);\n\n  return ObjectGroup;\n}();\n\nvar ElementStore = /*#__PURE__*/function () {\n  function ElementStore(elements) {\n    _classCallCheck2(this, ElementStore);\n\n    this.reset(elements);\n  }\n\n  _createClass2(ElementStore, [{\n    key: \"add\",\n    value: function add(element) {\n      var key = getKey(element);\n      this.elements[key] = element;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(element) {\n      var key = getKey(element);\n      var value = this.elements[key];\n\n      if (value) {\n        delete this.elements[key];\n        return value;\n      }\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      var _this39 = this;\n\n      var elements = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      this.elements = {};\n      Array.from(elements).forEach(function (element) {\n        _this39.add(element);\n      });\n      return elements;\n    }\n  }]);\n\n  return ElementStore;\n}();\n\nvar getKey = function getKey(element) {\n  return element.dataset.trixStoreKey;\n};\n\nvar ObjectView = /*#__PURE__*/function (_BasicObject13) {\n  _inherits2(ObjectView, _BasicObject13);\n\n  var _super24 = _createSuper2(ObjectView);\n\n  function ObjectView(object) {\n    var _this40;\n\n    _classCallCheck2(this, ObjectView);\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    _this40 = _super24.apply(this, arguments);\n    _this40.object = object;\n    _this40.options = options;\n    _this40.childViews = [];\n    _this40.rootView = _assertThisInitialized2(_this40);\n    return _this40;\n  }\n\n  _createClass2(ObjectView, [{\n    key: \"getNodes\",\n    value: function getNodes() {\n      if (!this.nodes) {\n        this.nodes = this.createNodes();\n      }\n\n      return this.nodes.map(function (node) {\n        return node.cloneNode(true);\n      });\n    }\n  }, {\n    key: \"invalidate\",\n    value: function invalidate() {\n      var _this$parentView;\n\n      this.nodes = null;\n      this.childViews = [];\n      return (_this$parentView = this.parentView) === null || _this$parentView === void 0 ? void 0 : _this$parentView.invalidate();\n    }\n  }, {\n    key: \"invalidateViewForObject\",\n    value: function invalidateViewForObject(object) {\n      var _this$findViewForObje;\n\n      return (_this$findViewForObje = this.findViewForObject(object)) === null || _this$findViewForObje === void 0 ? void 0 : _this$findViewForObje.invalidate();\n    }\n  }, {\n    key: \"findOrCreateCachedChildView\",\n    value: function findOrCreateCachedChildView(viewClass, object, options) {\n      var view = this.getCachedViewForObject(object);\n\n      if (view) {\n        this.recordChildView(view);\n      } else {\n        view = this.createChildView.apply(this, arguments);\n        this.cacheViewForObject(view, object);\n      }\n\n      return view;\n    }\n  }, {\n    key: \"createChildView\",\n    value: function createChildView(viewClass, object) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      if (object instanceof ObjectGroup) {\n        options.viewClass = viewClass;\n        viewClass = ObjectGroupView;\n      }\n\n      var view = new viewClass(object, options);\n      return this.recordChildView(view);\n    }\n  }, {\n    key: \"recordChildView\",\n    value: function recordChildView(view) {\n      view.parentView = this;\n      view.rootView = this.rootView;\n      this.childViews.push(view);\n      return view;\n    }\n  }, {\n    key: \"getAllChildViews\",\n    value: function getAllChildViews() {\n      var views = [];\n      this.childViews.forEach(function (childView) {\n        views.push(childView);\n        views = views.concat(childView.getAllChildViews());\n      });\n      return views;\n    }\n  }, {\n    key: \"findElement\",\n    value: function findElement() {\n      return this.findElementForObject(this.object);\n    }\n  }, {\n    key: \"findElementForObject\",\n    value: function findElementForObject(object) {\n      var id = object === null || object === void 0 ? void 0 : object.id;\n\n      if (id) {\n        return this.rootView.element.querySelector(\"[data-trix-id='\".concat(id, \"']\"));\n      }\n    }\n  }, {\n    key: \"findViewForObject\",\n    value: function findViewForObject(object) {\n      var _iterator6 = _createForOfIteratorHelper2(this.getAllChildViews()),\n          _step7;\n\n      try {\n        for (_iterator6.s(); !(_step7 = _iterator6.n()).done;) {\n          var view = _step7.value;\n\n          if (view.object === object) {\n            return view;\n          }\n        }\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n    }\n  }, {\n    key: \"getViewCache\",\n    value: function getViewCache() {\n      if (this.rootView === this) {\n        if (this.isViewCachingEnabled()) {\n          if (!this.viewCache) {\n            this.viewCache = {};\n          }\n\n          return this.viewCache;\n        }\n      } else {\n        return this.rootView.getViewCache();\n      }\n    }\n  }, {\n    key: \"isViewCachingEnabled\",\n    value: function isViewCachingEnabled() {\n      return this.shouldCacheViews !== false;\n    }\n  }, {\n    key: \"enableViewCaching\",\n    value: function enableViewCaching() {\n      this.shouldCacheViews = true;\n    }\n  }, {\n    key: \"disableViewCaching\",\n    value: function disableViewCaching() {\n      this.shouldCacheViews = false;\n    }\n  }, {\n    key: \"getCachedViewForObject\",\n    value: function getCachedViewForObject(object) {\n      var _this$getViewCache;\n\n      return (_this$getViewCache = this.getViewCache()) === null || _this$getViewCache === void 0 ? void 0 : _this$getViewCache[object.getCacheKey()];\n    }\n  }, {\n    key: \"cacheViewForObject\",\n    value: function cacheViewForObject(view, object) {\n      var cache = this.getViewCache();\n\n      if (cache) {\n        cache[object.getCacheKey()] = view;\n      }\n    }\n  }, {\n    key: \"garbageCollectCachedViews\",\n    value: function garbageCollectCachedViews() {\n      var cache = this.getViewCache();\n\n      if (cache) {\n        var views = this.getAllChildViews().concat(this);\n        var objectKeys = views.map(function (view) {\n          return view.object.getCacheKey();\n        });\n\n        for (var key in cache) {\n          if (!objectKeys.includes(key)) {\n            delete cache[key];\n          }\n        }\n      }\n    }\n  }]);\n\n  return ObjectView;\n}(BasicObject);\n\nvar ObjectGroupView = /*#__PURE__*/function (_ObjectView) {\n  _inherits2(ObjectGroupView, _ObjectView);\n\n  var _super25 = _createSuper2(ObjectGroupView);\n\n  function ObjectGroupView() {\n    var _this41;\n\n    _classCallCheck2(this, ObjectGroupView);\n\n    _this41 = _super25.apply(this, arguments);\n    _this41.objectGroup = _this41.object;\n    _this41.viewClass = _this41.options.viewClass;\n    delete _this41.options.viewClass;\n    return _this41;\n  }\n\n  _createClass2(ObjectGroupView, [{\n    key: \"getChildViews\",\n    value: function getChildViews() {\n      var _this42 = this;\n\n      if (!this.childViews.length) {\n        Array.from(this.objectGroup.getObjects()).forEach(function (object) {\n          _this42.findOrCreateCachedChildView(_this42.viewClass, object, _this42.options);\n        });\n      }\n\n      return this.childViews;\n    }\n  }, {\n    key: \"createNodes\",\n    value: function createNodes() {\n      var element = this.createContainerElement();\n      this.getChildViews().forEach(function (view) {\n        Array.from(view.getNodes()).forEach(function (node) {\n          element.appendChild(node);\n        });\n      });\n      return [element];\n    }\n  }, {\n    key: \"createContainerElement\",\n    value: function createContainerElement() {\n      var depth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.objectGroup.getDepth();\n      return this.getChildViews()[0].createContainerElement(depth);\n    }\n  }]);\n\n  return ObjectGroupView;\n}(ObjectView);\n\nvar css$2 = config.css;\n\nvar AttachmentView = /*#__PURE__*/function (_ObjectView2) {\n  _inherits2(AttachmentView, _ObjectView2);\n\n  var _super26 = _createSuper2(AttachmentView);\n\n  function AttachmentView() {\n    var _this43;\n\n    _classCallCheck2(this, AttachmentView);\n\n    _this43 = _super26.apply(this, arguments);\n    _this43.attachment = _this43.object;\n    _this43.attachment.uploadProgressDelegate = _assertThisInitialized2(_this43);\n    _this43.attachmentPiece = _this43.options.piece;\n    return _this43;\n  }\n\n  _createClass2(AttachmentView, [{\n    key: \"createContentNodes\",\n    value: function createContentNodes() {\n      return [];\n    }\n  }, {\n    key: \"createNodes\",\n    value: function createNodes() {\n      var innerElement;\n      var figure = innerElement = makeElement({\n        tagName: \"figure\",\n        className: this.getClassName(),\n        data: this.getData(),\n        editable: false\n      });\n      var href = this.getHref();\n\n      if (href) {\n        innerElement = makeElement({\n          tagName: \"a\",\n          editable: false,\n          attributes: {\n            href: href,\n            tabindex: -1\n          }\n        });\n        figure.appendChild(innerElement);\n      }\n\n      if (this.attachment.hasContent()) {\n        innerElement.innerHTML = this.attachment.getContent();\n      } else {\n        this.createContentNodes().forEach(function (node) {\n          innerElement.appendChild(node);\n        });\n      }\n\n      innerElement.appendChild(this.createCaptionElement());\n\n      if (this.attachment.isPending()) {\n        this.progressElement = makeElement({\n          tagName: \"progress\",\n          attributes: {\n            class: css$2.attachmentProgress,\n            value: this.attachment.getUploadProgress(),\n            max: 100\n          },\n          data: {\n            trixMutable: true,\n            trixStoreKey: [\"progressElement\", this.attachment.id].join(\"/\")\n          }\n        });\n        figure.appendChild(this.progressElement);\n      }\n\n      return [createCursorTarget(\"left\"), figure, createCursorTarget(\"right\")];\n    }\n  }, {\n    key: \"createCaptionElement\",\n    value: function createCaptionElement() {\n      var figcaption = makeElement({\n        tagName: \"figcaption\",\n        className: css$2.attachmentCaption\n      });\n      var caption = this.attachmentPiece.getCaption();\n\n      if (caption) {\n        figcaption.classList.add(\"\".concat(css$2.attachmentCaption, \"--edited\"));\n        figcaption.textContent = caption;\n      } else {\n        var _name, size;\n\n        var captionConfig = this.getCaptionConfig();\n\n        if (captionConfig.name) {\n          _name = this.attachment.getFilename();\n        }\n\n        if (captionConfig.size) {\n          size = this.attachment.getFormattedFilesize();\n        }\n\n        if (_name) {\n          var nameElement = makeElement({\n            tagName: \"span\",\n            className: css$2.attachmentName,\n            textContent: _name\n          });\n          figcaption.appendChild(nameElement);\n        }\n\n        if (size) {\n          if (_name) {\n            figcaption.appendChild(document.createTextNode(\" \"));\n          }\n\n          var sizeElement = makeElement({\n            tagName: \"span\",\n            className: css$2.attachmentSize,\n            textContent: size\n          });\n          figcaption.appendChild(sizeElement);\n        }\n      }\n\n      return figcaption;\n    }\n  }, {\n    key: \"getClassName\",\n    value: function getClassName() {\n      var names = [css$2.attachment, \"\".concat(css$2.attachment, \"--\").concat(this.attachment.getType())];\n      var extension = this.attachment.getExtension();\n\n      if (extension) {\n        names.push(\"\".concat(css$2.attachment, \"--\").concat(extension));\n      }\n\n      return names.join(\" \");\n    }\n  }, {\n    key: \"getData\",\n    value: function getData() {\n      var data = {\n        trixAttachment: JSON.stringify(this.attachment),\n        trixContentType: this.attachment.getContentType(),\n        trixId: this.attachment.id\n      };\n      var attributes = this.attachmentPiece.attributes;\n\n      if (!attributes.isEmpty()) {\n        data.trixAttributes = JSON.stringify(attributes);\n      }\n\n      if (this.attachment.isPending()) {\n        data.trixSerialize = false;\n      }\n\n      return data;\n    }\n  }, {\n    key: \"getHref\",\n    value: function getHref() {\n      if (!htmlContainsTagName(this.attachment.getContent(), \"a\")) {\n        return this.attachment.getHref();\n      }\n    }\n  }, {\n    key: \"getCaptionConfig\",\n    value: function getCaptionConfig() {\n      var _config$attachments$t;\n\n      var type = this.attachment.getType();\n      var captionConfig = copyObject((_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.caption);\n\n      if (type === \"file\") {\n        captionConfig.name = true;\n      }\n\n      return captionConfig;\n    }\n  }, {\n    key: \"findProgressElement\",\n    value: function findProgressElement() {\n      var _this$findElement;\n\n      return (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"progress\");\n    } // Attachment delegate\n\n  }, {\n    key: \"attachmentDidChangeUploadProgress\",\n    value: function attachmentDidChangeUploadProgress() {\n      var value = this.attachment.getUploadProgress();\n      var progressElement = this.findProgressElement();\n\n      if (progressElement) {\n        progressElement.value = value;\n      }\n    }\n  }]);\n\n  return AttachmentView;\n}(ObjectView);\n\nvar createCursorTarget = function createCursorTarget(name) {\n  return makeElement({\n    tagName: \"span\",\n    textContent: ZERO_WIDTH_SPACE,\n    data: {\n      trixCursorTarget: name,\n      trixSerialize: false\n    }\n  });\n};\n\nvar htmlContainsTagName = function htmlContainsTagName(html, tagName) {\n  var div = makeElement(\"div\");\n  div.innerHTML = html || \"\";\n  return div.querySelector(tagName);\n};\n\nvar PreviewableAttachmentView = /*#__PURE__*/function (_AttachmentView) {\n  _inherits2(PreviewableAttachmentView, _AttachmentView);\n\n  var _super27 = _createSuper2(PreviewableAttachmentView);\n\n  function PreviewableAttachmentView() {\n    var _this44;\n\n    _classCallCheck2(this, PreviewableAttachmentView);\n\n    _this44 = _super27.apply(this, arguments);\n    _this44.attachment.previewDelegate = _assertThisInitialized2(_this44);\n    return _this44;\n  }\n\n  _createClass2(PreviewableAttachmentView, [{\n    key: \"createContentNodes\",\n    value: function createContentNodes() {\n      this.image = makeElement({\n        tagName: \"img\",\n        attributes: {\n          src: \"\"\n        },\n        data: {\n          trixMutable: true\n        }\n      });\n      this.refresh(this.image);\n      return [this.image];\n    }\n  }, {\n    key: \"createCaptionElement\",\n    value: function createCaptionElement() {\n      var figcaption = _get2(_getPrototypeOf2(PreviewableAttachmentView.prototype), \"createCaptionElement\", this).apply(this, arguments);\n\n      if (!figcaption.textContent) {\n        figcaption.setAttribute(\"data-trix-placeholder\", config.lang.captionPlaceholder);\n      }\n\n      return figcaption;\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh(image) {\n      if (!image) {\n        var _this$findElement;\n\n        image = (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"img\");\n      }\n\n      if (image) {\n        return this.updateAttributesForImage(image);\n      }\n    }\n  }, {\n    key: \"updateAttributesForImage\",\n    value: function updateAttributesForImage(image) {\n      var url = this.attachment.getURL();\n      var previewURL = this.attachment.getPreviewURL();\n      image.src = previewURL || url;\n\n      if (previewURL === url) {\n        image.removeAttribute(\"data-trix-serialized-attributes\");\n      } else {\n        var serializedAttributes = JSON.stringify({\n          src: url\n        });\n        image.setAttribute(\"data-trix-serialized-attributes\", serializedAttributes);\n      }\n\n      var width = this.attachment.getWidth();\n      var height = this.attachment.getHeight();\n\n      if (width != null) {\n        image.width = width;\n      }\n\n      if (height != null) {\n        image.height = height;\n      }\n\n      var storeKey = [\"imageElement\", this.attachment.id, image.src, image.width, image.height].join(\"/\");\n      image.dataset.trixStoreKey = storeKey;\n    } // Attachment delegate\n\n  }, {\n    key: \"attachmentDidChangeAttributes\",\n    value: function attachmentDidChangeAttributes() {\n      this.refresh(this.image);\n      return this.refresh();\n    }\n  }]);\n\n  return PreviewableAttachmentView;\n}(AttachmentView);\n/* eslint-disable\n    no-useless-escape,\n    no-var,\n*/\n\n\nvar PieceView = /*#__PURE__*/function (_ObjectView3) {\n  _inherits2(PieceView, _ObjectView3);\n\n  var _super28 = _createSuper2(PieceView);\n\n  function PieceView() {\n    var _this45;\n\n    _classCallCheck2(this, PieceView);\n\n    _this45 = _super28.apply(this, arguments);\n    _this45.piece = _this45.object;\n    _this45.attributes = _this45.piece.getAttributes();\n    _this45.textConfig = _this45.options.textConfig;\n    _this45.context = _this45.options.context;\n\n    if (_this45.piece.attachment) {\n      _this45.attachment = _this45.piece.attachment;\n    } else {\n      _this45.string = _this45.piece.toString();\n    }\n\n    return _this45;\n  }\n\n  _createClass2(PieceView, [{\n    key: \"createNodes\",\n    value: function createNodes() {\n      var nodes = this.attachment ? this.createAttachmentNodes() : this.createStringNodes();\n      var element = this.createElement();\n\n      if (element) {\n        var innerElement = findInnerElement(element);\n        Array.from(nodes).forEach(function (node) {\n          innerElement.appendChild(node);\n        });\n        nodes = [element];\n      }\n\n      return nodes;\n    }\n  }, {\n    key: \"createAttachmentNodes\",\n    value: function createAttachmentNodes() {\n      var constructor = this.attachment.isPreviewable() ? PreviewableAttachmentView : AttachmentView;\n      var view = this.createChildView(constructor, this.piece.attachment, {\n        piece: this.piece\n      });\n      return view.getNodes();\n    }\n  }, {\n    key: \"createStringNodes\",\n    value: function createStringNodes() {\n      var _this$textConfig;\n\n      if ((_this$textConfig = this.textConfig) !== null && _this$textConfig !== void 0 && _this$textConfig.plaintext) {\n        return [document.createTextNode(this.string)];\n      } else {\n        var nodes = [];\n        var iterable = this.string.split(\"\\n\");\n\n        for (var index = 0; index < iterable.length; index++) {\n          var substring = iterable[index];\n\n          if (index > 0) {\n            var element = makeElement(\"br\");\n            nodes.push(element);\n          }\n\n          if (substring.length) {\n            var node = document.createTextNode(this.preserveSpaces(substring));\n            nodes.push(node);\n          }\n        }\n\n        return nodes;\n      }\n    }\n  }, {\n    key: \"createElement\",\n    value: function createElement() {\n      var element, key, value;\n      var styles = {};\n\n      for (key in this.attributes) {\n        value = this.attributes[key];\n\n        var _config = getTextConfig(key);\n\n        if (_config) {\n          if (_config.tagName) {\n            var innerElement;\n            var pendingElement = makeElement(_config.tagName);\n\n            if (innerElement) {\n              innerElement.appendChild(pendingElement);\n              innerElement = pendingElement;\n            } else {\n              element = innerElement = pendingElement;\n            }\n          }\n\n          if (_config.styleProperty) {\n            styles[_config.styleProperty] = value;\n          }\n\n          if (_config.style) {\n            for (key in _config.style) {\n              value = _config.style[key];\n              styles[key] = value;\n            }\n          }\n        }\n      }\n\n      if (Object.keys(styles).length) {\n        if (!element) {\n          element = makeElement(\"span\");\n        }\n\n        for (key in styles) {\n          value = styles[key];\n          element.style[key] = value;\n        }\n      }\n\n      return element;\n    }\n  }, {\n    key: \"createContainerElement\",\n    value: function createContainerElement() {\n      for (var key in this.attributes) {\n        var value = this.attributes[key];\n\n        var _config2 = getTextConfig(key);\n\n        if (_config2) {\n          if (_config2.groupTagName) {\n            var _attributes4 = {};\n            _attributes4[key] = value;\n            return makeElement(_config2.groupTagName, _attributes4);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"preserveSpaces\",\n    value: function preserveSpaces(string) {\n      if (this.context.isLast) {\n        string = string.replace(/\\ $/, NON_BREAKING_SPACE);\n      }\n\n      string = string.replace(/(\\S)\\ {3}(\\S)/g, \"$1 \".concat(NON_BREAKING_SPACE, \" $2\")).replace(/\\ {2}/g, \"\".concat(NON_BREAKING_SPACE, \" \")).replace(/\\ {2}/g, \" \".concat(NON_BREAKING_SPACE));\n\n      if (this.context.isFirst || this.context.followsWhitespace) {\n        string = string.replace(/^\\ /, NON_BREAKING_SPACE);\n      }\n\n      return string;\n    }\n  }]);\n\n  return PieceView;\n}(ObjectView);\n/* eslint-disable\n    no-var,\n*/\n\n\nvar TextView = /*#__PURE__*/function (_ObjectView4) {\n  _inherits2(TextView, _ObjectView4);\n\n  var _super29 = _createSuper2(TextView);\n\n  function TextView() {\n    var _this46;\n\n    _classCallCheck2(this, TextView);\n\n    _this46 = _super29.apply(this, arguments);\n    _this46.text = _this46.object;\n    _this46.textConfig = _this46.options.textConfig;\n    return _this46;\n  }\n\n  _createClass2(TextView, [{\n    key: \"createNodes\",\n    value: function createNodes() {\n      var nodes = [];\n      var pieces = ObjectGroup.groupObjects(this.getPieces());\n      var lastIndex = pieces.length - 1;\n\n      for (var index = 0; index < pieces.length; index++) {\n        var piece = pieces[index];\n        var context = {};\n\n        if (index === 0) {\n          context.isFirst = true;\n        }\n\n        if (index === lastIndex) {\n          context.isLast = true;\n        }\n\n        if (endsWithWhitespace(previousPiece)) {\n          context.followsWhitespace = true;\n        }\n\n        var view = this.findOrCreateCachedChildView(PieceView, piece, {\n          textConfig: this.textConfig,\n          context: context\n        });\n        nodes.push.apply(nodes, _toConsumableArray2(Array.from(view.getNodes() || [])));\n        var previousPiece = piece;\n      }\n\n      return nodes;\n    }\n  }, {\n    key: \"getPieces\",\n    value: function getPieces() {\n      return Array.from(this.text.getPieces()).filter(function (piece) {\n        return !piece.hasAttribute(\"blockBreak\");\n      });\n    }\n  }]);\n\n  return TextView;\n}(ObjectView);\n\nvar endsWithWhitespace = function endsWithWhitespace(piece) {\n  return /\\s$/.test(piece === null || piece === void 0 ? void 0 : piece.toString());\n};\n\nvar css$1 = config.css;\n\nvar BlockView = /*#__PURE__*/function (_ObjectView5) {\n  _inherits2(BlockView, _ObjectView5);\n\n  var _super30 = _createSuper2(BlockView);\n\n  function BlockView() {\n    var _this47;\n\n    _classCallCheck2(this, BlockView);\n\n    _this47 = _super30.apply(this, arguments);\n    _this47.block = _this47.object;\n    _this47.attributes = _this47.block.getAttributes();\n    return _this47;\n  }\n\n  _createClass2(BlockView, [{\n    key: \"createNodes\",\n    value: function createNodes() {\n      var comment = document.createComment(\"block\");\n      var nodes = [comment];\n\n      if (this.block.isEmpty()) {\n        nodes.push(makeElement(\"br\"));\n      } else {\n        var _getBlockConfig;\n\n        var textConfig = (_getBlockConfig = getBlockConfig(this.block.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.text;\n        var textView = this.findOrCreateCachedChildView(TextView, this.block.text, {\n          textConfig: textConfig\n        });\n        nodes.push.apply(nodes, _toConsumableArray2(Array.from(textView.getNodes() || [])));\n\n        if (this.shouldAddExtraNewlineElement()) {\n          nodes.push(makeElement(\"br\"));\n        }\n      }\n\n      if (this.attributes.length) {\n        return nodes;\n      } else {\n        var _attributes5;\n\n        var _tagName = config.blockAttributes.default.tagName;\n\n        if (this.block.isRTL()) {\n          _attributes5 = {\n            dir: \"rtl\"\n          };\n        }\n\n        var element = makeElement({\n          tagName: _tagName,\n          attributes: _attributes5\n        });\n        nodes.forEach(function (node) {\n          return element.appendChild(node);\n        });\n        return [element];\n      }\n    }\n  }, {\n    key: \"createContainerElement\",\n    value: function createContainerElement(depth) {\n      var attributes, className;\n      var attributeName = this.attributes[depth];\n\n      var _getBlockConfig6 = getBlockConfig(attributeName),\n          tagName = _getBlockConfig6.tagName;\n\n      if (depth === 0 && this.block.isRTL()) {\n        attributes = {\n          dir: \"rtl\"\n        };\n      }\n\n      if (attributeName === \"attachmentGallery\") {\n        var size = this.block.getBlockBreakPosition();\n        className = \"\".concat(css$1.attachmentGallery, \" \").concat(css$1.attachmentGallery, \"--\").concat(size);\n      }\n\n      return makeElement({\n        tagName: tagName,\n        className: className,\n        attributes: attributes\n      });\n    } // A single <br> at the end of a block element has no visual representation\n    // so add an extra one.\n\n  }, {\n    key: \"shouldAddExtraNewlineElement\",\n    value: function shouldAddExtraNewlineElement() {\n      return /\\n\\n$/.test(this.block.toString());\n    }\n  }]);\n\n  return BlockView;\n}(ObjectView);\n\nvar DocumentView = /*#__PURE__*/function (_ObjectView6) {\n  _inherits2(DocumentView, _ObjectView6);\n\n  var _super31 = _createSuper2(DocumentView);\n\n  function DocumentView() {\n    var _this48;\n\n    _classCallCheck2(this, DocumentView);\n\n    _this48 = _super31.apply(this, arguments);\n    _this48.element = _this48.options.element;\n    _this48.elementStore = new ElementStore();\n\n    _this48.setDocument(_this48.object);\n\n    return _this48;\n  }\n\n  _createClass2(DocumentView, [{\n    key: \"setDocument\",\n    value: function setDocument(document) {\n      if (!document.isEqualTo(this.document)) {\n        this.document = this.object = document;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this49 = this;\n\n      this.childViews = [];\n      this.shadowElement = makeElement(\"div\");\n\n      if (!this.document.isEmpty()) {\n        var objects = ObjectGroup.groupObjects(this.document.getBlocks(), {\n          asTree: true\n        });\n        Array.from(objects).forEach(function (object) {\n          var view = _this49.findOrCreateCachedChildView(BlockView, object);\n\n          Array.from(view.getNodes()).map(function (node) {\n            return _this49.shadowElement.appendChild(node);\n          });\n        });\n      }\n    }\n  }, {\n    key: \"isSynced\",\n    value: function isSynced() {\n      return elementsHaveEqualHTML(this.shadowElement, this.element);\n    }\n  }, {\n    key: \"sync\",\n    value: function sync() {\n      var fragment = this.createDocumentFragmentForSync();\n\n      while (this.element.lastChild) {\n        this.element.removeChild(this.element.lastChild);\n      }\n\n      this.element.appendChild(fragment);\n      return this.didSync();\n    } // Private\n\n  }, {\n    key: \"didSync\",\n    value: function didSync() {\n      var _this50 = this;\n\n      this.elementStore.reset(findStoredElements(this.element));\n      return defer(function () {\n        return _this50.garbageCollectCachedViews();\n      });\n    }\n  }, {\n    key: \"createDocumentFragmentForSync\",\n    value: function createDocumentFragmentForSync() {\n      var _this51 = this;\n\n      var fragment = document.createDocumentFragment();\n      Array.from(this.shadowElement.childNodes).forEach(function (node) {\n        fragment.appendChild(node.cloneNode(true));\n      });\n      Array.from(findStoredElements(fragment)).forEach(function (element) {\n        var storedElement = _this51.elementStore.remove(element);\n\n        if (storedElement) {\n          element.parentNode.replaceChild(storedElement, element);\n        }\n      });\n      return fragment;\n    }\n  }], [{\n    key: \"render\",\n    value: function render(document) {\n      var element = makeElement(\"div\");\n      var view = new this(document, {\n        element: element\n      });\n      view.render();\n      view.sync();\n      return element;\n    }\n  }]);\n\n  return DocumentView;\n}(ObjectView);\n\nvar findStoredElements = function findStoredElements(element) {\n  return element.querySelectorAll(\"[data-trix-store-key]\");\n};\n\nvar elementsHaveEqualHTML = function elementsHaveEqualHTML(element, otherElement) {\n  return ignoreSpaces(element.innerHTML) === ignoreSpaces(otherElement.innerHTML);\n};\n\nvar ignoreSpaces = function ignoreSpaces(html) {\n  return html.replace(/&nbsp;/g, \" \");\n};\n/* eslint-disable\n    no-empty,\n*/\n\n\nvar unserializableElementSelector = \"[data-trix-serialize=false]\";\nvar unserializableAttributeNames = [\"contenteditable\", \"data-trix-id\", \"data-trix-store-key\", \"data-trix-mutable\", \"data-trix-placeholder\", \"tabindex\"];\nvar serializedAttributesAttribute = \"data-trix-serialized-attributes\";\nvar serializedAttributesSelector = \"[\".concat(serializedAttributesAttribute, \"]\");\nvar blockCommentPattern = new RegExp(\"<!--block-->\", \"g\");\nvar serializers = {\n  \"application/json\": function applicationJson(serializable) {\n    var document;\n\n    if (serializable instanceof Document) {\n      document = serializable;\n    } else if (serializable instanceof HTMLElement) {\n      document = HTMLParser.parse(serializable.innerHTML).getDocument();\n    } else {\n      throw new Error(\"unserializable object\");\n    }\n\n    return document.toSerializableDocument().toJSONString();\n  },\n  \"text/html\": function textHtml(serializable) {\n    var element;\n\n    if (serializable instanceof Document) {\n      element = DocumentView.render(serializable);\n    } else if (serializable instanceof HTMLElement) {\n      element = serializable.cloneNode(true);\n    } else {\n      throw new Error(\"unserializable object\");\n    } // Remove unserializable elements\n\n\n    Array.from(element.querySelectorAll(unserializableElementSelector)).forEach(function (el) {\n      removeNode(el);\n    }); // Remove unserializable attributes\n\n    unserializableAttributeNames.forEach(function (attribute) {\n      Array.from(element.querySelectorAll(\"[\".concat(attribute, \"]\"))).forEach(function (el) {\n        el.removeAttribute(attribute);\n      });\n    }); // Rewrite elements with serialized attribute overrides\n\n    Array.from(element.querySelectorAll(serializedAttributesSelector)).forEach(function (el) {\n      try {\n        var _attributes6 = JSON.parse(el.getAttribute(serializedAttributesAttribute));\n\n        el.removeAttribute(serializedAttributesAttribute);\n\n        for (var _name2 in _attributes6) {\n          var value = _attributes6[_name2];\n          el.setAttribute(_name2, value);\n        }\n      } catch (error) {}\n    });\n    return element.innerHTML.replace(blockCommentPattern, \"\");\n  }\n};\nvar deserializers = {\n  \"application/json\": function applicationJson(string) {\n    return Document.fromJSONString(string);\n  },\n  \"text/html\": function textHtml(string) {\n    return HTMLParser.parse(string).getDocument();\n  }\n};\n\nvar serializeToContentType = function serializeToContentType(serializable, contentType) {\n  var serializer = serializers[contentType];\n\n  if (serializer) {\n    return serializer(serializable);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\n\nvar deserializeFromContentType = function deserializeFromContentType(string, contentType) {\n  var deserializer = deserializers[contentType];\n\n  if (deserializer) {\n    return deserializer(string);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\n\nvar mutableAttributeName = \"data-trix-mutable\";\nvar mutableSelector = \"[\".concat(mutableAttributeName, \"]\");\nvar options = {\n  attributes: true,\n  childList: true,\n  characterData: true,\n  characterDataOldValue: true,\n  subtree: true\n};\n\nvar MutationObserver = /*#__PURE__*/function (_BasicObject14) {\n  _inherits2(MutationObserver, _BasicObject14);\n\n  var _super32 = _createSuper2(MutationObserver);\n\n  function MutationObserver(element) {\n    var _this52;\n\n    _classCallCheck2(this, MutationObserver);\n\n    _this52 = _super32.call(this, element);\n    _this52.didMutate = _this52.didMutate.bind(_assertThisInitialized2(_this52));\n    _this52.element = element;\n    _this52.observer = new window.MutationObserver(_this52.didMutate);\n\n    _this52.start();\n\n    return _this52;\n  }\n\n  _createClass2(MutationObserver, [{\n    key: \"start\",\n    value: function start() {\n      this.reset();\n      return this.observer.observe(this.element, options);\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      return this.observer.disconnect();\n    }\n  }, {\n    key: \"didMutate\",\n    value: function didMutate(mutations) {\n      var _this$mutations;\n\n      (_this$mutations = this.mutations).push.apply(_this$mutations, _toConsumableArray2(Array.from(this.findSignificantMutations(mutations) || [])));\n\n      if (this.mutations.length) {\n        var _this$delegate, _this$delegate$elemen;\n\n        (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$elemen = _this$delegate.elementDidMutate) === null || _this$delegate$elemen === void 0 ? void 0 : _this$delegate$elemen.call(_this$delegate, this.getMutationSummary());\n        return this.reset();\n      }\n    } // Private\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.mutations = [];\n    }\n  }, {\n    key: \"findSignificantMutations\",\n    value: function findSignificantMutations(mutations) {\n      var _this53 = this;\n\n      return mutations.filter(function (mutation) {\n        return _this53.mutationIsSignificant(mutation);\n      });\n    }\n  }, {\n    key: \"mutationIsSignificant\",\n    value: function mutationIsSignificant(mutation) {\n      if (this.nodeIsMutable(mutation.target)) {\n        return false;\n      }\n\n      for (var _i4 = 0, _Array$from21 = Array.from(this.nodesModifiedByMutation(mutation)); _i4 < _Array$from21.length; _i4++) {\n        var node = _Array$from21[_i4];\n        if (this.nodeIsSignificant(node)) return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"nodeIsSignificant\",\n    value: function nodeIsSignificant(node) {\n      return node !== this.element && !this.nodeIsMutable(node) && !nodeIsEmptyTextNode(node);\n    }\n  }, {\n    key: \"nodeIsMutable\",\n    value: function nodeIsMutable(node) {\n      return findClosestElementFromNode(node, {\n        matchingSelector: mutableSelector\n      });\n    }\n  }, {\n    key: \"nodesModifiedByMutation\",\n    value: function nodesModifiedByMutation(mutation) {\n      var nodes = [];\n\n      switch (mutation.type) {\n        case \"attributes\":\n          if (mutation.attributeName !== mutableAttributeName) {\n            nodes.push(mutation.target);\n          }\n\n          break;\n\n        case \"characterData\":\n          // Changes to text nodes should consider the parent element\n          nodes.push(mutation.target.parentNode);\n          nodes.push(mutation.target);\n          break;\n\n        case \"childList\":\n          // Consider each added or removed node\n          nodes.push.apply(nodes, _toConsumableArray2(Array.from(mutation.addedNodes || [])));\n          nodes.push.apply(nodes, _toConsumableArray2(Array.from(mutation.removedNodes || [])));\n          break;\n      }\n\n      return nodes;\n    }\n  }, {\n    key: \"getMutationSummary\",\n    value: function getMutationSummary() {\n      return this.getTextMutationSummary();\n    }\n  }, {\n    key: \"getTextMutationSummary\",\n    value: function getTextMutationSummary() {\n      var _this$getTextChangesF = this.getTextChangesFromCharacterData(),\n          additions = _this$getTextChangesF.additions,\n          deletions = _this$getTextChangesF.deletions;\n\n      var textChanges = this.getTextChangesFromChildList();\n      Array.from(textChanges.additions).forEach(function (addition) {\n        if (!Array.from(additions).includes(addition)) {\n          additions.push(addition);\n        }\n      });\n      deletions.push.apply(deletions, _toConsumableArray2(Array.from(textChanges.deletions || [])));\n      var summary = {};\n      var added = additions.join(\"\");\n\n      if (added) {\n        summary.textAdded = added;\n      }\n\n      var deleted = deletions.join(\"\");\n\n      if (deleted) {\n        summary.textDeleted = deleted;\n      }\n\n      return summary;\n    }\n  }, {\n    key: \"getMutationsByType\",\n    value: function getMutationsByType(type) {\n      return Array.from(this.mutations).filter(function (mutation) {\n        return mutation.type === type;\n      });\n    }\n  }, {\n    key: \"getTextChangesFromChildList\",\n    value: function getTextChangesFromChildList() {\n      var textAdded, textRemoved;\n      var addedNodes = [];\n      var removedNodes = [];\n      Array.from(this.getMutationsByType(\"childList\")).forEach(function (mutation) {\n        addedNodes.push.apply(addedNodes, _toConsumableArray2(Array.from(mutation.addedNodes || [])));\n        removedNodes.push.apply(removedNodes, _toConsumableArray2(Array.from(mutation.removedNodes || [])));\n      });\n      var singleBlockCommentRemoved = addedNodes.length === 0 && removedNodes.length === 1 && nodeIsBlockStartComment(removedNodes[0]);\n\n      if (singleBlockCommentRemoved) {\n        textAdded = [];\n        textRemoved = [\"\\n\"];\n      } else {\n        textAdded = getTextForNodes(addedNodes);\n        textRemoved = getTextForNodes(removedNodes);\n      }\n\n      var additions = textAdded.filter(function (text, index) {\n        return text !== textRemoved[index];\n      }).map(normalizeSpaces);\n      var deletions = textRemoved.filter(function (text, index) {\n        return text !== textAdded[index];\n      }).map(normalizeSpaces);\n      return {\n        additions: additions,\n        deletions: deletions\n      };\n    }\n  }, {\n    key: \"getTextChangesFromCharacterData\",\n    value: function getTextChangesFromCharacterData() {\n      var added, removed;\n      var characterMutations = this.getMutationsByType(\"characterData\");\n\n      if (characterMutations.length) {\n        var startMutation = characterMutations[0],\n            endMutation = characterMutations[characterMutations.length - 1];\n        var oldString = normalizeSpaces(startMutation.oldValue);\n        var newString = normalizeSpaces(endMutation.target.data);\n        var summarized = summarizeStringChange(oldString, newString);\n        added = summarized.added;\n        removed = summarized.removed;\n      }\n\n      return {\n        additions: added ? [added] : [],\n        deletions: removed ? [removed] : []\n      };\n    }\n  }]);\n\n  return MutationObserver;\n}(BasicObject);\n\nvar getTextForNodes = function getTextForNodes() {\n  var nodes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var text = [];\n\n  for (var _i5 = 0, _Array$from22 = Array.from(nodes); _i5 < _Array$from22.length; _i5++) {\n    var node = _Array$from22[_i5];\n\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        text.push(node.data);\n        break;\n\n      case Node.ELEMENT_NODE:\n        if (tagName(node) === \"br\") {\n          text.push(\"\\n\");\n        } else {\n          text.push.apply(text, _toConsumableArray2(Array.from(getTextForNodes(node.childNodes) || [])));\n        }\n\n        break;\n    }\n  }\n\n  return text;\n};\n\nvar Controller = /*#__PURE__*/function (_BasicObject15) {\n  _inherits2(Controller, _BasicObject15);\n\n  var _super33 = _createSuper2(Controller);\n\n  function Controller() {\n    _classCallCheck2(this, Controller);\n\n    return _super33.apply(this, arguments);\n  }\n\n  return _createClass2(Controller);\n}(BasicObject);\n/* eslint-disable\n    no-empty,\n*/\n\n\nvar FileVerificationOperation = /*#__PURE__*/function (_Operation2) {\n  _inherits2(FileVerificationOperation, _Operation2);\n\n  var _super34 = _createSuper2(FileVerificationOperation);\n\n  function FileVerificationOperation(file) {\n    var _this54;\n\n    _classCallCheck2(this, FileVerificationOperation);\n\n    _this54 = _super34.apply(this, arguments);\n    _this54.file = file;\n    return _this54;\n  }\n\n  _createClass2(FileVerificationOperation, [{\n    key: \"perform\",\n    value: function perform(callback) {\n      var _this55 = this;\n\n      var reader = new FileReader();\n\n      reader.onerror = function () {\n        return callback(false);\n      };\n\n      reader.onload = function () {\n        reader.onerror = null;\n\n        try {\n          reader.abort();\n        } catch (error) {}\n\n        return callback(true, _this55.file);\n      };\n\n      return reader.readAsArrayBuffer(this.file);\n    }\n  }]);\n\n  return FileVerificationOperation;\n}(Operation);\n\nvar InputController = /*#__PURE__*/function (_BasicObject16) {\n  _inherits2(InputController, _BasicObject16);\n\n  var _super35 = _createSuper2(InputController);\n\n  function InputController(element) {\n    var _this56;\n\n    _classCallCheck2(this, InputController);\n\n    _this56 = _super35.apply(this, arguments);\n    _this56.element = element;\n    _this56.mutationObserver = new MutationObserver(_this56.element);\n    _this56.mutationObserver.delegate = _assertThisInitialized2(_this56);\n\n    for (var eventName in _this56.constructor.events) {\n      handleEvent(eventName, {\n        onElement: _this56.element,\n        withCallback: _this56.handlerFor(eventName)\n      });\n    }\n\n    return _this56;\n  }\n\n  _createClass2(InputController, [{\n    key: \"elementDidMutate\",\n    value: function elementDidMutate(mutationSummary) {}\n  }, {\n    key: \"editorWillSyncDocumentView\",\n    value: function editorWillSyncDocumentView() {\n      return this.mutationObserver.stop();\n    }\n  }, {\n    key: \"editorDidSyncDocumentView\",\n    value: function editorDidSyncDocumentView() {\n      return this.mutationObserver.start();\n    }\n  }, {\n    key: \"requestRender\",\n    value: function requestRender() {\n      var _this$delegate, _this$delegate$inputC;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidRequestRender) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n    }\n  }, {\n    key: \"requestReparse\",\n    value: function requestReparse() {\n      var _this$delegate2, _this$delegate2$input;\n\n      (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$input = _this$delegate2.inputControllerDidRequestReparse) === null || _this$delegate2$input === void 0 ? void 0 : _this$delegate2$input.call(_this$delegate2);\n      return this.requestRender();\n    }\n  }, {\n    key: \"attachFiles\",\n    value: function attachFiles(files) {\n      var _this57 = this;\n\n      var operations = Array.from(files).map(function (file) {\n        return new FileVerificationOperation(file);\n      });\n      return Promise.all(operations).then(function (files) {\n        _this57.handleInput(function () {\n          var _this$delegate3, _this$responder;\n\n          (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.inputControllerWillAttachFiles();\n          (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertFiles(files);\n          return this.requestRender();\n        });\n      });\n    } // Private\n\n  }, {\n    key: \"handlerFor\",\n    value: function handlerFor(eventName) {\n      var _this58 = this;\n\n      return function (event) {\n        if (!event.defaultPrevented) {\n          _this58.handleInput(function () {\n            if (!innerElementIsActive(_this58.element)) {\n              _this58.eventName = eventName;\n\n              _this58.constructor.events[eventName].call(_this58, event);\n            }\n          });\n        }\n      };\n    }\n  }, {\n    key: \"handleInput\",\n    value: function handleInput(callback) {\n      try {\n        var _this$delegate4;\n\n        (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillHandleInput();\n        callback.call(this);\n      } finally {\n        var _this$delegate5;\n\n        (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerDidHandleInput();\n      }\n    }\n  }, {\n    key: \"createLinkHTML\",\n    value: function createLinkHTML(href, text) {\n      var link = document.createElement(\"a\");\n      link.href = href;\n      link.textContent = text ? text : href;\n      return link.outerHTML;\n    }\n  }]);\n\n  return InputController;\n}(BasicObject);\n\n_defineProperty(InputController, \"events\", {});\n\nvar _$codePointAt, _;\n\nvar browser = config.browser,\n    keyNames$1 = config.keyNames;\nvar pastedFileCount = 0;\n\nvar Level0InputController = /*#__PURE__*/function (_InputController) {\n  _inherits2(Level0InputController, _InputController);\n\n  var _super36 = _createSuper2(Level0InputController);\n\n  function Level0InputController() {\n    var _this59;\n\n    _classCallCheck2(this, Level0InputController);\n\n    _this59 = _super36.apply(this, arguments);\n\n    _this59.resetInputSummary();\n\n    return _this59;\n  }\n\n  _createClass2(Level0InputController, [{\n    key: \"setInputSummary\",\n    value: function setInputSummary() {\n      var summary = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.inputSummary.eventName = this.eventName;\n\n      for (var key in summary) {\n        var value = summary[key];\n        this.inputSummary[key] = value;\n      }\n\n      return this.inputSummary;\n    }\n  }, {\n    key: \"resetInputSummary\",\n    value: function resetInputSummary() {\n      this.inputSummary = {};\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.resetInputSummary();\n      return selectionChangeObserver.reset();\n    } // Mutation observer delegate\n\n  }, {\n    key: \"elementDidMutate\",\n    value: function elementDidMutate(mutationSummary) {\n      if (this.isComposing()) {\n        var _this$delegate, _this$delegate$inputC;\n\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n      } else {\n        return this.handleInput(function () {\n          if (this.mutationIsSignificant(mutationSummary)) {\n            if (this.mutationIsExpected(mutationSummary)) {\n              this.requestRender();\n            } else {\n              this.requestReparse();\n            }\n          }\n\n          return this.reset();\n        });\n      }\n    }\n  }, {\n    key: \"mutationIsExpected\",\n    value: function mutationIsExpected(_ref) {\n      var textAdded = _ref.textAdded,\n          textDeleted = _ref.textDeleted;\n\n      if (this.inputSummary.preferDocument) {\n        return true;\n      }\n\n      var mutationAdditionMatchesSummary = textAdded != null ? textAdded === this.inputSummary.textAdded : !this.inputSummary.textAdded;\n      var mutationDeletionMatchesSummary = textDeleted != null ? this.inputSummary.didDelete : !this.inputSummary.didDelete;\n      var unexpectedNewlineAddition = [\"\\n\", \" \\n\"].includes(textAdded) && !mutationAdditionMatchesSummary;\n      var unexpectedNewlineDeletion = textDeleted === \"\\n\" && !mutationDeletionMatchesSummary;\n      var singleUnexpectedNewline = unexpectedNewlineAddition && !unexpectedNewlineDeletion || unexpectedNewlineDeletion && !unexpectedNewlineAddition;\n\n      if (singleUnexpectedNewline) {\n        var range = this.getSelectedRange();\n\n        if (range) {\n          var _this$responder;\n\n          var offset = unexpectedNewlineAddition ? textAdded.replace(/\\n$/, \"\").length || -1 : (textAdded === null || textAdded === void 0 ? void 0 : textAdded.length) || 1;\n\n          if ((_this$responder = this.responder) !== null && _this$responder !== void 0 && _this$responder.positionIsBlockBreak(range[1] + offset)) {\n            return true;\n          }\n        }\n      }\n\n      return mutationAdditionMatchesSummary && mutationDeletionMatchesSummary;\n    }\n  }, {\n    key: \"mutationIsSignificant\",\n    value: function mutationIsSignificant(mutationSummary) {\n      var _this$compositionInpu;\n\n      var textChanged = Object.keys(mutationSummary).length > 0;\n      var composedEmptyString = ((_this$compositionInpu = this.compositionInput) === null || _this$compositionInpu === void 0 ? void 0 : _this$compositionInpu.getEndData()) === \"\";\n      return textChanged || !composedEmptyString;\n    } // Private\n\n  }, {\n    key: \"getCompositionInput\",\n    value: function getCompositionInput() {\n      if (this.isComposing()) {\n        return this.compositionInput;\n      } else {\n        this.compositionInput = new CompositionInput(this);\n      }\n    }\n  }, {\n    key: \"isComposing\",\n    value: function isComposing() {\n      return this.compositionInput && !this.compositionInput.isEnded();\n    }\n  }, {\n    key: \"deleteInDirection\",\n    value: function deleteInDirection(direction, event) {\n      var _this$responder2;\n\n      if (((_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.deleteInDirection(direction)) === false) {\n        if (event) {\n          event.preventDefault();\n          return this.requestRender();\n        }\n      } else {\n        return this.setInputSummary({\n          didDelete: true\n        });\n      }\n    }\n  }, {\n    key: \"serializeSelectionToDataTransfer\",\n    value: function serializeSelectionToDataTransfer(dataTransfer) {\n      var _this$responder3;\n\n      if (!dataTransferIsWritable(dataTransfer)) return;\n      var document = (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.getSelectedDocument().toSerializableDocument();\n      dataTransfer.setData(\"application/x-trix-document\", JSON.stringify(document));\n      dataTransfer.setData(\"text/html\", DocumentView.render(document).innerHTML);\n      dataTransfer.setData(\"text/plain\", document.toString().replace(/\\n$/, \"\"));\n      return true;\n    }\n  }, {\n    key: \"canAcceptDataTransfer\",\n    value: function canAcceptDataTransfer(dataTransfer) {\n      var types = {};\n      Array.from((dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.types) || []).forEach(function (type) {\n        types[type] = true;\n      });\n      return types.Files || types[\"application/x-trix-document\"] || types[\"text/html\"] || types[\"text/plain\"];\n    }\n  }, {\n    key: \"getPastedHTMLUsingHiddenElement\",\n    value: function getPastedHTMLUsingHiddenElement(callback) {\n      var _this60 = this;\n\n      var selectedRange = this.getSelectedRange();\n      var style = {\n        position: \"absolute\",\n        left: \"\".concat(window.pageXOffset, \"px\"),\n        top: \"\".concat(window.pageYOffset, \"px\"),\n        opacity: 0\n      };\n      var element = makeElement({\n        style: style,\n        tagName: \"div\",\n        editable: true\n      });\n      document.body.appendChild(element);\n      element.focus();\n      return requestAnimationFrame(function () {\n        var html = element.innerHTML;\n        removeNode(element);\n\n        _this60.setSelectedRange(selectedRange);\n\n        return callback(html);\n      });\n    }\n  }]);\n\n  return Level0InputController;\n}(InputController);\n\n_defineProperty(Level0InputController, \"events\", {\n  keydown: function keydown(event) {\n    if (!this.isComposing()) {\n      this.resetInputSummary();\n    }\n\n    this.inputSummary.didInput = true;\n    var keyName = keyNames$1[event.keyCode];\n\n    if (keyName) {\n      var _context2;\n\n      var context = this.keys;\n      [\"ctrl\", \"alt\", \"shift\", \"meta\"].forEach(function (modifier) {\n        if (event[\"\".concat(modifier, \"Key\")]) {\n          var _context;\n\n          if (modifier === \"ctrl\") {\n            modifier = \"control\";\n          }\n\n          context = (_context = context) === null || _context === void 0 ? void 0 : _context[modifier];\n        }\n      });\n\n      if (((_context2 = context) === null || _context2 === void 0 ? void 0 : _context2[keyName]) != null) {\n        this.setInputSummary({\n          keyName: keyName\n        });\n        selectionChangeObserver.reset();\n        context[keyName].call(this, event);\n      }\n    }\n\n    if (keyEventIsKeyboardCommand(event)) {\n      var character = String.fromCharCode(event.keyCode).toLowerCase();\n\n      if (character) {\n        var _this$delegate3;\n\n        var keys = [\"alt\", \"shift\"].map(function (modifier) {\n          if (event[\"\".concat(modifier, \"Key\")]) {\n            return modifier;\n          }\n        }).filter(function (key) {\n          return key;\n        });\n        keys.push(character);\n\n        if ((_this$delegate3 = this.delegate) !== null && _this$delegate3 !== void 0 && _this$delegate3.inputControllerDidReceiveKeyboardCommand(keys)) {\n          event.preventDefault();\n        }\n      }\n    }\n  },\n  keypress: function keypress(event) {\n    if (this.inputSummary.eventName != null) return;\n    if (event.metaKey) return;\n    if (event.ctrlKey && !event.altKey) return;\n    var string = stringFromKeyEvent(event);\n\n    if (string) {\n      var _this$delegate4, _this$responder9;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n      (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.insertString(string);\n      return this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n    }\n  },\n  textInput: function textInput(event) {\n    // Handle autocapitalization\n    var data = event.data;\n    var textAdded = this.inputSummary.textAdded;\n\n    if (textAdded && textAdded !== data && textAdded.toUpperCase() === data) {\n      var _this$responder10;\n\n      var range = this.getSelectedRange();\n      this.setSelectedRange([range[0], range[1] + textAdded.length]);\n      (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.insertString(data);\n      this.setInputSummary({\n        textAdded: data\n      });\n      return this.setSelectedRange(range);\n    }\n  },\n  dragenter: function dragenter(event) {\n    event.preventDefault();\n  },\n  dragstart: function dragstart(event) {\n    var _this$delegate5, _this$delegate5$input;\n\n    this.serializeSelectionToDataTransfer(event.dataTransfer);\n    this.draggedRange = this.getSelectedRange();\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$input = _this$delegate5.inputControllerDidStartDrag) === null || _this$delegate5$input === void 0 ? void 0 : _this$delegate5$input.call(_this$delegate5);\n  },\n  dragover: function dragover(event) {\n    if (this.draggedRange || this.canAcceptDataTransfer(event.dataTransfer)) {\n      event.preventDefault();\n      var draggingPoint = {\n        x: event.clientX,\n        y: event.clientY\n      };\n\n      if (!objectsAreEqual(draggingPoint, this.draggingPoint)) {\n        var _this$delegate6, _this$delegate6$input;\n\n        this.draggingPoint = draggingPoint;\n        return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$input = _this$delegate6.inputControllerDidReceiveDragOverPoint) === null || _this$delegate6$input === void 0 ? void 0 : _this$delegate6$input.call(_this$delegate6, this.draggingPoint);\n      }\n    }\n  },\n  dragend: function dragend(event) {\n    var _this$delegate7, _this$delegate7$input;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$input = _this$delegate7.inputControllerDidCancelDrag) === null || _this$delegate7$input === void 0 ? void 0 : _this$delegate7$input.call(_this$delegate7);\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n  drop: function drop(event) {\n    var _event$dataTransfer, _this$responder11;\n\n    event.preventDefault();\n    var files = (_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.files;\n    var documentJSON = event.dataTransfer.getData(\"application/x-trix-document\");\n    var point = {\n      x: event.clientX,\n      y: event.clientY\n    };\n    (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.setLocationRangeFromPointRange(point);\n\n    if (files !== null && files !== void 0 && files.length) {\n      this.attachFiles(files);\n    } else if (this.draggedRange) {\n      var _this$delegate8, _this$responder12;\n\n      (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.inputControllerWillMoveText();\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.moveTextFromRange(this.draggedRange);\n      this.draggedRange = null;\n      this.requestRender();\n    } else if (documentJSON) {\n      var _this$responder13;\n\n      var _document4 = Document.fromJSONString(documentJSON);\n\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.insertDocument(_document4);\n      this.requestRender();\n    }\n\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n  cut: function cut(event) {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.selectionIsExpanded()) {\n      var _this$delegate9;\n\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillCutText();\n      this.deleteInDirection(\"backward\");\n\n      if (event.defaultPrevented) {\n        return this.requestRender();\n      }\n    }\n  },\n  copy: function copy(event) {\n    var _this$responder15;\n\n    if ((_this$responder15 = this.responder) !== null && _this$responder15 !== void 0 && _this$responder15.selectionIsExpanded()) {\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n    }\n  },\n  paste: function paste(event) {\n    var _this61 = this;\n\n    var clipboard = event.clipboardData || event.testClipboardData;\n    var paste = {\n      clipboard: clipboard\n    };\n\n    if (!clipboard || pasteEventIsCrippledSafariHTMLPaste(event)) {\n      this.getPastedHTMLUsingHiddenElement(function (html) {\n        var _this$delegate10, _this$responder16, _this$delegate11;\n\n        paste.type = \"text/html\";\n        paste.html = html;\n        (_this$delegate10 = _this61.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerWillPaste(paste);\n        (_this$responder16 = _this61.responder) === null || _this$responder16 === void 0 ? void 0 : _this$responder16.insertHTML(paste.html);\n\n        _this61.requestRender();\n\n        return (_this$delegate11 = _this61.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerDidPaste(paste);\n      });\n      return;\n    }\n\n    var href = clipboard.getData(\"URL\");\n    var html = clipboard.getData(\"text/html\");\n    var name = clipboard.getData(\"public.url-name\");\n\n    if (href) {\n      var _this$delegate12, _this$responder17, _this$delegate13;\n\n      var string;\n      paste.type = \"text/html\";\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerDidPaste(paste);\n    } else if (dataTransferIsPlainText(clipboard)) {\n      var _this$delegate14, _this$responder18, _this$delegate15;\n\n      paste.type = \"text/plain\";\n      paste.string = clipboard.getData(\"text/plain\");\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: paste.string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder18 = this.responder) === null || _this$responder18 === void 0 ? void 0 : _this$responder18.insertString(paste.string);\n      this.requestRender();\n      (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerDidPaste(paste);\n    } else if (html) {\n      var _this$delegate16, _this$responder19, _this$delegate17;\n\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPaste(paste);\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerDidPaste(paste);\n    } else if (Array.from(clipboard.types).includes(\"Files\")) {\n      var _clipboard$items, _clipboard$items$, _clipboard$items$$get;\n\n      var file = (_clipboard$items = clipboard.items) === null || _clipboard$items === void 0 ? void 0 : (_clipboard$items$ = _clipboard$items[0]) === null || _clipboard$items$ === void 0 ? void 0 : (_clipboard$items$$get = _clipboard$items$.getAsFile) === null || _clipboard$items$$get === void 0 ? void 0 : _clipboard$items$$get.call(_clipboard$items$);\n\n      if (file) {\n        var _this$delegate18, _this$responder20, _this$delegate19;\n\n        var extension = extensionForFile(file);\n\n        if (!file.name && extension) {\n          file.name = \"pasted-file-\".concat(++pastedFileCount, \".\").concat(extension);\n        }\n\n        paste.type = \"File\";\n        paste.file = file;\n        (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillAttachFiles();\n        (_this$responder20 = this.responder) === null || _this$responder20 === void 0 ? void 0 : _this$responder20.insertFile(paste.file);\n        this.requestRender();\n        (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      }\n    }\n\n    event.preventDefault();\n  },\n  compositionstart: function compositionstart(event) {\n    return this.getCompositionInput().start(event.data);\n  },\n  compositionupdate: function compositionupdate(event) {\n    return this.getCompositionInput().update(event.data);\n  },\n  compositionend: function compositionend(event) {\n    return this.getCompositionInput().end(event.data);\n  },\n  beforeinput: function beforeinput(event) {\n    this.inputSummary.didInput = true;\n  },\n  input: function input(event) {\n    this.inputSummary.didInput = true;\n    return event.stopPropagation();\n  }\n});\n\n_defineProperty(Level0InputController, \"keys\", {\n  backspace: function backspace(event) {\n    var _this$delegate20;\n\n    (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"backward\", event);\n  },\n  delete: function _delete(event) {\n    var _this$delegate21;\n\n    (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"forward\", event);\n  },\n  return: function _return(event) {\n    var _this$delegate22, _this$responder21;\n\n    this.setInputSummary({\n      preferDocument: true\n    });\n    (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPerformTyping();\n    return (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.insertLineBreak();\n  },\n  tab: function tab(event) {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canIncreaseNestingLevel()) {\n      var _this$responder23;\n\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.increaseNestingLevel();\n      this.requestRender();\n      event.preventDefault();\n    }\n  },\n  left: function left(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder24;\n\n      event.preventDefault();\n      return (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.moveCursorInDirection(\"backward\");\n    }\n  },\n  right: function right(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder25;\n\n      event.preventDefault();\n      return (_this$responder25 = this.responder) === null || _this$responder25 === void 0 ? void 0 : _this$responder25.moveCursorInDirection(\"forward\");\n    }\n  },\n  control: {\n    d: function d(event) {\n      var _this$delegate23;\n\n      (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"forward\", event);\n    },\n    h: function h(event) {\n      var _this$delegate24;\n\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"backward\", event);\n    },\n    o: function o(event) {\n      var _this$delegate25, _this$responder26;\n\n      event.preventDefault();\n      (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerWillPerformTyping();\n      (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.insertString(\"\\n\", {\n        updatePosition: false\n      });\n      return this.requestRender();\n    }\n  },\n  shift: {\n    return: function _return(event) {\n      var _this$delegate26, _this$responder27;\n\n      (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n      (_this$responder27 = this.responder) === null || _this$responder27 === void 0 ? void 0 : _this$responder27.insertString(\"\\n\");\n      this.requestRender();\n      event.preventDefault();\n    },\n    tab: function tab(event) {\n      var _this$responder28;\n\n      if ((_this$responder28 = this.responder) !== null && _this$responder28 !== void 0 && _this$responder28.canDecreaseNestingLevel()) {\n        var _this$responder29;\n\n        (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.decreaseNestingLevel();\n        this.requestRender();\n        event.preventDefault();\n      }\n    },\n    left: function left(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"backward\");\n      }\n    },\n    right: function right(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"forward\");\n      }\n    }\n  },\n  alt: {\n    backspace: function backspace(event) {\n      var _this$delegate27;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate27 = this.delegate) === null || _this$delegate27 === void 0 ? void 0 : _this$delegate27.inputControllerWillPerformTyping();\n    }\n  },\n  meta: {\n    backspace: function backspace(event) {\n      var _this$delegate28;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate28 = this.delegate) === null || _this$delegate28 === void 0 ? void 0 : _this$delegate28.inputControllerWillPerformTyping();\n    }\n  }\n});\n\nLevel0InputController.proxyMethod(\"responder?.getSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.setSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.expandSelectionInDirection\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsInCursorTarget\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsExpanded\");\n\nvar extensionForFile = function extensionForFile(file) {\n  var _file$type, _file$type$match;\n\n  return (_file$type = file.type) === null || _file$type === void 0 ? void 0 : (_file$type$match = _file$type.match(/\\/(\\w+)$/)) === null || _file$type$match === void 0 ? void 0 : _file$type$match[1];\n};\n\nvar hasStringCodePointAt = !!((_$codePointAt = (_ = \" \").codePointAt) !== null && _$codePointAt !== void 0 && _$codePointAt.call(_, 0));\n\nvar stringFromKeyEvent = function stringFromKeyEvent(event) {\n  if (event.key && hasStringCodePointAt && event.key.codePointAt(0) === event.keyCode) {\n    return event.key;\n  } else {\n    var code;\n\n    if (event.which === null) {\n      code = event.keyCode;\n    } else if (event.which !== 0 && event.charCode !== 0) {\n      code = event.charCode;\n    }\n\n    if (code != null && keyNames$1[code] !== \"escape\") {\n      return UTF16String.fromCodepoints([code]).toString();\n    }\n  }\n};\n\nvar pasteEventIsCrippledSafariHTMLPaste = function pasteEventIsCrippledSafariHTMLPaste(event) {\n  var paste = event.clipboardData;\n\n  if (paste) {\n    if (paste.types.includes(\"text/html\")) {\n      // Answer is yes if there's any possibility of Paste and Match Style in Safari,\n      // which is nearly impossible to detect confidently: https://bugs.webkit.org/show_bug.cgi?id=174165\n      var _iterator7 = _createForOfIteratorHelper2(paste.types),\n          _step8;\n\n      try {\n        for (_iterator7.s(); !(_step8 = _iterator7.n()).done;) {\n          var type = _step8.value;\n          var hasPasteboardFlavor = /^CorePasteboardFlavorType/.test(type);\n          var hasReadableDynamicData = /^dyn\\./.test(type) && paste.getData(type);\n          var mightBePasteAndMatchStyle = hasPasteboardFlavor || hasReadableDynamicData;\n\n          if (mightBePasteAndMatchStyle) {\n            return true;\n          }\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n\n      return false;\n    } else {\n      var isExternalHTMLPaste = paste.types.includes(\"com.apple.webarchive\");\n      var isExternalRichTextPaste = paste.types.includes(\"com.apple.flat-rtfd\");\n      return isExternalHTMLPaste || isExternalRichTextPaste;\n    }\n  }\n};\n\nvar CompositionInput = /*#__PURE__*/function (_BasicObject17) {\n  _inherits2(CompositionInput, _BasicObject17);\n\n  var _super37 = _createSuper2(CompositionInput);\n\n  function CompositionInput(inputController) {\n    var _this62;\n\n    _classCallCheck2(this, CompositionInput);\n\n    _this62 = _super37.apply(this, arguments);\n    _this62.inputController = inputController;\n    _this62.responder = _this62.inputController.responder;\n    _this62.delegate = _this62.inputController.delegate;\n    _this62.inputSummary = _this62.inputController.inputSummary;\n    _this62.data = {};\n    return _this62;\n  }\n\n  _createClass2(CompositionInput, [{\n    key: \"start\",\n    value: function start(data) {\n      this.data.start = data;\n\n      if (this.isSignificant()) {\n        var _this$responder5;\n\n        if (this.inputSummary.eventName === \"keypress\" && this.inputSummary.textAdded) {\n          var _this$responder4;\n\n          (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(\"left\");\n        }\n\n        if (!this.selectionIsExpanded()) {\n          this.insertPlaceholder();\n          this.requestRender();\n        }\n\n        this.range = (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.getSelectedRange();\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update(data) {\n      this.data.update = data;\n\n      if (this.isSignificant()) {\n        var range = this.selectPlaceholder();\n\n        if (range) {\n          this.forgetPlaceholder();\n          this.range = range;\n        }\n      }\n    }\n  }, {\n    key: \"end\",\n    value: function end(data) {\n      this.data.end = data;\n\n      if (this.isSignificant()) {\n        this.forgetPlaceholder();\n\n        if (this.canApplyToDocument()) {\n          var _this$delegate2, _this$responder6, _this$responder7, _this$responder8;\n\n          this.setInputSummary({\n            preferDocument: true,\n            didInput: false\n          });\n          (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.inputControllerWillPerformTyping();\n          (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.setSelectedRange(this.range);\n          (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertString(this.data.end);\n          return (_this$responder8 = this.responder) === null || _this$responder8 === void 0 ? void 0 : _this$responder8.setSelectedRange(this.range[0] + this.data.end.length);\n        } else if (this.data.start != null || this.data.update != null) {\n          this.requestReparse();\n          return this.inputController.reset();\n        }\n      } else {\n        return this.inputController.reset();\n      }\n    }\n  }, {\n    key: \"getEndData\",\n    value: function getEndData() {\n      return this.data.end;\n    }\n  }, {\n    key: \"isEnded\",\n    value: function isEnded() {\n      return this.getEndData() != null;\n    }\n  }, {\n    key: \"isSignificant\",\n    value: function isSignificant() {\n      if (browser.composesExistingText) {\n        return this.inputSummary.didInput;\n      } else {\n        return true;\n      }\n    } // Private\n\n  }, {\n    key: \"canApplyToDocument\",\n    value: function canApplyToDocument() {\n      var _this$data$start, _this$data$end;\n\n      return ((_this$data$start = this.data.start) === null || _this$data$start === void 0 ? void 0 : _this$data$start.length) === 0 && ((_this$data$end = this.data.end) === null || _this$data$end === void 0 ? void 0 : _this$data$end.length) > 0 && this.range;\n    }\n  }]);\n\n  return CompositionInput;\n}(BasicObject);\n\nCompositionInput.proxyMethod(\"inputController.setInputSummary\");\nCompositionInput.proxyMethod(\"inputController.requestRender\");\nCompositionInput.proxyMethod(\"inputController.requestReparse\");\nCompositionInput.proxyMethod(\"responder?.selectionIsExpanded\");\nCompositionInput.proxyMethod(\"responder?.insertPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.selectPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.forgetPlaceholder\");\n\nvar Level2InputController = /*#__PURE__*/function (_InputController2) {\n  _inherits2(Level2InputController, _InputController2);\n\n  var _super38 = _createSuper2(Level2InputController);\n\n  function Level2InputController() {\n    var _this63;\n\n    _classCallCheck2(this, Level2InputController);\n\n    _this63 = _super38.apply(this, arguments);\n    _this63.render = _this63.render.bind(_assertThisInitialized2(_this63));\n    return _this63;\n  }\n\n  _createClass2(Level2InputController, [{\n    key: \"elementDidMutate\",\n    value: function elementDidMutate() {\n      if (this.scheduledRender) {\n        if (this.composing) {\n          var _this$delegate, _this$delegate$inputC;\n\n          return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n        }\n      } else {\n        return this.reparse();\n      }\n    }\n  }, {\n    key: \"scheduleRender\",\n    value: function scheduleRender() {\n      return this.scheduledRender ? this.scheduledRender : this.scheduledRender = requestAnimationFrame(this.render);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$afterRender;\n\n      cancelAnimationFrame(this.scheduledRender);\n      this.scheduledRender = null;\n\n      if (!this.composing) {\n        var _this$delegate2;\n\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.render();\n      }\n\n      (_this$afterRender = this.afterRender) === null || _this$afterRender === void 0 ? void 0 : _this$afterRender.call(this);\n      this.afterRender = null;\n    }\n  }, {\n    key: \"reparse\",\n    value: function reparse() {\n      var _this$delegate3;\n\n      return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.reparse();\n    } // Responder helpers\n\n  }, {\n    key: \"insertString\",\n    value: function insertString() {\n      var _this$delegate4;\n\n      var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n      var options = arguments.length > 1 ? arguments[1] : undefined;\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n      return this.withTargetDOMRange(function () {\n        var _this$responder;\n\n        return (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertString(string, options);\n      });\n    }\n  }, {\n    key: \"toggleAttributeIfSupported\",\n    value: function toggleAttributeIfSupported(attributeName) {\n      if (getAllAttributeNames().includes(attributeName)) {\n        var _this$delegate5;\n\n        (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerWillPerformFormatting(attributeName);\n        return this.withTargetDOMRange(function () {\n          var _this$responder2;\n\n          return (_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.toggleCurrentAttribute(attributeName);\n        });\n      }\n    }\n  }, {\n    key: \"activateAttributeIfSupported\",\n    value: function activateAttributeIfSupported(attributeName, value) {\n      if (getAllAttributeNames().includes(attributeName)) {\n        var _this$delegate6;\n\n        (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.inputControllerWillPerformFormatting(attributeName);\n        return this.withTargetDOMRange(function () {\n          var _this$responder3;\n\n          return (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.setCurrentAttribute(attributeName, value);\n        });\n      }\n    }\n  }, {\n    key: \"deleteInDirection\",\n    value: function deleteInDirection(direction) {\n      var _this64 = this;\n\n      var _ref21 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        recordUndoEntry: true\n      },\n          recordUndoEntry = _ref21.recordUndoEntry;\n\n      if (recordUndoEntry) {\n        var _this$delegate7;\n\n        (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.inputControllerWillPerformTyping();\n      }\n\n      var perform = function perform() {\n        var _this$responder4;\n\n        return (_this$responder4 = _this64.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(direction);\n      };\n\n      var domRange = this.getTargetDOMRange({\n        minLength: 2\n      });\n\n      if (domRange) {\n        return this.withTargetDOMRange(domRange, perform);\n      } else {\n        return perform();\n      }\n    } // Selection helpers\n\n  }, {\n    key: \"withTargetDOMRange\",\n    value: function withTargetDOMRange(domRange, fn) {\n      if (typeof domRange === \"function\") {\n        fn = domRange;\n        domRange = this.getTargetDOMRange();\n      }\n\n      if (domRange) {\n        var _this$responder5;\n\n        return (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.withTargetDOMRange(domRange, fn.bind(this));\n      } else {\n        selectionChangeObserver.reset();\n        return fn.call(this);\n      }\n    }\n  }, {\n    key: \"getTargetDOMRange\",\n    value: function getTargetDOMRange() {\n      var _this$event$getTarget, _this$event;\n\n      var _ref22 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        minLength: 0\n      },\n          minLength = _ref22.minLength;\n\n      var targetRanges = (_this$event$getTarget = (_this$event = this.event).getTargetRanges) === null || _this$event$getTarget === void 0 ? void 0 : _this$event$getTarget.call(_this$event);\n\n      if (targetRanges) {\n        if (targetRanges.length) {\n          var domRange = staticRangeToRange(targetRanges[0]);\n\n          if (minLength === 0 || domRange.toString().length >= minLength) {\n            return domRange;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"withEvent\",\n    value: function withEvent(event, fn) {\n      var result;\n      this.event = event;\n\n      try {\n        result = fn.call(this);\n      } finally {\n        this.event = null;\n      }\n\n      return result;\n    }\n  }]);\n\n  return Level2InputController;\n}(InputController);\n\n_defineProperty(Level2InputController, \"events\", {\n  keydown: function keydown(event) {\n    if (keyEventIsKeyboardCommand(event)) {\n      var _this$delegate8;\n\n      var command = keyboardCommandFromKeyEvent(event);\n\n      if ((_this$delegate8 = this.delegate) !== null && _this$delegate8 !== void 0 && _this$delegate8.inputControllerDidReceiveKeyboardCommand(command)) {\n        event.preventDefault();\n      }\n    } else {\n      var _name3 = event.key;\n\n      if (event.altKey) {\n        _name3 += \"+Alt\";\n      }\n\n      if (event.shiftKey) {\n        _name3 += \"+Shift\";\n      }\n\n      var handler = this.constructor.keys[_name3];\n\n      if (handler) {\n        return this.withEvent(event, handler);\n      }\n    }\n  },\n  // Handle paste event to work around beforeinput.insertFromPaste browser bugs.\n  // Safe to remove each condition once fixed upstream.\n  paste: function paste(event) {\n    var _event$clipboardData; // https://bugs.webkit.org/show_bug.cgi?id=194921\n\n\n    var paste;\n    var href = (_event$clipboardData = event.clipboardData) === null || _event$clipboardData === void 0 ? void 0 : _event$clipboardData.getData(\"URL\");\n\n    if (pasteEventHasFilesOnly(event)) {\n      event.preventDefault();\n      return this.attachFiles(event.clipboardData.files); // https://bugs.chromium.org/p/chromium/issues/detail?id=934448\n    } else if (pasteEventHasPlainTextOnly(event)) {\n      var _this$delegate9, _this$responder6, _this$delegate10;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/plain\",\n        string: event.clipboardData.getData(\"text/plain\")\n      };\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillPaste(paste);\n      (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.insertString(paste.string);\n      this.render();\n      return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerDidPaste(paste); // https://bugs.webkit.org/show_bug.cgi?id=196702\n    } else if (href) {\n      var _this$delegate11, _this$responder7, _this$delegate12;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/html\",\n        html: this.createLinkHTML(href)\n      };\n      (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerWillPaste(paste);\n      (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertHTML(paste.html);\n      this.render();\n      return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerDidPaste(paste);\n    }\n  },\n  beforeinput: function beforeinput(event) {\n    var handler = this.constructor.inputTypes[event.inputType];\n\n    if (handler) {\n      this.withEvent(event, handler);\n      return this.scheduleRender();\n    }\n  },\n  input: function input(event) {\n    return selectionChangeObserver.reset();\n  },\n  dragstart: function dragstart(event) {\n    var _this$responder8;\n\n    if ((_this$responder8 = this.responder) !== null && _this$responder8 !== void 0 && _this$responder8.selectionContainsAttachments()) {\n      var _this$responder9;\n\n      event.dataTransfer.setData(\"application/x-trix-dragging\", true);\n      this.dragging = {\n        range: (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.getSelectedRange(),\n        point: pointFromEvent(event)\n      };\n    }\n  },\n  dragenter: function dragenter(event) {\n    if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n  dragover: function dragover(event) {\n    if (this.dragging) {\n      event.preventDefault();\n      var point = pointFromEvent(event);\n\n      if (!objectsAreEqual(point, this.dragging.point)) {\n        var _this$responder10;\n\n        this.dragging.point = point;\n        return (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.setLocationRangeFromPointRange(point);\n      }\n    } else if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n  drop: function drop(event) {\n    if (this.dragging) {\n      var _this$delegate13, _this$responder11;\n\n      event.preventDefault();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerWillMoveText();\n      (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.moveTextFromRange(this.dragging.range);\n      this.dragging = null;\n      return this.scheduleRender();\n    } else if (dragEventHasFiles(event)) {\n      var _this$responder12;\n\n      event.preventDefault();\n      var point = pointFromEvent(event);\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.setLocationRangeFromPointRange(point);\n      return this.attachFiles(event.dataTransfer.files);\n    }\n  },\n  dragend: function dragend() {\n    if (this.dragging) {\n      var _this$responder13;\n\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.setSelectedRange(this.dragging.range);\n      this.dragging = null;\n    }\n  },\n  compositionend: function compositionend(event) {\n    if (this.composing) {\n      this.composing = false;\n      return this.scheduleRender();\n    }\n  }\n});\n\n_defineProperty(Level2InputController, \"keys\", {\n  ArrowLeft: function ArrowLeft() {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.shouldManageMovingCursorInDirection(\"backward\")) {\n      var _this$responder15;\n\n      this.event.preventDefault();\n      return (_this$responder15 = this.responder) === null || _this$responder15 === void 0 ? void 0 : _this$responder15.moveCursorInDirection(\"backward\");\n    }\n  },\n  ArrowRight: function ArrowRight() {\n    var _this$responder16;\n\n    if ((_this$responder16 = this.responder) !== null && _this$responder16 !== void 0 && _this$responder16.shouldManageMovingCursorInDirection(\"forward\")) {\n      var _this$responder17;\n\n      this.event.preventDefault();\n      return (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.moveCursorInDirection(\"forward\");\n    }\n  },\n  Backspace: function Backspace() {\n    var _this$responder18;\n\n    if ((_this$responder18 = this.responder) !== null && _this$responder18 !== void 0 && _this$responder18.shouldManageDeletingInDirection(\"backward\")) {\n      var _this$delegate14, _this$responder19;\n\n      this.event.preventDefault();\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPerformTyping();\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.deleteInDirection(\"backward\");\n      return this.render();\n    }\n  },\n  Tab: function Tab() {\n    var _this$responder20;\n\n    if ((_this$responder20 = this.responder) !== null && _this$responder20 !== void 0 && _this$responder20.canIncreaseNestingLevel()) {\n      var _this$responder21;\n\n      this.event.preventDefault();\n      (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.increaseNestingLevel();\n      return this.render();\n    }\n  },\n  \"Tab+Shift\": function TabShift() {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canDecreaseNestingLevel()) {\n      var _this$responder23;\n\n      this.event.preventDefault();\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.decreaseNestingLevel();\n      return this.render();\n    }\n  }\n});\n\n_defineProperty(Level2InputController, \"inputTypes\", {\n  deleteByComposition: function deleteByComposition() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n  deleteByCut: function deleteByCut() {\n    return this.deleteInDirection(\"backward\");\n  },\n  deleteByDrag: function deleteByDrag() {\n    this.event.preventDefault();\n    return this.withTargetDOMRange(function () {\n      var _this$responder24;\n\n      this.deleteByDragRange = (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.getSelectedRange();\n    });\n  },\n  deleteCompositionText: function deleteCompositionText() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n  deleteContent: function deleteContent() {\n    return this.deleteInDirection(\"backward\");\n  },\n  deleteContentBackward: function deleteContentBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n  deleteContentForward: function deleteContentForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n  deleteEntireSoftLine: function deleteEntireSoftLine() {\n    return this.deleteInDirection(\"forward\");\n  },\n  deleteHardLineBackward: function deleteHardLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n  deleteHardLineForward: function deleteHardLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n  deleteSoftLineBackward: function deleteSoftLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n  deleteSoftLineForward: function deleteSoftLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n  deleteWordBackward: function deleteWordBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n  deleteWordForward: function deleteWordForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n  formatBackColor: function formatBackColor() {\n    return this.activateAttributeIfSupported(\"backgroundColor\", this.event.data);\n  },\n  formatBold: function formatBold() {\n    return this.toggleAttributeIfSupported(\"bold\");\n  },\n  formatFontColor: function formatFontColor() {\n    return this.activateAttributeIfSupported(\"color\", this.event.data);\n  },\n  formatFontName: function formatFontName() {\n    return this.activateAttributeIfSupported(\"font\", this.event.data);\n  },\n  formatIndent: function formatIndent() {\n    var _this$responder25;\n\n    if ((_this$responder25 = this.responder) !== null && _this$responder25 !== void 0 && _this$responder25.canIncreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder26;\n\n        return (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.increaseNestingLevel();\n      });\n    }\n  },\n  formatItalic: function formatItalic() {\n    return this.toggleAttributeIfSupported(\"italic\");\n  },\n  formatJustifyCenter: function formatJustifyCenter() {\n    return this.toggleAttributeIfSupported(\"justifyCenter\");\n  },\n  formatJustifyFull: function formatJustifyFull() {\n    return this.toggleAttributeIfSupported(\"justifyFull\");\n  },\n  formatJustifyLeft: function formatJustifyLeft() {\n    return this.toggleAttributeIfSupported(\"justifyLeft\");\n  },\n  formatJustifyRight: function formatJustifyRight() {\n    return this.toggleAttributeIfSupported(\"justifyRight\");\n  },\n  formatOutdent: function formatOutdent() {\n    var _this$responder27;\n\n    if ((_this$responder27 = this.responder) !== null && _this$responder27 !== void 0 && _this$responder27.canDecreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder28;\n\n        return (_this$responder28 = this.responder) === null || _this$responder28 === void 0 ? void 0 : _this$responder28.decreaseNestingLevel();\n      });\n    }\n  },\n  formatRemove: function formatRemove() {\n    this.withTargetDOMRange(function () {\n      for (var attributeName in (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.getCurrentAttributes()) {\n        var _this$responder29, _this$responder30;\n\n        (_this$responder30 = this.responder) === null || _this$responder30 === void 0 ? void 0 : _this$responder30.removeCurrentAttribute(attributeName);\n      }\n    });\n  },\n  formatSetBlockTextDirection: function formatSetBlockTextDirection() {\n    return this.activateAttributeIfSupported(\"blockDir\", this.event.data);\n  },\n  formatSetInlineTextDirection: function formatSetInlineTextDirection() {\n    return this.activateAttributeIfSupported(\"textDir\", this.event.data);\n  },\n  formatStrikeThrough: function formatStrikeThrough() {\n    return this.toggleAttributeIfSupported(\"strike\");\n  },\n  formatSubscript: function formatSubscript() {\n    return this.toggleAttributeIfSupported(\"sub\");\n  },\n  formatSuperscript: function formatSuperscript() {\n    return this.toggleAttributeIfSupported(\"sup\");\n  },\n  formatUnderline: function formatUnderline() {\n    return this.toggleAttributeIfSupported(\"underline\");\n  },\n  historyRedo: function historyRedo() {\n    var _this$delegate15;\n\n    return (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerWillPerformRedo();\n  },\n  historyUndo: function historyUndo() {\n    var _this$delegate16;\n\n    return (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPerformUndo();\n  },\n  insertCompositionText: function insertCompositionText() {\n    this.composing = true;\n    return this.insertString(this.event.data);\n  },\n  insertFromComposition: function insertFromComposition() {\n    this.composing = false;\n    return this.insertString(this.event.data);\n  },\n  insertFromDrop: function insertFromDrop() {\n    var range = this.deleteByDragRange;\n\n    if (range) {\n      var _this$delegate17;\n\n      this.deleteByDragRange = null;\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerWillMoveText();\n      return this.withTargetDOMRange(function () {\n        var _this$responder31;\n\n        return (_this$responder31 = this.responder) === null || _this$responder31 === void 0 ? void 0 : _this$responder31.moveTextFromRange(range);\n      });\n    }\n  },\n  insertFromPaste: function insertFromPaste() {\n    var _this65 = this;\n\n    var _dataTransfer$files;\n\n    var dataTransfer = this.event.dataTransfer;\n    var paste = {\n      dataTransfer: dataTransfer\n    };\n    var href = dataTransfer.getData(\"URL\");\n    var html = dataTransfer.getData(\"text/html\");\n\n    if (href) {\n      var _this$delegate18;\n\n      var string;\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n\n      var _name4 = dataTransfer.getData(\"public.url-name\");\n\n      if (_name4) {\n        string = squishBreakableWhitespace(_name4).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder32;\n\n        return (_this$responder32 = this.responder) === null || _this$responder32 === void 0 ? void 0 : _this$responder32.insertHTML(paste.html);\n      });\n\n      this.afterRender = function () {\n        var _this$delegate19;\n\n        return (_this$delegate19 = _this65.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      };\n    } else if (dataTransferIsPlainText(dataTransfer)) {\n      var _this$delegate20;\n\n      paste.type = \"text/plain\";\n      paste.string = dataTransfer.getData(\"text/plain\");\n      (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder33;\n\n        return (_this$responder33 = this.responder) === null || _this$responder33 === void 0 ? void 0 : _this$responder33.insertString(paste.string);\n      });\n\n      this.afterRender = function () {\n        var _this$delegate21;\n\n        return (_this$delegate21 = _this65.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerDidPaste(paste);\n      };\n    } else if (html) {\n      var _this$delegate22;\n\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder34;\n\n        return (_this$responder34 = this.responder) === null || _this$responder34 === void 0 ? void 0 : _this$responder34.insertHTML(paste.html);\n      });\n\n      this.afterRender = function () {\n        var _this$delegate23;\n\n        return (_this$delegate23 = _this65.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerDidPaste(paste);\n      };\n    } else if ((_dataTransfer$files = dataTransfer.files) !== null && _dataTransfer$files !== void 0 && _dataTransfer$files.length) {\n      var _this$delegate24;\n\n      paste.type = \"File\";\n      paste.file = dataTransfer.files[0];\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder35;\n\n        return (_this$responder35 = this.responder) === null || _this$responder35 === void 0 ? void 0 : _this$responder35.insertFile(paste.file);\n      });\n\n      this.afterRender = function () {\n        var _this$delegate25;\n\n        return (_this$delegate25 = _this65.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerDidPaste(paste);\n      };\n    }\n  },\n  insertFromYank: function insertFromYank() {\n    return this.insertString(this.event.data);\n  },\n  insertLineBreak: function insertLineBreak() {\n    return this.insertString(\"\\n\");\n  },\n  insertLink: function insertLink() {\n    return this.activateAttributeIfSupported(\"href\", this.event.data);\n  },\n  insertOrderedList: function insertOrderedList() {\n    return this.toggleAttributeIfSupported(\"number\");\n  },\n  insertParagraph: function insertParagraph() {\n    var _this$delegate26;\n\n    (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder36;\n\n      return (_this$responder36 = this.responder) === null || _this$responder36 === void 0 ? void 0 : _this$responder36.insertLineBreak();\n    });\n  },\n  insertReplacementText: function insertReplacementText() {\n    return this.insertString(this.event.dataTransfer.getData(\"text/plain\"), {\n      updatePosition: false\n    });\n  },\n  insertText: function insertText() {\n    var _this$event$dataTrans;\n\n    return this.insertString(this.event.data || ((_this$event$dataTrans = this.event.dataTransfer) === null || _this$event$dataTrans === void 0 ? void 0 : _this$event$dataTrans.getData(\"text/plain\")));\n  },\n  insertTranspose: function insertTranspose() {\n    return this.insertString(this.event.data);\n  },\n  insertUnorderedList: function insertUnorderedList() {\n    return this.toggleAttributeIfSupported(\"bullet\");\n  }\n});\n\nvar staticRangeToRange = function staticRangeToRange(staticRange) {\n  var range = document.createRange();\n  range.setStart(staticRange.startContainer, staticRange.startOffset);\n  range.setEnd(staticRange.endContainer, staticRange.endOffset);\n  return range;\n}; // Event helpers\n\n\nvar dragEventHasFiles = function dragEventHasFiles(event) {\n  var _event$dataTransfer;\n\n  return Array.from(((_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.types) || []).includes(\"Files\");\n};\n\nvar pasteEventHasFilesOnly = function pasteEventHasFilesOnly(event) {\n  var clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"Files\") && clipboard.types.length === 1 && clipboard.files.length >= 1;\n  }\n};\n\nvar pasteEventHasPlainTextOnly = function pasteEventHasPlainTextOnly(event) {\n  var clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"text/plain\") && clipboard.types.length === 1;\n  }\n};\n\nvar keyboardCommandFromKeyEvent = function keyboardCommandFromKeyEvent(event) {\n  var command = [];\n\n  if (event.altKey) {\n    command.push(\"alt\");\n  }\n\n  if (event.shiftKey) {\n    command.push(\"shift\");\n  }\n\n  command.push(event.key);\n  return command;\n};\n\nvar pointFromEvent = function pointFromEvent(event) {\n  return {\n    x: event.clientX,\n    y: event.clientY\n  };\n};\n\nvar lang = config.lang,\n    css = config.css,\n    keyNames = config.keyNames;\n\nvar undoable = function undoable(fn) {\n  return function () {\n    var commands = fn.apply(this, arguments);\n    commands.do();\n\n    if (!this.undos) {\n      this.undos = [];\n    }\n\n    this.undos.push(commands.undo);\n  };\n};\n\nvar AttachmentEditorController = /*#__PURE__*/function (_BasicObject18) {\n  _inherits2(AttachmentEditorController, _BasicObject18);\n\n  var _super39 = _createSuper2(AttachmentEditorController);\n\n  function AttachmentEditorController(attachmentPiece, _element, container) {\n    var _this66;\n\n    _classCallCheck2(this, AttachmentEditorController);\n\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    _this66 = _super39.apply(this, arguments);\n\n    _defineProperty(_assertThisInitialized2(_this66), \"makeElementMutable\", undoable(function () {\n      return {\n        do: function _do() {\n          _this66.element.dataset.trixMutable = true;\n        },\n        undo: function undo() {\n          return delete _this66.element.dataset.trixMutable;\n        }\n      };\n    }));\n\n    _defineProperty(_assertThisInitialized2(_this66), \"addToolbar\", undoable(function () {\n      // <div class=\"#{css.attachmentMetadataContainer}\" data-trix-mutable=\"true\">\n      //   <div class=\"trix-button-row\">\n      //     <span class=\"trix-button-group trix-button-group--actions\">\n      //       <button type=\"button\" class=\"trix-button trix-button--remove\" title=\"#{lang.remove}\" data-trix-action=\"remove\">#{lang.remove}</button>\n      //     </span>\n      //   </div>\n      // </div>\n      var element = makeElement({\n        tagName: \"div\",\n        className: css.attachmentToolbar,\n        data: {\n          trixMutable: true\n        },\n        childNodes: makeElement({\n          tagName: \"div\",\n          className: \"trix-button-row\",\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: \"trix-button-group trix-button-group--actions\",\n            childNodes: makeElement({\n              tagName: \"button\",\n              className: \"trix-button trix-button--remove\",\n              textContent: lang.remove,\n              attributes: {\n                title: lang.remove\n              },\n              data: {\n                trixAction: \"remove\"\n              }\n            })\n          })\n        })\n      });\n\n      if (_this66.attachment.isPreviewable()) {\n        // <div class=\"#{css.attachmentMetadataContainer}\">\n        //   <span class=\"#{css.attachmentMetadata}\">\n        //     <span class=\"#{css.attachmentName}\" title=\"#{name}\">#{name}</span>\n        //     <span class=\"#{css.attachmentSize}\">#{size}</span>\n        //   </span>\n        // </div>\n        element.appendChild(makeElement({\n          tagName: \"div\",\n          className: css.attachmentMetadataContainer,\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: css.attachmentMetadata,\n            childNodes: [makeElement({\n              tagName: \"span\",\n              className: css.attachmentName,\n              textContent: _this66.attachment.getFilename(),\n              attributes: {\n                title: _this66.attachment.getFilename()\n              }\n            }), makeElement({\n              tagName: \"span\",\n              className: css.attachmentSize,\n              textContent: _this66.attachment.getFormattedFilesize()\n            })]\n          })\n        }));\n      }\n\n      handleEvent(\"click\", {\n        onElement: element,\n        withCallback: _this66.didClickToolbar\n      });\n      handleEvent(\"click\", {\n        onElement: element,\n        matchingSelector: \"[data-trix-action]\",\n        withCallback: _this66.didClickActionButton\n      });\n      return {\n        do: function _do() {\n          return _this66.element.appendChild(element);\n        },\n        undo: function undo() {\n          return removeNode(element);\n        }\n      };\n    }));\n\n    _defineProperty(_assertThisInitialized2(_this66), \"installCaptionEditor\", undoable(function () {\n      var textarea = makeElement({\n        tagName: \"textarea\",\n        className: css.attachmentCaptionEditor,\n        attributes: {\n          placeholder: lang.captionPlaceholder\n        },\n        data: {\n          trixMutable: true\n        }\n      });\n      textarea.value = _this66.attachmentPiece.getCaption();\n      var textareaClone = textarea.cloneNode();\n      textareaClone.classList.add(\"trix-autoresize-clone\");\n      textareaClone.tabIndex = -1;\n\n      var autoresize = function autoresize() {\n        textareaClone.value = textarea.value;\n        textarea.style.height = textareaClone.scrollHeight + \"px\";\n      };\n\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: autoresize\n      });\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: _this66.didInputCaption\n      });\n      handleEvent(\"keydown\", {\n        onElement: textarea,\n        withCallback: _this66.didKeyDownCaption\n      });\n      handleEvent(\"change\", {\n        onElement: textarea,\n        withCallback: _this66.didChangeCaption\n      });\n      handleEvent(\"blur\", {\n        onElement: textarea,\n        withCallback: _this66.didBlurCaption\n      });\n\n      var figcaption = _this66.element.querySelector(\"figcaption\");\n\n      var editingFigcaption = figcaption.cloneNode();\n      return {\n        do: function _do() {\n          figcaption.style.display = \"none\";\n          editingFigcaption.appendChild(textarea);\n          editingFigcaption.appendChild(textareaClone);\n          editingFigcaption.classList.add(\"\".concat(css.attachmentCaption, \"--editing\"));\n          figcaption.parentElement.insertBefore(editingFigcaption, figcaption);\n          autoresize();\n\n          if (_this66.options.editCaption) {\n            return defer(function () {\n              return textarea.focus();\n            });\n          }\n        },\n        undo: function undo() {\n          removeNode(editingFigcaption);\n          figcaption.style.display = null;\n        }\n      };\n    }));\n\n    _this66.didClickToolbar = _this66.didClickToolbar.bind(_assertThisInitialized2(_this66));\n    _this66.didClickActionButton = _this66.didClickActionButton.bind(_assertThisInitialized2(_this66));\n    _this66.didKeyDownCaption = _this66.didKeyDownCaption.bind(_assertThisInitialized2(_this66));\n    _this66.didInputCaption = _this66.didInputCaption.bind(_assertThisInitialized2(_this66));\n    _this66.didChangeCaption = _this66.didChangeCaption.bind(_assertThisInitialized2(_this66));\n    _this66.didBlurCaption = _this66.didBlurCaption.bind(_assertThisInitialized2(_this66));\n    _this66.attachmentPiece = attachmentPiece;\n    _this66.element = _element;\n    _this66.container = container;\n    _this66.options = options;\n    _this66.attachment = _this66.attachmentPiece.attachment;\n\n    if (tagName(_this66.element) === \"a\") {\n      _this66.element = _this66.element.firstChild;\n    }\n\n    _this66.install();\n\n    return _this66;\n  }\n\n  _createClass2(AttachmentEditorController, [{\n    key: \"install\",\n    value: function install() {\n      this.makeElementMutable();\n      this.addToolbar();\n\n      if (this.attachment.isPreviewable()) {\n        this.installCaptionEditor();\n      }\n    }\n  }, {\n    key: \"uninstall\",\n    value: function uninstall() {\n      var _this$delegate;\n\n      var undo = this.undos.pop();\n      this.savePendingCaption();\n\n      while (undo) {\n        undo();\n        undo = this.undos.pop();\n      }\n\n      (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.didUninstallAttachmentEditor(this);\n    } // Private\n\n  }, {\n    key: \"savePendingCaption\",\n    value: function savePendingCaption() {\n      if (this.pendingCaption) {\n        var caption = this.pendingCaption;\n        this.pendingCaption = null;\n\n        if (caption) {\n          var _this$delegate2, _this$delegate2$attac;\n\n          (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentEditorDidRequestUpdatingAttributesForAttachment) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, {\n            caption: caption\n          }, this.attachment);\n        } else {\n          var _this$delegate3, _this$delegate3$attac;\n\n          (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$attac = _this$delegate3.attachmentEditorDidRequestRemovingAttributeForAttachment) === null || _this$delegate3$attac === void 0 ? void 0 : _this$delegate3$attac.call(_this$delegate3, \"caption\", this.attachment);\n        }\n      }\n    } // Installing and uninstalling\n    // Event handlers\n\n  }, {\n    key: \"didClickToolbar\",\n    value: function didClickToolbar(event) {\n      event.preventDefault();\n      return event.stopPropagation();\n    }\n  }, {\n    key: \"didClickActionButton\",\n    value: function didClickActionButton(event) {\n      var _this$delegate4;\n\n      var action = event.target.getAttribute(\"data-trix-action\");\n\n      switch (action) {\n        case \"remove\":\n          return (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.attachmentEditorDidRequestRemovalOfAttachment(this.attachment);\n      }\n    }\n  }, {\n    key: \"didKeyDownCaption\",\n    value: function didKeyDownCaption(event) {\n      if (keyNames[event.keyCode] === \"return\") {\n        var _this$delegate5, _this$delegate5$attac;\n\n        event.preventDefault();\n        this.savePendingCaption();\n        return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$attac = _this$delegate5.attachmentEditorDidRequestDeselectingAttachment) === null || _this$delegate5$attac === void 0 ? void 0 : _this$delegate5$attac.call(_this$delegate5, this.attachment);\n      }\n    }\n  }, {\n    key: \"didInputCaption\",\n    value: function didInputCaption(event) {\n      this.pendingCaption = event.target.value.replace(/\\s/g, \" \").trim();\n    }\n  }, {\n    key: \"didChangeCaption\",\n    value: function didChangeCaption(event) {\n      return this.savePendingCaption();\n    }\n  }, {\n    key: \"didBlurCaption\",\n    value: function didBlurCaption(event) {\n      return this.savePendingCaption();\n    }\n  }]);\n\n  return AttachmentEditorController;\n}(BasicObject);\n\nvar CompositionController = /*#__PURE__*/function (_BasicObject19) {\n  _inherits2(CompositionController, _BasicObject19);\n\n  var _super40 = _createSuper2(CompositionController);\n\n  function CompositionController(element, composition) {\n    var _this67;\n\n    _classCallCheck2(this, CompositionController);\n\n    _this67 = _super40.apply(this, arguments);\n    _this67.didFocus = _this67.didFocus.bind(_assertThisInitialized2(_this67));\n    _this67.didBlur = _this67.didBlur.bind(_assertThisInitialized2(_this67));\n    _this67.didClickAttachment = _this67.didClickAttachment.bind(_assertThisInitialized2(_this67));\n    _this67.element = element;\n    _this67.composition = composition;\n    _this67.documentView = new DocumentView(_this67.composition.document, {\n      element: _this67.element\n    });\n    handleEvent(\"focus\", {\n      onElement: _this67.element,\n      withCallback: _this67.didFocus\n    });\n    handleEvent(\"blur\", {\n      onElement: _this67.element,\n      withCallback: _this67.didBlur\n    });\n    handleEvent(\"click\", {\n      onElement: _this67.element,\n      matchingSelector: \"a[contenteditable=false]\",\n      preventDefault: true\n    });\n    handleEvent(\"mousedown\", {\n      onElement: _this67.element,\n      matchingSelector: attachmentSelector,\n      withCallback: _this67.didClickAttachment\n    });\n    handleEvent(\"click\", {\n      onElement: _this67.element,\n      matchingSelector: \"a\".concat(attachmentSelector),\n      preventDefault: true\n    });\n    return _this67;\n  }\n\n  _createClass2(CompositionController, [{\n    key: \"didFocus\",\n    value: function didFocus(event) {\n      var _this68 = this;\n\n      var _this$blurPromise;\n\n      var perform = function perform() {\n        if (!_this68.focused) {\n          var _this$delegate, _this$delegate$compos;\n\n          _this68.focused = true;\n          return (_this$delegate = _this68.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionControllerDidFocus) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate);\n        }\n      };\n\n      return ((_this$blurPromise = this.blurPromise) === null || _this$blurPromise === void 0 ? void 0 : _this$blurPromise.then(perform)) || perform();\n    }\n  }, {\n    key: \"didBlur\",\n    value: function didBlur(event) {\n      var _this69 = this;\n\n      this.blurPromise = new Promise(function (resolve) {\n        return defer(function () {\n          if (!innerElementIsActive(_this69.element)) {\n            var _this$delegate2, _this$delegate2$compo;\n\n            _this69.focused = null;\n            (_this$delegate2 = _this69.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionControllerDidBlur) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n          }\n\n          _this69.blurPromise = null;\n          return resolve();\n        });\n      });\n    }\n  }, {\n    key: \"didClickAttachment\",\n    value: function didClickAttachment(event, target) {\n      var _this$delegate3, _this$delegate3$compo;\n\n      var attachment = this.findAttachmentForElement(target);\n      var editCaption = !!findClosestElementFromNode(event.target, {\n        matchingSelector: \"figcaption\"\n      });\n      return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionControllerDidSelectAttachment) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3, attachment, {\n        editCaption: editCaption\n      });\n    }\n  }, {\n    key: \"getSerializableElement\",\n    value: function getSerializableElement() {\n      if (this.isEditingAttachment()) {\n        return this.documentView.shadowElement;\n      } else {\n        return this.element;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$delegate6, _this$delegate6$compo;\n\n      if (this.revision !== this.composition.revision) {\n        this.documentView.setDocument(this.composition.document);\n        this.documentView.render();\n        this.revision = this.composition.revision;\n      }\n\n      if (this.canSyncDocumentView() && !this.documentView.isSynced()) {\n        var _this$delegate4, _this$delegate4$compo, _this$delegate5, _this$delegate5$compo;\n\n        (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : (_this$delegate4$compo = _this$delegate4.compositionControllerWillSyncDocumentView) === null || _this$delegate4$compo === void 0 ? void 0 : _this$delegate4$compo.call(_this$delegate4);\n        this.documentView.sync();\n        (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$compo = _this$delegate5.compositionControllerDidSyncDocumentView) === null || _this$delegate5$compo === void 0 ? void 0 : _this$delegate5$compo.call(_this$delegate5);\n      }\n\n      return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionControllerDidRender) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6);\n    }\n  }, {\n    key: \"rerenderViewForObject\",\n    value: function rerenderViewForObject(object) {\n      this.invalidateViewForObject(object);\n      return this.render();\n    }\n  }, {\n    key: \"invalidateViewForObject\",\n    value: function invalidateViewForObject(object) {\n      return this.documentView.invalidateViewForObject(object);\n    }\n  }, {\n    key: \"isViewCachingEnabled\",\n    value: function isViewCachingEnabled() {\n      return this.documentView.isViewCachingEnabled();\n    }\n  }, {\n    key: \"enableViewCaching\",\n    value: function enableViewCaching() {\n      return this.documentView.enableViewCaching();\n    }\n  }, {\n    key: \"disableViewCaching\",\n    value: function disableViewCaching() {\n      return this.documentView.disableViewCaching();\n    }\n  }, {\n    key: \"refreshViewCache\",\n    value: function refreshViewCache() {\n      return this.documentView.garbageCollectCachedViews();\n    } // Attachment editor management\n\n  }, {\n    key: \"isEditingAttachment\",\n    value: function isEditingAttachment() {\n      return !!this.attachmentEditor;\n    }\n  }, {\n    key: \"installAttachmentEditorForAttachment\",\n    value: function installAttachmentEditorForAttachment(attachment, options) {\n      var _this$attachmentEdito;\n\n      if (((_this$attachmentEdito = this.attachmentEditor) === null || _this$attachmentEdito === void 0 ? void 0 : _this$attachmentEdito.attachment) === attachment) return;\n      var element = this.documentView.findElementForObject(attachment);\n      if (!element) return;\n      this.uninstallAttachmentEditor();\n      var attachmentPiece = this.composition.document.getAttachmentPieceForAttachment(attachment);\n      this.attachmentEditor = new AttachmentEditorController(attachmentPiece, element, this.element, options);\n      this.attachmentEditor.delegate = this;\n    }\n  }, {\n    key: \"uninstallAttachmentEditor\",\n    value: function uninstallAttachmentEditor() {\n      var _this$attachmentEdito2;\n\n      return (_this$attachmentEdito2 = this.attachmentEditor) === null || _this$attachmentEdito2 === void 0 ? void 0 : _this$attachmentEdito2.uninstall();\n    } // Attachment controller delegate\n\n  }, {\n    key: \"didUninstallAttachmentEditor\",\n    value: function didUninstallAttachmentEditor() {\n      this.attachmentEditor = null;\n      return this.render();\n    }\n  }, {\n    key: \"attachmentEditorDidRequestUpdatingAttributesForAttachment\",\n    value: function attachmentEditorDidRequestUpdatingAttributesForAttachment(attributes, attachment) {\n      var _this$delegate7, _this$delegate7$compo;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionControllerWillUpdateAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment);\n      return this.composition.updateAttributesForAttachment(attributes, attachment);\n    }\n  }, {\n    key: \"attachmentEditorDidRequestRemovingAttributeForAttachment\",\n    value: function attachmentEditorDidRequestRemovingAttributeForAttachment(attribute, attachment) {\n      var _this$delegate8, _this$delegate8$compo;\n\n      (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionControllerWillUpdateAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n      return this.composition.removeAttributeForAttachment(attribute, attachment);\n    }\n  }, {\n    key: \"attachmentEditorDidRequestRemovalOfAttachment\",\n    value: function attachmentEditorDidRequestRemovalOfAttachment(attachment) {\n      var _this$delegate9, _this$delegate9$compo;\n\n      return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionControllerDidRequestRemovalOfAttachment) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n    }\n  }, {\n    key: \"attachmentEditorDidRequestDeselectingAttachment\",\n    value: function attachmentEditorDidRequestDeselectingAttachment(attachment) {\n      var _this$delegate10, _this$delegate10$comp;\n\n      return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionControllerDidRequestDeselectingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, attachment);\n    } // Private\n\n  }, {\n    key: \"canSyncDocumentView\",\n    value: function canSyncDocumentView() {\n      return !this.isEditingAttachment();\n    }\n  }, {\n    key: \"findAttachmentForElement\",\n    value: function findAttachmentForElement(element) {\n      return this.composition.document.getAttachmentById(parseInt(element.dataset.trixId, 10));\n    }\n  }]);\n\n  return CompositionController;\n}(BasicObject);\n\nvar attributeButtonSelector = \"[data-trix-attribute]\";\nvar actionButtonSelector = \"[data-trix-action]\";\nvar toolbarButtonSelector = \"\".concat(attributeButtonSelector, \", \").concat(actionButtonSelector);\nvar dialogSelector = \"[data-trix-dialog]\";\nvar activeDialogSelector = \"\".concat(dialogSelector, \"[data-trix-active]\");\nvar dialogButtonSelector = \"\".concat(dialogSelector, \" [data-trix-method]\");\nvar dialogInputSelector = \"\".concat(dialogSelector, \" [data-trix-input]\");\n\nvar getInputForDialog = function getInputForDialog(element, attributeName) {\n  if (!attributeName) {\n    attributeName = getAttributeName(element);\n  }\n\n  return element.querySelector(\"[data-trix-input][name='\".concat(attributeName, \"']\"));\n};\n\nvar getActionName = function getActionName(element) {\n  return element.getAttribute(\"data-trix-action\");\n};\n\nvar getAttributeName = function getAttributeName(element) {\n  return element.getAttribute(\"data-trix-attribute\") || element.getAttribute(\"data-trix-dialog-attribute\");\n};\n\nvar getDialogName = function getDialogName(element) {\n  return element.getAttribute(\"data-trix-dialog\");\n};\n\nvar ToolbarController = /*#__PURE__*/function (_BasicObject20) {\n  _inherits2(ToolbarController, _BasicObject20);\n\n  var _super41 = _createSuper2(ToolbarController);\n\n  function ToolbarController(element) {\n    var _this70;\n\n    _classCallCheck2(this, ToolbarController);\n\n    _this70 = _super41.call(this, element);\n    _this70.didClickActionButton = _this70.didClickActionButton.bind(_assertThisInitialized2(_this70));\n    _this70.didClickAttributeButton = _this70.didClickAttributeButton.bind(_assertThisInitialized2(_this70));\n    _this70.didClickDialogButton = _this70.didClickDialogButton.bind(_assertThisInitialized2(_this70));\n    _this70.didKeyDownDialogInput = _this70.didKeyDownDialogInput.bind(_assertThisInitialized2(_this70));\n    _this70.element = element;\n    _this70.attributes = {};\n    _this70.actions = {};\n\n    _this70.resetDialogInputs();\n\n    handleEvent(\"mousedown\", {\n      onElement: _this70.element,\n      matchingSelector: actionButtonSelector,\n      withCallback: _this70.didClickActionButton\n    });\n    handleEvent(\"mousedown\", {\n      onElement: _this70.element,\n      matchingSelector: attributeButtonSelector,\n      withCallback: _this70.didClickAttributeButton\n    });\n    handleEvent(\"click\", {\n      onElement: _this70.element,\n      matchingSelector: toolbarButtonSelector,\n      preventDefault: true\n    });\n    handleEvent(\"click\", {\n      onElement: _this70.element,\n      matchingSelector: dialogButtonSelector,\n      withCallback: _this70.didClickDialogButton\n    });\n    handleEvent(\"keydown\", {\n      onElement: _this70.element,\n      matchingSelector: dialogInputSelector,\n      withCallback: _this70.didKeyDownDialogInput\n    });\n    return _this70;\n  } // Event handlers\n\n\n  _createClass2(ToolbarController, [{\n    key: \"didClickActionButton\",\n    value: function didClickActionButton(event, element) {\n      var _this$delegate;\n\n      (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.toolbarDidClickButton();\n      event.preventDefault();\n      var actionName = getActionName(element);\n\n      if (this.getDialog(actionName)) {\n        return this.toggleDialog(actionName);\n      } else {\n        var _this$delegate2;\n\n        return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.toolbarDidInvokeAction(actionName);\n      }\n    }\n  }, {\n    key: \"didClickAttributeButton\",\n    value: function didClickAttributeButton(event, element) {\n      var _this$delegate3;\n\n      (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.toolbarDidClickButton();\n      event.preventDefault();\n      var attributeName = getAttributeName(element);\n\n      if (this.getDialog(attributeName)) {\n        this.toggleDialog(attributeName);\n      } else {\n        var _this$delegate4;\n\n        (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.toolbarDidToggleAttribute(attributeName);\n      }\n\n      return this.refreshAttributeButtons();\n    }\n  }, {\n    key: \"didClickDialogButton\",\n    value: function didClickDialogButton(event, element) {\n      var dialogElement = findClosestElementFromNode(element, {\n        matchingSelector: dialogSelector\n      });\n      var method = element.getAttribute(\"data-trix-method\");\n      return this[method].call(this, dialogElement);\n    }\n  }, {\n    key: \"didKeyDownDialogInput\",\n    value: function didKeyDownDialogInput(event, element) {\n      if (event.keyCode === 13) {\n        // Enter key\n        event.preventDefault();\n        var attribute = element.getAttribute(\"name\");\n        var dialog = this.getDialog(attribute);\n        this.setAttribute(dialog);\n      }\n\n      if (event.keyCode === 27) {\n        // Escape key\n        event.preventDefault();\n        return this.hideDialog();\n      }\n    } // Action buttons\n\n  }, {\n    key: \"updateActions\",\n    value: function updateActions(actions) {\n      this.actions = actions;\n      return this.refreshActionButtons();\n    }\n  }, {\n    key: \"refreshActionButtons\",\n    value: function refreshActionButtons() {\n      var _this71 = this;\n\n      return this.eachActionButton(function (element, actionName) {\n        element.disabled = _this71.actions[actionName] === false;\n      });\n    }\n  }, {\n    key: \"eachActionButton\",\n    value: function eachActionButton(callback) {\n      return Array.from(this.element.querySelectorAll(actionButtonSelector)).map(function (element) {\n        return callback(element, getActionName(element));\n      });\n    } // Attribute buttons\n\n  }, {\n    key: \"updateAttributes\",\n    value: function updateAttributes(attributes) {\n      this.attributes = attributes;\n      return this.refreshAttributeButtons();\n    }\n  }, {\n    key: \"refreshAttributeButtons\",\n    value: function refreshAttributeButtons() {\n      var _this72 = this;\n\n      return this.eachAttributeButton(function (element, attributeName) {\n        element.disabled = _this72.attributes[attributeName] === false;\n\n        if (_this72.attributes[attributeName] || _this72.dialogIsVisible(attributeName)) {\n          element.setAttribute(\"data-trix-active\", \"\");\n          return element.classList.add(\"trix-active\");\n        } else {\n          element.removeAttribute(\"data-trix-active\");\n          return element.classList.remove(\"trix-active\");\n        }\n      });\n    }\n  }, {\n    key: \"eachAttributeButton\",\n    value: function eachAttributeButton(callback) {\n      return Array.from(this.element.querySelectorAll(attributeButtonSelector)).map(function (element) {\n        return callback(element, getAttributeName(element));\n      });\n    }\n  }, {\n    key: \"applyKeyboardCommand\",\n    value: function applyKeyboardCommand(keys) {\n      var keyString = JSON.stringify(keys.sort());\n\n      for (var _i6 = 0, _Array$from23 = Array.from(this.element.querySelectorAll(\"[data-trix-key]\")); _i6 < _Array$from23.length; _i6++) {\n        var button = _Array$from23[_i6];\n        var buttonKeys = button.getAttribute(\"data-trix-key\").split(\"+\");\n        var buttonKeyString = JSON.stringify(buttonKeys.sort());\n\n        if (buttonKeyString === keyString) {\n          triggerEvent(\"mousedown\", {\n            onElement: button\n          });\n          return true;\n        }\n      }\n\n      return false;\n    } // Dialogs\n\n  }, {\n    key: \"dialogIsVisible\",\n    value: function dialogIsVisible(dialogName) {\n      var element = this.getDialog(dialogName);\n\n      if (element) {\n        return element.hasAttribute(\"data-trix-active\");\n      }\n    }\n  }, {\n    key: \"toggleDialog\",\n    value: function toggleDialog(dialogName) {\n      if (this.dialogIsVisible(dialogName)) {\n        return this.hideDialog();\n      } else {\n        return this.showDialog(dialogName);\n      }\n    }\n  }, {\n    key: \"showDialog\",\n    value: function showDialog(dialogName) {\n      var _this$delegate5, _this$delegate6;\n\n      this.hideDialog();\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.toolbarWillShowDialog();\n      var element = this.getDialog(dialogName);\n      element.setAttribute(\"data-trix-active\", \"\");\n      element.classList.add(\"trix-active\");\n      Array.from(element.querySelectorAll(\"input[disabled]\")).forEach(function (disabledInput) {\n        disabledInput.removeAttribute(\"disabled\");\n      });\n      var attributeName = getAttributeName(element);\n\n      if (attributeName) {\n        var _input = getInputForDialog(element, dialogName);\n\n        if (_input) {\n          _input.value = this.attributes[attributeName] || \"\";\n\n          _input.select();\n        }\n      }\n\n      return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.toolbarDidShowDialog(dialogName);\n    }\n  }, {\n    key: \"setAttribute\",\n    value: function setAttribute(dialogElement) {\n      var attributeName = getAttributeName(dialogElement);\n      var input = getInputForDialog(dialogElement, attributeName);\n\n      if (input.willValidate && !input.checkValidity()) {\n        input.setAttribute(\"data-trix-validate\", \"\");\n        input.classList.add(\"trix-validate\");\n        return input.focus();\n      } else {\n        var _this$delegate7;\n\n        (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.toolbarDidUpdateAttribute(attributeName, input.value);\n        return this.hideDialog();\n      }\n    }\n  }, {\n    key: \"removeAttribute\",\n    value: function removeAttribute(dialogElement) {\n      var _this$delegate8;\n\n      var attributeName = getAttributeName(dialogElement);\n      (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.toolbarDidRemoveAttribute(attributeName);\n      return this.hideDialog();\n    }\n  }, {\n    key: \"hideDialog\",\n    value: function hideDialog() {\n      var element = this.element.querySelector(activeDialogSelector);\n\n      if (element) {\n        var _this$delegate9;\n\n        element.removeAttribute(\"data-trix-active\");\n        element.classList.remove(\"trix-active\");\n        this.resetDialogInputs();\n        return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.toolbarDidHideDialog(getDialogName(element));\n      }\n    }\n  }, {\n    key: \"resetDialogInputs\",\n    value: function resetDialogInputs() {\n      Array.from(this.element.querySelectorAll(dialogInputSelector)).forEach(function (input) {\n        input.setAttribute(\"disabled\", \"disabled\");\n        input.removeAttribute(\"data-trix-validate\");\n        input.classList.remove(\"trix-validate\");\n      });\n    }\n  }, {\n    key: \"getDialog\",\n    value: function getDialog(dialogName) {\n      return this.element.querySelector(\"[data-trix-dialog=\".concat(dialogName, \"]\"));\n    }\n  }]);\n\n  return ToolbarController;\n}(BasicObject);\n\nvar snapshotsAreEqual = function snapshotsAreEqual(a, b) {\n  return rangesAreEqual(a.selectedRange, b.selectedRange) && a.document.isEqualTo(b.document);\n};\n\nvar EditorController = /*#__PURE__*/function (_Controller) {\n  _inherits2(EditorController, _Controller);\n\n  var _super42 = _createSuper2(EditorController);\n\n  function EditorController(_ref) {\n    var _this73;\n\n    _classCallCheck2(this, EditorController);\n\n    var editorElement = _ref.editorElement,\n        document = _ref.document,\n        html = _ref.html;\n    _this73 = _super42.apply(this, arguments);\n    _this73.editorElement = editorElement;\n    _this73.selectionManager = new SelectionManager(_this73.editorElement);\n    _this73.selectionManager.delegate = _assertThisInitialized2(_this73);\n    _this73.composition = new Composition();\n    _this73.composition.delegate = _assertThisInitialized2(_this73);\n    _this73.attachmentManager = new AttachmentManager(_this73.composition.getAttachments());\n    _this73.attachmentManager.delegate = _assertThisInitialized2(_this73);\n    _this73.inputController = config.input.getLevel() === 2 ? new Level2InputController(_this73.editorElement) : new Level0InputController(_this73.editorElement);\n    _this73.inputController.delegate = _assertThisInitialized2(_this73);\n    _this73.inputController.responder = _this73.composition;\n    _this73.compositionController = new CompositionController(_this73.editorElement, _this73.composition);\n    _this73.compositionController.delegate = _assertThisInitialized2(_this73);\n    _this73.toolbarController = new ToolbarController(_this73.editorElement.toolbarElement);\n    _this73.toolbarController.delegate = _assertThisInitialized2(_this73);\n    _this73.editor = new Editor(_this73.composition, _this73.selectionManager, _this73.editorElement);\n\n    if (document) {\n      _this73.editor.loadDocument(document);\n    } else {\n      _this73.editor.loadHTML(html);\n    }\n\n    return _this73;\n  }\n\n  _createClass2(EditorController, [{\n    key: \"registerSelectionManager\",\n    value: function registerSelectionManager() {\n      return selectionChangeObserver.registerSelectionManager(this.selectionManager);\n    }\n  }, {\n    key: \"unregisterSelectionManager\",\n    value: function unregisterSelectionManager() {\n      return selectionChangeObserver.unregisterSelectionManager(this.selectionManager);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return this.compositionController.render();\n    }\n  }, {\n    key: \"reparse\",\n    value: function reparse() {\n      return this.composition.replaceHTML(this.editorElement.innerHTML);\n    } // Composition delegate\n\n  }, {\n    key: \"compositionDidChangeDocument\",\n    value: function compositionDidChangeDocument(document) {\n      this.notifyEditorElement(\"document-change\");\n\n      if (!this.handlingInput) {\n        return this.render();\n      }\n    }\n  }, {\n    key: \"compositionDidChangeCurrentAttributes\",\n    value: function compositionDidChangeCurrentAttributes(currentAttributes) {\n      this.currentAttributes = currentAttributes;\n      this.toolbarController.updateAttributes(this.currentAttributes);\n      this.updateCurrentActions();\n      return this.notifyEditorElement(\"attributes-change\", {\n        attributes: this.currentAttributes\n      });\n    }\n  }, {\n    key: \"compositionDidPerformInsertionAtRange\",\n    value: function compositionDidPerformInsertionAtRange(range) {\n      if (this.pasting) {\n        this.pastedRange = range;\n      }\n    }\n  }, {\n    key: \"compositionShouldAcceptFile\",\n    value: function compositionShouldAcceptFile(file) {\n      return this.notifyEditorElement(\"file-accept\", {\n        file: file\n      });\n    }\n  }, {\n    key: \"compositionDidAddAttachment\",\n    value: function compositionDidAddAttachment(attachment) {\n      var managedAttachment = this.attachmentManager.manageAttachment(attachment);\n      return this.notifyEditorElement(\"attachment-add\", {\n        attachment: managedAttachment\n      });\n    }\n  }, {\n    key: \"compositionDidEditAttachment\",\n    value: function compositionDidEditAttachment(attachment) {\n      this.compositionController.rerenderViewForObject(attachment);\n      var managedAttachment = this.attachmentManager.manageAttachment(attachment);\n      this.notifyEditorElement(\"attachment-edit\", {\n        attachment: managedAttachment\n      });\n      return this.notifyEditorElement(\"change\");\n    }\n  }, {\n    key: \"compositionDidChangeAttachmentPreviewURL\",\n    value: function compositionDidChangeAttachmentPreviewURL(attachment) {\n      this.compositionController.invalidateViewForObject(attachment);\n      return this.notifyEditorElement(\"change\");\n    }\n  }, {\n    key: \"compositionDidRemoveAttachment\",\n    value: function compositionDidRemoveAttachment(attachment) {\n      var managedAttachment = this.attachmentManager.unmanageAttachment(attachment);\n      return this.notifyEditorElement(\"attachment-remove\", {\n        attachment: managedAttachment\n      });\n    }\n  }, {\n    key: \"compositionDidStartEditingAttachment\",\n    value: function compositionDidStartEditingAttachment(attachment, options) {\n      this.attachmentLocationRange = this.composition.document.getLocationRangeOfAttachment(attachment);\n      this.compositionController.installAttachmentEditorForAttachment(attachment, options);\n      return this.selectionManager.setLocationRange(this.attachmentLocationRange);\n    }\n  }, {\n    key: \"compositionDidStopEditingAttachment\",\n    value: function compositionDidStopEditingAttachment(attachment) {\n      this.compositionController.uninstallAttachmentEditor();\n      this.attachmentLocationRange = null;\n    }\n  }, {\n    key: \"compositionDidRequestChangingSelectionToLocationRange\",\n    value: function compositionDidRequestChangingSelectionToLocationRange(locationRange) {\n      if (this.loadingSnapshot && !this.isFocused()) return;\n      this.requestedLocationRange = locationRange;\n      this.compositionRevisionWhenLocationRangeRequested = this.composition.revision;\n\n      if (!this.handlingInput) {\n        return this.render();\n      }\n    }\n  }, {\n    key: \"compositionWillLoadSnapshot\",\n    value: function compositionWillLoadSnapshot() {\n      this.loadingSnapshot = true;\n    }\n  }, {\n    key: \"compositionDidLoadSnapshot\",\n    value: function compositionDidLoadSnapshot() {\n      this.compositionController.refreshViewCache();\n      this.render();\n      this.loadingSnapshot = false;\n    }\n  }, {\n    key: \"getSelectionManager\",\n    value: function getSelectionManager() {\n      return this.selectionManager;\n    } // Attachment manager delegate\n\n  }, {\n    key: \"attachmentManagerDidRequestRemovalOfAttachment\",\n    value: function attachmentManagerDidRequestRemovalOfAttachment(attachment) {\n      return this.removeAttachment(attachment);\n    } // Document controller delegate\n\n  }, {\n    key: \"compositionControllerWillSyncDocumentView\",\n    value: function compositionControllerWillSyncDocumentView() {\n      this.inputController.editorWillSyncDocumentView();\n      this.selectionManager.lock();\n      return this.selectionManager.clearSelection();\n    }\n  }, {\n    key: \"compositionControllerDidSyncDocumentView\",\n    value: function compositionControllerDidSyncDocumentView() {\n      this.inputController.editorDidSyncDocumentView();\n      this.selectionManager.unlock();\n      this.updateCurrentActions();\n      return this.notifyEditorElement(\"sync\");\n    }\n  }, {\n    key: \"compositionControllerDidRender\",\n    value: function compositionControllerDidRender() {\n      if (this.requestedLocationRange) {\n        if (this.compositionRevisionWhenLocationRangeRequested === this.composition.revision) {\n          this.selectionManager.setLocationRange(this.requestedLocationRange);\n        }\n\n        this.requestedLocationRange = null;\n        this.compositionRevisionWhenLocationRangeRequested = null;\n      }\n\n      if (this.renderedCompositionRevision !== this.composition.revision) {\n        this.runEditorFilters();\n        this.composition.updateCurrentAttributes();\n        this.notifyEditorElement(\"render\");\n      }\n\n      this.renderedCompositionRevision = this.composition.revision;\n    }\n  }, {\n    key: \"compositionControllerDidFocus\",\n    value: function compositionControllerDidFocus() {\n      if (this.isFocusedInvisibly()) {\n        this.setLocationRange({\n          index: 0,\n          offset: 0\n        });\n      }\n\n      this.toolbarController.hideDialog();\n      return this.notifyEditorElement(\"focus\");\n    }\n  }, {\n    key: \"compositionControllerDidBlur\",\n    value: function compositionControllerDidBlur() {\n      return this.notifyEditorElement(\"blur\");\n    }\n  }, {\n    key: \"compositionControllerDidSelectAttachment\",\n    value: function compositionControllerDidSelectAttachment(attachment, options) {\n      this.toolbarController.hideDialog();\n      return this.composition.editAttachment(attachment, options);\n    }\n  }, {\n    key: \"compositionControllerDidRequestDeselectingAttachment\",\n    value: function compositionControllerDidRequestDeselectingAttachment(attachment) {\n      var locationRange = this.attachmentLocationRange || this.composition.document.getLocationRangeOfAttachment(attachment);\n      return this.selectionManager.setLocationRange(locationRange[1]);\n    }\n  }, {\n    key: \"compositionControllerWillUpdateAttachment\",\n    value: function compositionControllerWillUpdateAttachment(attachment) {\n      return this.editor.recordUndoEntry(\"Edit Attachment\", {\n        context: attachment.id,\n        consolidatable: true\n      });\n    }\n  }, {\n    key: \"compositionControllerDidRequestRemovalOfAttachment\",\n    value: function compositionControllerDidRequestRemovalOfAttachment(attachment) {\n      return this.removeAttachment(attachment);\n    } // Input controller delegate\n\n  }, {\n    key: \"inputControllerWillHandleInput\",\n    value: function inputControllerWillHandleInput() {\n      this.handlingInput = true;\n      this.requestedRender = false;\n    }\n  }, {\n    key: \"inputControllerDidRequestRender\",\n    value: function inputControllerDidRequestRender() {\n      this.requestedRender = true;\n    }\n  }, {\n    key: \"inputControllerDidHandleInput\",\n    value: function inputControllerDidHandleInput() {\n      this.handlingInput = false;\n\n      if (this.requestedRender) {\n        this.requestedRender = false;\n        return this.render();\n      }\n    }\n  }, {\n    key: \"inputControllerDidAllowUnhandledInput\",\n    value: function inputControllerDidAllowUnhandledInput() {\n      return this.notifyEditorElement(\"change\");\n    }\n  }, {\n    key: \"inputControllerDidRequestReparse\",\n    value: function inputControllerDidRequestReparse() {\n      return this.reparse();\n    }\n  }, {\n    key: \"inputControllerWillPerformTyping\",\n    value: function inputControllerWillPerformTyping() {\n      return this.recordTypingUndoEntry();\n    }\n  }, {\n    key: \"inputControllerWillPerformFormatting\",\n    value: function inputControllerWillPerformFormatting(attributeName) {\n      return this.recordFormattingUndoEntry(attributeName);\n    }\n  }, {\n    key: \"inputControllerWillCutText\",\n    value: function inputControllerWillCutText() {\n      return this.editor.recordUndoEntry(\"Cut\");\n    }\n  }, {\n    key: \"inputControllerWillPaste\",\n    value: function inputControllerWillPaste(paste) {\n      this.editor.recordUndoEntry(\"Paste\");\n      this.pasting = true;\n      return this.notifyEditorElement(\"before-paste\", {\n        paste: paste\n      });\n    }\n  }, {\n    key: \"inputControllerDidPaste\",\n    value: function inputControllerDidPaste(paste) {\n      paste.range = this.pastedRange;\n      this.pastedRange = null;\n      this.pasting = null;\n      return this.notifyEditorElement(\"paste\", {\n        paste: paste\n      });\n    }\n  }, {\n    key: \"inputControllerWillMoveText\",\n    value: function inputControllerWillMoveText() {\n      return this.editor.recordUndoEntry(\"Move\");\n    }\n  }, {\n    key: \"inputControllerWillAttachFiles\",\n    value: function inputControllerWillAttachFiles() {\n      return this.editor.recordUndoEntry(\"Drop Files\");\n    }\n  }, {\n    key: \"inputControllerWillPerformUndo\",\n    value: function inputControllerWillPerformUndo() {\n      return this.editor.undo();\n    }\n  }, {\n    key: \"inputControllerWillPerformRedo\",\n    value: function inputControllerWillPerformRedo() {\n      return this.editor.redo();\n    }\n  }, {\n    key: \"inputControllerDidReceiveKeyboardCommand\",\n    value: function inputControllerDidReceiveKeyboardCommand(keys) {\n      return this.toolbarController.applyKeyboardCommand(keys);\n    }\n  }, {\n    key: \"inputControllerDidStartDrag\",\n    value: function inputControllerDidStartDrag() {\n      this.locationRangeBeforeDrag = this.selectionManager.getLocationRange();\n    }\n  }, {\n    key: \"inputControllerDidReceiveDragOverPoint\",\n    value: function inputControllerDidReceiveDragOverPoint(point) {\n      return this.selectionManager.setLocationRangeFromPointRange(point);\n    }\n  }, {\n    key: \"inputControllerDidCancelDrag\",\n    value: function inputControllerDidCancelDrag() {\n      this.selectionManager.setLocationRange(this.locationRangeBeforeDrag);\n      this.locationRangeBeforeDrag = null;\n    } // Selection manager delegate\n\n  }, {\n    key: \"locationRangeDidChange\",\n    value: function locationRangeDidChange(locationRange) {\n      this.composition.updateCurrentAttributes();\n      this.updateCurrentActions();\n\n      if (this.attachmentLocationRange && !rangesAreEqual(this.attachmentLocationRange, locationRange)) {\n        this.composition.stopEditingAttachment();\n      }\n\n      return this.notifyEditorElement(\"selection-change\");\n    } // Toolbar controller delegate\n\n  }, {\n    key: \"toolbarDidClickButton\",\n    value: function toolbarDidClickButton() {\n      if (!this.getLocationRange()) {\n        return this.setLocationRange({\n          index: 0,\n          offset: 0\n        });\n      }\n    }\n  }, {\n    key: \"toolbarDidInvokeAction\",\n    value: function toolbarDidInvokeAction(actionName) {\n      return this.invokeAction(actionName);\n    }\n  }, {\n    key: \"toolbarDidToggleAttribute\",\n    value: function toolbarDidToggleAttribute(attributeName) {\n      this.recordFormattingUndoEntry(attributeName);\n      this.composition.toggleCurrentAttribute(attributeName);\n      this.render();\n\n      if (!this.selectionFrozen) {\n        return this.editorElement.focus();\n      }\n    }\n  }, {\n    key: \"toolbarDidUpdateAttribute\",\n    value: function toolbarDidUpdateAttribute(attributeName, value) {\n      this.recordFormattingUndoEntry(attributeName);\n      this.composition.setCurrentAttribute(attributeName, value);\n      this.render();\n\n      if (!this.selectionFrozen) {\n        return this.editorElement.focus();\n      }\n    }\n  }, {\n    key: \"toolbarDidRemoveAttribute\",\n    value: function toolbarDidRemoveAttribute(attributeName) {\n      this.recordFormattingUndoEntry(attributeName);\n      this.composition.removeCurrentAttribute(attributeName);\n      this.render();\n\n      if (!this.selectionFrozen) {\n        return this.editorElement.focus();\n      }\n    }\n  }, {\n    key: \"toolbarWillShowDialog\",\n    value: function toolbarWillShowDialog(dialogElement) {\n      this.composition.expandSelectionForEditing();\n      return this.freezeSelection();\n    }\n  }, {\n    key: \"toolbarDidShowDialog\",\n    value: function toolbarDidShowDialog(dialogName) {\n      return this.notifyEditorElement(\"toolbar-dialog-show\", {\n        dialogName: dialogName\n      });\n    }\n  }, {\n    key: \"toolbarDidHideDialog\",\n    value: function toolbarDidHideDialog(dialogName) {\n      this.thawSelection();\n      this.editorElement.focus();\n      return this.notifyEditorElement(\"toolbar-dialog-hide\", {\n        dialogName: dialogName\n      });\n    } // Selection\n\n  }, {\n    key: \"freezeSelection\",\n    value: function freezeSelection() {\n      if (!this.selectionFrozen) {\n        this.selectionManager.lock();\n        this.composition.freezeSelection();\n        this.selectionFrozen = true;\n        return this.render();\n      }\n    }\n  }, {\n    key: \"thawSelection\",\n    value: function thawSelection() {\n      if (this.selectionFrozen) {\n        this.composition.thawSelection();\n        this.selectionManager.unlock();\n        this.selectionFrozen = false;\n        return this.render();\n      }\n    }\n  }, {\n    key: \"canInvokeAction\",\n    value: function canInvokeAction(actionName) {\n      if (this.actionIsExternal(actionName)) {\n        return true;\n      } else {\n        var _this$actions$actionN, _this$actions$actionN2;\n\n        return !!((_this$actions$actionN = this.actions[actionName]) !== null && _this$actions$actionN !== void 0 && (_this$actions$actionN2 = _this$actions$actionN.test) !== null && _this$actions$actionN2 !== void 0 && _this$actions$actionN2.call(this));\n      }\n    }\n  }, {\n    key: \"invokeAction\",\n    value: function invokeAction(actionName) {\n      if (this.actionIsExternal(actionName)) {\n        return this.notifyEditorElement(\"action-invoke\", {\n          actionName: actionName\n        });\n      } else {\n        var _this$actions$actionN3, _this$actions$actionN4;\n\n        return (_this$actions$actionN3 = this.actions[actionName]) === null || _this$actions$actionN3 === void 0 ? void 0 : (_this$actions$actionN4 = _this$actions$actionN3.perform) === null || _this$actions$actionN4 === void 0 ? void 0 : _this$actions$actionN4.call(this);\n      }\n    }\n  }, {\n    key: \"actionIsExternal\",\n    value: function actionIsExternal(actionName) {\n      return /^x-./.test(actionName);\n    }\n  }, {\n    key: \"getCurrentActions\",\n    value: function getCurrentActions() {\n      var result = {};\n\n      for (var actionName in this.actions) {\n        result[actionName] = this.canInvokeAction(actionName);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"updateCurrentActions\",\n    value: function updateCurrentActions() {\n      var currentActions = this.getCurrentActions();\n\n      if (!objectsAreEqual(currentActions, this.currentActions)) {\n        this.currentActions = currentActions;\n        this.toolbarController.updateActions(this.currentActions);\n        return this.notifyEditorElement(\"actions-change\", {\n          actions: this.currentActions\n        });\n      }\n    } // Editor filters\n\n  }, {\n    key: \"runEditorFilters\",\n    value: function runEditorFilters() {\n      var _this74 = this;\n\n      var snapshot = this.composition.getSnapshot();\n      Array.from(this.editor.filters).forEach(function (filter) {\n        var _snapshot = snapshot,\n            document = _snapshot.document,\n            selectedRange = _snapshot.selectedRange;\n        snapshot = filter.call(_this74.editor, snapshot) || {};\n\n        if (!snapshot.document) {\n          snapshot.document = document;\n        }\n\n        if (!snapshot.selectedRange) {\n          snapshot.selectedRange = selectedRange;\n        }\n      });\n\n      if (!snapshotsAreEqual(snapshot, this.composition.getSnapshot())) {\n        return this.composition.loadSnapshot(snapshot);\n      }\n    } // Private\n\n  }, {\n    key: \"updateInputElement\",\n    value: function updateInputElement() {\n      var element = this.compositionController.getSerializableElement();\n      var value = serializeToContentType(element, \"text/html\");\n      return this.editorElement.setInputElementValue(value);\n    }\n  }, {\n    key: \"notifyEditorElement\",\n    value: function notifyEditorElement(message, data) {\n      switch (message) {\n        case \"document-change\":\n          this.documentChangedSinceLastRender = true;\n          break;\n\n        case \"render\":\n          if (this.documentChangedSinceLastRender) {\n            this.documentChangedSinceLastRender = false;\n            this.notifyEditorElement(\"change\");\n          }\n\n          break;\n\n        case \"change\":\n        case \"attachment-add\":\n        case \"attachment-edit\":\n        case \"attachment-remove\":\n          this.updateInputElement();\n          break;\n      }\n\n      return this.editorElement.notify(message, data);\n    }\n  }, {\n    key: \"removeAttachment\",\n    value: function removeAttachment(attachment) {\n      this.editor.recordUndoEntry(\"Delete Attachment\");\n      this.composition.removeAttachment(attachment);\n      return this.render();\n    }\n  }, {\n    key: \"recordFormattingUndoEntry\",\n    value: function recordFormattingUndoEntry(attributeName) {\n      var blockConfig = getBlockConfig(attributeName);\n      var locationRange = this.selectionManager.getLocationRange();\n\n      if (blockConfig || !rangeIsCollapsed(locationRange)) {\n        return this.editor.recordUndoEntry(\"Formatting\", {\n          context: this.getUndoContext(),\n          consolidatable: true\n        });\n      }\n    }\n  }, {\n    key: \"recordTypingUndoEntry\",\n    value: function recordTypingUndoEntry() {\n      return this.editor.recordUndoEntry(\"Typing\", {\n        context: this.getUndoContext(this.currentAttributes),\n        consolidatable: true\n      });\n    }\n  }, {\n    key: \"getUndoContext\",\n    value: function getUndoContext() {\n      for (var _len = arguments.length, context = new Array(_len), _key = 0; _key < _len; _key++) {\n        context[_key] = arguments[_key];\n      }\n\n      return [this.getLocationContext(), this.getTimeContext()].concat(_toConsumableArray2(Array.from(context)));\n    }\n  }, {\n    key: \"getLocationContext\",\n    value: function getLocationContext() {\n      var locationRange = this.selectionManager.getLocationRange();\n\n      if (rangeIsCollapsed(locationRange)) {\n        return locationRange[0].index;\n      } else {\n        return locationRange;\n      }\n    }\n  }, {\n    key: \"getTimeContext\",\n    value: function getTimeContext() {\n      if (config.undoInterval > 0) {\n        return Math.floor(new Date().getTime() / config.undoInterval);\n      } else {\n        return 0;\n      }\n    }\n  }, {\n    key: \"isFocused\",\n    value: function isFocused() {\n      var _this$editorElement$o;\n\n      return this.editorElement === ((_this$editorElement$o = this.editorElement.ownerDocument) === null || _this$editorElement$o === void 0 ? void 0 : _this$editorElement$o.activeElement);\n    } // Detect \"Cursor disappears sporadically\" Firefox bug.\n    // - https://bugzilla.mozilla.org/show_bug.cgi?id=226301\n\n  }, {\n    key: \"isFocusedInvisibly\",\n    value: function isFocusedInvisibly() {\n      return this.isFocused() && !this.getLocationRange();\n    }\n  }, {\n    key: \"actions\",\n    get: function get() {\n      return this.constructor.actions;\n    }\n  }]);\n\n  return EditorController;\n}(Controller);\n\n_defineProperty(EditorController, \"actions\", {\n  undo: {\n    test: function test() {\n      return this.editor.canUndo();\n    },\n    perform: function perform() {\n      return this.editor.undo();\n    }\n  },\n  redo: {\n    test: function test() {\n      return this.editor.canRedo();\n    },\n    perform: function perform() {\n      return this.editor.redo();\n    }\n  },\n  link: {\n    test: function test() {\n      return this.editor.canActivateAttribute(\"href\");\n    }\n  },\n  increaseNestingLevel: {\n    test: function test() {\n      return this.editor.canIncreaseNestingLevel();\n    },\n    perform: function perform() {\n      return this.editor.increaseNestingLevel() && this.render();\n    }\n  },\n  decreaseNestingLevel: {\n    test: function test() {\n      return this.editor.canDecreaseNestingLevel();\n    },\n    perform: function perform() {\n      return this.editor.decreaseNestingLevel() && this.render();\n    }\n  },\n  attachFiles: {\n    test: function test() {\n      return true;\n    },\n    perform: function perform() {\n      return config.input.pickFiles(this.editor.insertFiles);\n    }\n  }\n});\n\nEditorController.proxyMethod(\"getSelectionManager().setLocationRange\");\nEditorController.proxyMethod(\"getSelectionManager().getLocationRange\");\ninstallDefaultCSSForTagName(\"trix-toolbar\", \"%t {\\n  display: block;\\n}\\n\\n%t {\\n  white-space: nowrap;\\n}\\n\\n%t [data-trix-dialog] {\\n  display: none;\\n}\\n\\n%t [data-trix-dialog][data-trix-active] {\\n  display: block;\\n}\\n\\n%t [data-trix-dialog] [data-trix-validate]:invalid {\\n  background-color: #ffdddd;\\n}\");\n\nvar TrixToolbarElement = /*#__PURE__*/function (_HTMLElement) {\n  _inherits2(TrixToolbarElement, _HTMLElement);\n\n  var _super43 = _createSuper2(TrixToolbarElement);\n\n  function TrixToolbarElement() {\n    _classCallCheck2(this, TrixToolbarElement);\n\n    return _super43.apply(this, arguments);\n  }\n\n  _createClass2(TrixToolbarElement, [{\n    key: \"connectedCallback\",\n    value: // Element lifecycle\n    function connectedCallback() {\n      if (this.innerHTML === \"\") {\n        this.innerHTML = config.toolbar.getDefaultHTML();\n      }\n    }\n  }]);\n\n  return TrixToolbarElement;\n}( /*#__PURE__*/_wrapNativeSuper2(HTMLElement));\n\nwindow.customElements.define(\"trix-toolbar\", TrixToolbarElement);\nvar id = 0; // Contenteditable support helpers\n\nvar autofocus = function autofocus(element) {\n  if (!document.querySelector(\":focus\")) {\n    if (element.hasAttribute(\"autofocus\") && document.querySelector(\"[autofocus]\") === element) {\n      return element.focus();\n    }\n  }\n};\n\nvar makeEditable = function makeEditable(element) {\n  if (element.hasAttribute(\"contenteditable\")) {\n    return;\n  }\n\n  element.setAttribute(\"contenteditable\", \"\");\n  return handleEventOnce(\"focus\", {\n    onElement: element,\n    withCallback: function withCallback() {\n      return configureContentEditable(element);\n    }\n  });\n};\n\nvar configureContentEditable = function configureContentEditable(element) {\n  disableObjectResizing(element);\n  return setDefaultParagraphSeparator(element);\n};\n\nvar disableObjectResizing = function disableObjectResizing(element) {\n  var _document$queryComman, _document;\n\n  if ((_document$queryComman = (_document = document).queryCommandSupported) !== null && _document$queryComman !== void 0 && _document$queryComman.call(_document, \"enableObjectResizing\")) {\n    document.execCommand(\"enableObjectResizing\", false, false);\n    return handleEvent(\"mscontrolselect\", {\n      onElement: element,\n      preventDefault: true\n    });\n  }\n};\n\nvar setDefaultParagraphSeparator = function setDefaultParagraphSeparator(element) {\n  var _document$queryComman2, _document2;\n\n  if ((_document$queryComman2 = (_document2 = document).queryCommandSupported) !== null && _document$queryComman2 !== void 0 && _document$queryComman2.call(_document2, \"DefaultParagraphSeparator\")) {\n    var _tagName2 = config.blockAttributes.default.tagName;\n\n    if ([\"div\", \"p\"].includes(_tagName2)) {\n      return document.execCommand(\"DefaultParagraphSeparator\", false, _tagName2);\n    }\n  }\n}; // Accessibility helpers\n\n\nvar addAccessibilityRole = function addAccessibilityRole(element) {\n  if (element.hasAttribute(\"role\")) {\n    return;\n  }\n\n  return element.setAttribute(\"role\", \"textbox\");\n};\n\nvar ensureAriaLabel = function ensureAriaLabel(element) {\n  if (element.hasAttribute(\"aria-label\") || element.hasAttribute(\"aria-labelledby\")) {\n    return;\n  }\n\n  var update = function update() {\n    var texts = Array.from(element.labels).map(function (label) {\n      if (!label.contains(element)) return label.textContent;\n    }).filter(function (text) {\n      return text;\n    });\n    var text = texts.join(\" \");\n\n    if (text) {\n      return element.setAttribute(\"aria-label\", text);\n    } else {\n      return element.removeAttribute(\"aria-label\");\n    }\n  };\n\n  update();\n  return handleEvent(\"focus\", {\n    onElement: element,\n    withCallback: update\n  });\n}; // Style\n\n\nvar cursorTargetStyles = function () {\n  if (config.browser.forcesObjectResizing) {\n    return {\n      display: \"inline\",\n      width: \"auto\"\n    };\n  } else {\n    return {\n      display: \"inline-block\",\n      width: \"1px\"\n    };\n  }\n}();\n\ninstallDefaultCSSForTagName(\"trix-editor\", \"%t {\\n    display: block;\\n}\\n\\n%t:empty:not(:focus)::before {\\n    content: attr(placeholder);\\n    color: graytext;\\n    cursor: text;\\n    pointer-events: none;\\n    white-space: pre-line;\\n}\\n\\n%t a[contenteditable=false] {\\n    cursor: text;\\n}\\n\\n%t img {\\n    max-width: 100%;\\n    height: auto;\\n}\\n\\n%t \".concat(attachmentSelector, \" figcaption textarea {\\n    resize: none;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption textarea.trix-autoresize-clone {\\n    position: absolute;\\n    left: -9999px;\\n    max-height: 0px;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption[data-trix-placeholder]:empty::before {\\n    content: attr(data-trix-placeholder);\\n    color: graytext;\\n}\\n\\n%t [data-trix-cursor-target] {\\n    display: \").concat(cursorTargetStyles.display, \" !important;\\n    width: \").concat(cursorTargetStyles.width, \" !important;\\n    padding: 0 !important;\\n    margin: 0 !important;\\n    border: none !important;\\n}\\n\\n%t [data-trix-cursor-target=left] {\\n    vertical-align: top !important;\\n    margin-left: -1px !important;\\n}\\n\\n%t [data-trix-cursor-target=right] {\\n    vertical-align: bottom !important;\\n    margin-right: -1px !important;\\n}\"));\n\nvar TrixEditorElement = /*#__PURE__*/function (_HTMLElement2) {\n  _inherits2(TrixEditorElement, _HTMLElement2);\n\n  var _super44 = _createSuper2(TrixEditorElement);\n\n  function TrixEditorElement() {\n    _classCallCheck2(this, TrixEditorElement);\n\n    return _super44.apply(this, arguments);\n  }\n\n  _createClass2(TrixEditorElement, [{\n    key: \"trixId\",\n    get: // Properties\n    function get() {\n      if (this.hasAttribute(\"trix-id\")) {\n        return this.getAttribute(\"trix-id\");\n      } else {\n        this.setAttribute(\"trix-id\", ++id);\n        return this.trixId;\n      }\n    }\n  }, {\n    key: \"labels\",\n    get: function get() {\n      var labels = [];\n\n      if (this.id && this.ownerDocument) {\n        labels.push.apply(labels, _toConsumableArray2(Array.from(this.ownerDocument.querySelectorAll(\"label[for='\".concat(this.id, \"']\")) || [])));\n      }\n\n      var label = findClosestElementFromNode(this, {\n        matchingSelector: \"label\"\n      });\n\n      if (label) {\n        if ([this, null].includes(label.control)) {\n          labels.push(label);\n        }\n      }\n\n      return labels;\n    }\n  }, {\n    key: \"toolbarElement\",\n    get: function get() {\n      if (this.hasAttribute(\"toolbar\")) {\n        var _this$ownerDocument;\n\n        return (_this$ownerDocument = this.ownerDocument) === null || _this$ownerDocument === void 0 ? void 0 : _this$ownerDocument.getElementById(this.getAttribute(\"toolbar\"));\n      } else if (this.parentNode) {\n        var toolbarId = \"trix-toolbar-\".concat(this.trixId);\n        this.setAttribute(\"toolbar\", toolbarId);\n        var element = makeElement(\"trix-toolbar\", {\n          id: toolbarId\n        });\n        this.parentNode.insertBefore(element, this);\n        return element;\n      } else {\n        return undefined;\n      }\n    }\n  }, {\n    key: \"form\",\n    get: function get() {\n      var _this$inputElement;\n\n      return (_this$inputElement = this.inputElement) === null || _this$inputElement === void 0 ? void 0 : _this$inputElement.form;\n    }\n  }, {\n    key: \"inputElement\",\n    get: function get() {\n      if (this.hasAttribute(\"input\")) {\n        var _this$ownerDocument2;\n\n        return (_this$ownerDocument2 = this.ownerDocument) === null || _this$ownerDocument2 === void 0 ? void 0 : _this$ownerDocument2.getElementById(this.getAttribute(\"input\"));\n      } else if (this.parentNode) {\n        var inputId = \"trix-input-\".concat(this.trixId);\n        this.setAttribute(\"input\", inputId);\n        var element = makeElement(\"input\", {\n          type: \"hidden\",\n          id: inputId\n        });\n        this.parentNode.insertBefore(element, this.nextElementSibling);\n        return element;\n      } else {\n        return undefined;\n      }\n    }\n  }, {\n    key: \"editor\",\n    get: function get() {\n      var _this$editorControlle;\n\n      return (_this$editorControlle = this.editorController) === null || _this$editorControlle === void 0 ? void 0 : _this$editorControlle.editor;\n    }\n  }, {\n    key: \"name\",\n    get: function get() {\n      var _this$inputElement2;\n\n      return (_this$inputElement2 = this.inputElement) === null || _this$inputElement2 === void 0 ? void 0 : _this$inputElement2.name;\n    }\n  }, {\n    key: \"value\",\n    get: function get() {\n      var _this$inputElement3;\n\n      return (_this$inputElement3 = this.inputElement) === null || _this$inputElement3 === void 0 ? void 0 : _this$inputElement3.value;\n    },\n    set: function set(defaultValue) {\n      var _this$editor;\n\n      this.defaultValue = defaultValue;\n      (_this$editor = this.editor) === null || _this$editor === void 0 ? void 0 : _this$editor.loadHTML(this.defaultValue);\n    } // Controller delegate methods\n\n  }, {\n    key: \"notify\",\n    value: function notify(message, data) {\n      if (this.editorController) {\n        return triggerEvent(\"trix-\".concat(message), {\n          onElement: this,\n          attributes: data\n        });\n      }\n    }\n  }, {\n    key: \"setInputElementValue\",\n    value: function setInputElementValue(value) {\n      if (this.inputElement) {\n        this.inputElement.value = value;\n      }\n    } // Element lifecycle\n\n  }, {\n    key: \"connectedCallback\",\n    value: function connectedCallback() {\n      var _this75 = this;\n\n      if (!this.hasAttribute(\"data-trix-internal\")) {\n        makeEditable(this);\n        addAccessibilityRole(this);\n        ensureAriaLabel(this);\n\n        if (!this.editorController) {\n          triggerEvent(\"trix-before-initialize\", {\n            onElement: this\n          });\n          this.editorController = new EditorController({\n            editorElement: this,\n            html: this.defaultValue = this.value\n          });\n          requestAnimationFrame(function () {\n            return triggerEvent(\"trix-initialize\", {\n              onElement: _this75\n            });\n          });\n        }\n\n        this.editorController.registerSelectionManager();\n        this.registerResetListener();\n        this.registerClickListener();\n        autofocus(this);\n      }\n    }\n  }, {\n    key: \"disconnectedCallback\",\n    value: function disconnectedCallback() {\n      var _this$editorControlle2;\n\n      (_this$editorControlle2 = this.editorController) === null || _this$editorControlle2 === void 0 ? void 0 : _this$editorControlle2.unregisterSelectionManager();\n      this.unregisterResetListener();\n      return this.unregisterClickListener();\n    } // Form support\n\n  }, {\n    key: \"registerResetListener\",\n    value: function registerResetListener() {\n      this.resetListener = this.resetBubbled.bind(this);\n      return window.addEventListener(\"reset\", this.resetListener, false);\n    }\n  }, {\n    key: \"unregisterResetListener\",\n    value: function unregisterResetListener() {\n      return window.removeEventListener(\"reset\", this.resetListener, false);\n    }\n  }, {\n    key: \"registerClickListener\",\n    value: function registerClickListener() {\n      this.clickListener = this.clickBubbled.bind(this);\n      return window.addEventListener(\"click\", this.clickListener, false);\n    }\n  }, {\n    key: \"unregisterClickListener\",\n    value: function unregisterClickListener() {\n      return window.removeEventListener(\"click\", this.clickListener, false);\n    }\n  }, {\n    key: \"resetBubbled\",\n    value: function resetBubbled(event) {\n      if (event.defaultPrevented) return;\n      if (event.target !== this.form) return;\n      return this.reset();\n    }\n  }, {\n    key: \"clickBubbled\",\n    value: function clickBubbled(event) {\n      if (event.defaultPrevented) return;\n      if (this.contains(event.target)) return;\n      var label = findClosestElementFromNode(event.target, {\n        matchingSelector: \"label\"\n      });\n      if (!label) return;\n      if (!Array.from(this.labels).includes(label)) return;\n      return this.focus();\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.value = this.defaultValue;\n    }\n  }]);\n\n  return TrixEditorElement;\n}( /*#__PURE__*/_wrapNativeSuper2(HTMLElement));\n\nwindow.customElements.define(\"trix-editor\", TrixEditorElement);\nexport { Trix as default };","map":{"version":3,"sources":["/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/trix/dist/trix.js"],"names":["name","version","description","main","module","style","files","repository","type","url","keywords","author","license","bugs","homepage","devDependencies","eslint","esm","karma","qunit","rangy","rollup","svgo","scripts","build","watch","lint","pretest","test","postversion","release","dependencies","_package","attachmentSelector","attachments","preview","presentation","caption","size","file","attributes","default","tagName","parse","quote","nestable","heading1","terminal","breakOnReturn","group","code","text","plaintext","bulletList","bullet","listAttribute","element","tagName$1","parentNode","numberList","number","attachmentGallery","exclusive","_element$tagName","toLowerCase","browser$1","composesExistingText","navigator","userAgent","forcesObjectResizing","supportsInputEvents","InputEvent","property","prototype","css$3","attachment","attachmentCaption","attachmentCaptionEditor","attachmentMetadata","attachmentMetadataContainer","attachmentName","attachmentProgress","attachmentSize","attachmentToolbar","lang$1","attachFiles","bold","bullets","byte","bytes","captionPlaceholder","indent","italic","link","numbers","outdent","redo","remove","strike","undo","unlink","urlPlaceholder","GB","KB","MB","PB","TB","sizes","fileSize","prefix","precision","formatter","concat","base","exp","Math","floor","log","humanSize","pow","string","toFixed","withoutInsignificantZeros","replace","ZERO_WIDTH_SPACE","NON_BREAKING_SPACE","OBJECT_REPLACEMENT_CHARACTER","extend","properties","key","value","html","document","documentElement","match","matches","handleEvent","eventName","arguments","length","undefined","onElement","matchingSelector","withCallback","inPhase","preventDefault","times","selector","useCapture","handler","event","destroy","target","findClosestElementFromNode","call","removeEventListener","addEventListener","handleEventOnce","options","triggerEvent","bubbles","cancelable","createEvent","initEvent","dispatchEvent","elementMatchesSelector","nodeType","node","untilNode","Node","ELEMENT_NODE","closest","findInnerElement","_element","firstElementChild","innerElementIsActive","activeElement","elementContainsNode","findNodeFromContainerAndOffset","container","offset","TEXT_NODE","firstChild","childNodes","item","findElementFromContainerAndOffset","findChildIndexOfNode","_node","childIndex","previousSibling","removeNode","_node$parentNode","removeChild","walkTree","tree","onlyNodesOfType","usingFilter","expandEntityReferences","whatToShow","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","SHOW_COMMENT","SHOW_ALL","createTreeWalker","makeElement","tag","createElement","editable","contenteditable","setAttribute","data","dataset","className","split","forEach","classList","add","textContent","childNode","appendChild","blockTagNames","getBlockTagNames","attributes$1","push","nodeIsBlockContainer","nodeIsBlockStartComment","nodeProbablyIsBlockContainer","includes","nodeIsBlockStart","strict","nodeIsCommentNode","COMMENT_NODE","nodeIsCursorTarget","nodeIsTextNode","trixCursorTarget","nodeIsAttachmentElement","nodeIsEmptyTextNode","input","level2Enabled","getLevel","pickFiles","callback","multiple","hidden","id","fileInputId","getElementById","body","click","keyNames$2","textAttributes","inheritable","parser","window","getComputedStyle","fontWeight","fontStyle","href","groupTagName","getAttribute","frozen","backgroundColor","toolbar","getDefaultHTML","undoInterval","config","blockAttributes","browser","css","keyNames","lang","_asyncIterator","iterable","method","async","sync","retry","Symbol","asyncIterator","iterator","AsyncFromSyncIterator","TypeError","s","n","next","AsyncFromSyncIteratorContinuation","apply","return","ret","Promise","resolve","done","throw","thr","reject","r","Object","then","REACT_ELEMENT_TYPE","_jsx","props","children","defaultProps","childrenLength","childArray","Array","i","propName","$$typeof","ref","_owner","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","_objectSpread2","source","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_typeof","obj","constructor","_wrapRegExp","re","groups","BabelRegExp","_super","RegExp","_groups","WeakMap","flags","_this","set","get","_setPrototypeOf","_inherits","exec","str","result","buildGroups","substitution","_","args","slice","g","reduce","create","_AwaitValue","wrapped","_AsyncGenerator","gen","front","back","send","arg","request","resume","wrappedAwait","settle","err","_invoke","_wrapAsyncGenerator","fn","_awaitAsyncGenerator","_asyncGeneratorDelegate","inner","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","self","_classCallCheck","instance","Constructor","_defineProperties","descriptor","configurable","writable","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","desc","objectSymbols","_defaults","defaults","getOwnPropertyNames","_extends","assign","hasOwnProperty","_objectSpread","subClass","superClass","_inheritsLoose","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","e","_construct","Parent","Class","a","Function","bind","_isNativeFunction","toString","indexOf","_wrapNativeSuper","_cache","Map","has","Wrapper","_instanceof","left","right","hasInstance","_interopRequireDefault","__esModule","_getRequireWildcardCache","nodeInterop","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","cache","newObj","hasPropertyDescriptor","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","NewTarget","_superPropBase","_get","receiver","_set","isStrict","Error","_taggedTemplateLiteral","strings","raw","freeze","_taggedTemplateLiteralLoose","_readOnlyError","_writeOnlyError","_classNameTDZError","_temporalUndefined","_tdz","_temporalRef","val","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","isArray","_arrayLikeToArray","_maybeArrayLike","len","from","_i","_arr","_n","_d","_s","_e","_step","minLen","arr2","_createForOfIteratorHelper","allowArrayLike","it","F","f","normalCompletion","didErr","step","_createForOfIteratorHelperLoose","_skipFirstGeneratorNext","_toPrimitive","hint","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","initializer","_applyDecoratedDescriptor","decorators","reverse","decorator","id$2","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classExtractFieldDescriptor","_classApplyDescriptorGet","_classPrivateFieldSet","_classApplyDescriptorSet","_classPrivateFieldDestructureSet","_classApplyDescriptorDestructureSet","action","_classStaticPrivateFieldSpecGet","classConstructor","_classCheckPrivateStaticAccess","_classCheckPrivateStaticFieldDescriptor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","__destrObj","v","_classStaticPrivateFieldDestructureSet","_decorate","factory","mixins","api","_getDecoratorsApi","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","d","map","_createElementDescriptor","initializeClassElements","runClassFinishers","finishers","elementsDefinitionOrder","kind","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","splice","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","j","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","def","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_checkPrivateRedeclaration","privateCollection","_classPrivateFieldInitSpec","_classPrivateMethodInitSpec","_classPrivateMethodSet","BasicObject","expression","parseProxyMethodExpression","toMethod","toProperty","optional","subject","_this$toMethod","_object","proxyMethodExpressionPattern","_Array$from","_$codePointAt$1","_$1","_String$fromCodePoint","UTF16String","ucs2String","codepoints","ucs2Length","ucs2encode","max","ucs2Offset","ucs2decode","fromCodepoints","box","fromUCS2String","hasArrayFrom","hasStringCodePointAt$1","codePointAt","hasStringFromCodePoint","fromCodePoint","char","output","counter","charCodeAt","extra","array","characters","fromCharCode","join","id$1","TrixObject","parts","contents","contentsForInspection","JSON","stringify","jsonString","fromJSON","arraysAreEqual","b","index","arrayStartsWith","spliceArray","_len","_key","summarizeArrayChange","oldArray","newArray","added","removed","existingValues","Set","currentValues","RTL_PATTERN","getDirection","dir","dirName","form","supportsDirName","FormData","supportsDirSelector","trim","charAt","allAttributeNames","blockAttributeNames","textAttributeNames","listAttributeNames","getAllAttributeNames","getTextAttributeNames","getBlockAttributeNames","getBlockConfig","attributeName","getTextConfig","getListAttributeNames","installDefaultCSSForTagName","defaultCSS","styleElement","insertStyleElementForTagName","nonce","getCSPNonce","head","insertBefore","getMetaElement","querySelector","testTransferData","dataTransferIsPlainText","dataTransfer","getData","DOMParser","parseFromString","dataTransferIsWritable","setData","keyEventIsKeyboardCommand","platform","metaKey","ctrlKey","defer","setTimeout","copyObject","objectsAreEqual","normalizeRange","range","copyValue","rangeIsCollapsed","start","end","rangeValuesAreEqual","rangesAreEqual","leftRange","rightRange","leftStart","leftEnd","rightStart","rightEnd","SelectionChangeObserver","update","run","selectionManagers","started","selectionManager","stop","selectionDidChange","domRange","getDOMRange","domRangesAreEqual","notifySelectionManagersOfSelectionChange","requestAnimationFrame","startContainer","startOffset","endContainer","endOffset","selectionChangeObserver","getDOMSelection","selection","getSelection","rangeCount","_getDOMSelection","getRangeAt","domRangeIsPrivate","setDOMRange","removeAllRanges","addRange","nodeIsPrivate","normalizeSpaces","normalizeNewlines","breakableWhitespacePattern","squishBreakableWhitespace","summarizeStringChange","oldString","newString","utf16StringDifferences","isEqualTo","diffA","utf16StringDifference","utf16String","diffB","leftIndex","rightIndexA","rightIndexB","Hash","values","copy","merge","unbox","hash","getKeys","toArray","toObject","objects","getKeysCommonToHash","keyToRemove","sortedKeys","sort","Operation","performing","performed","succeeded","promise","perform","_this$promise","_this$promise$cancel","cancel","proxyMethod","ImagePreloadOperation","image","Image","onload","width","naturalWidth","height","naturalHeight","onerror","src","Attachment","releaseFile","didChangeAttributes","attribute","newAttributes","_this$previewDelegate","_this$previewDelegate2","_this$delegate","_this$delegate$attach","previewDelegate","attachmentDidChangeAttributes","delegate","isPreviewable","preloadURL","getURL","getHref","previewablePattern","getContentType","hasContent","filesize","_this$getFilename$mat","getFilename","preloadFile","releasePreloadedFile","uploadProgress","_this$uploadProgressD","_this$uploadProgressD2","uploadProgressDelegate","attachmentDidChangeUploadProgress","getAttributes","getCacheKey","getPreviewURL","previewURL","preloadingURL","_this$previewDelegate3","_this$previewDelegate4","_this$delegate2","_this$delegate2$attac","attachmentDidChangePreviewURL","preload","fileObjectURL","URL","createObjectURL","revokeObjectURL","operation","_ref","getWidth","getHeight","setAttributes","setPreviewURL","catch","attributesForFile","setFile","filename","contentType","attachmentJSON","ManagedAttachment","attachmentManager","requestRemovalOfAttachment","AttachmentManager","managedAttachments","manageAttachment","attachmentIsManaged","attachmentManagerDidRequestRemovalOfAttachment","managedAttachment","Piece","getValue","copyWithAttributes","piece","hasSameConstructorAs","hasSameStringValueAsPiece","hasSameAttributesAsPiece","inspect","hasAttribute","types","pieceJSON","AttachmentPiece","ensureAttachmentExclusivelyHasAttribute","removeProhibitedAttributes","permittedAttributes","isPending","_piece$attachment","json","registerType","StringPiece","SplittableList","splittableList","position","splitObjectAtPosition","insertSplittableListAtIndex","replaceObjectAtIndex","splitObjectsAtRange","rightIndex","transform","transformedObjects","rightOuterIndex","startOfRange","leftInnerIndex","endOfRange","findIndexAndOffsetAtPosition","splitIndex","splitOffset","getObjectAtIndex","splitAtOffset","leftObject","rightObject","getLength","pendingObject","_pendingObject$canBeC","_pendingObject","canBeConsolidatedWith","consolidateWith","startIndex","endIndex","objectsInRange","consolidatedInRange","consolidate","currentPosition","nextPosition","currentIndex","endPosition","objectArraysAreEqual","Text","pieces","notEmpty","isEmpty","pieceList","copyWithPieceList","objectMap","getPieces","insertTextAtPosition","insertSplittableListAtPosition","removeObjectsInRange","removeTextAtRange","getTextAtRange","addAttributesAtRange","transformObjectsInRange","copyWithAdditionalAttributes","copyWithoutAttribute","_this$pieceList$getOb","getObjectAtPosition","fromCommonAttributesOfObjects","getCommonAttributes","getCommonAttributesAtRange","getSplittableListInRange","getStringAtRange","getAttachmentPieces","attachmentId","getAttachmentAndPositionById","attachmentAndPosition","getRangeOfAttachment","getEndPosition","_text$pieceList","isBlockBreak","eachObject","selectSplittableList","isSerializable","toJSON","toConsole","textJSON","Block","applyBlockBreakToText","block","copyWithText","mappedText","copyUsingObjectMap","expandAttribute","removeLastValue","removeAttribute","getLastAttribute","getLastElement","level","getAttributeLevel","getNestableAttributes","getLastNestableAttribute","lastIndexOf","_getBlockConfig","_getBlockConfig2","_getBlockConfig3","direction","isRTL","hasAttributes","newlineText","textForStringWithAttributes","getTextWithoutBlockBreak","appendText","textEndsInBlockBreak","getBlockBreakPosition","depth","otherBlock","otherAttributes","otherAttribute","blockJSON","unmarkExistingInnerBlockBreaksInText","addBlockBreakToText","modified","innerPieces","lastPiece","unmarkBlockBreakPiece","blockBreakText","blockBreak","endText","ObjectMap","Document","blocks","blockList","getBlockAtIndex","consolidateBlocks","sourceDocument","getObjects","getBlocks","mappedBlock","oldBlock","newBlock","locationFromPosition","getBlockAtPosition","removeObjectAtIndex","formattedDocument","startPosition","startLocation","baseBlockAttributes","getBaseBlockAttributes","trailingBlockAttributes","leadingBlockAttributes","copyWithBaseBlockAttributes","blockCount","getBlockCount","firstBlock","firstText","insertTextAtRange","insertDocumentAtRange","editObjectAtIndex","leftPosition","rightPosition","locationRangeFromRange","leftLocation","rightLocation","leftOffset","leftBlock","rightOffset","rightBlock","removeRightNewline","getStringAtPosition","leftText","rightText","removingLeftBlock","useRightBlock","affectedBlockCount","getDocumentAtRange","movingRightward","eachBlockAtRange","textRange","addAttribute","addAttributeAtRange","eachBlock","removeAttributeAtRange","getTextAtIndex","updateAttributesForAttachment","expanded","expandRangeToLineBreaksAndSplitBlocks","blockConfig","removeLastListAttributeAtRange","exceptAttributeName","converted","convertLineBreaksToBlockBreaksInRange","removeBlockAttributesAtRange","removeLastTerminalAttributeAtRange","consolidateBlocksAtRange","lastAttributeName","copyWithoutAttributes","endLocation","startBlock","findLineBreakInDirectionFromPosition","positionFromLocation","insertBlockBreakAtRange","endBlock","consolidateFromIndexToIndex","_this$getBlockAtIndex","getPieceAtPosition","editCount","getCommonAttributesAtPosition","attributesForBlock","commonAttributes","getAttributesAtPosition","attributesLeft","inheritableAttributes","getExpandedRangeForAttributeAtOffset","blockIndex","lastAttributeIndex","min","getAttachments","attachmentPieces","ranges","withValue","location","findPositionAtIndexAndOffset","locationRange","getTexts","toSerializableText","documentJSON","DEFAULT_ALLOWED_ATTRIBUTES","DEFAULT_FORBIDDEN_PROTOCOLS","DEFAULT_FORBIDDEN_ELEMENTS","HTMLSanitizer","allowedAttributes","forbiddenProtocols","forbiddenElements","createBodyElementForHTML","sanitizeElements","normalizeListElementNesting","innerHTML","walker","nodesToRemove","nextNode","currentNode","elementIsRemovable","sanitizeElement","protocol","querySelectorAll","listElement","previousElement","previousElementSibling","elementIsForbidden","elementIsntSerializable","sanitizer","sanitize","doc","implementation","createHTMLDocument","pieceForString","pieceForAttachment","blockForAttributes","parseTrixDataAttribute","getImageDimensions","dimensions","parseInt","HTMLParser","referenceElement","blockElements","processedElements","createHiddenContainer","getHTML","containerElement","nodeFilter","processNode","translateBlockElementMarginsToNewlines","removeHiddenContainer","cloneNode","display","nextSibling","isInsignificantTextNode","appendBlockForTextNode","processTextNode","appendBlockForElement","processElement","currentBlockElement","isBlockElement","appendStringWithAttributes","_this$currentBlock","getBlockAttributes","currentBlock","appendBlockForAttributesWithElement","elementIsBlockElement","currentBlockContainsElement","parentBlockElement","findParentBlockElement","appendEmptyBlock","parentElement","elementCanDisplayPreformattedText","_node$previousSibling","stringEndsWithWhitespace","leftTrimBreakableWhitespace","getTextAttributes","appendAttachmentWithAttributes","isExtraBR","appendPiece","unshift","configAttr","attributeInheritedFromBlock","findBlockElementAncestors","blockElement","styleProperty","attrConfig","_attrConfig$test","ancestors","stringIsAllBreakableWhitespace","nodeEndsWithNonWhitespace","lastChild","defaultMargin","getMarginOfDefaultBlockElement","margin","getMarginOfBlockElementAtIndex","top","prependStringToTextAtIndex","bottom","appendStringToTextAtIndex","getBlockElementMargin","whiteSpace","marginTop","marginBottom","FILTER_REJECT","FILTER_ACCEPT","LineBreakInsertion","composition","selectedRange","getSelectedRange","breaksOnReturn","previousCharacter","nextCharacter","isListItem","PLACEHOLDER","Composition","currentAttributes","revision","_this$delegate$compos","refreshAttachments","compositionDidChangeDocument","_this$delegate2$compo","_this$delegate3","_this$delegate3$compo","compositionWillLoadSnapshot","setDocument","setSelection","compositionDidLoadSnapshot","updatePosition","notifyDelegateOfInsertionAtRange","insertDocument","getCurrentTextAttributes","insertText","insertion","shouldDecreaseListLevel","decreaseListLevel","shouldPrependListItem","copyWithoutText","shouldInsertBlockBreak","insertBlockBreak","shouldRemoveLastBlockAttribute","removeLastBlockAttribute","shouldBreakFormattedBlock","breakFormattedBlock","insertString","getDocument","mergeDocumentAtRange","copyUsingObjectsFromDocument","getLocationRange","rangeFromLocationRange","insertFiles","_this$delegate4","compositionShouldAcceptFile","attachmentForFile","insertAttachments","_config$attachments$t","getType","attachmentText","textForAttachmentWithAttributes","shouldManageMovingCursorInDirection","deletingIntoPreviousBlock","selectionSpansBlocks","selectionIsCollapsed","canDecreaseBlockAttributeLevel","getBlock","decreaseBlockAttributeLevel","getExpandedRangeInDirection","getAttachmentAtRange","editAttachment","moveTextFromRangeToPosition","stopEditingAttachment","removeCurrentAttribute","placeholderPosition","getPosition","setSelectedRange","setCurrentAttribute","canSetCurrentBlockAttribute","canSetCurrentTextAttribute","getSelectedDocument","isTerminalBlock","setBlockAttribute","setTextAttribute","notifyDelegateOfCurrentAttributesChange","canSetCurrentAttribute","applyBlockAttributeAtRange","removeBlockAttribute","updateCurrentAttributes","removeTextAttribute","_this$getBlock","getNestingLevel","previousBlock","getPreviousBlock","getListItemAttributes","replaceBlock","decreaseNestingLevel","increaseNestingLevel","_this$getBlock2","_this$getBlock3","attributeLevel","ignoreLock","hasCurrentAttribute","_this$delegate5","compositionDidRequestChangingSelectionToLocationRange","getSelectionManager","setLocationRange","targetLocationRange","withTargetLocationRange","createLocationRangeFromDOMRange","translateUTF16PositionFromOffset","editingAttachment","canEditAttachment","expandSelectionAroundCommonAttribute","getRangeOfCommonAttributeAtPosition","_this$getSelectedAtta","getSelectedAttachments","positionIsCursorTarget","locationIsCursorTarget","_this$document$getPie","_this$getSelectedDocu","_this$delegate6","_this$delegate6$compo","compositionDidRemoveAttachment","_this$delegate7","_this$delegate7$compo","compositionDidAddAttachment","_this$delegate8","_this$delegate8$compo","compositionDidEditAttachment","_this$delegate9","_this$delegate9$compo","compositionDidChangeAttachmentPreviewURL","_this$delegate10","_this$delegate10$comp","compositionDidStartEditingAttachment","_this$delegate11","_this$delegate11$comp","compositionDidStopEditingAttachment","removeAttributeForAttachment","newDocument","removeLastAttribute","_this$delegate12","_this$delegate12$comp","compositionDidChangeCurrentAttributes","_this$delegate13","_this$delegate13$comp","compositionDidPerformInsertionAtRange","utf16string","toUTF16String","utf16position","offsetFromUCS2Offset","offsetToUCS2Offset","UndoManager","undoEntries","redoEntries","consolidatable","previousEntry","entryHasDescriptionAndContext","undoEntry","createEntry","pop","redoEntry","loadSnapshot","snapshot","getSnapshot","entry","attachmentGalleryFilter","Filter","BLOCK_ATTRIBUTE_NAME","TEXT_ATTRIBUTE_NAME","TEXT_ATTRIBUTE_VALUE","applyBlockAttribute","findRangesOfBlocks","findRangesOfPieces","getCharacterAtPosition","moveSelectedRangeForward","findRangesForBlockAttribute","findRangesForTextAttribute","DEFAULT_FILTERS","Editor","undoManager","filters","loadDocument","deleteInDirection","insertAttachment","insertFile","insertHTML","insertLineBreak","getClientRectAtLocationRange","expandSelectionInDirection","moveCursorInDirection","canDecreaseNestingLevel","canIncreaseNestingLevel","canRedo","canUndo","recordUndoEntry","LocationMapper","foundBlock","attachmentElement","findAttachmentElementParentForNode","rejectAttachmentContents","nodeLength","findNodeAndOffsetFromLocation","nodeOffset","getSignificantNodesForIndex","nodes","acceptSignificantNodes","recordingNodes","rejectEmptyTextNodes","PointMapper","x","y","caretPositionFromPoint","offsetNode","createRange","setStart","caretRangeFromPoint","createTextRange","originalDOMRange","moveToPoint","select","getClientRects","SelectionManager","didMouseDown","locationMapper","pointMapper","lockCount","currentLocationRange","lockedLocationRange","createDOMRangeFromLocationRange","updateCurrentLocationRange","pointRange","getLocationAtPoint","getClientRectsForDOMRange","_getDOMRange","collapsed","domRangeWithinElement","findLocationFromContainerAndOffset","pauseTemporarily","resumeHandlers","paused","clearTimeout","resumeTimeout","_this$delegate$locati","locationRangeDidChange","rangeStart","findContainerAndOffsetFromLocation","rangeEnd","setEnd","point","createDOMRangeFromPoint","_this$createLocationR","models","Cocument","Trix","VERSION","ObjectGroup","asTree","groupObjects","ungroupedObjects","_object$canBeGrouped2","_object$canBeGrouped","_group$canBeGroupedWi","_group","canBeGrouped","canBeGroupedWith","ElementStore","reset","getKey","trixStoreKey","ObjectView","childViews","rootView","createNodes","_this$parentView","parentView","invalidate","_this$findViewForObje","findViewForObject","viewClass","view","getCachedViewForObject","recordChildView","createChildView","cacheViewForObject","ObjectGroupView","views","childView","getAllChildViews","findElementForObject","isViewCachingEnabled","viewCache","getViewCache","shouldCacheViews","_this$getViewCache","objectKeys","objectGroup","findOrCreateCachedChildView","createContainerElement","getChildViews","getNodes","getDepth","css$2","AttachmentView","attachmentPiece","innerElement","figure","getClassName","tabindex","getContent","createContentNodes","createCaptionElement","progressElement","class","getUploadProgress","trixMutable","createCursorTarget","figcaption","getCaption","captionConfig","getCaptionConfig","getFormattedFilesize","nameElement","createTextNode","sizeElement","names","extension","getExtension","trixAttachment","trixContentType","trixId","trixAttributes","trixSerialize","htmlContainsTagName","_this$findElement","findElement","findProgressElement","div","PreviewableAttachmentView","refresh","updateAttributesForImage","serializedAttributes","storeKey","PieceView","textConfig","createAttachmentNodes","createStringNodes","_this$textConfig","substring","preserveSpaces","styles","pendingElement","isLast","isFirst","followsWhitespace","TextView","lastIndex","endsWithWhitespace","previousPiece","css$1","BlockView","comment","createComment","textView","shouldAddExtraNewlineElement","DocumentView","elementStore","shadowElement","elementsHaveEqualHTML","fragment","createDocumentFragmentForSync","didSync","findStoredElements","garbageCollectCachedViews","createDocumentFragment","storedElement","replaceChild","render","otherElement","ignoreSpaces","unserializableElementSelector","unserializableAttributeNames","serializedAttributesAttribute","serializedAttributesSelector","blockCommentPattern","serializers","serializable","HTMLElement","toSerializableDocument","toJSONString","el","deserializers","fromJSONString","serializeToContentType","serializer","deserializeFromContentType","deserializer","mutableAttributeName","mutableSelector","childList","characterData","characterDataOldValue","subtree","MutationObserver","didMutate","observer","observe","disconnect","mutations","findSignificantMutations","_this$delegate$elemen","elementDidMutate","getMutationSummary","mutation","mutationIsSignificant","nodeIsMutable","nodesModifiedByMutation","nodeIsSignificant","addedNodes","removedNodes","getTextMutationSummary","getTextChangesFromCharacterData","additions","deletions","textChanges","getTextChangesFromChildList","addition","summary","textAdded","deleted","textDeleted","textRemoved","getMutationsByType","singleBlockCommentRemoved","getTextForNodes","characterMutations","startMutation","endMutation","oldValue","summarized","Controller","FileVerificationOperation","reader","FileReader","abort","readAsArrayBuffer","InputController","mutationObserver","events","handlerFor","mutationSummary","_this$delegate$inputC","inputControllerDidRequestRender","_this$delegate2$input","inputControllerDidRequestReparse","requestRender","operations","all","handleInput","_this$responder","inputControllerWillAttachFiles","responder","defaultPrevented","inputControllerWillHandleInput","inputControllerDidHandleInput","outerHTML","_$codePointAt","keyNames$1","pastedFileCount","Level0InputController","resetInputSummary","inputSummary","isComposing","inputControllerDidAllowUnhandledInput","mutationIsExpected","requestReparse","preferDocument","mutationAdditionMatchesSummary","mutationDeletionMatchesSummary","didDelete","unexpectedNewlineAddition","unexpectedNewlineDeletion","singleUnexpectedNewline","positionIsBlockBreak","_this$compositionInpu","textChanged","composedEmptyString","compositionInput","getEndData","CompositionInput","isEnded","_this$responder2","setInputSummary","_this$responder3","Files","pageXOffset","pageYOffset","opacity","focus","keydown","didInput","keyName","keyCode","_context2","modifier","_context","character","inputControllerDidReceiveKeyboardCommand","keypress","altKey","stringFromKeyEvent","_this$responder9","inputControllerWillPerformTyping","selectionIsExpanded","textInput","toUpperCase","_this$responder10","dragenter","dragstart","_this$delegate5$input","serializeSelectionToDataTransfer","draggedRange","inputControllerDidStartDrag","dragover","canAcceptDataTransfer","draggingPoint","clientX","clientY","_this$delegate6$input","inputControllerDidReceiveDragOverPoint","dragend","_this$delegate7$input","inputControllerDidCancelDrag","drop","_event$dataTransfer","_this$responder11","setLocationRangeFromPointRange","_this$responder12","inputControllerWillMoveText","moveTextFromRange","_this$responder13","cut","_this$responder14","clipboardData","inputControllerWillCutText","_this$responder15","paste","clipboard","testClipboardData","pasteEventIsCrippledSafariHTMLPaste","getPastedHTMLUsingHiddenElement","_this$responder16","inputControllerWillPaste","inputControllerDidPaste","_this$responder17","createLinkHTML","_this$delegate14","_this$responder18","_this$delegate15","_this$delegate16","_this$responder19","_this$delegate17","_clipboard$items","_clipboard$items$","_clipboard$items$$get","items","getAsFile","_this$delegate18","_this$responder20","_this$delegate19","extensionForFile","compositionstart","getCompositionInput","compositionupdate","compositionend","beforeinput","stopPropagation","backspace","_this$delegate20","delete","_this$delegate21","_this$delegate22","_this$responder21","tab","_this$responder22","_this$responder23","selectionIsInCursorTarget","_this$responder24","_this$responder25","control","_this$delegate23","h","_this$delegate24","_this$delegate25","_this$responder26","shift","_this$delegate26","_this$responder27","_this$responder28","_this$responder29","alt","_this$delegate27","meta","_this$delegate28","_file$type","_file$type$match","hasStringCodePointAt","which","charCode","hasPasteboardFlavor","hasReadableDynamicData","mightBePasteAndMatchStyle","isExternalHTMLPaste","isExternalRichTextPaste","inputController","isSignificant","_this$responder5","_this$responder4","insertPlaceholder","selectPlaceholder","forgetPlaceholder","canApplyToDocument","_this$responder6","_this$responder7","_this$responder8","_this$data$start","_this$data$end","Level2InputController","scheduledRender","composing","reparse","_this$afterRender","cancelAnimationFrame","afterRender","withTargetDOMRange","inputControllerWillPerformFormatting","toggleCurrentAttribute","getTargetDOMRange","minLength","_this$event$getTarget","_this$event","targetRanges","getTargetRanges","staticRangeToRange","command","keyboardCommandFromKeyEvent","shiftKey","withEvent","_event$clipboardData","pasteEventHasFilesOnly","pasteEventHasPlainTextOnly","inputTypes","inputType","scheduleRender","selectionContainsAttachments","dragging","pointFromEvent","dragEventHasFiles","ArrowLeft","ArrowRight","Backspace","shouldManageDeletingInDirection","Tab","deleteByComposition","deleteByCut","deleteByDrag","deleteByDragRange","deleteCompositionText","deleteContent","deleteContentBackward","deleteContentForward","deleteEntireSoftLine","deleteHardLineBackward","deleteHardLineForward","deleteSoftLineBackward","deleteSoftLineForward","deleteWordBackward","deleteWordForward","formatBackColor","activateAttributeIfSupported","formatBold","toggleAttributeIfSupported","formatFontColor","formatFontName","formatIndent","formatItalic","formatJustifyCenter","formatJustifyFull","formatJustifyLeft","formatJustifyRight","formatOutdent","formatRemove","getCurrentAttributes","_this$responder30","formatSetBlockTextDirection","formatSetInlineTextDirection","formatStrikeThrough","formatSubscript","formatSuperscript","formatUnderline","historyRedo","inputControllerWillPerformRedo","historyUndo","inputControllerWillPerformUndo","insertCompositionText","insertFromComposition","insertFromDrop","_this$responder31","insertFromPaste","_dataTransfer$files","_this$responder32","_this$responder33","_this$responder34","_this$responder35","insertFromYank","insertLink","insertOrderedList","insertParagraph","_this$responder36","insertReplacementText","_this$event$dataTrans","insertTranspose","insertUnorderedList","staticRange","undoable","commands","do","undos","AttachmentEditorController","title","trixAction","didClickToolbar","didClickActionButton","textarea","placeholder","textareaClone","tabIndex","autoresize","scrollHeight","didInputCaption","didKeyDownCaption","didChangeCaption","didBlurCaption","editingFigcaption","editCaption","install","makeElementMutable","addToolbar","installCaptionEditor","savePendingCaption","didUninstallAttachmentEditor","pendingCaption","attachmentEditorDidRequestUpdatingAttributesForAttachment","_this$delegate3$attac","attachmentEditorDidRequestRemovingAttributeForAttachment","attachmentEditorDidRequestRemovalOfAttachment","_this$delegate5$attac","attachmentEditorDidRequestDeselectingAttachment","CompositionController","didFocus","didBlur","didClickAttachment","documentView","_this$blurPromise","focused","compositionControllerDidFocus","blurPromise","compositionControllerDidBlur","findAttachmentForElement","compositionControllerDidSelectAttachment","isEditingAttachment","canSyncDocumentView","isSynced","_this$delegate4$compo","_this$delegate5$compo","compositionControllerWillSyncDocumentView","compositionControllerDidSyncDocumentView","compositionControllerDidRender","invalidateViewForObject","enableViewCaching","disableViewCaching","attachmentEditor","_this$attachmentEdito","uninstallAttachmentEditor","getAttachmentPieceForAttachment","_this$attachmentEdito2","uninstall","compositionControllerWillUpdateAttachment","compositionControllerDidRequestRemovalOfAttachment","compositionControllerDidRequestDeselectingAttachment","getAttachmentById","attributeButtonSelector","actionButtonSelector","toolbarButtonSelector","dialogSelector","activeDialogSelector","dialogButtonSelector","dialogInputSelector","getInputForDialog","getAttributeName","getActionName","getDialogName","ToolbarController","didClickAttributeButton","didClickDialogButton","didKeyDownDialogInput","actions","resetDialogInputs","toolbarDidClickButton","actionName","getDialog","toggleDialog","toolbarDidInvokeAction","toolbarDidToggleAttribute","refreshAttributeButtons","dialogElement","dialog","hideDialog","refreshActionButtons","eachActionButton","disabled","eachAttributeButton","dialogIsVisible","keyString","button","buttonKeys","buttonKeyString","dialogName","showDialog","toolbarWillShowDialog","disabledInput","toolbarDidShowDialog","willValidate","checkValidity","toolbarDidUpdateAttribute","toolbarDidRemoveAttribute","toolbarDidHideDialog","snapshotsAreEqual","EditorController","editorElement","compositionController","toolbarController","toolbarElement","editor","loadHTML","registerSelectionManager","unregisterSelectionManager","replaceHTML","notifyEditorElement","handlingInput","updateAttributes","updateCurrentActions","pasting","pastedRange","rerenderViewForObject","unmanageAttachment","attachmentLocationRange","getLocationRangeOfAttachment","installAttachmentEditorForAttachment","loadingSnapshot","isFocused","requestedLocationRange","compositionRevisionWhenLocationRangeRequested","refreshViewCache","removeAttachment","editorWillSyncDocumentView","lock","clearSelection","editorDidSyncDocumentView","unlock","renderedCompositionRevision","runEditorFilters","isFocusedInvisibly","requestedRender","recordTypingUndoEntry","recordFormattingUndoEntry","applyKeyboardCommand","locationRangeBeforeDrag","invokeAction","selectionFrozen","expandSelectionForEditing","freezeSelection","thawSelection","actionIsExternal","_this$actions$actionN","_this$actions$actionN2","_this$actions$actionN3","_this$actions$actionN4","canInvokeAction","currentActions","getCurrentActions","updateActions","getSerializableElement","setInputElementValue","message","documentChangedSinceLastRender","updateInputElement","notify","getUndoContext","getLocationContext","getTimeContext","Date","getTime","_this$editorElement$o","ownerDocument","canActivateAttribute","TrixToolbarElement","customElements","define","autofocus","makeEditable","configureContentEditable","disableObjectResizing","setDefaultParagraphSeparator","_document$queryComman","_document","queryCommandSupported","execCommand","_document$queryComman2","_document2","addAccessibilityRole","ensureAriaLabel","texts","labels","label","contains","cursorTargetStyles","TrixEditorElement","_this$ownerDocument","toolbarId","_this$inputElement","inputElement","_this$ownerDocument2","inputId","nextElementSibling","_this$editorControlle","editorController","_this$inputElement2","_this$inputElement3","defaultValue","_this$editor","registerResetListener","registerClickListener","_this$editorControlle2","unregisterResetListener","unregisterClickListener","resetListener","resetBubbled","clickListener","clickBubbled"],"mappings":"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","sourcesContent":["/*\nTrix 2.0.0-alpha.0\nCopyright © 2022 Basecamp, LLC\n */\nvar name = \"trix\";\nvar version = \"2.0.0-alpha.0\";\nvar description = \"A rich text editor for everyday writing\";\nvar main = \"dist/trix.umd.js\";\nvar module = \"dist/trix.js\";\nvar style = \"dist/trix.css\";\nvar files = [\n\t\"dist/*.css\",\n\t\"dist/*.js\"\n];\nvar repository = {\n\ttype: \"git\",\n\turl: \"git+https://github.com/basecamp/trix.git\"\n};\nvar keywords = [\n\t\"rich text\",\n\t\"wysiwyg\",\n\t\"editor\"\n];\nvar author = \"Basecamp, LLC\";\nvar license = \"MIT\";\nvar bugs = {\n\turl: \"https://github.com/basecamp/trix/issues\"\n};\nvar homepage = \"https://trix-editor.org/\";\nvar devDependencies = {\n\t\"@babel/core\": \"^7.16.0\",\n\t\"@babel/preset-env\": \"^7.16.4\",\n\t\"@rollup/plugin-babel\": \"^5.3.0\",\n\t\"@rollup/plugin-json\": \"^4.1.0\",\n\t\"babel-eslint\": \"^10.1.0\",\n\teslint: \"^7.32.0\",\n\tesm: \"^3.2.25\",\n\tkarma: \"5.0.2\",\n\t\"karma-chrome-launcher\": \"3.1.0\",\n\t\"karma-qunit\": \"^4.1.2\",\n\t\"karma-sauce-launcher\": \"^4.3.6\",\n\t\"node-sass\": \"^6.0.1\",\n\tqunit: \"2.9.3\",\n\trangy: \"^1.3.0\",\n\trollup: \"^2.56.3\",\n\t\"rollup-plugin-commonjs\": \"^10.1.0\",\n\t\"rollup-plugin-includepaths\": \"^0.2.4\",\n\t\"rollup-plugin-node-resolve\": \"^5.2.0\",\n\t\"rollup-plugin-terser\": \"^7.0.2\",\n\tsvgo: \"^2.8.0\"\n};\nvar scripts = {\n\t\"build-css\": \"node-sass --functions=./assets/trix/stylesheets/functions assets/trix.scss dist/trix.css\",\n\t\"build-js\": \"rollup -c\",\n\t\"build-assets\": \"cp -f assets/*.html dist/\",\n\tbuild: \"yarn run build-js && yarn run build-css && yarn run build-assets\",\n\twatch: \"rollup -c -w\",\n\tlint: \"eslint .\",\n\tpretest: \"yarn run lint && yarn run build\",\n\ttest: \"karma start\",\n\tpostversion: \"git push && git push --tags\",\n\trelease: \"yarn test && npm adduser && yarn version && npm publish\"\n};\nvar dependencies = {\n};\nvar _package = {\n\tname: name,\n\tversion: version,\n\tdescription: description,\n\tmain: main,\n\tmodule: module,\n\tstyle: style,\n\tfiles: files,\n\trepository: repository,\n\tkeywords: keywords,\n\tauthor: author,\n\tlicense: license,\n\tbugs: bugs,\n\thomepage: homepage,\n\tdevDependencies: devDependencies,\n\tscripts: scripts,\n\tdependencies: dependencies\n};\n\nconst attachmentSelector = \"[data-trix-attachment]\";\nconst attachments = {\n  preview: {\n    presentation: \"gallery\",\n    caption: {\n      name: true,\n      size: true\n    }\n  },\n  file: {\n    caption: {\n      size: true\n    }\n  }\n};\n\nconst attributes = {\n  default: {\n    tagName: \"div\",\n    parse: false\n  },\n  quote: {\n    tagName: \"blockquote\",\n    nestable: true\n  },\n  heading1: {\n    tagName: \"h1\",\n    terminal: true,\n    breakOnReturn: true,\n    group: false\n  },\n  code: {\n    tagName: \"pre\",\n    terminal: true,\n    text: {\n      plaintext: true\n    }\n  },\n  bulletList: {\n    tagName: \"ul\",\n    parse: false\n  },\n  bullet: {\n    tagName: \"li\",\n    listAttribute: \"bulletList\",\n    group: false,\n    nestable: true,\n\n    test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n\n  },\n  numberList: {\n    tagName: \"ol\",\n    parse: false\n  },\n  number: {\n    tagName: \"li\",\n    listAttribute: \"numberList\",\n    group: false,\n    nestable: true,\n\n    test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n\n  },\n  attachmentGallery: {\n    tagName: \"div\",\n    exclusive: true,\n    terminal: true,\n    parse: false,\n    group: false\n  }\n};\n\nconst tagName$1 = element => {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\n\nvar browser$1 = {\n  // Android emits composition events when moving the cursor through existing text\n  // Introduced in Chrome 65: https://bugs.chromium.org/p/chromium/issues/detail?id=764439#c9\n  composesExistingText: /Android.*Chrome/.test(navigator.userAgent),\n  // IE 11 activates resizing handles on editable elements that have \"layout\"\n  forcesObjectResizing: /Trident.*rv:11/.test(navigator.userAgent),\n  // https://www.w3.org/TR/input-events-1/ + https://www.w3.org/TR/input-events-2/\n  supportsInputEvents: function () {\n    if (typeof InputEvent === \"undefined\") {\n      return false;\n    }\n\n    for (const property of [\"data\", \"getTargetRanges\", \"inputType\"]) {\n      if (!(property in InputEvent.prototype)) {\n        return false;\n      }\n    }\n\n    return true;\n  }()\n};\n\nvar css$3 = {\n  attachment: \"attachment\",\n  attachmentCaption: \"attachment__caption\",\n  attachmentCaptionEditor: \"attachment__caption-editor\",\n  attachmentMetadata: \"attachment__metadata\",\n  attachmentMetadataContainer: \"attachment__metadata-container\",\n  attachmentName: \"attachment__name\",\n  attachmentProgress: \"attachment__progress\",\n  attachmentSize: \"attachment__size\",\n  attachmentToolbar: \"attachment__toolbar\",\n  attachmentGallery: \"attachment-gallery\"\n};\n\nvar lang$1 = {\n  attachFiles: \"Attach Files\",\n  bold: \"Bold\",\n  bullets: \"Bullets\",\n  byte: \"Byte\",\n  bytes: \"Bytes\",\n  captionPlaceholder: \"Add a caption…\",\n  code: \"Code\",\n  heading1: \"Heading\",\n  indent: \"Increase Level\",\n  italic: \"Italic\",\n  link: \"Link\",\n  numbers: \"Numbers\",\n  outdent: \"Decrease Level\",\n  quote: \"Quote\",\n  redo: \"Redo\",\n  remove: \"Remove\",\n  strike: \"Strikethrough\",\n  undo: \"Undo\",\n  unlink: \"Unlink\",\n  url: \"URL\",\n  urlPlaceholder: \"Enter a URL…\",\n  GB: \"GB\",\n  KB: \"KB\",\n  MB: \"MB\",\n  PB: \"PB\",\n  TB: \"TB\"\n};\n\n/* eslint-disable\n    no-case-declarations,\n*/\nconst sizes = [lang$1.bytes, lang$1.KB, lang$1.MB, lang$1.GB, lang$1.TB, lang$1.PB];\nvar fileSize = {\n  prefix: \"IEC\",\n  precision: 2,\n\n  formatter(number) {\n    switch (number) {\n      case 0:\n        return \"0 \".concat(lang$1.bytes);\n\n      case 1:\n        return \"1 \".concat(lang$1.byte);\n\n      default:\n        let base;\n\n        if (this.prefix === \"SI\") {\n          base = 1000;\n        } else if (this.prefix === \"IEC\") {\n          base = 1024;\n        }\n\n        const exp = Math.floor(Math.log(number) / Math.log(base));\n        const humanSize = number / Math.pow(base, exp);\n        const string = humanSize.toFixed(this.precision);\n        const withoutInsignificantZeros = string.replace(/0*$/, \"\").replace(/\\.$/, \"\");\n        return \"\".concat(withoutInsignificantZeros, \" \").concat(sizes[exp]);\n    }\n  }\n\n};\n\nconst ZERO_WIDTH_SPACE = \"\\uFEFF\";\nconst NON_BREAKING_SPACE = \"\\u00A0\";\nconst OBJECT_REPLACEMENT_CHARACTER = \"\\uFFFC\";\n\nconst extend = function (properties) {\n  for (const key in properties) {\n    const value = properties[key];\n    this[key] = value;\n  }\n\n  return this;\n};\n\nconst html = document.documentElement;\nconst match = html.matches;\nconst handleEvent = function (eventName) {\n  let {\n    onElement,\n    matchingSelector,\n    withCallback,\n    inPhase,\n    preventDefault,\n    times\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const element = onElement ? onElement : html;\n  const selector = matchingSelector;\n  const useCapture = inPhase === \"capturing\";\n\n  const handler = function (event) {\n    if (times != null && --times === 0) {\n      handler.destroy();\n    }\n\n    const target = findClosestElementFromNode(event.target, {\n      matchingSelector: selector\n    });\n\n    if (target != null) {\n      withCallback === null || withCallback === void 0 ? void 0 : withCallback.call(target, event, target);\n\n      if (preventDefault) {\n        event.preventDefault();\n      }\n    }\n  };\n\n  handler.destroy = () => element.removeEventListener(eventName, handler, useCapture);\n\n  element.addEventListener(eventName, handler, useCapture);\n  return handler;\n};\nconst handleEventOnce = function (eventName) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  options.times = 1;\n  return handleEvent(eventName, options);\n};\nconst triggerEvent = function (eventName) {\n  let {\n    onElement,\n    bubbles,\n    cancelable,\n    attributes\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const element = onElement != null ? onElement : html;\n  bubbles = bubbles !== false;\n  cancelable = cancelable !== false;\n  const event = document.createEvent(\"Events\");\n  event.initEvent(eventName, bubbles, cancelable);\n\n  if (attributes != null) {\n    extend.call(event, attributes);\n  }\n\n  return element.dispatchEvent(event);\n};\nconst elementMatchesSelector = function (element, selector) {\n  if ((element === null || element === void 0 ? void 0 : element.nodeType) === 1) {\n    return match.call(element, selector);\n  }\n};\nconst findClosestElementFromNode = function (node) {\n  let {\n    matchingSelector,\n    untilNode\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  while (node && node.nodeType !== Node.ELEMENT_NODE) {\n    node = node.parentNode;\n  }\n\n  if (node == null) {\n    return;\n  }\n\n  if (matchingSelector != null) {\n    if (node.closest && untilNode == null) {\n      return node.closest(matchingSelector);\n    } else {\n      while (node && node !== untilNode) {\n        if (elementMatchesSelector(node, matchingSelector)) {\n          return node;\n        }\n\n        node = node.parentNode;\n      }\n    }\n  } else {\n    return node;\n  }\n};\nconst findInnerElement = function (element) {\n  while ((_element = element) !== null && _element !== void 0 && _element.firstElementChild) {\n    var _element;\n\n    element = element.firstElementChild;\n  }\n\n  return element;\n};\nconst innerElementIsActive = element => document.activeElement !== element && elementContainsNode(element, document.activeElement);\nconst elementContainsNode = function (element, node) {\n  if (!element || !node) {\n    return;\n  }\n\n  while (node) {\n    if (node === element) {\n      return true;\n    }\n\n    node = node.parentNode;\n  }\n};\nconst findNodeFromContainerAndOffset = function (container, offset) {\n  if (!container) {\n    return;\n  }\n\n  if (container.nodeType === Node.TEXT_NODE) {\n    return container;\n  } else if (offset === 0) {\n    return container.firstChild != null ? container.firstChild : container;\n  } else {\n    return container.childNodes.item(offset - 1);\n  }\n};\nconst findElementFromContainerAndOffset = function (container, offset) {\n  const node = findNodeFromContainerAndOffset(container, offset);\n  return findClosestElementFromNode(node);\n};\nconst findChildIndexOfNode = function (node) {\n  var _node;\n\n  if (!((_node = node) !== null && _node !== void 0 && _node.parentNode)) {\n    return;\n  }\n\n  let childIndex = 0;\n  node = node.previousSibling;\n\n  while (node) {\n    childIndex++;\n    node = node.previousSibling;\n  }\n\n  return childIndex;\n};\nconst removeNode = node => {\n  var _node$parentNode;\n\n  return node === null || node === void 0 ? void 0 : (_node$parentNode = node.parentNode) === null || _node$parentNode === void 0 ? void 0 : _node$parentNode.removeChild(node);\n};\nconst walkTree = function (tree) {\n  let {\n    onlyNodesOfType,\n    usingFilter,\n    expandEntityReferences\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  const whatToShow = (() => {\n    switch (onlyNodesOfType) {\n      case \"element\":\n        return NodeFilter.SHOW_ELEMENT;\n\n      case \"text\":\n        return NodeFilter.SHOW_TEXT;\n\n      case \"comment\":\n        return NodeFilter.SHOW_COMMENT;\n\n      default:\n        return NodeFilter.SHOW_ALL;\n    }\n  })();\n\n  return document.createTreeWalker(tree, whatToShow, usingFilter != null ? usingFilter : null, expandEntityReferences === true);\n};\nconst tagName = element => {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\nconst makeElement = function (tag) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  let key, value;\n\n  if (typeof tag === \"object\") {\n    options = tag;\n    tag = options.tagName;\n  } else {\n    options = {\n      attributes: options\n    };\n  }\n\n  const element = document.createElement(tag);\n\n  if (options.editable != null) {\n    if (options.attributes == null) {\n      options.attributes = {};\n    }\n\n    options.attributes.contenteditable = options.editable;\n  }\n\n  if (options.attributes) {\n    for (key in options.attributes) {\n      value = options.attributes[key];\n      element.setAttribute(key, value);\n    }\n  }\n\n  if (options.style) {\n    for (key in options.style) {\n      value = options.style[key];\n      element.style[key] = value;\n    }\n  }\n\n  if (options.data) {\n    for (key in options.data) {\n      value = options.data[key];\n      element.dataset[key] = value;\n    }\n  }\n\n  if (options.className) {\n    options.className.split(\" \").forEach(className => {\n      element.classList.add(className);\n    });\n  }\n\n  if (options.textContent) {\n    element.textContent = options.textContent;\n  }\n\n  if (options.childNodes) {\n    [].concat(options.childNodes).forEach(childNode => {\n      element.appendChild(childNode);\n    });\n  }\n\n  return element;\n};\nlet blockTagNames = undefined;\nconst getBlockTagNames = function () {\n  if (blockTagNames != null) {\n    return blockTagNames;\n  }\n\n  blockTagNames = [];\n\n  for (const key in attributes) {\n    const attributes$1 = attributes[key];\n\n    if (attributes$1.tagName) {\n      blockTagNames.push(attributes$1.tagName);\n    }\n  }\n\n  return blockTagNames;\n};\nconst nodeIsBlockContainer = node => nodeIsBlockStartComment(node === null || node === void 0 ? void 0 : node.firstChild);\nconst nodeProbablyIsBlockContainer = function (node) {\n  return getBlockTagNames().includes(tagName(node)) && !getBlockTagNames().includes(tagName(node.firstChild));\n};\nconst nodeIsBlockStart = function (node) {\n  let {\n    strict\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    strict: true\n  };\n\n  if (strict) {\n    return nodeIsBlockStartComment(node);\n  } else {\n    return nodeIsBlockStartComment(node) || !nodeIsBlockStartComment(node.firstChild) && nodeProbablyIsBlockContainer(node);\n  }\n};\nconst nodeIsBlockStartComment = node => nodeIsCommentNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"block\";\nconst nodeIsCommentNode = node => (node === null || node === void 0 ? void 0 : node.nodeType) === Node.COMMENT_NODE;\nconst nodeIsCursorTarget = function (node) {\n  let {\n    name\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!node) {\n    return;\n  }\n\n  if (nodeIsTextNode(node)) {\n    if (node.data === ZERO_WIDTH_SPACE) {\n      if (name) {\n        return node.parentNode.dataset.trixCursorTarget === name;\n      } else {\n        return true;\n      }\n    }\n  } else {\n    return nodeIsCursorTarget(node.firstChild);\n  }\n};\nconst nodeIsAttachmentElement = node => elementMatchesSelector(node, attachmentSelector);\nconst nodeIsEmptyTextNode = node => nodeIsTextNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"\";\nconst nodeIsTextNode = node => (node === null || node === void 0 ? void 0 : node.nodeType) === Node.TEXT_NODE;\n\nconst input = {\n  level2Enabled: true,\n\n  getLevel() {\n    if (this.level2Enabled && browser$1.supportsInputEvents) {\n      return 2;\n    } else {\n      return 0;\n    }\n  },\n\n  pickFiles(callback) {\n    const input = makeElement(\"input\", {\n      type: \"file\",\n      multiple: true,\n      hidden: true,\n      id: this.fileInputId\n    });\n    input.addEventListener(\"change\", () => {\n      callback(input.files);\n      removeNode(input);\n    });\n    removeNode(document.getElementById(this.fileInputId));\n    document.body.appendChild(input);\n    input.click();\n  }\n\n};\n\nvar keyNames$2 = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"return\",\n  27: \"escape\",\n  37: \"left\",\n  39: \"right\",\n  46: \"delete\",\n  68: \"d\",\n  72: \"h\",\n  79: \"o\"\n};\n\nvar textAttributes = {\n  bold: {\n    tagName: \"strong\",\n    inheritable: true,\n\n    parser(element) {\n      const style = window.getComputedStyle(element);\n      return style.fontWeight === \"bold\" || style.fontWeight >= 600;\n    }\n\n  },\n  italic: {\n    tagName: \"em\",\n    inheritable: true,\n\n    parser(element) {\n      const style = window.getComputedStyle(element);\n      return style.fontStyle === \"italic\";\n    }\n\n  },\n  href: {\n    groupTagName: \"a\",\n\n    parser(element) {\n      const matchingSelector = \"a:not(\".concat(attachmentSelector, \")\");\n      const link = element.closest(matchingSelector);\n\n      if (link) {\n        return link.getAttribute(\"href\");\n      }\n    }\n\n  },\n  strike: {\n    tagName: \"del\",\n    inheritable: true\n  },\n  frozen: {\n    style: {\n      backgroundColor: \"highlight\"\n    }\n  }\n};\n\nvar toolbar = {\n  getDefaultHTML() {\n    return \"<div class=\\\"trix-button-row\\\">\\n      <span class=\\\"trix-button-group trix-button-group--text-tools\\\" data-trix-button-group=\\\"text-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bold\\\" data-trix-attribute=\\\"bold\\\" data-trix-key=\\\"b\\\" title=\\\"\".concat(lang$1.bold, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bold, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-italic\\\" data-trix-attribute=\\\"italic\\\" data-trix-key=\\\"i\\\" title=\\\"\").concat(lang$1.italic, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.italic, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-strike\\\" data-trix-attribute=\\\"strike\\\" title=\\\"\").concat(lang$1.strike, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.strike, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-link\\\" data-trix-attribute=\\\"href\\\" data-trix-action=\\\"link\\\" data-trix-key=\\\"k\\\" title=\\\"\").concat(lang$1.link, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.link, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--block-tools\\\" data-trix-button-group=\\\"block-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-heading-1\\\" data-trix-attribute=\\\"heading1\\\" title=\\\"\").concat(lang$1.heading1, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.heading1, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-quote\\\" data-trix-attribute=\\\"quote\\\" title=\\\"\").concat(lang$1.quote, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.quote, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-code\\\" data-trix-attribute=\\\"code\\\" title=\\\"\").concat(lang$1.code, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.code, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bullet-list\\\" data-trix-attribute=\\\"bullet\\\" title=\\\"\").concat(lang$1.bullets, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bullets, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-number-list\\\" data-trix-attribute=\\\"number\\\" title=\\\"\").concat(lang$1.numbers, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.numbers, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-decrease-nesting-level\\\" data-trix-action=\\\"decreaseNestingLevel\\\" title=\\\"\").concat(lang$1.outdent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.outdent, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-increase-nesting-level\\\" data-trix-action=\\\"increaseNestingLevel\\\" title=\\\"\").concat(lang$1.indent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.indent, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--file-tools\\\" data-trix-button-group=\\\"file-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-attach\\\" data-trix-action=\\\"attachFiles\\\" title=\\\"\").concat(lang$1.attachFiles, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.attachFiles, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group-spacer\\\"></span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--history-tools\\\" data-trix-button-group=\\\"history-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-undo\\\" data-trix-action=\\\"undo\\\" data-trix-key=\\\"z\\\" title=\\\"\").concat(lang$1.undo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.undo, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-redo\\\" data-trix-action=\\\"redo\\\" data-trix-key=\\\"shift+z\\\" title=\\\"\").concat(lang$1.redo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.redo, \"</button>\\n      </span>\\n    </div>\\n\\n    <div class=\\\"trix-dialogs\\\" data-trix-dialogs>\\n      <div class=\\\"trix-dialog trix-dialog--link\\\" data-trix-dialog=\\\"href\\\" data-trix-dialog-attribute=\\\"href\\\">\\n        <div class=\\\"trix-dialog__link-fields\\\">\\n          <input type=\\\"url\\\" name=\\\"href\\\" class=\\\"trix-input trix-input--dialog\\\" placeholder=\\\"\").concat(lang$1.urlPlaceholder, \"\\\" aria-label=\\\"\").concat(lang$1.url, \"\\\" required data-trix-input>\\n          <div class=\\\"trix-button-group\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.link, \"\\\" data-trix-method=\\\"setAttribute\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.unlink, \"\\\" data-trix-method=\\\"removeAttribute\\\">\\n          </div>\\n        </div>\\n      </div>\\n    </div>\");\n  }\n\n};\n\nconst undoInterval = 5000;\n\nconst config = {\n  attachments,\n  blockAttributes: attributes,\n  browser: browser$1,\n  css: css$3,\n  fileSize,\n  input,\n  keyNames: keyNames$2,\n  lang: lang$1,\n  textAttributes,\n  toolbar,\n  undoInterval\n};\n\nfunction _asyncIterator(iterable) {\n  var method,\n      async,\n      sync,\n      retry = 2;\n\n  if (typeof Symbol !== \"undefined\") {\n    async = Symbol.asyncIterator;\n    sync = Symbol.iterator;\n  }\n\n  while (retry--) {\n    if (async && (method = iterable[async]) != null) {\n      return method.call(iterable);\n    }\n\n    if (sync && (method = iterable[sync]) != null) {\n      return new AsyncFromSyncIterator(method.call(iterable));\n    }\n\n    async = \"@@asyncIterator\";\n    sync = \"@@iterator\";\n  }\n\n  throw new TypeError(\"Object is not async iterable\");\n}\n\nfunction AsyncFromSyncIterator(s) {\n  AsyncFromSyncIterator = function (s) {\n    this.s = s;\n    this.n = s.next;\n  };\n\n  AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function () {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    return: function (value) {\n      var ret = this.s.return;\n\n      if (ret === undefined) {\n        return Promise.resolve({\n          value: value,\n          done: true\n        });\n      }\n\n      return AsyncFromSyncIteratorContinuation(ret.apply(this.s, arguments));\n    },\n    throw: function (value) {\n      var thr = this.s.return;\n      if (thr === undefined) return Promise.reject(value);\n      return AsyncFromSyncIteratorContinuation(thr.apply(this.s, arguments));\n    }\n  };\n\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) {\n      return Promise.reject(new TypeError(r + \" is not an object.\"));\n    }\n\n    var done = r.done;\n    return Promise.resolve(r.value).then(function (value) {\n      return {\n        value: value,\n        done: done\n      };\n    });\n  }\n\n  return new AsyncFromSyncIterator(s);\n}\n\nvar REACT_ELEMENT_TYPE;\n\nfunction _jsx(type, props, key, children) {\n  if (!REACT_ELEMENT_TYPE) {\n    REACT_ELEMENT_TYPE = typeof Symbol === \"function\" && Symbol[\"for\"] && Symbol[\"for\"](\"react.element\") || 0xeac7;\n  }\n\n  var defaultProps = type && type.defaultProps;\n  var childrenLength = arguments.length - 3;\n\n  if (!props && childrenLength !== 0) {\n    props = {\n      children: void 0\n    };\n  }\n\n  if (childrenLength === 1) {\n    props.children = children;\n  } else if (childrenLength > 1) {\n    var childArray = new Array(childrenLength);\n\n    for (var i = 0; i < childrenLength; i++) {\n      childArray[i] = arguments[i + 3];\n    }\n\n    props.children = childArray;\n  }\n\n  if (props && defaultProps) {\n    for (var propName in defaultProps) {\n      if (props[propName] === void 0) {\n        props[propName] = defaultProps[propName];\n      }\n    }\n  } else if (!props) {\n    props = defaultProps || {};\n  }\n\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key === undefined ? null : \"\" + key,\n    ref: null,\n    props: props,\n    _owner: null\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _wrapRegExp() {\n  _wrapRegExp = function (re, groups) {\n    return new BabelRegExp(re, undefined, groups);\n  };\n\n  var _super = RegExp.prototype;\n\n  var _groups = new WeakMap();\n\n  function BabelRegExp(re, flags, groups) {\n    var _this = new RegExp(re, flags);\n\n    _groups.set(_this, groups || _groups.get(re));\n\n    return _setPrototypeOf(_this, BabelRegExp.prototype);\n  }\n\n  _inherits(BabelRegExp, RegExp);\n\n  BabelRegExp.prototype.exec = function (str) {\n    var result = _super.exec.call(this, str);\n\n    if (result) result.groups = buildGroups(result, this);\n    return result;\n  };\n\n  BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n    if (typeof substitution === \"string\") {\n      var groups = _groups.get(this);\n\n      return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n        return \"$\" + groups[name];\n      }));\n    } else if (typeof substitution === \"function\") {\n      var _this = this;\n\n      return _super[Symbol.replace].call(this, str, function () {\n        var args = arguments;\n\n        if (typeof args[args.length - 1] !== \"object\") {\n          args = [].slice.call(args);\n          args.push(buildGroups(args, _this));\n        }\n\n        return substitution.apply(this, args);\n      });\n    } else {\n      return _super[Symbol.replace].call(this, str, substitution);\n    }\n  };\n\n  function buildGroups(result, re) {\n    var g = _groups.get(re);\n\n    return Object.keys(g).reduce(function (groups, name) {\n      groups[name] = result[g[name]];\n      return groups;\n    }, Object.create(null));\n  }\n\n  return _wrapRegExp.apply(this, arguments);\n}\n\nfunction _AwaitValue(value) {\n  this.wrapped = value;\n}\n\nfunction _AsyncGenerator(gen) {\n  var front, back;\n\n  function send(key, arg) {\n    return new Promise(function (resolve, reject) {\n      var request = {\n        key: key,\n        arg: arg,\n        resolve: resolve,\n        reject: reject,\n        next: null\n      };\n\n      if (back) {\n        back = back.next = request;\n      } else {\n        front = back = request;\n        resume(key, arg);\n      }\n    });\n  }\n\n  function resume(key, arg) {\n    try {\n      var result = gen[key](arg);\n      var value = result.value;\n      var wrappedAwait = value instanceof _AwaitValue;\n      Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n        if (wrappedAwait) {\n          resume(key === \"return\" ? \"return\" : \"next\", arg);\n          return;\n        }\n\n        settle(result.done ? \"return\" : \"normal\", arg);\n      }, function (err) {\n        resume(\"throw\", err);\n      });\n    } catch (err) {\n      settle(\"throw\", err);\n    }\n  }\n\n  function settle(type, value) {\n    switch (type) {\n      case \"return\":\n        front.resolve({\n          value: value,\n          done: true\n        });\n        break;\n\n      case \"throw\":\n        front.reject(value);\n        break;\n\n      default:\n        front.resolve({\n          value: value,\n          done: false\n        });\n        break;\n    }\n\n    front = front.next;\n\n    if (front) {\n      resume(front.key, front.arg);\n    } else {\n      back = null;\n    }\n  }\n\n  this._invoke = send;\n\n  if (typeof gen.return !== \"function\") {\n    this.return = undefined;\n  }\n}\n\n_AsyncGenerator.prototype[typeof Symbol === \"function\" && Symbol.asyncIterator || \"@@asyncIterator\"] = function () {\n  return this;\n};\n\n_AsyncGenerator.prototype.next = function (arg) {\n  return this._invoke(\"next\", arg);\n};\n\n_AsyncGenerator.prototype.throw = function (arg) {\n  return this._invoke(\"throw\", arg);\n};\n\n_AsyncGenerator.prototype.return = function (arg) {\n  return this._invoke(\"return\", arg);\n};\n\nfunction _wrapAsyncGenerator(fn) {\n  return function () {\n    return new _AsyncGenerator(fn.apply(this, arguments));\n  };\n}\n\nfunction _awaitAsyncGenerator(value) {\n  return new _AwaitValue(value);\n}\n\nfunction _asyncGeneratorDelegate(inner, awaitWrap) {\n  var iter = {},\n      waiting = false;\n\n  function pump(key, value) {\n    waiting = true;\n    value = new Promise(function (resolve) {\n      resolve(inner[key](value));\n    });\n    return {\n      done: false,\n      value: awaitWrap(value)\n    };\n  }\n\n  ;\n\n  iter[typeof Symbol !== \"undefined\" && Symbol.iterator || \"@@iterator\"] = function () {\n    return this;\n  };\n\n  iter.next = function (value) {\n    if (waiting) {\n      waiting = false;\n      return value;\n    }\n\n    return pump(\"next\", value);\n  };\n\n  if (typeof inner.throw === \"function\") {\n    iter.throw = function (value) {\n      if (waiting) {\n        waiting = false;\n        throw value;\n      }\n\n      return pump(\"throw\", value);\n    };\n  }\n\n  if (typeof inner.return === \"function\") {\n    iter.return = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump(\"return\", value);\n    };\n  }\n\n  return iter;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineEnumerableProperties(obj, descs) {\n  for (var key in descs) {\n    var desc = descs[key];\n    desc.configurable = desc.enumerable = true;\n    if (\"value\" in desc) desc.writable = true;\n    Object.defineProperty(obj, key, desc);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n    for (var i = 0; i < objectSymbols.length; i++) {\n      var sym = objectSymbols[i];\n      var desc = descs[sym];\n      desc.configurable = desc.enumerable = true;\n      if (\"value\" in desc) desc.writable = true;\n      Object.defineProperty(obj, sym, desc);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? Object(arguments[i]) : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys.push.apply(ownKeys, Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !_isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return _setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nfunction _instanceof(left, right) {\n  if (right != null && typeof Symbol !== \"undefined\" && right[Symbol.hasInstance]) {\n    return !!right[Symbol.hasInstance](left);\n  } else {\n    return left instanceof right;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function (nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _newArrowCheck(innerThis, boundThis) {\n  if (innerThis !== boundThis) {\n    throw new TypeError(\"Cannot instantiate an arrow function\");\n  }\n}\n\nfunction _objectDestructuringEmpty(obj) {\n  if (obj == null) throw new TypeError(\"Cannot destructure undefined\");\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction set(target, property, value, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.set) {\n    set = Reflect.set;\n  } else {\n    set = function set(target, property, value, receiver) {\n      var base = _superPropBase(target, property);\n\n      var desc;\n\n      if (base) {\n        desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.set) {\n          desc.set.call(receiver, value);\n          return true;\n        } else if (!desc.writable) {\n          return false;\n        }\n      }\n\n      desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n      if (desc) {\n        if (!desc.writable) {\n          return false;\n        }\n\n        desc.value = value;\n        Object.defineProperty(receiver, property, desc);\n      } else {\n        _defineProperty(receiver, property, value);\n      }\n\n      return true;\n    };\n  }\n\n  return set(target, property, value, receiver);\n}\n\nfunction _set(target, property, value, receiver, isStrict) {\n  var s = set(target, property, value, receiver || target);\n\n  if (!s && isStrict) {\n    throw new Error('failed to set property');\n  }\n\n  return value;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}\n\nfunction _taggedTemplateLiteralLoose(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  strings.raw = raw;\n  return strings;\n}\n\nfunction _readOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nfunction _writeOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is write-only\");\n}\n\nfunction _classNameTDZError(name) {\n  throw new Error(\"Class \\\"\" + name + \"\\\" cannot be referenced in computed property keys.\");\n}\n\nfunction _temporalUndefined() {}\n\nfunction _tdz(name) {\n  throw new ReferenceError(name + \" is not defined - temporal dead zone\");\n}\n\nfunction _temporalRef(val, name) {\n  return val === _temporalUndefined ? _tdz(name) : val;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _slicedToArrayLoose(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _maybeArrayLike(next, arr, i) {\n  if (arr && !Array.isArray(arr) && typeof arr.length === \"number\") {\n    var len = arr.length;\n    return _arrayLikeToArray(arr, i !== void 0 && i < len ? i : len);\n  }\n\n  return next(arr, i);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _iterableToArrayLimitLoose(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n\n  for (_i = _i.call(arr), _step; !(_step = _i.next()).done;) {\n    _arr.push(_step.value);\n\n    if (i && _arr.length === i) break;\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (e) {\n          throw e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (e) {\n      didErr = true;\n      err = e;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _skipFirstGeneratorNext(fn) {\n  return function () {\n    var it = fn.apply(this, arguments);\n    it.next();\n    return it;\n  };\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.');\n}\n\nfunction _initializerDefineProperty(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar id$2 = 0;\n\nfunction _classPrivateFieldLooseKey(name) {\n  return \"__private_\" + id$2++ + \"_\" + name;\n}\n\nfunction _classPrivateFieldLooseBase(receiver, privateKey) {\n  if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n    throw new TypeError(\"attempted to use private field on non-instance\");\n  }\n\n  return receiver;\n}\n\nfunction _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classPrivateFieldDestructureSet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) {\n  if (!privateMap.has(receiver)) {\n    throw new TypeError(\"attempted to \" + action + \" private field on non-instance\");\n  }\n\n  return privateMap.get(receiver);\n}\n\nfunction _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  return method;\n}\n\nfunction _classStaticPrivateMethodSet() {\n  throw new TypeError(\"attempted to set read only static private field\");\n}\n\nfunction _classApplyDescriptorGet(receiver, descriptor) {\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) {\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n}\n\nfunction _classApplyDescriptorDestructureSet(receiver, descriptor) {\n  if (descriptor.set) {\n    if (!(\"__destrObj\" in descriptor)) {\n      descriptor.__destrObj = {\n        set value(v) {\n          descriptor.set.call(receiver, v);\n        }\n\n      };\n    }\n\n    return descriptor.__destrObj;\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    return descriptor;\n  }\n}\n\nfunction _classStaticPrivateFieldDestructureSet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classCheckPrivateStaticAccess(receiver, classConstructor) {\n  if (receiver !== classConstructor) {\n    throw new TypeError(\"Private static access of wrong provenance\");\n  }\n}\n\nfunction _classCheckPrivateStaticFieldDescriptor(descriptor, action) {\n  if (descriptor === undefined) {\n    throw new TypeError(\"attempted to \" + action + \" private static field before its declaration\");\n  }\n}\n\nfunction _decorate(decorators, factory, superClass, mixins) {\n  var api = _getDecoratorsApi();\n\n  if (mixins) {\n    for (var i = 0; i < mixins.length; i++) {\n      api = mixins[i](api);\n    }\n  }\n\n  var r = factory(function initialize(O) {\n    api.initializeInstanceElements(O, decorated.elements);\n  }, superClass);\n  var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n  api.initializeClassElements(r.F, decorated.elements);\n  return api.runClassFinishers(r.F, decorated.finishers);\n}\n\nfunction _getDecoratorsApi() {\n  _getDecoratorsApi = function () {\n    return api;\n  };\n\n  var api = {\n    elementsDefinitionOrder: [[\"method\"], [\"field\"]],\n    initializeInstanceElements: function (O, elements) {\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          if (element.kind === kind && element.placement === \"own\") {\n            this.defineClassElement(O, element);\n          }\n        }, this);\n      }, this);\n    },\n    initializeClassElements: function (F, elements) {\n      var proto = F.prototype;\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          var placement = element.placement;\n\n          if (element.kind === kind && (placement === \"static\" || placement === \"prototype\")) {\n            var receiver = placement === \"static\" ? F : proto;\n            this.defineClassElement(receiver, element);\n          }\n        }, this);\n      }, this);\n    },\n    defineClassElement: function (receiver, element) {\n      var descriptor = element.descriptor;\n\n      if (element.kind === \"field\") {\n        var initializer = element.initializer;\n        descriptor = {\n          enumerable: descriptor.enumerable,\n          writable: descriptor.writable,\n          configurable: descriptor.configurable,\n          value: initializer === void 0 ? void 0 : initializer.call(receiver)\n        };\n      }\n\n      Object.defineProperty(receiver, element.key, descriptor);\n    },\n    decorateClass: function (elements, decorators) {\n      var newElements = [];\n      var finishers = [];\n      var placements = {\n        static: [],\n        prototype: [],\n        own: []\n      };\n      elements.forEach(function (element) {\n        this.addElementPlacement(element, placements);\n      }, this);\n      elements.forEach(function (element) {\n        if (!_hasDecorators(element)) return newElements.push(element);\n        var elementFinishersExtras = this.decorateElement(element, placements);\n        newElements.push(elementFinishersExtras.element);\n        newElements.push.apply(newElements, elementFinishersExtras.extras);\n        finishers.push.apply(finishers, elementFinishersExtras.finishers);\n      }, this);\n\n      if (!decorators) {\n        return {\n          elements: newElements,\n          finishers: finishers\n        };\n      }\n\n      var result = this.decorateConstructor(newElements, decorators);\n      finishers.push.apply(finishers, result.finishers);\n      result.finishers = finishers;\n      return result;\n    },\n    addElementPlacement: function (element, placements, silent) {\n      var keys = placements[element.placement];\n\n      if (!silent && keys.indexOf(element.key) !== -1) {\n        throw new TypeError(\"Duplicated element (\" + element.key + \")\");\n      }\n\n      keys.push(element.key);\n    },\n    decorateElement: function (element, placements) {\n      var extras = [];\n      var finishers = [];\n\n      for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n        var keys = placements[element.placement];\n        keys.splice(keys.indexOf(element.key), 1);\n        var elementObject = this.fromElementDescriptor(element);\n        var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n        element = elementFinisherExtras.element;\n        this.addElementPlacement(element, placements);\n\n        if (elementFinisherExtras.finisher) {\n          finishers.push(elementFinisherExtras.finisher);\n        }\n\n        var newExtras = elementFinisherExtras.extras;\n\n        if (newExtras) {\n          for (var j = 0; j < newExtras.length; j++) {\n            this.addElementPlacement(newExtras[j], placements);\n          }\n\n          extras.push.apply(extras, newExtras);\n        }\n      }\n\n      return {\n        element: element,\n        finishers: finishers,\n        extras: extras\n      };\n    },\n    decorateConstructor: function (elements, decorators) {\n      var finishers = [];\n\n      for (var i = decorators.length - 1; i >= 0; i--) {\n        var obj = this.fromClassDescriptor(elements);\n        var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n        if (elementsAndFinisher.finisher !== undefined) {\n          finishers.push(elementsAndFinisher.finisher);\n        }\n\n        if (elementsAndFinisher.elements !== undefined) {\n          elements = elementsAndFinisher.elements;\n\n          for (var j = 0; j < elements.length - 1; j++) {\n            for (var k = j + 1; k < elements.length; k++) {\n              if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                throw new TypeError(\"Duplicated element (\" + elements[j].key + \")\");\n              }\n            }\n          }\n        }\n      }\n\n      return {\n        elements: elements,\n        finishers: finishers\n      };\n    },\n    fromElementDescriptor: function (element) {\n      var obj = {\n        kind: element.kind,\n        key: element.key,\n        placement: element.placement,\n        descriptor: element.descriptor\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      if (element.kind === \"field\") obj.initializer = element.initializer;\n      return obj;\n    },\n    toElementDescriptors: function (elementObjects) {\n      if (elementObjects === undefined) return;\n      return _toArray(elementObjects).map(function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n        this.disallowProperty(elementObject, \"finisher\", \"An element descriptor\");\n        this.disallowProperty(elementObject, \"extras\", \"An element descriptor\");\n        return element;\n      }, this);\n    },\n    toElementDescriptor: function (elementObject) {\n      var kind = String(elementObject.kind);\n\n      if (kind !== \"method\" && kind !== \"field\") {\n        throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n      }\n\n      var key = _toPropertyKey(elementObject.key);\n\n      var placement = String(elementObject.placement);\n\n      if (placement !== \"static\" && placement !== \"prototype\" && placement !== \"own\") {\n        throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n      }\n\n      var descriptor = elementObject.descriptor;\n      this.disallowProperty(elementObject, \"elements\", \"An element descriptor\");\n      var element = {\n        kind: kind,\n        key: key,\n        placement: placement,\n        descriptor: Object.assign({}, descriptor)\n      };\n\n      if (kind !== \"field\") {\n        this.disallowProperty(elementObject, \"initializer\", \"A method descriptor\");\n      } else {\n        this.disallowProperty(descriptor, \"get\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"set\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"value\", \"The property descriptor of a field descriptor\");\n        element.initializer = elementObject.initializer;\n      }\n\n      return element;\n    },\n    toElementFinisherExtras: function (elementObject) {\n      var element = this.toElementDescriptor(elementObject);\n\n      var finisher = _optionalCallableProperty(elementObject, \"finisher\");\n\n      var extras = this.toElementDescriptors(elementObject.extras);\n      return {\n        element: element,\n        finisher: finisher,\n        extras: extras\n      };\n    },\n    fromClassDescriptor: function (elements) {\n      var obj = {\n        kind: \"class\",\n        elements: elements.map(this.fromElementDescriptor, this)\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      return obj;\n    },\n    toClassDescriptor: function (obj) {\n      var kind = String(obj.kind);\n\n      if (kind !== \"class\") {\n        throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n      }\n\n      this.disallowProperty(obj, \"key\", \"A class descriptor\");\n      this.disallowProperty(obj, \"placement\", \"A class descriptor\");\n      this.disallowProperty(obj, \"descriptor\", \"A class descriptor\");\n      this.disallowProperty(obj, \"initializer\", \"A class descriptor\");\n      this.disallowProperty(obj, \"extras\", \"A class descriptor\");\n\n      var finisher = _optionalCallableProperty(obj, \"finisher\");\n\n      var elements = this.toElementDescriptors(obj.elements);\n      return {\n        elements: elements,\n        finisher: finisher\n      };\n    },\n    runClassFinishers: function (constructor, finishers) {\n      for (var i = 0; i < finishers.length; i++) {\n        var newConstructor = (0, finishers[i])(constructor);\n\n        if (newConstructor !== undefined) {\n          if (typeof newConstructor !== \"function\") {\n            throw new TypeError(\"Finishers must return a constructor.\");\n          }\n\n          constructor = newConstructor;\n        }\n      }\n\n      return constructor;\n    },\n    disallowProperty: function (obj, name, objectType) {\n      if (obj[name] !== undefined) {\n        throw new TypeError(objectType + \" can't have a .\" + name + \" property.\");\n      }\n    }\n  };\n  return api;\n}\n\nfunction _createElementDescriptor(def) {\n  var key = _toPropertyKey(def.key);\n\n  var descriptor;\n\n  if (def.kind === \"method\") {\n    descriptor = {\n      value: def.value,\n      writable: true,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"get\") {\n    descriptor = {\n      get: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"set\") {\n    descriptor = {\n      set: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"field\") {\n    descriptor = {\n      configurable: true,\n      writable: true,\n      enumerable: true\n    };\n  }\n\n  var element = {\n    kind: def.kind === \"field\" ? \"field\" : \"method\",\n    key: key,\n    placement: def.static ? \"static\" : def.kind === \"field\" ? \"own\" : \"prototype\",\n    descriptor: descriptor\n  };\n  if (def.decorators) element.decorators = def.decorators;\n  if (def.kind === \"field\") element.initializer = def.value;\n  return element;\n}\n\nfunction _coalesceGetterSetter(element, other) {\n  if (element.descriptor.get !== undefined) {\n    other.descriptor.get = element.descriptor.get;\n  } else {\n    other.descriptor.set = element.descriptor.set;\n  }\n}\n\nfunction _coalesceClassElements(elements) {\n  var newElements = [];\n\n  var isSameElement = function (other) {\n    return other.kind === \"method\" && other.key === element.key && other.placement === element.placement;\n  };\n\n  for (var i = 0; i < elements.length; i++) {\n    var element = elements[i];\n    var other;\n\n    if (element.kind === \"method\" && (other = newElements.find(isSameElement))) {\n      if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n        if (_hasDecorators(element) || _hasDecorators(other)) {\n          throw new ReferenceError(\"Duplicated methods (\" + element.key + \") can't be decorated.\");\n        }\n\n        other.descriptor = element.descriptor;\n      } else {\n        if (_hasDecorators(element)) {\n          if (_hasDecorators(other)) {\n            throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + \"the same property (\" + element.key + \").\");\n          }\n\n          other.decorators = element.decorators;\n        }\n\n        _coalesceGetterSetter(element, other);\n      }\n    } else {\n      newElements.push(element);\n    }\n  }\n\n  return newElements;\n}\n\nfunction _hasDecorators(element) {\n  return element.decorators && element.decorators.length;\n}\n\nfunction _isDataDescriptor(desc) {\n  return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n}\n\nfunction _optionalCallableProperty(obj, name) {\n  var value = obj[name];\n\n  if (value !== undefined && typeof value !== \"function\") {\n    throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n  }\n\n  return value;\n}\n\nfunction _classPrivateMethodGet(receiver, privateSet, fn) {\n  if (!privateSet.has(receiver)) {\n    throw new TypeError(\"attempted to get private field on non-instance\");\n  }\n\n  return fn;\n}\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) {\n  if (privateCollection.has(obj)) {\n    throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n  }\n}\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) {\n  _checkPrivateRedeclaration(obj, privateMap);\n\n  privateMap.set(obj, value);\n}\n\nfunction _classPrivateMethodInitSpec(obj, privateSet) {\n  _checkPrivateRedeclaration(obj, privateSet);\n\n  privateSet.add(obj);\n}\n\nfunction _classPrivateMethodSet() {\n  throw new TypeError(\"attempted to reassign private method\");\n}\n\nclass BasicObject {\n  static proxyMethod(expression) {\n    const {\n      name,\n      toMethod,\n      toProperty,\n      optional\n    } = parseProxyMethodExpression(expression);\n\n    this.prototype[name] = function () {\n      let subject;\n      let object;\n\n      if (toMethod) {\n        if (optional) {\n          var _this$toMethod;\n\n          object = (_this$toMethod = this[toMethod]) === null || _this$toMethod === void 0 ? void 0 : _this$toMethod.call(this);\n        } else {\n          object = this[toMethod]();\n        }\n      } else if (toProperty) {\n        object = this[toProperty];\n      }\n\n      if (optional) {\n        var _object;\n\n        subject = (_object = object) === null || _object === void 0 ? void 0 : _object[name];\n\n        if (subject) {\n          return apply.call(subject, object, arguments);\n        }\n      } else {\n        subject = object[name];\n        return apply.call(subject, object, arguments);\n      }\n    };\n  }\n\n}\n\nconst parseProxyMethodExpression = function (expression) {\n  const match = expression.match(proxyMethodExpressionPattern);\n\n  if (!match) {\n    throw new Error(\"can't parse @proxyMethod expression: \".concat(expression));\n  }\n\n  const args = {\n    name: match[4]\n  };\n\n  if (match[2] != null) {\n    args.toMethod = match[1];\n  } else {\n    args.toProperty = match[1];\n  }\n\n  if (match[3] != null) {\n    args.optional = true;\n  }\n\n  return args;\n};\n\nconst {\n  apply\n} = Function.prototype;\nconst proxyMethodExpressionPattern = new RegExp(\"\\\n^\\\n(.+?)\\\n(\\\\(\\\\))?\\\n(\\\\?)?\\\n\\\\.\\\n(.+?)\\\n$\\\n\");\n\nvar _Array$from, _$codePointAt$1, _$1, _String$fromCodePoint;\nclass UTF16String extends BasicObject {\n  static box() {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n\n    if (value instanceof this) {\n      return value;\n    } else {\n      return this.fromUCS2String(value === null || value === void 0 ? void 0 : value.toString());\n    }\n  }\n\n  static fromUCS2String(ucs2String) {\n    return new this(ucs2String, ucs2decode(ucs2String));\n  }\n\n  static fromCodepoints(codepoints) {\n    return new this(ucs2encode(codepoints), codepoints);\n  }\n\n  constructor(ucs2String, codepoints) {\n    super(...arguments);\n    this.ucs2String = ucs2String;\n    this.codepoints = codepoints;\n    this.length = this.codepoints.length;\n    this.ucs2Length = this.ucs2String.length;\n  }\n\n  offsetToUCS2Offset(offset) {\n    return ucs2encode(this.codepoints.slice(0, Math.max(0, offset))).length;\n  }\n\n  offsetFromUCS2Offset(ucs2Offset) {\n    return ucs2decode(this.ucs2String.slice(0, Math.max(0, ucs2Offset))).length;\n  }\n\n  slice() {\n    return this.constructor.fromCodepoints(this.codepoints.slice(...arguments));\n  }\n\n  charAt(offset) {\n    return this.slice(offset, offset + 1);\n  }\n\n  isEqualTo(value) {\n    return this.constructor.box(value).ucs2String === this.ucs2String;\n  }\n\n  toJSON() {\n    return this.ucs2String;\n  }\n\n  getCacheKey() {\n    return this.ucs2String;\n  }\n\n  toString() {\n    return this.ucs2String;\n  }\n\n}\nconst hasArrayFrom = ((_Array$from = Array.from) === null || _Array$from === void 0 ? void 0 : _Array$from.call(Array, \"\\ud83d\\udc7c\").length) === 1;\nconst hasStringCodePointAt$1 = ((_$codePointAt$1 = (_$1 = \" \").codePointAt) === null || _$codePointAt$1 === void 0 ? void 0 : _$codePointAt$1.call(_$1, 0)) != null;\nconst hasStringFromCodePoint = ((_String$fromCodePoint = String.fromCodePoint) === null || _String$fromCodePoint === void 0 ? void 0 : _String$fromCodePoint.call(String, 32, 128124)) === \" \\ud83d\\udc7c\"; // UCS-2 conversion helpers ported from Mathias Bynens' Punycode.js:\n// https://github.com/bestiejs/punycode.js#punycodeucs2\n\nlet ucs2decode, ucs2encode; // Creates an array containing the numeric code points of each Unicode\n// character in the string. While JavaScript uses UCS-2 internally,\n// this function will convert a pair of surrogate halves (each of which\n// UCS-2 exposes as separate characters) into a single code point,\n// matching UTF-16.\n\nif (hasArrayFrom && hasStringCodePointAt$1) {\n  ucs2decode = string => Array.from(string).map(char => char.codePointAt(0));\n} else {\n  ucs2decode = function (string) {\n    const output = [];\n    let counter = 0;\n    const {\n      length\n    } = string;\n\n    while (counter < length) {\n      let value = string.charCodeAt(counter++);\n\n      if (0xd800 <= value && value <= 0xdbff && counter < length) {\n        // high surrogate, and there is a next character\n        const extra = string.charCodeAt(counter++);\n\n        if ((extra & 0xfc00) === 0xdc00) {\n          // low surrogate\n          value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n        } else {\n          // unmatched surrogate; only append this code unit, in case the\n          // next code unit is the high surrogate of a surrogate pair\n          counter--;\n        }\n      }\n\n      output.push(value);\n    }\n\n    return output;\n  };\n} // Creates a string based on an array of numeric code points.\n\n\nif (hasStringFromCodePoint) {\n  ucs2encode = array => String.fromCodePoint(...Array.from(array || []));\n} else {\n  ucs2encode = function (array) {\n    const characters = (() => {\n      const result = [];\n      Array.from(array).forEach(value => {\n        let output = \"\";\n\n        if (value > 0xffff) {\n          value -= 0x10000;\n          output += String.fromCharCode(value >>> 10 & 0x3ff | 0xd800);\n          value = 0xdc00 | value & 0x3ff;\n        }\n\n        result.push(output + String.fromCharCode(value));\n      });\n      return result;\n    })();\n\n    return characters.join(\"\");\n  };\n}\n\nlet id$1 = 0;\nclass TrixObject extends BasicObject {\n  static fromJSONString(jsonString) {\n    return this.fromJSON(JSON.parse(jsonString));\n  }\n\n  constructor() {\n    super(...arguments);\n    this.id = ++id$1;\n  }\n\n  hasSameConstructorAs(object) {\n    return this.constructor === (object === null || object === void 0 ? void 0 : object.constructor);\n  }\n\n  isEqualTo(object) {\n    return this === object;\n  }\n\n  inspect() {\n    const parts = [];\n    const contents = this.contentsForInspection() || {};\n\n    for (const key in contents) {\n      const value = contents[key];\n      parts.push(\"\".concat(key, \"=\").concat(value));\n    }\n\n    return \"#<\".concat(this.constructor.name, \":\").concat(this.id).concat(parts.length ? \" \".concat(parts.join(\", \")) : \"\", \">\");\n  }\n\n  contentsForInspection() {}\n\n  toJSONString() {\n    return JSON.stringify(this);\n  }\n\n  toUTF16String() {\n    return UTF16String.box(this);\n  }\n\n  getCacheKey() {\n    return this.id.toString();\n  }\n\n}\n\n/* eslint-disable\n    id-length,\n*/\nconst arraysAreEqual = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let index = 0; index < a.length; index++) {\n    const value = a[index];\n\n    if (value !== b[index]) {\n      return false;\n    }\n  }\n\n  return true;\n};\nconst arrayStartsWith = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return arraysAreEqual(a.slice(0, b.length), b);\n};\nconst spliceArray = function (array) {\n  const result = array.slice(0);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  result.splice(...args);\n  return result;\n};\nconst summarizeArrayChange = function () {\n  let oldArray = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let newArray = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  const added = [];\n  const removed = [];\n  const existingValues = new Set();\n  oldArray.forEach(value => {\n    existingValues.add(value);\n  });\n  const currentValues = new Set();\n  newArray.forEach(value => {\n    currentValues.add(value);\n\n    if (!existingValues.has(value)) {\n      added.push(value);\n    }\n  });\n  oldArray.forEach(value => {\n    if (!currentValues.has(value)) {\n      removed.push(value);\n    }\n  });\n  return {\n    added,\n    removed\n  };\n};\n\nconst RTL_PATTERN = /[\\u05BE\\u05C0\\u05C3\\u05D0-\\u05EA\\u05F0-\\u05F4\\u061B\\u061F\\u0621-\\u063A\\u0640-\\u064A\\u066D\\u0671-\\u06B7\\u06BA-\\u06BE\\u06C0-\\u06CE\\u06D0-\\u06D5\\u06E5\\u06E6\\u200F\\u202B\\u202E\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE72\\uFE74\\uFE76-\\uFEFC]/;\nconst getDirection = function () {\n  const input = makeElement(\"input\", {\n    dir: \"auto\",\n    name: \"x\",\n    dirName: \"x.dir\"\n  });\n  const form = makeElement(\"form\");\n  form.appendChild(input);\n\n  const supportsDirName = function () {\n    try {\n      return new FormData(form).has(input.dirName);\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  const supportsDirSelector = function () {\n    try {\n      return input.matches(\":dir(ltr),:dir(rtl)\");\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  if (supportsDirName) {\n    return function (string) {\n      input.value = string;\n      return new FormData(form).get(input.dirName);\n    };\n  } else if (supportsDirSelector) {\n    return function (string) {\n      input.value = string;\n\n      if (input.matches(\":dir(rtl)\")) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  } else {\n    return function (string) {\n      const char = string.trim().charAt(0);\n\n      if (RTL_PATTERN.test(char)) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  }\n}();\n\nlet allAttributeNames = null;\nlet blockAttributeNames = null;\nlet textAttributeNames = null;\nlet listAttributeNames = null;\nconst getAllAttributeNames = () => {\n  if (!allAttributeNames) {\n    allAttributeNames = getTextAttributeNames().concat(getBlockAttributeNames());\n  }\n\n  return allAttributeNames;\n};\nconst getBlockConfig = attributeName => config.blockAttributes[attributeName];\nconst getBlockAttributeNames = () => {\n  if (!blockAttributeNames) {\n    blockAttributeNames = Object.keys(config.blockAttributes);\n  }\n\n  return blockAttributeNames;\n};\nconst getTextConfig = attributeName => config.textAttributes[attributeName];\nconst getTextAttributeNames = () => {\n  if (!textAttributeNames) {\n    textAttributeNames = Object.keys(config.textAttributes);\n  }\n\n  return textAttributeNames;\n};\nconst getListAttributeNames = () => {\n  if (!listAttributeNames) {\n    listAttributeNames = [];\n\n    for (const key in config.blockAttributes) {\n      const {\n        listAttribute\n      } = config.blockAttributes[key];\n\n      if (listAttribute != null) {\n        listAttributeNames.push(listAttribute);\n      }\n    }\n  }\n\n  return listAttributeNames;\n};\n\n/* eslint-disable\n*/\nconst installDefaultCSSForTagName = function (tagName, defaultCSS) {\n  const styleElement = insertStyleElementForTagName(tagName);\n  styleElement.textContent = defaultCSS.replace(/%t/g, tagName);\n};\n\nconst insertStyleElementForTagName = function (tagName) {\n  const element = document.createElement(\"style\");\n  element.setAttribute(\"type\", \"text/css\");\n  element.setAttribute(\"data-tag-name\", tagName.toLowerCase());\n  const nonce = getCSPNonce();\n\n  if (nonce) {\n    element.setAttribute(\"nonce\", nonce);\n  }\n\n  document.head.insertBefore(element, document.head.firstChild);\n  return element;\n};\n\nconst getCSPNonce = function () {\n  const element = getMetaElement(\"trix-csp-nonce\") || getMetaElement(\"csp-nonce\");\n\n  if (element) {\n    return element.getAttribute(\"content\");\n  }\n};\n\nconst getMetaElement = name => document.head.querySelector(\"meta[name=\".concat(name, \"]\"));\n\nconst testTransferData = {\n  \"application/x-trix-feature-detection\": \"test\"\n};\nconst dataTransferIsPlainText = function (dataTransfer) {\n  const text = dataTransfer.getData(\"text/plain\");\n  const html = dataTransfer.getData(\"text/html\");\n\n  if (text && html) {\n    const {\n      body\n    } = new DOMParser().parseFromString(html, \"text/html\");\n\n    if (body.textContent === text) {\n      return !body.querySelector(\"*\");\n    }\n  } else {\n    return text === null || text === void 0 ? void 0 : text.length;\n  }\n};\nconst dataTransferIsWritable = function (dataTransfer) {\n  if (!(dataTransfer !== null && dataTransfer !== void 0 && dataTransfer.setData)) return false;\n\n  for (const key in testTransferData) {\n    const value = testTransferData[key];\n\n    try {\n      dataTransfer.setData(key, value);\n      if (!dataTransfer.getData(key) === value) return false;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  return true;\n};\nconst keyEventIsKeyboardCommand = function () {\n  if (/Mac|^iP/.test(navigator.platform)) {\n    return event => event.metaKey;\n  } else {\n    return event => event.ctrlKey;\n  }\n}();\n\nconst defer = fn => setTimeout(fn, 1);\n\n/* eslint-disable\n    id-length,\n*/\nconst copyObject = function () {\n  let object = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const result = {};\n\n  for (const key in object) {\n    const value = object[key];\n    result[key] = value;\n  }\n\n  return result;\n};\nconst objectsAreEqual = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (Object.keys(a).length !== Object.keys(b).length) {\n    return false;\n  }\n\n  for (const key in a) {\n    const value = a[key];\n\n    if (value !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst normalizeRange = function (range) {\n  if (range == null) return;\n\n  if (!Array.isArray(range)) {\n    range = [range, range];\n  }\n\n  return [copyValue(range[0]), copyValue(range[1] != null ? range[1] : range[0])];\n};\nconst rangeIsCollapsed = function (range) {\n  if (range == null) return;\n  const [start, end] = normalizeRange(range);\n  return rangeValuesAreEqual(start, end);\n};\nconst rangesAreEqual = function (leftRange, rightRange) {\n  if (leftRange == null || rightRange == null) return;\n  const [leftStart, leftEnd] = normalizeRange(leftRange);\n  const [rightStart, rightEnd] = normalizeRange(rightRange);\n  return rangeValuesAreEqual(leftStart, rightStart) && rangeValuesAreEqual(leftEnd, rightEnd);\n};\n\nconst copyValue = function (value) {\n  if (typeof value === \"number\") {\n    return value;\n  } else {\n    return copyObject(value);\n  }\n};\n\nconst rangeValuesAreEqual = function (left, right) {\n  if (typeof left === \"number\") {\n    return left === right;\n  } else {\n    return objectsAreEqual(left, right);\n  }\n};\n\n/* eslint-disable\n    id-length,\n*/\nclass SelectionChangeObserver extends BasicObject {\n  constructor() {\n    super(...arguments);\n    this.update = this.update.bind(this);\n    this.run = this.run.bind(this);\n    this.selectionManagers = [];\n  }\n\n  start() {\n    if (!this.started) {\n      this.started = true;\n\n      if (\"onselectionchange\" in document) {\n        return document.addEventListener(\"selectionchange\", this.update, true);\n      } else {\n        return this.run();\n      }\n    }\n  }\n\n  stop() {\n    if (this.started) {\n      this.started = false;\n      return document.removeEventListener(\"selectionchange\", this.update, true);\n    }\n  }\n\n  registerSelectionManager(selectionManager) {\n    if (!this.selectionManagers.includes(selectionManager)) {\n      this.selectionManagers.push(selectionManager);\n      return this.start();\n    }\n  }\n\n  unregisterSelectionManager(selectionManager) {\n    this.selectionManagers = this.selectionManagers.filter(s => s !== selectionManager);\n\n    if (this.selectionManagers.length === 0) {\n      return this.stop();\n    }\n  }\n\n  notifySelectionManagersOfSelectionChange() {\n    return this.selectionManagers.map(selectionManager => selectionManager.selectionDidChange());\n  }\n\n  update() {\n    const domRange = getDOMRange();\n\n    if (!domRangesAreEqual(domRange, this.domRange)) {\n      this.domRange = domRange;\n      return this.notifySelectionManagersOfSelectionChange();\n    }\n  }\n\n  reset() {\n    this.domRange = null;\n    return this.update();\n  } // Private\n\n\n  run() {\n    if (this.started) {\n      this.update();\n      return requestAnimationFrame(this.run);\n    }\n  }\n\n}\n\nconst domRangesAreEqual = (left, right) => (left === null || left === void 0 ? void 0 : left.startContainer) === (right === null || right === void 0 ? void 0 : right.startContainer) && (left === null || left === void 0 ? void 0 : left.startOffset) === (right === null || right === void 0 ? void 0 : right.startOffset) && (left === null || left === void 0 ? void 0 : left.endContainer) === (right === null || right === void 0 ? void 0 : right.endContainer) && (left === null || left === void 0 ? void 0 : left.endOffset) === (right === null || right === void 0 ? void 0 : right.endOffset);\n\nconst selectionChangeObserver = new SelectionChangeObserver();\nconst getDOMSelection = function () {\n  const selection = window.getSelection();\n\n  if (selection.rangeCount > 0) {\n    return selection;\n  }\n};\nconst getDOMRange = function () {\n  var _getDOMSelection;\n\n  const domRange = (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.getRangeAt(0);\n\n  if (domRange) {\n    if (!domRangeIsPrivate(domRange)) {\n      return domRange;\n    }\n  }\n};\nconst setDOMRange = function (domRange) {\n  const selection = window.getSelection();\n  selection.removeAllRanges();\n  selection.addRange(domRange);\n  return selectionChangeObserver.update();\n}; // In Firefox, clicking certain <input> elements changes the selection to a\n// private element used to draw its UI. Attempting to access properties of those\n// elements throws an error.\n// https://bugzilla.mozilla.org/show_bug.cgi?id=208427\n\nconst domRangeIsPrivate = domRange => nodeIsPrivate(domRange.startContainer) || nodeIsPrivate(domRange.endContainer);\n\nconst nodeIsPrivate = node => !Object.getPrototypeOf(node);\n\n/* eslint-disable\n    id-length,\n    no-useless-escape,\n*/\nconst normalizeSpaces = string => string.replace(new RegExp(\"\".concat(ZERO_WIDTH_SPACE), \"g\"), \"\").replace(new RegExp(\"\".concat(NON_BREAKING_SPACE), \"g\"), \" \");\nconst normalizeNewlines = string => string.replace(/\\r\\n/g, \"\\n\");\nconst breakableWhitespacePattern = new RegExp(\"[^\\\\S\".concat(NON_BREAKING_SPACE, \"]\"));\nconst squishBreakableWhitespace = string => string // Replace all breakable whitespace characters with a space\n.replace(new RegExp(\"\".concat(breakableWhitespacePattern.source), \"g\"), \" \") // Replace two or more spaces with a single space\n.replace(/\\ {2,}/g, \" \");\nconst summarizeStringChange = function (oldString, newString) {\n  let added, removed;\n  oldString = UTF16String.box(oldString);\n  newString = UTF16String.box(newString);\n\n  if (newString.length < oldString.length) {\n    [removed, added] = utf16StringDifferences(oldString, newString);\n  } else {\n    [added, removed] = utf16StringDifferences(newString, oldString);\n  }\n\n  return {\n    added,\n    removed\n  };\n};\n\nconst utf16StringDifferences = function (a, b) {\n  if (a.isEqualTo(b)) {\n    return [\"\", \"\"];\n  }\n\n  const diffA = utf16StringDifference(a, b);\n  const {\n    length\n  } = diffA.utf16String;\n  let diffB;\n\n  if (length) {\n    const {\n      offset\n    } = diffA;\n    const codepoints = a.codepoints.slice(0, offset).concat(a.codepoints.slice(offset + length));\n    diffB = utf16StringDifference(b, UTF16String.fromCodepoints(codepoints));\n  } else {\n    diffB = utf16StringDifference(b, a);\n  }\n\n  return [diffA.utf16String.toString(), diffB.utf16String.toString()];\n};\n\nconst utf16StringDifference = function (a, b) {\n  let leftIndex = 0;\n  let rightIndexA = a.length;\n  let rightIndexB = b.length;\n\n  while (leftIndex < rightIndexA && a.charAt(leftIndex).isEqualTo(b.charAt(leftIndex))) {\n    leftIndex++;\n  }\n\n  while (rightIndexA > leftIndex + 1 && a.charAt(rightIndexA - 1).isEqualTo(b.charAt(rightIndexB - 1))) {\n    rightIndexA--;\n    rightIndexB--;\n  }\n\n  return {\n    utf16String: a.slice(leftIndex, rightIndexA),\n    offset: leftIndex\n  };\n};\n\nclass Hash extends TrixObject {\n  static fromCommonAttributesOfObjects() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n    if (!objects.length) {\n      return new this();\n    }\n\n    let hash = box(objects[0]);\n    let keys = hash.getKeys();\n    objects.slice(1).forEach(object => {\n      keys = hash.getKeysCommonToHash(box(object));\n      hash = hash.slice(keys);\n    });\n    return hash;\n  }\n\n  static box(values) {\n    return box(values);\n  }\n\n  constructor() {\n    let values = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(...arguments);\n    this.values = copy(values);\n  }\n\n  add(key, value) {\n    return this.merge(object(key, value));\n  }\n\n  remove(key) {\n    return new Hash(copy(this.values, key));\n  }\n\n  get(key) {\n    return this.values[key];\n  }\n\n  has(key) {\n    return key in this.values;\n  }\n\n  merge(values) {\n    return new Hash(merge(this.values, unbox(values)));\n  }\n\n  slice(keys) {\n    const values = {};\n    keys.forEach(key => {\n      if (this.has(key)) {\n        values[key] = this.values[key];\n      }\n    });\n    return new Hash(values);\n  }\n\n  getKeys() {\n    return Object.keys(this.values);\n  }\n\n  getKeysCommonToHash(hash) {\n    hash = box(hash);\n    return this.getKeys().filter(key => this.values[key] === hash.values[key]);\n  }\n\n  isEqualTo(values) {\n    return arraysAreEqual(this.toArray(), box(values).toArray());\n  }\n\n  isEmpty() {\n    return this.getKeys().length === 0;\n  }\n\n  toArray() {\n    if (!this.array) {\n      const result = [];\n\n      for (const key in this.values) {\n        const value = this.values[key];\n        result.push(result.push(key, value));\n      }\n\n      this.array = result.slice(0);\n    }\n\n    return this.array;\n  }\n\n  toObject() {\n    return copy(this.values);\n  }\n\n  toJSON() {\n    return this.toObject();\n  }\n\n  contentsForInspection() {\n    return {\n      values: JSON.stringify(this.values)\n    };\n  }\n\n}\n\nconst object = function (key, value) {\n  const result = {};\n  result[key] = value;\n  return result;\n};\n\nconst merge = function (object, values) {\n  const result = copy(object);\n\n  for (const key in values) {\n    const value = values[key];\n    result[key] = value;\n  }\n\n  return result;\n};\n\nconst copy = function (object, keyToRemove) {\n  const result = {};\n  const sortedKeys = Object.keys(object).sort();\n  sortedKeys.forEach(key => {\n    if (key !== keyToRemove) {\n      result[key] = object[key];\n    }\n  });\n  return result;\n};\n\nconst box = function (object) {\n  if (object instanceof Hash) {\n    return object;\n  } else {\n    return new Hash(object);\n  }\n};\n\nconst unbox = function (object) {\n  if (object instanceof Hash) {\n    return object.values;\n  } else {\n    return object;\n  }\n};\n\nclass Operation extends BasicObject {\n  isPerforming() {\n    return this.performing === true;\n  }\n\n  hasPerformed() {\n    return this.performed === true;\n  }\n\n  hasSucceeded() {\n    return this.performed && this.succeeded;\n  }\n\n  hasFailed() {\n    return this.performed && !this.succeeded;\n  }\n\n  getPromise() {\n    if (!this.promise) {\n      this.promise = new Promise((resolve, reject) => {\n        this.performing = true;\n        return this.perform((succeeded, result) => {\n          this.succeeded = succeeded;\n          this.performing = false;\n          this.performed = true;\n\n          if (this.succeeded) {\n            resolve(result);\n          } else {\n            reject(result);\n          }\n        });\n      });\n    }\n\n    return this.promise;\n  }\n\n  perform(callback) {\n    return callback(false);\n  }\n\n  release() {\n    var _this$promise, _this$promise$cancel;\n\n    (_this$promise = this.promise) === null || _this$promise === void 0 ? void 0 : (_this$promise$cancel = _this$promise.cancel) === null || _this$promise$cancel === void 0 ? void 0 : _this$promise$cancel.call(_this$promise);\n    this.promise = null;\n    this.performing = null;\n    this.performed = null;\n    this.succeeded = null;\n  }\n\n}\nOperation.proxyMethod(\"getPromise().then\");\nOperation.proxyMethod(\"getPromise().catch\");\n\nclass ImagePreloadOperation extends Operation {\n  constructor(url) {\n    super(...arguments);\n    this.url = url;\n  }\n\n  perform(callback) {\n    const image = new Image();\n\n    image.onload = () => {\n      image.width = this.width = image.naturalWidth;\n      image.height = this.height = image.naturalHeight;\n      return callback(true, image);\n    };\n\n    image.onerror = () => callback(false);\n\n    image.src = this.url;\n  }\n\n}\n\nclass Attachment extends TrixObject {\n  static attachmentForFile(file) {\n    const attributes = this.attributesForFile(file);\n    const attachment = new this(attributes);\n    attachment.setFile(file);\n    return attachment;\n  }\n\n  static attributesForFile(file) {\n    return new Hash({\n      filename: file.name,\n      filesize: file.size,\n      contentType: file.type\n    });\n  }\n\n  static fromJSON(attachmentJSON) {\n    return new this(attachmentJSON);\n  }\n\n  constructor() {\n    let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(attributes);\n    this.releaseFile = this.releaseFile.bind(this);\n    this.attributes = Hash.box(attributes);\n    this.didChangeAttributes();\n  }\n\n  getAttribute(attribute) {\n    return this.attributes.get(attribute);\n  }\n\n  hasAttribute(attribute) {\n    return this.attributes.has(attribute);\n  }\n\n  getAttributes() {\n    return this.attributes.toObject();\n  }\n\n  setAttributes() {\n    let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const newAttributes = this.attributes.merge(attributes);\n\n    if (!this.attributes.isEqualTo(newAttributes)) {\n      var _this$previewDelegate, _this$previewDelegate2, _this$delegate, _this$delegate$attach;\n\n      this.attributes = newAttributes;\n      this.didChangeAttributes();\n      (_this$previewDelegate = this.previewDelegate) === null || _this$previewDelegate === void 0 ? void 0 : (_this$previewDelegate2 = _this$previewDelegate.attachmentDidChangeAttributes) === null || _this$previewDelegate2 === void 0 ? void 0 : _this$previewDelegate2.call(_this$previewDelegate, this);\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentDidChangeAttributes) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, this);\n    }\n  }\n\n  didChangeAttributes() {\n    if (this.isPreviewable()) {\n      return this.preloadURL();\n    }\n  }\n\n  isPending() {\n    return this.file != null && !(this.getURL() || this.getHref());\n  }\n\n  isPreviewable() {\n    if (this.attributes.has(\"previewable\")) {\n      return this.attributes.get(\"previewable\");\n    } else {\n      return Attachment.previewablePattern.test(this.getContentType());\n    }\n  }\n\n  getType() {\n    if (this.hasContent()) {\n      return \"content\";\n    } else if (this.isPreviewable()) {\n      return \"preview\";\n    } else {\n      return \"file\";\n    }\n  }\n\n  getURL() {\n    return this.attributes.get(\"url\");\n  }\n\n  getHref() {\n    return this.attributes.get(\"href\");\n  }\n\n  getFilename() {\n    return this.attributes.get(\"filename\") || \"\";\n  }\n\n  getFilesize() {\n    return this.attributes.get(\"filesize\");\n  }\n\n  getFormattedFilesize() {\n    const filesize = this.attributes.get(\"filesize\");\n\n    if (typeof filesize === \"number\") {\n      return config.fileSize.formatter(filesize);\n    } else {\n      return \"\";\n    }\n  }\n\n  getExtension() {\n    var _this$getFilename$mat;\n\n    return (_this$getFilename$mat = this.getFilename().match(/\\.(\\w+)$/)) === null || _this$getFilename$mat === void 0 ? void 0 : _this$getFilename$mat[1].toLowerCase();\n  }\n\n  getContentType() {\n    return this.attributes.get(\"contentType\");\n  }\n\n  hasContent() {\n    return this.attributes.has(\"content\");\n  }\n\n  getContent() {\n    return this.attributes.get(\"content\");\n  }\n\n  getWidth() {\n    return this.attributes.get(\"width\");\n  }\n\n  getHeight() {\n    return this.attributes.get(\"height\");\n  }\n\n  getFile() {\n    return this.file;\n  }\n\n  setFile(file) {\n    this.file = file;\n\n    if (this.isPreviewable()) {\n      return this.preloadFile();\n    }\n  }\n\n  releaseFile() {\n    this.releasePreloadedFile();\n    this.file = null;\n  }\n\n  getUploadProgress() {\n    return this.uploadProgress != null ? this.uploadProgress : 0;\n  }\n\n  setUploadProgress(value) {\n    if (this.uploadProgress !== value) {\n      var _this$uploadProgressD, _this$uploadProgressD2;\n\n      this.uploadProgress = value;\n      return (_this$uploadProgressD = this.uploadProgressDelegate) === null || _this$uploadProgressD === void 0 ? void 0 : (_this$uploadProgressD2 = _this$uploadProgressD.attachmentDidChangeUploadProgress) === null || _this$uploadProgressD2 === void 0 ? void 0 : _this$uploadProgressD2.call(_this$uploadProgressD, this);\n    }\n  }\n\n  toJSON() {\n    return this.getAttributes();\n  }\n\n  getCacheKey() {\n    return [super.getCacheKey(...arguments), this.attributes.getCacheKey(), this.getPreviewURL()].join(\"/\");\n  } // Previewable\n\n\n  getPreviewURL() {\n    return this.previewURL || this.preloadingURL;\n  }\n\n  setPreviewURL(url) {\n    if (url !== this.getPreviewURL()) {\n      var _this$previewDelegate3, _this$previewDelegate4, _this$delegate2, _this$delegate2$attac;\n\n      this.previewURL = url;\n      (_this$previewDelegate3 = this.previewDelegate) === null || _this$previewDelegate3 === void 0 ? void 0 : (_this$previewDelegate4 = _this$previewDelegate3.attachmentDidChangeAttributes) === null || _this$previewDelegate4 === void 0 ? void 0 : _this$previewDelegate4.call(_this$previewDelegate3, this);\n      return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentDidChangePreviewURL) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, this);\n    }\n  }\n\n  preloadURL() {\n    return this.preload(this.getURL(), this.releaseFile);\n  }\n\n  preloadFile() {\n    if (this.file) {\n      this.fileObjectURL = URL.createObjectURL(this.file);\n      return this.preload(this.fileObjectURL);\n    }\n  }\n\n  releasePreloadedFile() {\n    if (this.fileObjectURL) {\n      URL.revokeObjectURL(this.fileObjectURL);\n      this.fileObjectURL = null;\n    }\n  }\n\n  preload(url, callback) {\n    if (url && url !== this.getPreviewURL()) {\n      this.preloadingURL = url;\n      const operation = new ImagePreloadOperation(url);\n      return operation.then(_ref => {\n        let {\n          width,\n          height\n        } = _ref;\n\n        if (!this.getWidth() || !this.getHeight()) {\n          this.setAttributes({\n            width,\n            height\n          });\n        }\n\n        this.preloadingURL = null;\n        this.setPreviewURL(url);\n        return callback === null || callback === void 0 ? void 0 : callback();\n      }).catch(() => {\n        this.preloadingURL = null;\n        return callback === null || callback === void 0 ? void 0 : callback();\n      });\n    }\n  }\n\n}\n\n_defineProperty(Attachment, \"previewablePattern\", /^image(\\/(gif|png|jpe?g)|$)/);\n\nclass ManagedAttachment extends BasicObject {\n  constructor(attachmentManager, attachment) {\n    super(...arguments);\n    this.attachmentManager = attachmentManager;\n    this.attachment = attachment;\n    this.id = this.attachment.id;\n    this.file = this.attachment.file;\n  }\n\n  remove() {\n    return this.attachmentManager.requestRemovalOfAttachment(this.attachment);\n  }\n\n}\nManagedAttachment.proxyMethod(\"attachment.getAttribute\");\nManagedAttachment.proxyMethod(\"attachment.hasAttribute\");\nManagedAttachment.proxyMethod(\"attachment.setAttribute\");\nManagedAttachment.proxyMethod(\"attachment.getAttributes\");\nManagedAttachment.proxyMethod(\"attachment.setAttributes\");\nManagedAttachment.proxyMethod(\"attachment.isPending\");\nManagedAttachment.proxyMethod(\"attachment.isPreviewable\");\nManagedAttachment.proxyMethod(\"attachment.getURL\");\nManagedAttachment.proxyMethod(\"attachment.getHref\");\nManagedAttachment.proxyMethod(\"attachment.getFilename\");\nManagedAttachment.proxyMethod(\"attachment.getFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getFormattedFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getExtension\");\nManagedAttachment.proxyMethod(\"attachment.getContentType\");\nManagedAttachment.proxyMethod(\"attachment.getFile\");\nManagedAttachment.proxyMethod(\"attachment.setFile\");\nManagedAttachment.proxyMethod(\"attachment.releaseFile\");\nManagedAttachment.proxyMethod(\"attachment.getUploadProgress\");\nManagedAttachment.proxyMethod(\"attachment.setUploadProgress\");\n\nclass AttachmentManager extends BasicObject {\n  constructor() {\n    let attachments = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.managedAttachments = {};\n    Array.from(attachments).forEach(attachment => {\n      this.manageAttachment(attachment);\n    });\n  }\n\n  getAttachments() {\n    const result = [];\n\n    for (const id in this.managedAttachments) {\n      const attachment = this.managedAttachments[id];\n      result.push(attachment);\n    }\n\n    return result;\n  }\n\n  manageAttachment(attachment) {\n    if (!this.managedAttachments[attachment.id]) {\n      this.managedAttachments[attachment.id] = new ManagedAttachment(this, attachment);\n    }\n\n    return this.managedAttachments[attachment.id];\n  }\n\n  attachmentIsManaged(attachment) {\n    return attachment.id in this.managedAttachments;\n  }\n\n  requestRemovalOfAttachment(attachment) {\n    if (this.attachmentIsManaged(attachment)) {\n      var _this$delegate, _this$delegate$attach;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentManagerDidRequestRemovalOfAttachment) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, attachment);\n    }\n  }\n\n  unmanageAttachment(attachment) {\n    const managedAttachment = this.managedAttachments[attachment.id];\n    delete this.managedAttachments[attachment.id];\n    return managedAttachment;\n  }\n\n}\n\nclass Piece extends TrixObject {\n  static registerType(type, constructor) {\n    constructor.type = type;\n    this.types[type] = constructor;\n  }\n\n  static fromJSON(pieceJSON) {\n    const constructor = this.types[pieceJSON.type];\n\n    if (constructor) {\n      return constructor.fromJSON(pieceJSON);\n    }\n  }\n\n  constructor(value) {\n    let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.attributes = Hash.box(attributes);\n  }\n\n  copyWithAttributes(attributes) {\n    return new this.constructor(this.getValue(), attributes);\n  }\n\n  copyWithAdditionalAttributes(attributes) {\n    return this.copyWithAttributes(this.attributes.merge(attributes));\n  }\n\n  copyWithoutAttribute(attribute) {\n    return this.copyWithAttributes(this.attributes.remove(attribute));\n  }\n\n  copy() {\n    return this.copyWithAttributes(this.attributes);\n  }\n\n  getAttribute(attribute) {\n    return this.attributes.get(attribute);\n  }\n\n  getAttributesHash() {\n    return this.attributes;\n  }\n\n  getAttributes() {\n    return this.attributes.toObject();\n  }\n\n  hasAttribute(attribute) {\n    return this.attributes.has(attribute);\n  }\n\n  hasSameStringValueAsPiece(piece) {\n    return piece && this.toString() === piece.toString();\n  }\n\n  hasSameAttributesAsPiece(piece) {\n    return piece && (this.attributes === piece.attributes || this.attributes.isEqualTo(piece.attributes));\n  }\n\n  isBlockBreak() {\n    return false;\n  }\n\n  isEqualTo(piece) {\n    return super.isEqualTo(...arguments) || this.hasSameConstructorAs(piece) && this.hasSameStringValueAsPiece(piece) && this.hasSameAttributesAsPiece(piece);\n  }\n\n  isEmpty() {\n    return this.length === 0;\n  }\n\n  isSerializable() {\n    return true;\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.type,\n      attributes: this.getAttributes()\n    };\n  }\n\n  contentsForInspection() {\n    return {\n      type: this.constructor.type,\n      attributes: this.attributes.inspect()\n    };\n  } // Grouping\n\n\n  canBeGrouped() {\n    return this.hasAttribute(\"href\");\n  }\n\n  canBeGroupedWith(piece) {\n    return this.getAttribute(\"href\") === piece.getAttribute(\"href\");\n  } // Splittable\n\n\n  getLength() {\n    return this.length;\n  }\n\n  canBeConsolidatedWith(piece) {\n    return false;\n  }\n\n}\n\n_defineProperty(Piece, \"types\", {});\n\nclass AttachmentPiece extends Piece {\n  static fromJSON(pieceJSON) {\n    return new this(Attachment.fromJSON(pieceJSON.attachment), pieceJSON.attributes);\n  }\n\n  constructor(attachment) {\n    super(...arguments);\n    this.attachment = attachment;\n    this.length = 1;\n    this.ensureAttachmentExclusivelyHasAttribute(\"href\");\n\n    if (!this.attachment.hasContent()) {\n      this.removeProhibitedAttributes();\n    }\n  }\n\n  ensureAttachmentExclusivelyHasAttribute(attribute) {\n    if (this.hasAttribute(attribute)) {\n      if (!this.attachment.hasAttribute(attribute)) {\n        this.attachment.setAttributes(this.attributes.slice(attribute));\n      }\n\n      this.attributes = this.attributes.remove(attribute);\n    }\n  }\n\n  removeProhibitedAttributes() {\n    const attributes = this.attributes.slice(AttachmentPiece.permittedAttributes);\n\n    if (!attributes.isEqualTo(this.attributes)) {\n      this.attributes = attributes;\n    }\n  }\n\n  getValue() {\n    return this.attachment;\n  }\n\n  isSerializable() {\n    return !this.attachment.isPending();\n  }\n\n  getCaption() {\n    return this.attributes.get(\"caption\") || \"\";\n  }\n\n  isEqualTo(piece) {\n    var _piece$attachment;\n\n    return super.isEqualTo(piece) && this.attachment.id === (piece === null || piece === void 0 ? void 0 : (_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id);\n  }\n\n  toString() {\n    return OBJECT_REPLACEMENT_CHARACTER;\n  }\n\n  toJSON() {\n    const json = super.toJSON(...arguments);\n    json.attachment = this.attachment;\n    return json;\n  }\n\n  getCacheKey() {\n    return [super.getCacheKey(...arguments), this.attachment.getCacheKey()].join(\"/\");\n  }\n\n  toConsole() {\n    return JSON.stringify(this.toString());\n  }\n\n}\n\n_defineProperty(AttachmentPiece, \"permittedAttributes\", [\"caption\", \"presentation\"]);\n\nPiece.registerType(\"attachment\", AttachmentPiece);\n\nclass StringPiece extends Piece {\n  static fromJSON(pieceJSON) {\n    return new this(pieceJSON.string, pieceJSON.attributes);\n  }\n\n  constructor(string) {\n    super(...arguments);\n    this.string = normalizeNewlines(string);\n    this.length = this.string.length;\n  }\n\n  getValue() {\n    return this.string;\n  }\n\n  toString() {\n    return this.string.toString();\n  }\n\n  isBlockBreak() {\n    return this.toString() === \"\\n\" && this.getAttribute(\"blockBreak\") === true;\n  }\n\n  toJSON() {\n    const result = super.toJSON(...arguments);\n    result.string = this.string;\n    return result;\n  } // Splittable\n\n\n  canBeConsolidatedWith(piece) {\n    return piece && this.hasSameConstructorAs(piece) && this.hasSameAttributesAsPiece(piece);\n  }\n\n  consolidateWith(piece) {\n    return new this.constructor(this.toString() + piece.toString(), this.attributes);\n  }\n\n  splitAtOffset(offset) {\n    let left, right;\n\n    if (offset === 0) {\n      left = null;\n      right = this;\n    } else if (offset === this.length) {\n      left = this;\n      right = null;\n    } else {\n      left = new this.constructor(this.string.slice(0, offset), this.attributes);\n      right = new this.constructor(this.string.slice(offset), this.attributes);\n    }\n\n    return [left, right];\n  }\n\n  toConsole() {\n    let {\n      string\n    } = this;\n\n    if (string.length > 15) {\n      string = string.slice(0, 14) + \"…\";\n    }\n\n    return JSON.stringify(string.toString());\n  }\n\n}\nPiece.registerType(\"string\", StringPiece);\n\n/* eslint-disable\n    prefer-const,\n*/\nclass SplittableList extends TrixObject {\n  static box(objects) {\n    if (objects instanceof this) {\n      return objects;\n    } else {\n      return new this(objects);\n    }\n  }\n\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.objects = objects.slice(0);\n    this.length = this.objects.length;\n  }\n\n  indexOf(object) {\n    return this.objects.indexOf(object);\n  }\n\n  splice() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return new this.constructor(spliceArray(this.objects, ...args));\n  }\n\n  eachObject(callback) {\n    return this.objects.map((object, index) => callback(object, index));\n  }\n\n  insertObjectAtIndex(object, index) {\n    return this.splice(index, 0, object);\n  }\n\n  insertSplittableListAtIndex(splittableList, index) {\n    return this.splice(index, 0, ...splittableList.objects);\n  }\n\n  insertSplittableListAtPosition(splittableList, position) {\n    const [objects, index] = this.splitObjectAtPosition(position);\n    return new this.constructor(objects).insertSplittableListAtIndex(splittableList, index);\n  }\n\n  editObjectAtIndex(index, callback) {\n    return this.replaceObjectAtIndex(callback(this.objects[index]), index);\n  }\n\n  replaceObjectAtIndex(object, index) {\n    return this.splice(index, 1, object);\n  }\n\n  removeObjectAtIndex(index) {\n    return this.splice(index, 1);\n  }\n\n  getObjectAtIndex(index) {\n    return this.objects[index];\n  }\n\n  getSplittableListInRange(range) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    return new this.constructor(objects.slice(leftIndex, rightIndex + 1));\n  }\n\n  selectSplittableList(test) {\n    const objects = this.objects.filter(object => test(object));\n    return new this.constructor(objects);\n  }\n\n  removeObjectsInRange(range) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    return new this.constructor(objects).splice(leftIndex, rightIndex - leftIndex + 1);\n  }\n\n  transformObjectsInRange(range, transform) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    const transformedObjects = objects.map((object, index) => leftIndex <= index && index <= rightIndex ? transform(object) : object);\n    return new this.constructor(transformedObjects);\n  }\n\n  splitObjectsAtRange(range) {\n    let rightOuterIndex;\n    let [objects, leftInnerIndex, offset] = this.splitObjectAtPosition(startOfRange(range));\n    [objects, rightOuterIndex] = new this.constructor(objects).splitObjectAtPosition(endOfRange(range) + offset);\n    return [objects, leftInnerIndex, rightOuterIndex - 1];\n  }\n\n  getObjectAtPosition(position) {\n    const {\n      index\n    } = this.findIndexAndOffsetAtPosition(position);\n    return this.objects[index];\n  }\n\n  splitObjectAtPosition(position) {\n    let splitIndex, splitOffset;\n    const {\n      index,\n      offset\n    } = this.findIndexAndOffsetAtPosition(position);\n    const objects = this.objects.slice(0);\n\n    if (index != null) {\n      if (offset === 0) {\n        splitIndex = index;\n        splitOffset = 0;\n      } else {\n        const object = this.getObjectAtIndex(index);\n        const [leftObject, rightObject] = object.splitAtOffset(offset);\n        objects.splice(index, 1, leftObject, rightObject);\n        splitIndex = index + 1;\n        splitOffset = leftObject.getLength() - offset;\n      }\n    } else {\n      splitIndex = objects.length;\n      splitOffset = 0;\n    }\n\n    return [objects, splitIndex, splitOffset];\n  }\n\n  consolidate() {\n    const objects = [];\n    let pendingObject = this.objects[0];\n    this.objects.slice(1).forEach(object => {\n      var _pendingObject$canBeC, _pendingObject;\n\n      if ((_pendingObject$canBeC = (_pendingObject = pendingObject).canBeConsolidatedWith) !== null && _pendingObject$canBeC !== void 0 && _pendingObject$canBeC.call(_pendingObject, object)) {\n        pendingObject = pendingObject.consolidateWith(object);\n      } else {\n        objects.push(pendingObject);\n        pendingObject = object;\n      }\n    });\n\n    if (pendingObject) {\n      objects.push(pendingObject);\n    }\n\n    return new this.constructor(objects);\n  }\n\n  consolidateFromIndexToIndex(startIndex, endIndex) {\n    const objects = this.objects.slice(0);\n    const objectsInRange = objects.slice(startIndex, endIndex + 1);\n    const consolidatedInRange = new this.constructor(objectsInRange).consolidate().toArray();\n    return this.splice(startIndex, objectsInRange.length, ...consolidatedInRange);\n  }\n\n  findIndexAndOffsetAtPosition(position) {\n    let index;\n    let currentPosition = 0;\n\n    for (index = 0; index < this.objects.length; index++) {\n      const object = this.objects[index];\n      const nextPosition = currentPosition + object.getLength();\n\n      if (currentPosition <= position && position < nextPosition) {\n        return {\n          index,\n          offset: position - currentPosition\n        };\n      }\n\n      currentPosition = nextPosition;\n    }\n\n    return {\n      index: null,\n      offset: null\n    };\n  }\n\n  findPositionAtIndexAndOffset(index, offset) {\n    let position = 0;\n\n    for (let currentIndex = 0; currentIndex < this.objects.length; currentIndex++) {\n      const object = this.objects[currentIndex];\n\n      if (currentIndex < index) {\n        position += object.getLength();\n      } else if (currentIndex === index) {\n        position += offset;\n        break;\n      }\n    }\n\n    return position;\n  }\n\n  getEndPosition() {\n    if (this.endPosition == null) {\n      this.endPosition = 0;\n      this.objects.forEach(object => this.endPosition += object.getLength());\n    }\n\n    return this.endPosition;\n  }\n\n  toString() {\n    return this.objects.join(\"\");\n  }\n\n  toArray() {\n    return this.objects.slice(0);\n  }\n\n  toJSON() {\n    return this.toArray();\n  }\n\n  isEqualTo(splittableList) {\n    return super.isEqualTo(...arguments) || objectArraysAreEqual(this.objects, splittableList === null || splittableList === void 0 ? void 0 : splittableList.objects);\n  }\n\n  contentsForInspection() {\n    return {\n      objects: \"[\".concat(this.objects.map(object => object.inspect()).join(\", \"), \"]\")\n    };\n  }\n\n}\n\nconst objectArraysAreEqual = function (left) {\n  let right = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (left.length !== right.length) {\n    return false;\n  }\n\n  let result = true;\n\n  for (let index = 0; index < left.length; index++) {\n    const object = left[index];\n\n    if (result && !object.isEqualTo(right[index])) {\n      result = false;\n    }\n  }\n\n  return result;\n};\n\nconst startOfRange = range => range[0];\n\nconst endOfRange = range => range[1];\n\nclass Text extends TrixObject {\n  static textForAttachmentWithAttributes(attachment, attributes) {\n    const piece = new AttachmentPiece(attachment, attributes);\n    return new this([piece]);\n  }\n\n  static textForStringWithAttributes(string, attributes) {\n    const piece = new StringPiece(string, attributes);\n    return new this([piece]);\n  }\n\n  static fromJSON(textJSON) {\n    const pieces = Array.from(textJSON).map(pieceJSON => Piece.fromJSON(pieceJSON));\n    return new this(pieces);\n  }\n\n  constructor() {\n    let pieces = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    const notEmpty = pieces.filter(piece => !piece.isEmpty());\n    this.pieceList = new SplittableList(notEmpty);\n  }\n\n  copy() {\n    return this.copyWithPieceList(this.pieceList);\n  }\n\n  copyWithPieceList(pieceList) {\n    return new this.constructor(pieceList.consolidate().toArray());\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const pieces = this.getPieces().map(piece => objectMap.find(piece) || piece);\n    return new this.constructor(pieces);\n  }\n\n  appendText(text) {\n    return this.insertTextAtPosition(text, this.getLength());\n  }\n\n  insertTextAtPosition(text, position) {\n    return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(text.pieceList, position));\n  }\n\n  removeTextAtRange(range) {\n    return this.copyWithPieceList(this.pieceList.removeObjectsInRange(range));\n  }\n\n  replaceTextAtRange(text, range) {\n    return this.removeTextAtRange(range).insertTextAtPosition(text, range[0]);\n  }\n\n  moveTextFromRangeToPosition(range, position) {\n    if (range[0] <= position && position <= range[1]) return;\n    const text = this.getTextAtRange(range);\n    const length = text.getLength();\n\n    if (range[0] < position) {\n      position -= length;\n    }\n\n    return this.removeTextAtRange(range).insertTextAtPosition(text, position);\n  }\n\n  addAttributeAtRange(attribute, value, range) {\n    const attributes = {};\n    attributes[attribute] = value;\n    return this.addAttributesAtRange(attributes, range);\n  }\n\n  addAttributesAtRange(attributes, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithAdditionalAttributes(attributes)));\n  }\n\n  removeAttributeAtRange(attribute, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithoutAttribute(attribute)));\n  }\n\n  setAttributesAtRange(attributes, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithAttributes(attributes)));\n  }\n\n  getAttributesAtPosition(position) {\n    var _this$pieceList$getOb;\n\n    return ((_this$pieceList$getOb = this.pieceList.getObjectAtPosition(position)) === null || _this$pieceList$getOb === void 0 ? void 0 : _this$pieceList$getOb.getAttributes()) || {};\n  }\n\n  getCommonAttributes() {\n    const objects = Array.from(this.pieceList.toArray()).map(piece => piece.getAttributes());\n    return Hash.fromCommonAttributesOfObjects(objects).toObject();\n  }\n\n  getCommonAttributesAtRange(range) {\n    return this.getTextAtRange(range).getCommonAttributes() || {};\n  }\n\n  getExpandedRangeForAttributeAtOffset(attributeName, offset) {\n    let right;\n    let left = right = offset;\n    const length = this.getLength();\n\n    while (left > 0 && this.getCommonAttributesAtRange([left - 1, right])[attributeName]) {\n      left--;\n    }\n\n    while (right < length && this.getCommonAttributesAtRange([offset, right + 1])[attributeName]) {\n      right++;\n    }\n\n    return [left, right];\n  }\n\n  getTextAtRange(range) {\n    return this.copyWithPieceList(this.pieceList.getSplittableListInRange(range));\n  }\n\n  getStringAtRange(range) {\n    return this.pieceList.getSplittableListInRange(range).toString();\n  }\n\n  getStringAtPosition(position) {\n    return this.getStringAtRange([position, position + 1]);\n  }\n\n  startsWithString(string) {\n    return this.getStringAtRange([0, string.length]) === string;\n  }\n\n  endsWithString(string) {\n    const length = this.getLength();\n    return this.getStringAtRange([length - string.length, length]) === string;\n  }\n\n  getAttachmentPieces() {\n    return this.pieceList.toArray().filter(piece => !!piece.attachment);\n  }\n\n  getAttachments() {\n    return this.getAttachmentPieces().map(piece => piece.attachment);\n  }\n\n  getAttachmentAndPositionById(attachmentId) {\n    let position = 0;\n\n    for (const piece of this.pieceList.toArray()) {\n      var _piece$attachment;\n\n      if (((_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id) === attachmentId) {\n        return {\n          attachment: piece.attachment,\n          position\n        };\n      }\n\n      position += piece.length;\n    }\n\n    return {\n      attachment: null,\n      position: null\n    };\n  }\n\n  getAttachmentById(attachmentId) {\n    const {\n      attachment\n    } = this.getAttachmentAndPositionById(attachmentId);\n    return attachment;\n  }\n\n  getRangeOfAttachment(attachment) {\n    const attachmentAndPosition = this.getAttachmentAndPositionById(attachment.id);\n    const position = attachmentAndPosition.position;\n    attachment = attachmentAndPosition.attachment;\n\n    if (attachment) {\n      return [position, position + 1];\n    }\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n\n    if (range) {\n      return this.addAttributesAtRange(attributes, range);\n    } else {\n      return this;\n    }\n  }\n\n  getLength() {\n    return this.pieceList.getEndPosition();\n  }\n\n  isEmpty() {\n    return this.getLength() === 0;\n  }\n\n  isEqualTo(text) {\n    var _text$pieceList;\n\n    return super.isEqualTo(text) || (text === null || text === void 0 ? void 0 : (_text$pieceList = text.pieceList) === null || _text$pieceList === void 0 ? void 0 : _text$pieceList.isEqualTo(this.pieceList));\n  }\n\n  isBlockBreak() {\n    return this.getLength() === 1 && this.pieceList.getObjectAtIndex(0).isBlockBreak();\n  }\n\n  eachPiece(callback) {\n    return this.pieceList.eachObject(callback);\n  }\n\n  getPieces() {\n    return this.pieceList.toArray();\n  }\n\n  getPieceAtPosition(position) {\n    return this.pieceList.getObjectAtPosition(position);\n  }\n\n  contentsForInspection() {\n    return {\n      pieceList: this.pieceList.inspect()\n    };\n  }\n\n  toSerializableText() {\n    const pieceList = this.pieceList.selectSplittableList(piece => piece.isSerializable());\n    return this.copyWithPieceList(pieceList);\n  }\n\n  toString() {\n    return this.pieceList.toString();\n  }\n\n  toJSON() {\n    return this.pieceList.toJSON();\n  }\n\n  toConsole() {\n    return JSON.stringify(this.pieceList.toArray().map(piece => JSON.parse(piece.toConsole())));\n  } // BIDI\n\n\n  getDirection() {\n    return getDirection(this.toString());\n  }\n\n  isRTL() {\n    return this.getDirection() === \"rtl\";\n  }\n\n}\n\nclass Block extends TrixObject {\n  static fromJSON(blockJSON) {\n    const text = Text.fromJSON(blockJSON.text);\n    return new this(text, blockJSON.attributes);\n  }\n\n  constructor(text, attributes) {\n    super(...arguments);\n    this.text = applyBlockBreakToText(text || new Text());\n    this.attributes = attributes || [];\n  }\n\n  isEmpty() {\n    return this.text.isBlockBreak();\n  }\n\n  isEqualTo(block) {\n    if (super.isEqualTo(block)) return true;\n    return this.text.isEqualTo(block === null || block === void 0 ? void 0 : block.text) && arraysAreEqual(this.attributes, block === null || block === void 0 ? void 0 : block.attributes);\n  }\n\n  copyWithText(text) {\n    return new Block(text, this.attributes);\n  }\n\n  copyWithoutText() {\n    return this.copyWithText(null);\n  }\n\n  copyWithAttributes(attributes) {\n    return new Block(this.text, attributes);\n  }\n\n  copyWithoutAttributes() {\n    return this.copyWithAttributes(null);\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const mappedText = objectMap.find(this.text);\n\n    if (mappedText) {\n      return this.copyWithText(mappedText);\n    } else {\n      return this.copyWithText(this.text.copyUsingObjectMap(objectMap));\n    }\n  }\n\n  addAttribute(attribute) {\n    const attributes = this.attributes.concat(expandAttribute(attribute));\n    return this.copyWithAttributes(attributes);\n  }\n\n  removeAttribute(attribute) {\n    const {\n      listAttribute\n    } = getBlockConfig(attribute);\n    const attributes = removeLastValue(removeLastValue(this.attributes, attribute), listAttribute);\n    return this.copyWithAttributes(attributes);\n  }\n\n  removeLastAttribute() {\n    return this.removeAttribute(this.getLastAttribute());\n  }\n\n  getLastAttribute() {\n    return getLastElement(this.attributes);\n  }\n\n  getAttributes() {\n    return this.attributes.slice(0);\n  }\n\n  getAttributeLevel() {\n    return this.attributes.length;\n  }\n\n  getAttributeAtLevel(level) {\n    return this.attributes[level - 1];\n  }\n\n  hasAttribute(attributeName) {\n    return this.attributes.includes(attributeName);\n  }\n\n  hasAttributes() {\n    return this.getAttributeLevel() > 0;\n  }\n\n  getLastNestableAttribute() {\n    return getLastElement(this.getNestableAttributes());\n  }\n\n  getNestableAttributes() {\n    return this.attributes.filter(attribute => getBlockConfig(attribute).nestable);\n  }\n\n  getNestingLevel() {\n    return this.getNestableAttributes().length;\n  }\n\n  decreaseNestingLevel() {\n    const attribute = this.getLastNestableAttribute();\n\n    if (attribute) {\n      return this.removeAttribute(attribute);\n    } else {\n      return this;\n    }\n  }\n\n  increaseNestingLevel() {\n    const attribute = this.getLastNestableAttribute();\n\n    if (attribute) {\n      const index = this.attributes.lastIndexOf(attribute);\n      const attributes = spliceArray(this.attributes, index + 1, 0, ...expandAttribute(attribute));\n      return this.copyWithAttributes(attributes);\n    } else {\n      return this;\n    }\n  }\n\n  getListItemAttributes() {\n    return this.attributes.filter(attribute => getBlockConfig(attribute).listAttribute);\n  }\n\n  isListItem() {\n    var _getBlockConfig;\n\n    return (_getBlockConfig = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.listAttribute;\n  }\n\n  isTerminalBlock() {\n    var _getBlockConfig2;\n\n    return (_getBlockConfig2 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig2 === void 0 ? void 0 : _getBlockConfig2.terminal;\n  }\n\n  breaksOnReturn() {\n    var _getBlockConfig3;\n\n    return (_getBlockConfig3 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig3 === void 0 ? void 0 : _getBlockConfig3.breakOnReturn;\n  }\n\n  findLineBreakInDirectionFromPosition(direction, position) {\n    const string = this.toString();\n    let result;\n\n    switch (direction) {\n      case \"forward\":\n        result = string.indexOf(\"\\n\", position);\n        break;\n\n      case \"backward\":\n        result = string.slice(0, position).lastIndexOf(\"\\n\");\n    }\n\n    if (result !== -1) {\n      return result;\n    }\n  }\n\n  contentsForInspection() {\n    return {\n      text: this.text.inspect(),\n      attributes: this.attributes\n    };\n  }\n\n  toString() {\n    return this.text.toString();\n  }\n\n  toJSON() {\n    return {\n      text: this.text,\n      attributes: this.attributes\n    };\n  } // BIDI\n\n\n  getDirection() {\n    return this.text.getDirection();\n  }\n\n  isRTL() {\n    return this.text.isRTL();\n  } // Splittable\n\n\n  getLength() {\n    return this.text.getLength();\n  }\n\n  canBeConsolidatedWith(block) {\n    return !this.hasAttributes() && !block.hasAttributes() && this.getDirection() === block.getDirection();\n  }\n\n  consolidateWith(block) {\n    const newlineText = Text.textForStringWithAttributes(\"\\n\");\n    const text = this.getTextWithoutBlockBreak().appendText(newlineText);\n    return this.copyWithText(text.appendText(block.text));\n  }\n\n  splitAtOffset(offset) {\n    let left, right;\n\n    if (offset === 0) {\n      left = null;\n      right = this;\n    } else if (offset === this.getLength()) {\n      left = this;\n      right = null;\n    } else {\n      left = this.copyWithText(this.text.getTextAtRange([0, offset]));\n      right = this.copyWithText(this.text.getTextAtRange([offset, this.getLength()]));\n    }\n\n    return [left, right];\n  }\n\n  getBlockBreakPosition() {\n    return this.text.getLength() - 1;\n  }\n\n  getTextWithoutBlockBreak() {\n    if (textEndsInBlockBreak(this.text)) {\n      return this.text.getTextAtRange([0, this.getBlockBreakPosition()]);\n    } else {\n      return this.text.copy();\n    }\n  } // Grouping\n\n\n  canBeGrouped(depth) {\n    return this.attributes[depth];\n  }\n\n  canBeGroupedWith(otherBlock, depth) {\n    const otherAttributes = otherBlock.getAttributes();\n    const otherAttribute = otherAttributes[depth];\n    const attribute = this.attributes[depth];\n    return attribute === otherAttribute && !(getBlockConfig(attribute).group === false && !getListAttributeNames().includes(otherAttributes[depth + 1])) && (this.getDirection() === otherBlock.getDirection() || otherBlock.isEmpty());\n  }\n\n} // Block breaks\n\nconst applyBlockBreakToText = function (text) {\n  text = unmarkExistingInnerBlockBreaksInText(text);\n  text = addBlockBreakToText(text);\n  return text;\n};\n\nconst unmarkExistingInnerBlockBreaksInText = function (text) {\n  let modified = false;\n  const pieces = text.getPieces();\n  let innerPieces = pieces.slice(0, pieces.length - 1);\n  const lastPiece = pieces[pieces.length - 1];\n  if (!lastPiece) return text;\n  innerPieces = innerPieces.map(piece => {\n    if (piece.isBlockBreak()) {\n      modified = true;\n      return unmarkBlockBreakPiece(piece);\n    } else {\n      return piece;\n    }\n  });\n\n  if (modified) {\n    return new Text([...innerPieces, lastPiece]);\n  } else {\n    return text;\n  }\n};\n\nconst blockBreakText = Text.textForStringWithAttributes(\"\\n\", {\n  blockBreak: true\n});\n\nconst addBlockBreakToText = function (text) {\n  if (textEndsInBlockBreak(text)) {\n    return text;\n  } else {\n    return text.appendText(blockBreakText);\n  }\n};\n\nconst textEndsInBlockBreak = function (text) {\n  const length = text.getLength();\n\n  if (length === 0) {\n    return false;\n  }\n\n  const endText = text.getTextAtRange([length - 1, length]);\n  return endText.isBlockBreak();\n};\n\nconst unmarkBlockBreakPiece = piece => piece.copyWithoutAttribute(\"blockBreak\"); // Attributes\n\n\nconst expandAttribute = function (attribute) {\n  const {\n    listAttribute\n  } = getBlockConfig(attribute);\n\n  if (listAttribute) {\n    return [listAttribute, attribute];\n  } else {\n    return [attribute];\n  }\n}; // Array helpers\n\n\nconst getLastElement = array => array.slice(-1)[0];\n\nconst removeLastValue = function (array, value) {\n  const index = array.lastIndexOf(value);\n\n  if (index === -1) {\n    return array;\n  } else {\n    return spliceArray(array, index, 1);\n  }\n};\n\nclass ObjectMap extends BasicObject {\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.objects = {};\n    Array.from(objects).forEach(object => {\n      const hash = JSON.stringify(object);\n\n      if (this.objects[hash] == null) {\n        this.objects[hash] = object;\n      }\n    });\n  }\n\n  find(object) {\n    const hash = JSON.stringify(object);\n    return this.objects[hash];\n  }\n\n}\n\nclass Document extends TrixObject {\n  static fromJSON(documentJSON) {\n    const blocks = Array.from(documentJSON).map(blockJSON => Block.fromJSON(blockJSON));\n    return new this(blocks);\n  }\n\n  static fromString(string, textAttributes) {\n    const text = Text.textForStringWithAttributes(string, textAttributes);\n    return new this([new Block(text)]);\n  }\n\n  constructor() {\n    let blocks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n\n    if (blocks.length === 0) {\n      blocks = [new Block()];\n    }\n\n    this.blockList = SplittableList.box(blocks);\n  }\n\n  isEmpty() {\n    const block = this.getBlockAtIndex(0);\n    return this.blockList.length === 1 && block.isEmpty() && !block.hasAttributes();\n  }\n\n  copy() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const blocks = options.consolidateBlocks ? this.blockList.consolidate().toArray() : this.blockList.toArray();\n    return new this.constructor(blocks);\n  }\n\n  copyUsingObjectsFromDocument(sourceDocument) {\n    const objectMap = new ObjectMap(sourceDocument.getObjects());\n    return this.copyUsingObjectMap(objectMap);\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const blocks = this.getBlocks().map(block => {\n      const mappedBlock = objectMap.find(block);\n      return mappedBlock || block.copyUsingObjectMap(objectMap);\n    });\n    return new this.constructor(blocks);\n  }\n\n  copyWithBaseBlockAttributes() {\n    let blockAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    const blocks = this.getBlocks().map(block => {\n      const attributes = blockAttributes.concat(block.getAttributes());\n      return block.copyWithAttributes(attributes);\n    });\n    return new this.constructor(blocks);\n  }\n\n  replaceBlock(oldBlock, newBlock) {\n    const index = this.blockList.indexOf(oldBlock);\n\n    if (index === -1) {\n      return this;\n    }\n\n    return new this.constructor(this.blockList.replaceObjectAtIndex(newBlock, index));\n  }\n\n  insertDocumentAtRange(document, range) {\n    const {\n      blockList\n    } = document;\n    range = normalizeRange(range);\n    let [position] = range;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    let result = this;\n    const block = this.getBlockAtPosition(position);\n\n    if (rangeIsCollapsed(range) && block.isEmpty() && !block.hasAttributes()) {\n      result = new this.constructor(result.blockList.removeObjectAtIndex(index));\n    } else if (block.getBlockBreakPosition() === offset) {\n      position++;\n    }\n\n    result = result.removeTextAtRange(range);\n    return new this.constructor(result.blockList.insertSplittableListAtPosition(blockList, position));\n  }\n\n  mergeDocumentAtRange(document, range) {\n    let formattedDocument, result;\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const blockAttributes = this.getBlockAtIndex(startLocation.index).getAttributes();\n    const baseBlockAttributes = document.getBaseBlockAttributes();\n    const trailingBlockAttributes = blockAttributes.slice(-baseBlockAttributes.length);\n\n    if (arraysAreEqual(baseBlockAttributes, trailingBlockAttributes)) {\n      const leadingBlockAttributes = blockAttributes.slice(0, -baseBlockAttributes.length);\n      formattedDocument = document.copyWithBaseBlockAttributes(leadingBlockAttributes);\n    } else {\n      formattedDocument = document.copy({\n        consolidateBlocks: true\n      }).copyWithBaseBlockAttributes(blockAttributes);\n    }\n\n    const blockCount = formattedDocument.getBlockCount();\n    const firstBlock = formattedDocument.getBlockAtIndex(0);\n\n    if (arraysAreEqual(blockAttributes, firstBlock.getAttributes())) {\n      const firstText = firstBlock.getTextWithoutBlockBreak();\n      result = this.insertTextAtRange(firstText, range);\n\n      if (blockCount > 1) {\n        formattedDocument = new this.constructor(formattedDocument.getBlocks().slice(1));\n        const position = startPosition + firstText.getLength();\n        result = result.insertDocumentAtRange(formattedDocument, position);\n      }\n    } else {\n      result = this.insertDocumentAtRange(formattedDocument, range);\n    }\n\n    return result;\n  }\n\n  insertTextAtRange(text, range) {\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(startPosition);\n    const document = this.removeTextAtRange(range);\n    return new this.constructor(document.blockList.editObjectAtIndex(index, block => block.copyWithText(block.text.insertTextAtPosition(text, offset))));\n  }\n\n  removeTextAtRange(range) {\n    let blocks;\n    range = normalizeRange(range);\n    const [leftPosition, rightPosition] = range;\n\n    if (rangeIsCollapsed(range)) {\n      return this;\n    }\n\n    const [leftLocation, rightLocation] = Array.from(this.locationRangeFromRange(range));\n    const leftIndex = leftLocation.index;\n    const leftOffset = leftLocation.offset;\n    const leftBlock = this.getBlockAtIndex(leftIndex);\n    const rightIndex = rightLocation.index;\n    const rightOffset = rightLocation.offset;\n    const rightBlock = this.getBlockAtIndex(rightIndex);\n    const removeRightNewline = rightPosition - leftPosition === 1 && leftBlock.getBlockBreakPosition() === leftOffset && rightBlock.getBlockBreakPosition() !== rightOffset && rightBlock.text.getStringAtPosition(rightOffset) === \"\\n\";\n\n    if (removeRightNewline) {\n      blocks = this.blockList.editObjectAtIndex(rightIndex, block => block.copyWithText(block.text.removeTextAtRange([rightOffset, rightOffset + 1])));\n    } else {\n      let block;\n      const leftText = leftBlock.text.getTextAtRange([0, leftOffset]);\n      const rightText = rightBlock.text.getTextAtRange([rightOffset, rightBlock.getLength()]);\n      const text = leftText.appendText(rightText);\n      const removingLeftBlock = leftIndex !== rightIndex && leftOffset === 0;\n      const useRightBlock = removingLeftBlock && leftBlock.getAttributeLevel() >= rightBlock.getAttributeLevel();\n\n      if (useRightBlock) {\n        block = rightBlock.copyWithText(text);\n      } else {\n        block = leftBlock.copyWithText(text);\n      }\n\n      const affectedBlockCount = rightIndex + 1 - leftIndex;\n      blocks = this.blockList.splice(leftIndex, affectedBlockCount, block);\n    }\n\n    return new this.constructor(blocks);\n  }\n\n  moveTextFromRangeToPosition(range, position) {\n    let text;\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n\n    if (startPosition <= position && position <= endPosition) {\n      return this;\n    }\n\n    let document = this.getDocumentAtRange(range);\n    let result = this.removeTextAtRange(range);\n    const movingRightward = startPosition < position;\n\n    if (movingRightward) {\n      position -= document.getLength();\n    }\n\n    const [firstBlock, ...blocks] = document.getBlocks();\n\n    if (blocks.length === 0) {\n      text = firstBlock.getTextWithoutBlockBreak();\n\n      if (movingRightward) {\n        position += 1;\n      }\n    } else {\n      text = firstBlock.text;\n    }\n\n    result = result.insertTextAtRange(text, position);\n\n    if (blocks.length === 0) {\n      return result;\n    }\n\n    document = new this.constructor(blocks);\n    position += text.getLength();\n    return result.insertDocumentAtRange(document, position);\n  }\n\n  addAttributeAtRange(attribute, value, range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, (block, textRange, index) => blockList = blockList.editObjectAtIndex(index, function () {\n      if (getBlockConfig(attribute)) {\n        return block.addAttribute(attribute, value);\n      } else {\n        if (textRange[0] === textRange[1]) {\n          return block;\n        } else {\n          return block.copyWithText(block.text.addAttributeAtRange(attribute, value, textRange));\n        }\n      }\n    }));\n    return new this.constructor(blockList);\n  }\n\n  addAttribute(attribute, value) {\n    let {\n      blockList\n    } = this;\n    this.eachBlock((block, index) => blockList = blockList.editObjectAtIndex(index, () => block.addAttribute(attribute, value)));\n    return new this.constructor(blockList);\n  }\n\n  removeAttributeAtRange(attribute, range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      if (getBlockConfig(attribute)) {\n        blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(attribute));\n      } else if (textRange[0] !== textRange[1]) {\n        blockList = blockList.editObjectAtIndex(index, () => block.copyWithText(block.text.removeAttributeAtRange(attribute, textRange)));\n      }\n    });\n    return new this.constructor(blockList);\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    const [startPosition] = Array.from(range);\n    const {\n      index\n    } = this.locationFromPosition(startPosition);\n    const text = this.getTextAtIndex(index);\n    return new this.constructor(this.blockList.editObjectAtIndex(index, block => block.copyWithText(text.updateAttributesForAttachment(attributes, attachment))));\n  }\n\n  removeAttributeForAttachment(attribute, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    return this.removeAttributeAtRange(attribute, range);\n  }\n\n  insertBlockBreakAtRange(range) {\n    let blocks;\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const {\n      offset\n    } = this.locationFromPosition(startPosition);\n    const document = this.removeTextAtRange(range);\n\n    if (offset === 0) {\n      blocks = [new Block()];\n    }\n\n    return new this.constructor(document.blockList.insertSplittableListAtPosition(new SplittableList(blocks), startPosition));\n  }\n\n  applyBlockAttributeAtRange(attributeName, value, range) {\n    const expanded = this.expandRangeToLineBreaksAndSplitBlocks(range);\n    let document = expanded.document;\n    range = expanded.range;\n    const blockConfig = getBlockConfig(attributeName);\n\n    if (blockConfig.listAttribute) {\n      document = document.removeLastListAttributeAtRange(range, {\n        exceptAttributeName: attributeName\n      });\n      const converted = document.convertLineBreaksToBlockBreaksInRange(range);\n      document = converted.document;\n      range = converted.range;\n    } else if (blockConfig.exclusive) {\n      document = document.removeBlockAttributesAtRange(range);\n    } else if (blockConfig.terminal) {\n      document = document.removeLastTerminalAttributeAtRange(range);\n    } else {\n      document = document.consolidateBlocksAtRange(range);\n    }\n\n    return document.addAttributeAtRange(attributeName, value, range);\n  }\n\n  removeLastListAttributeAtRange(range) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      const lastAttributeName = block.getLastAttribute();\n\n      if (!lastAttributeName) {\n        return;\n      }\n\n      if (!getBlockConfig(lastAttributeName).listAttribute) {\n        return;\n      }\n\n      if (lastAttributeName === options.exceptAttributeName) {\n        return;\n      }\n\n      blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(lastAttributeName));\n    });\n    return new this.constructor(blockList);\n  }\n\n  removeLastTerminalAttributeAtRange(range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      const lastAttributeName = block.getLastAttribute();\n\n      if (!lastAttributeName) {\n        return;\n      }\n\n      if (!getBlockConfig(lastAttributeName).terminal) {\n        return;\n      }\n\n      blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(lastAttributeName));\n    });\n    return new this.constructor(blockList);\n  }\n\n  removeBlockAttributesAtRange(range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      if (block.hasAttributes()) {\n        blockList = blockList.editObjectAtIndex(index, () => block.copyWithoutAttributes());\n      }\n    });\n    return new this.constructor(blockList);\n  }\n\n  expandRangeToLineBreaksAndSplitBlocks(range) {\n    let position;\n    range = normalizeRange(range);\n    let [startPosition, endPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n    let document = this;\n    const startBlock = document.getBlockAtIndex(startLocation.index);\n    startLocation.offset = startBlock.findLineBreakInDirectionFromPosition(\"backward\", startLocation.offset);\n\n    if (startLocation.offset != null) {\n      position = document.positionFromLocation(startLocation);\n      document = document.insertBlockBreakAtRange([position, position + 1]);\n      endLocation.index += 1;\n      endLocation.offset -= document.getBlockAtIndex(startLocation.index).getLength();\n      startLocation.index += 1;\n    }\n\n    startLocation.offset = 0;\n\n    if (endLocation.offset === 0 && endLocation.index > startLocation.index) {\n      endLocation.index -= 1;\n      endLocation.offset = document.getBlockAtIndex(endLocation.index).getBlockBreakPosition();\n    } else {\n      const endBlock = document.getBlockAtIndex(endLocation.index);\n\n      if (endBlock.text.getStringAtRange([endLocation.offset - 1, endLocation.offset]) === \"\\n\") {\n        endLocation.offset -= 1;\n      } else {\n        endLocation.offset = endBlock.findLineBreakInDirectionFromPosition(\"forward\", endLocation.offset);\n      }\n\n      if (endLocation.offset !== endBlock.getBlockBreakPosition()) {\n        position = document.positionFromLocation(endLocation);\n        document = document.insertBlockBreakAtRange([position, position + 1]);\n      }\n    }\n\n    startPosition = document.positionFromLocation(startLocation);\n    endPosition = document.positionFromLocation(endLocation);\n    range = normalizeRange([startPosition, endPosition]);\n    return {\n      document,\n      range\n    };\n  }\n\n  convertLineBreaksToBlockBreaksInRange(range) {\n    range = normalizeRange(range);\n    let [position] = range;\n    const string = this.getStringAtRange(range).slice(0, -1);\n    let document = this;\n    string.replace(/.*?\\n/g, function (match) {\n      position += match.length;\n      document = document.insertBlockBreakAtRange([position - 1, position]);\n    });\n    return {\n      document,\n      range\n    };\n  }\n\n  consolidateBlocksAtRange(range) {\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n    const startIndex = this.locationFromPosition(startPosition).index;\n    const endIndex = this.locationFromPosition(endPosition).index;\n    return new this.constructor(this.blockList.consolidateFromIndexToIndex(startIndex, endIndex));\n  }\n\n  getDocumentAtRange(range) {\n    range = normalizeRange(range);\n    const blocks = this.blockList.getSplittableListInRange(range).toArray();\n    return new this.constructor(blocks);\n  }\n\n  getStringAtRange(range) {\n    let endIndex;\n    const array = range = normalizeRange(range),\n          endPosition = array[array.length - 1];\n\n    if (endPosition !== this.getLength()) {\n      endIndex = -1;\n    }\n\n    return this.getDocumentAtRange(range).toString().slice(0, endIndex);\n  }\n\n  getBlockAtIndex(index) {\n    return this.blockList.getObjectAtIndex(index);\n  }\n\n  getBlockAtPosition(position) {\n    const {\n      index\n    } = this.locationFromPosition(position);\n    return this.getBlockAtIndex(index);\n  }\n\n  getTextAtIndex(index) {\n    var _this$getBlockAtIndex;\n\n    return (_this$getBlockAtIndex = this.getBlockAtIndex(index)) === null || _this$getBlockAtIndex === void 0 ? void 0 : _this$getBlockAtIndex.text;\n  }\n\n  getTextAtPosition(position) {\n    const {\n      index\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index);\n  }\n\n  getPieceAtPosition(position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index).getPieceAtPosition(offset);\n  }\n\n  getCharacterAtPosition(position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index).getStringAtRange([offset, offset + 1]);\n  }\n\n  getLength() {\n    return this.blockList.getEndPosition();\n  }\n\n  getBlocks() {\n    return this.blockList.toArray();\n  }\n\n  getBlockCount() {\n    return this.blockList.length;\n  }\n\n  getEditCount() {\n    return this.editCount;\n  }\n\n  eachBlock(callback) {\n    return this.blockList.eachObject(callback);\n  }\n\n  eachBlockAtRange(range, callback) {\n    let block, textRange;\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n\n    if (startLocation.index === endLocation.index) {\n      block = this.getBlockAtIndex(startLocation.index);\n      textRange = [startLocation.offset, endLocation.offset];\n      return callback(block, textRange, startLocation.index);\n    } else {\n      for (let index = startLocation.index; index <= endLocation.index; index++) {\n        block = this.getBlockAtIndex(index);\n\n        if (block) {\n          switch (index) {\n            case startLocation.index:\n              textRange = [startLocation.offset, block.text.getLength()];\n              break;\n\n            case endLocation.index:\n              textRange = [0, endLocation.offset];\n              break;\n\n            default:\n              textRange = [0, block.text.getLength()];\n          }\n\n          callback(block, textRange, index);\n        }\n      }\n    }\n  }\n\n  getCommonAttributesAtRange(range) {\n    range = normalizeRange(range);\n    const [startPosition] = range;\n\n    if (rangeIsCollapsed(range)) {\n      return this.getCommonAttributesAtPosition(startPosition);\n    } else {\n      const textAttributes = [];\n      const blockAttributes = [];\n      this.eachBlockAtRange(range, function (block, textRange) {\n        if (textRange[0] !== textRange[1]) {\n          textAttributes.push(block.text.getCommonAttributesAtRange(textRange));\n          return blockAttributes.push(attributesForBlock(block));\n        }\n      });\n      return Hash.fromCommonAttributesOfObjects(textAttributes).merge(Hash.fromCommonAttributesOfObjects(blockAttributes)).toObject();\n    }\n  }\n\n  getCommonAttributesAtPosition(position) {\n    let key, value;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    const block = this.getBlockAtIndex(index);\n\n    if (!block) {\n      return {};\n    }\n\n    const commonAttributes = attributesForBlock(block);\n    const attributes = block.text.getAttributesAtPosition(offset);\n    const attributesLeft = block.text.getAttributesAtPosition(offset - 1);\n    const inheritableAttributes = Object.keys(config.textAttributes).filter(key => {\n      return config.textAttributes[key].inheritable;\n    });\n\n    for (key in attributesLeft) {\n      value = attributesLeft[key];\n\n      if (value === attributes[key] || inheritableAttributes.includes(key)) {\n        commonAttributes[key] = value;\n      }\n    }\n\n    return commonAttributes;\n  }\n\n  getRangeOfCommonAttributeAtPosition(attributeName, position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    const text = this.getTextAtIndex(index);\n    const [startOffset, endOffset] = Array.from(text.getExpandedRangeForAttributeAtOffset(attributeName, offset));\n    const start = this.positionFromLocation({\n      index,\n      offset: startOffset\n    });\n    const end = this.positionFromLocation({\n      index,\n      offset: endOffset\n    });\n    return normalizeRange([start, end]);\n  }\n\n  getBaseBlockAttributes() {\n    let baseBlockAttributes = this.getBlockAtIndex(0).getAttributes();\n\n    for (let blockIndex = 1; blockIndex < this.getBlockCount(); blockIndex++) {\n      const blockAttributes = this.getBlockAtIndex(blockIndex).getAttributes();\n      const lastAttributeIndex = Math.min(baseBlockAttributes.length, blockAttributes.length);\n\n      baseBlockAttributes = (() => {\n        const result = [];\n\n        for (let index = 0; index < lastAttributeIndex; index++) {\n          if (blockAttributes[index] !== baseBlockAttributes[index]) {\n            break;\n          }\n\n          result.push(blockAttributes[index]);\n        }\n\n        return result;\n      })();\n    }\n\n    return baseBlockAttributes;\n  }\n\n  getAttachmentById(attachmentId) {\n    for (const attachment of this.getAttachments()) {\n      if (attachment.id === attachmentId) {\n        return attachment;\n      }\n    }\n  }\n\n  getAttachmentPieces() {\n    let attachmentPieces = [];\n    this.blockList.eachObject(_ref => {\n      let {\n        text\n      } = _ref;\n      return attachmentPieces = attachmentPieces.concat(text.getAttachmentPieces());\n    });\n    return attachmentPieces;\n  }\n\n  getAttachments() {\n    return this.getAttachmentPieces().map(piece => piece.attachment);\n  }\n\n  getRangeOfAttachment(attachment) {\n    let position = 0;\n    const iterable = this.blockList.toArray();\n\n    for (let index = 0; index < iterable.length; index++) {\n      const {\n        text\n      } = iterable[index];\n      const textRange = text.getRangeOfAttachment(attachment);\n\n      if (textRange) {\n        return normalizeRange([position + textRange[0], position + textRange[1]]);\n      }\n\n      position += text.getLength();\n    }\n  }\n\n  getLocationRangeOfAttachment(attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    return this.locationRangeFromRange(range);\n  }\n\n  getAttachmentPieceForAttachment(attachment) {\n    for (const piece of this.getAttachmentPieces()) {\n      if (piece.attachment === attachment) {\n        return piece;\n      }\n    }\n  }\n\n  findRangesForBlockAttribute(attributeName) {\n    let position = 0;\n    const ranges = [];\n    this.getBlocks().forEach(block => {\n      const length = block.getLength();\n\n      if (block.hasAttribute(attributeName)) {\n        ranges.push([position, position + length]);\n      }\n\n      position += length;\n    });\n    return ranges;\n  }\n\n  findRangesForTextAttribute(attributeName) {\n    let {\n      withValue\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let position = 0;\n    let range = [];\n    const ranges = [];\n\n    const match = function (piece) {\n      if (withValue) {\n        return piece.getAttribute(attributeName) === withValue;\n      } else {\n        return piece.hasAttribute(attributeName);\n      }\n    };\n\n    this.getPieces().forEach(piece => {\n      const length = piece.getLength();\n\n      if (match(piece)) {\n        if (range[1] === position) {\n          range[1] = position + length;\n        } else {\n          ranges.push(range = [position, position + length]);\n        }\n      }\n\n      position += length;\n    });\n    return ranges;\n  }\n\n  locationFromPosition(position) {\n    const location = this.blockList.findIndexAndOffsetAtPosition(Math.max(0, position));\n\n    if (location.index != null) {\n      return location;\n    } else {\n      const blocks = this.getBlocks();\n      return {\n        index: blocks.length - 1,\n        offset: blocks[blocks.length - 1].getLength()\n      };\n    }\n  }\n\n  positionFromLocation(location) {\n    return this.blockList.findPositionAtIndexAndOffset(location.index, location.offset);\n  }\n\n  locationRangeFromPosition(position) {\n    return normalizeRange(this.locationFromPosition(position));\n  }\n\n  locationRangeFromRange(range) {\n    range = normalizeRange(range);\n    if (!range) return;\n    const [startPosition, endPosition] = Array.from(range);\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n    return normalizeRange([startLocation, endLocation]);\n  }\n\n  rangeFromLocationRange(locationRange) {\n    let rightPosition;\n    locationRange = normalizeRange(locationRange);\n    const leftPosition = this.positionFromLocation(locationRange[0]);\n\n    if (!rangeIsCollapsed(locationRange)) {\n      rightPosition = this.positionFromLocation(locationRange[1]);\n    }\n\n    return normalizeRange([leftPosition, rightPosition]);\n  }\n\n  isEqualTo(document) {\n    return this.blockList.isEqualTo(document === null || document === void 0 ? void 0 : document.blockList);\n  }\n\n  getTexts() {\n    return this.getBlocks().map(block => block.text);\n  }\n\n  getPieces() {\n    const pieces = [];\n    Array.from(this.getTexts()).forEach(text => {\n      pieces.push(...Array.from(text.getPieces() || []));\n    });\n    return pieces;\n  }\n\n  getObjects() {\n    return this.getBlocks().concat(this.getTexts()).concat(this.getPieces());\n  }\n\n  toSerializableDocument() {\n    const blocks = [];\n    this.blockList.eachObject(block => blocks.push(block.copyWithText(block.text.toSerializableText())));\n    return new this.constructor(blocks);\n  }\n\n  toString() {\n    return this.blockList.toString();\n  }\n\n  toJSON() {\n    return this.blockList.toJSON();\n  }\n\n  toConsole() {\n    return JSON.stringify(this.blockList.toArray()).map(block => JSON.parse(block.text.toConsole()));\n  }\n\n}\n\nconst attributesForBlock = function (block) {\n  const attributes = {};\n  const attributeName = block.getLastAttribute();\n\n  if (attributeName) {\n    attributes[attributeName] = true;\n  }\n\n  return attributes;\n};\n\nconst DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height class\".split(\" \");\nconst DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \");\nconst DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe\".split(\" \");\nclass HTMLSanitizer extends BasicObject {\n  static sanitize(html, options) {\n    const sanitizer = new this(html, options);\n    sanitizer.sanitize();\n    return sanitizer;\n  }\n\n  constructor(html) {\n    let {\n      allowedAttributes,\n      forbiddenProtocols,\n      forbiddenElements\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.allowedAttributes = allowedAttributes || DEFAULT_ALLOWED_ATTRIBUTES;\n    this.forbiddenProtocols = forbiddenProtocols || DEFAULT_FORBIDDEN_PROTOCOLS;\n    this.forbiddenElements = forbiddenElements || DEFAULT_FORBIDDEN_ELEMENTS;\n    this.body = createBodyElementForHTML(html);\n  }\n\n  sanitize() {\n    this.sanitizeElements();\n    return this.normalizeListElementNesting();\n  }\n\n  getHTML() {\n    return this.body.innerHTML;\n  }\n\n  getBody() {\n    return this.body;\n  } // Private\n\n\n  sanitizeElements() {\n    const walker = walkTree(this.body);\n    const nodesToRemove = [];\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      switch (node.nodeType) {\n        case Node.ELEMENT_NODE:\n          if (this.elementIsRemovable(node)) {\n            nodesToRemove.push(node);\n          } else {\n            this.sanitizeElement(node);\n          }\n\n          break;\n\n        case Node.COMMENT_NODE:\n          nodesToRemove.push(node);\n          break;\n      }\n    }\n\n    nodesToRemove.forEach(node => removeNode(node));\n    return this.body;\n  }\n\n  sanitizeElement(element) {\n    if (element.hasAttribute(\"href\")) {\n      if (this.forbiddenProtocols.includes(element.protocol)) {\n        element.removeAttribute(\"href\");\n      }\n    }\n\n    Array.from(element.attributes).forEach(_ref => {\n      let {\n        name\n      } = _ref;\n\n      if (!this.allowedAttributes.includes(name) && name.indexOf(\"data-trix\") !== 0) {\n        element.removeAttribute(name);\n      }\n    });\n    return element;\n  }\n\n  normalizeListElementNesting() {\n    Array.from(this.body.querySelectorAll(\"ul,ol\")).forEach(listElement => {\n      const previousElement = listElement.previousElementSibling;\n\n      if (previousElement) {\n        if (tagName(previousElement) === \"li\") {\n          previousElement.appendChild(listElement);\n        }\n      }\n    });\n    return this.body;\n  }\n\n  elementIsRemovable(element) {\n    if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n    return this.elementIsForbidden(element) || this.elementIsntSerializable(element);\n  }\n\n  elementIsForbidden(element) {\n    return this.forbiddenElements.includes(tagName(element));\n  }\n\n  elementIsntSerializable(element) {\n    return element.getAttribute(\"data-trix-serialize\") === \"false\" && !nodeIsAttachmentElement(element);\n  }\n\n}\n\nconst createBodyElementForHTML = function () {\n  let html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  // Remove everything after </html>\n  html = html.replace(/<\\/html[^>]*>[^]*$/i, \"</html>\");\n  const doc = document.implementation.createHTMLDocument(\"\");\n  doc.documentElement.innerHTML = html;\n  Array.from(doc.head.querySelectorAll(\"style\")).forEach(element => {\n    doc.body.appendChild(element);\n  });\n  return doc.body;\n};\n\n/* eslint-disable\n    no-case-declarations,\n    no-irregular-whitespace,\n*/\n\nconst pieceForString = function (string) {\n  let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const type = \"string\";\n  string = normalizeSpaces(string);\n  return {\n    string,\n    attributes,\n    type\n  };\n};\n\nconst pieceForAttachment = function (attachment) {\n  let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const type = \"attachment\";\n  return {\n    attachment,\n    attributes,\n    type\n  };\n};\n\nconst blockForAttributes = function () {\n  let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const text = [];\n  return {\n    text,\n    attributes\n  };\n};\n\nconst parseTrixDataAttribute = (element, name) => {\n  try {\n    return JSON.parse(element.getAttribute(\"data-trix-\".concat(name)));\n  } catch (error) {\n    return {};\n  }\n};\n\nconst getImageDimensions = element => {\n  const width = element.getAttribute(\"width\");\n  const height = element.getAttribute(\"height\");\n  const dimensions = {};\n\n  if (width) {\n    dimensions.width = parseInt(width, 10);\n  }\n\n  if (height) {\n    dimensions.height = parseInt(height, 10);\n  }\n\n  return dimensions;\n};\n\nclass HTMLParser extends BasicObject {\n  static parse(html, options) {\n    const parser = new this(html, options);\n    parser.parse();\n    return parser;\n  }\n\n  constructor(html) {\n    let {\n      referenceElement\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.html = html;\n    this.referenceElement = referenceElement;\n    this.blocks = [];\n    this.blockElements = [];\n    this.processedElements = [];\n  }\n\n  getDocument() {\n    return Document.fromJSON(this.blocks);\n  } // HTML parsing\n\n\n  parse() {\n    try {\n      this.createHiddenContainer();\n      const html = HTMLSanitizer.sanitize(this.html).getHTML();\n      this.containerElement.innerHTML = html;\n      const walker = walkTree(this.containerElement, {\n        usingFilter: nodeFilter\n      });\n\n      while (walker.nextNode()) {\n        this.processNode(walker.currentNode);\n      }\n\n      return this.translateBlockElementMarginsToNewlines();\n    } finally {\n      this.removeHiddenContainer();\n    }\n  }\n\n  createHiddenContainer() {\n    if (this.referenceElement) {\n      this.containerElement = this.referenceElement.cloneNode(false);\n      this.containerElement.removeAttribute(\"id\");\n      this.containerElement.setAttribute(\"data-trix-internal\", \"\");\n      this.containerElement.style.display = \"none\";\n      return this.referenceElement.parentNode.insertBefore(this.containerElement, this.referenceElement.nextSibling);\n    } else {\n      this.containerElement = makeElement({\n        tagName: \"div\",\n        style: {\n          display: \"none\"\n        }\n      });\n      return document.body.appendChild(this.containerElement);\n    }\n  }\n\n  removeHiddenContainer() {\n    return removeNode(this.containerElement);\n  }\n\n  processNode(node) {\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        if (!this.isInsignificantTextNode(node)) {\n          this.appendBlockForTextNode(node);\n          return this.processTextNode(node);\n        }\n\n        break;\n\n      case Node.ELEMENT_NODE:\n        this.appendBlockForElement(node);\n        return this.processElement(node);\n    }\n  }\n\n  appendBlockForTextNode(node) {\n    const element = node.parentNode;\n\n    if (element === this.currentBlockElement && this.isBlockElement(node.previousSibling)) {\n      return this.appendStringWithAttributes(\"\\n\");\n    } else if (element === this.containerElement || this.isBlockElement(element)) {\n      var _this$currentBlock;\n\n      const attributes = this.getBlockAttributes(element);\n\n      if (!arraysAreEqual(attributes, (_this$currentBlock = this.currentBlock) === null || _this$currentBlock === void 0 ? void 0 : _this$currentBlock.attributes)) {\n        this.currentBlock = this.appendBlockForAttributesWithElement(attributes, element);\n        this.currentBlockElement = element;\n      }\n    }\n  }\n\n  appendBlockForElement(element) {\n    const elementIsBlockElement = this.isBlockElement(element);\n    const currentBlockContainsElement = elementContainsNode(this.currentBlockElement, element);\n\n    if (elementIsBlockElement && !this.isBlockElement(element.firstChild)) {\n      if (!this.isInsignificantTextNode(element.firstChild) || !this.isBlockElement(element.firstElementChild)) {\n        const attributes = this.getBlockAttributes(element);\n\n        if (element.firstChild) {\n          if (!(currentBlockContainsElement && arraysAreEqual(attributes, this.currentBlock.attributes))) {\n            this.currentBlock = this.appendBlockForAttributesWithElement(attributes, element);\n            this.currentBlockElement = element;\n          } else {\n            return this.appendStringWithAttributes(\"\\n\");\n          }\n        }\n      }\n    } else if (this.currentBlockElement && !currentBlockContainsElement && !elementIsBlockElement) {\n      const parentBlockElement = this.findParentBlockElement(element);\n\n      if (parentBlockElement) {\n        return this.appendBlockForElement(parentBlockElement);\n      } else {\n        this.currentBlock = this.appendEmptyBlock();\n        this.currentBlockElement = null;\n      }\n    }\n  }\n\n  findParentBlockElement(element) {\n    let {\n      parentElement\n    } = element;\n\n    while (parentElement && parentElement !== this.containerElement) {\n      if (this.isBlockElement(parentElement) && this.blockElements.includes(parentElement)) {\n        return parentElement;\n      } else {\n        parentElement = parentElement.parentElement;\n      }\n    }\n\n    return null;\n  }\n\n  processTextNode(node) {\n    let string = node.data;\n\n    if (!elementCanDisplayPreformattedText(node.parentNode)) {\n      var _node$previousSibling;\n\n      string = squishBreakableWhitespace(string);\n\n      if (stringEndsWithWhitespace((_node$previousSibling = node.previousSibling) === null || _node$previousSibling === void 0 ? void 0 : _node$previousSibling.textContent)) {\n        string = leftTrimBreakableWhitespace(string);\n      }\n    }\n\n    return this.appendStringWithAttributes(string, this.getTextAttributes(node.parentNode));\n  }\n\n  processElement(element) {\n    let attributes;\n\n    if (nodeIsAttachmentElement(element)) {\n      attributes = parseTrixDataAttribute(element, \"attachment\");\n\n      if (Object.keys(attributes).length) {\n        const textAttributes = this.getTextAttributes(element);\n        this.appendAttachmentWithAttributes(attributes, textAttributes); // We have everything we need so avoid processing inner nodes\n\n        element.innerHTML = \"\";\n      }\n\n      return this.processedElements.push(element);\n    } else {\n      switch (tagName(element)) {\n        case \"br\":\n          if (!this.isExtraBR(element) && !this.isBlockElement(element.nextSibling)) {\n            this.appendStringWithAttributes(\"\\n\", this.getTextAttributes(element));\n          }\n\n          return this.processedElements.push(element);\n\n        case \"img\":\n          attributes = {\n            url: element.getAttribute(\"src\"),\n            contentType: \"image\"\n          };\n          const object = getImageDimensions(element);\n\n          for (const key in object) {\n            const value = object[key];\n            attributes[key] = value;\n          }\n\n          this.appendAttachmentWithAttributes(attributes, this.getTextAttributes(element));\n          return this.processedElements.push(element);\n\n        case \"tr\":\n          if (element.parentNode.firstChild !== element) {\n            return this.appendStringWithAttributes(\"\\n\");\n          }\n\n          break;\n\n        case \"td\":\n          if (element.parentNode.firstChild !== element) {\n            return this.appendStringWithAttributes(\" | \");\n          }\n\n          break;\n      }\n    }\n  } // Document construction\n\n\n  appendBlockForAttributesWithElement(attributes, element) {\n    this.blockElements.push(element);\n    const block = blockForAttributes(attributes);\n    this.blocks.push(block);\n    return block;\n  }\n\n  appendEmptyBlock() {\n    return this.appendBlockForAttributesWithElement([], null);\n  }\n\n  appendStringWithAttributes(string, attributes) {\n    return this.appendPiece(pieceForString(string, attributes));\n  }\n\n  appendAttachmentWithAttributes(attachment, attributes) {\n    return this.appendPiece(pieceForAttachment(attachment, attributes));\n  }\n\n  appendPiece(piece) {\n    if (this.blocks.length === 0) {\n      this.appendEmptyBlock();\n    }\n\n    return this.blocks[this.blocks.length - 1].text.push(piece);\n  }\n\n  appendStringToTextAtIndex(string, index) {\n    const {\n      text\n    } = this.blocks[index];\n    const piece = text[text.length - 1];\n\n    if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n      piece.string += string;\n    } else {\n      return text.push(pieceForString(string));\n    }\n  }\n\n  prependStringToTextAtIndex(string, index) {\n    const {\n      text\n    } = this.blocks[index];\n    const piece = text[0];\n\n    if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n      piece.string = string + piece.string;\n    } else {\n      return text.unshift(pieceForString(string));\n    }\n  } // Attribute parsing\n\n\n  getTextAttributes(element) {\n    let value;\n    const attributes = {};\n\n    for (const attribute in config.textAttributes) {\n      const configAttr = config.textAttributes[attribute];\n\n      if (configAttr.tagName && findClosestElementFromNode(element, {\n        matchingSelector: configAttr.tagName,\n        untilNode: this.containerElement\n      })) {\n        attributes[attribute] = true;\n      } else if (configAttr.parser) {\n        value = configAttr.parser(element);\n\n        if (value) {\n          let attributeInheritedFromBlock = false;\n\n          for (const blockElement of this.findBlockElementAncestors(element)) {\n            if (configAttr.parser(blockElement) === value) {\n              attributeInheritedFromBlock = true;\n              break;\n            }\n          }\n\n          if (!attributeInheritedFromBlock) {\n            attributes[attribute] = value;\n          }\n        }\n      } else if (configAttr.styleProperty) {\n        value = element.style[configAttr.styleProperty];\n\n        if (value) {\n          attributes[attribute] = value;\n        }\n      }\n    }\n\n    if (nodeIsAttachmentElement(element)) {\n      const object = parseTrixDataAttribute(element, \"attributes\");\n\n      for (const key in object) {\n        value = object[key];\n        attributes[key] = value;\n      }\n    }\n\n    return attributes;\n  }\n\n  getBlockAttributes(element) {\n    const attributes = [];\n\n    while (element && element !== this.containerElement) {\n      for (const attribute in config.blockAttributes) {\n        const attrConfig = config.blockAttributes[attribute];\n\n        if (attrConfig.parse !== false) {\n          if (tagName(element) === attrConfig.tagName) {\n            var _attrConfig$test;\n\n            if ((_attrConfig$test = attrConfig.test) !== null && _attrConfig$test !== void 0 && _attrConfig$test.call(attrConfig, element) || !attrConfig.test) {\n              attributes.push(attribute);\n\n              if (attrConfig.listAttribute) {\n                attributes.push(attrConfig.listAttribute);\n              }\n            }\n          }\n        }\n      }\n\n      element = element.parentNode;\n    }\n\n    return attributes.reverse();\n  }\n\n  findBlockElementAncestors(element) {\n    const ancestors = [];\n\n    while (element && element !== this.containerElement) {\n      const tag = tagName(element);\n\n      if (getBlockTagNames().includes(tag)) {\n        ancestors.push(element);\n      }\n\n      element = element.parentNode;\n    }\n\n    return ancestors;\n  } // Element inspection\n\n\n  isBlockElement(element) {\n    if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n    if (nodeIsAttachmentElement(element)) return;\n    if (findClosestElementFromNode(element, {\n      matchingSelector: \"td\",\n      untilNode: this.containerElement\n    })) return;\n    return getBlockTagNames().includes(tagName(element)) || window.getComputedStyle(element).display === \"block\";\n  }\n\n  isInsignificantTextNode(node) {\n    if ((node === null || node === void 0 ? void 0 : node.nodeType) !== Node.TEXT_NODE) return;\n    if (!stringIsAllBreakableWhitespace(node.data)) return;\n    const {\n      parentNode,\n      previousSibling,\n      nextSibling\n    } = node;\n    if (nodeEndsWithNonWhitespace(parentNode.previousSibling) && !this.isBlockElement(parentNode.previousSibling)) return;\n    if (elementCanDisplayPreformattedText(parentNode)) return;\n    return !previousSibling || this.isBlockElement(previousSibling) || !nextSibling || this.isBlockElement(nextSibling);\n  }\n\n  isExtraBR(element) {\n    return tagName(element) === \"br\" && this.isBlockElement(element.parentNode) && element.parentNode.lastChild === element;\n  } // Margin translation\n\n\n  translateBlockElementMarginsToNewlines() {\n    const defaultMargin = this.getMarginOfDefaultBlockElement();\n\n    for (let index = 0; index < this.blocks.length; index++) {\n      const margin = this.getMarginOfBlockElementAtIndex(index);\n\n      if (margin) {\n        if (margin.top > defaultMargin.top * 2) {\n          this.prependStringToTextAtIndex(\"\\n\", index);\n        }\n\n        if (margin.bottom > defaultMargin.bottom * 2) {\n          this.appendStringToTextAtIndex(\"\\n\", index);\n        }\n      }\n    }\n  }\n\n  getMarginOfBlockElementAtIndex(index) {\n    const element = this.blockElements[index];\n\n    if (element) {\n      if (element.textContent) {\n        if (!getBlockTagNames().includes(tagName(element)) && !this.processedElements.includes(element)) {\n          return getBlockElementMargin(element);\n        }\n      }\n    }\n  }\n\n  getMarginOfDefaultBlockElement() {\n    const element = makeElement(config.blockAttributes.default.tagName);\n    this.containerElement.appendChild(element);\n    return getBlockElementMargin(element);\n  }\n\n} // Helpers\n\nconst elementCanDisplayPreformattedText = function (element) {\n  const {\n    whiteSpace\n  } = window.getComputedStyle(element);\n  return [\"pre\", \"pre-wrap\", \"pre-line\"].includes(whiteSpace);\n};\n\nconst nodeEndsWithNonWhitespace = node => node && !stringEndsWithWhitespace(node.textContent);\n\nconst getBlockElementMargin = function (element) {\n  const style = window.getComputedStyle(element);\n\n  if (style.display === \"block\") {\n    return {\n      top: parseInt(style.marginTop),\n      bottom: parseInt(style.marginBottom)\n    };\n  }\n};\n\nconst nodeFilter = function (node) {\n  if (tagName(node) === \"style\") {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n}; // Whitespace\n\n\nconst leftTrimBreakableWhitespace = string => string.replace(new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"+\")), \"\");\n\nconst stringIsAllBreakableWhitespace = string => new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"*$\")).test(string);\n\nconst stringEndsWithWhitespace = string => /\\s$/.test(string);\n\nclass LineBreakInsertion {\n  constructor(composition) {\n    this.composition = composition;\n    this.document = this.composition.document;\n    const selectedRange = this.composition.getSelectedRange();\n    this.startPosition = selectedRange[0];\n    this.endPosition = selectedRange[1];\n    this.startLocation = this.document.locationFromPosition(this.startPosition);\n    this.endLocation = this.document.locationFromPosition(this.endPosition);\n    this.block = this.document.getBlockAtIndex(this.endLocation.index);\n    this.breaksOnReturn = this.block.breaksOnReturn();\n    this.previousCharacter = this.block.text.getStringAtPosition(this.endLocation.offset - 1);\n    this.nextCharacter = this.block.text.getStringAtPosition(this.endLocation.offset);\n  }\n\n  shouldInsertBlockBreak() {\n    if (this.block.hasAttributes() && this.block.isListItem() && !this.block.isEmpty()) {\n      return this.startLocation.offset !== 0;\n    } else {\n      return this.breaksOnReturn && this.nextCharacter !== \"\\n\";\n    }\n  }\n\n  shouldBreakFormattedBlock() {\n    return this.block.hasAttributes() && !this.block.isListItem() && (this.breaksOnReturn && this.nextCharacter === \"\\n\" || this.previousCharacter === \"\\n\");\n  }\n\n  shouldDecreaseListLevel() {\n    return this.block.hasAttributes() && this.block.isListItem() && this.block.isEmpty();\n  }\n\n  shouldPrependListItem() {\n    return this.block.isListItem() && this.startLocation.offset === 0 && !this.block.isEmpty();\n  }\n\n  shouldRemoveLastBlockAttribute() {\n    return this.block.hasAttributes() && !this.block.isListItem() && this.block.isEmpty();\n  }\n\n}\n\nconst PLACEHOLDER = \" \";\nclass Composition extends BasicObject {\n  constructor() {\n    super(...arguments);\n    this.document = new Document();\n    this.attachments = [];\n    this.currentAttributes = {};\n    this.revision = 0;\n  }\n\n  setDocument(document) {\n    if (!document.isEqualTo(this.document)) {\n      var _this$delegate, _this$delegate$compos;\n\n      this.document = document;\n      this.refreshAttachments();\n      this.revision++;\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionDidChangeDocument) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate, document);\n    }\n  } // Snapshots\n\n\n  getSnapshot() {\n    return {\n      document: this.document,\n      selectedRange: this.getSelectedRange()\n    };\n  }\n\n  loadSnapshot(_ref) {\n    var _this$delegate2, _this$delegate2$compo, _this$delegate3, _this$delegate3$compo;\n\n    let {\n      document,\n      selectedRange\n    } = _ref;\n    (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionWillLoadSnapshot) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n    this.setDocument(document != null ? document : new Document());\n    this.setSelection(selectedRange != null ? selectedRange : [0, 0]);\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionDidLoadSnapshot) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3);\n  } // Responder protocol\n\n\n  insertText(text) {\n    let {\n      updatePosition\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      updatePosition: true\n    };\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertTextAtRange(text, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + text.getLength();\n\n    if (updatePosition) {\n      this.setSelection(endPosition);\n    }\n\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertBlock() {\n    let block = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Block();\n    const document = new Document([block]);\n    return this.insertDocument(document);\n  }\n\n  insertDocument() {\n    let document = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Document();\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertDocumentAtRange(document, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + document.getLength();\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertString(string, options) {\n    const attributes = this.getCurrentTextAttributes();\n    const text = Text.textForStringWithAttributes(string, attributes);\n    return this.insertText(text, options);\n  }\n\n  insertBlockBreak() {\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertBlockBreakAtRange(selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + 1;\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertLineBreak() {\n    const insertion = new LineBreakInsertion(this);\n\n    if (insertion.shouldDecreaseListLevel()) {\n      this.decreaseListLevel();\n      return this.setSelection(insertion.startPosition);\n    } else if (insertion.shouldPrependListItem()) {\n      const document = new Document([insertion.block.copyWithoutText()]);\n      return this.insertDocument(document);\n    } else if (insertion.shouldInsertBlockBreak()) {\n      return this.insertBlockBreak();\n    } else if (insertion.shouldRemoveLastBlockAttribute()) {\n      return this.removeLastBlockAttribute();\n    } else if (insertion.shouldBreakFormattedBlock()) {\n      return this.breakFormattedBlock(insertion);\n    } else {\n      return this.insertString(\"\\n\");\n    }\n  }\n\n  insertHTML(html) {\n    const document = HTMLParser.parse(html).getDocument();\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.mergeDocumentAtRange(document, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + document.getLength() - 1;\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  replaceHTML(html) {\n    const document = HTMLParser.parse(html).getDocument().copyUsingObjectsFromDocument(this.document);\n    const locationRange = this.getLocationRange({\n      strict: false\n    });\n    const selectedRange = this.document.rangeFromLocationRange(locationRange);\n    this.setDocument(document);\n    return this.setSelection(selectedRange);\n  }\n\n  insertFile(file) {\n    return this.insertFiles([file]);\n  }\n\n  insertFiles(files) {\n    const attachments = [];\n    Array.from(files).forEach(file => {\n      var _this$delegate4;\n\n      if ((_this$delegate4 = this.delegate) !== null && _this$delegate4 !== void 0 && _this$delegate4.compositionShouldAcceptFile(file)) {\n        const attachment = Attachment.attachmentForFile(file);\n        attachments.push(attachment);\n      }\n    });\n    return this.insertAttachments(attachments);\n  }\n\n  insertAttachment(attachment) {\n    return this.insertAttachments([attachment]);\n  }\n\n  insertAttachments(attachments) {\n    let text = new Text();\n    Array.from(attachments).forEach(attachment => {\n      var _config$attachments$t;\n\n      const type = attachment.getType();\n      const presentation = (_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.presentation;\n      const attributes = this.getCurrentTextAttributes();\n\n      if (presentation) {\n        attributes.presentation = presentation;\n      }\n\n      const attachmentText = Text.textForAttachmentWithAttributes(attachment, attributes);\n      text = text.appendText(attachmentText);\n    });\n    return this.insertText(text);\n  }\n\n  shouldManageDeletingInDirection(direction) {\n    const locationRange = this.getLocationRange();\n\n    if (rangeIsCollapsed(locationRange)) {\n      if (direction === \"backward\" && locationRange[0].offset === 0) {\n        return true;\n      }\n\n      if (this.shouldManageMovingCursorInDirection(direction)) {\n        return true;\n      }\n    } else {\n      if (locationRange[0].index !== locationRange[1].index) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  deleteInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let attachment, deletingIntoPreviousBlock, selectionSpansBlocks;\n    const locationRange = this.getLocationRange();\n    let range = this.getSelectedRange();\n    const selectionIsCollapsed = rangeIsCollapsed(range);\n\n    if (selectionIsCollapsed) {\n      deletingIntoPreviousBlock = direction === \"backward\" && locationRange[0].offset === 0;\n    } else {\n      selectionSpansBlocks = locationRange[0].index !== locationRange[1].index;\n    }\n\n    if (deletingIntoPreviousBlock) {\n      if (this.canDecreaseBlockAttributeLevel()) {\n        const block = this.getBlock();\n\n        if (block.isListItem()) {\n          this.decreaseListLevel();\n        } else {\n          this.decreaseBlockAttributeLevel();\n        }\n\n        this.setSelection(range[0]);\n\n        if (block.isEmpty()) {\n          return false;\n        }\n      }\n    }\n\n    if (selectionIsCollapsed) {\n      range = this.getExpandedRangeInDirection(direction, {\n        length\n      });\n\n      if (direction === \"backward\") {\n        attachment = this.getAttachmentAtRange(range);\n      }\n    }\n\n    if (attachment) {\n      this.editAttachment(attachment);\n      return false;\n    } else {\n      this.setDocument(this.document.removeTextAtRange(range));\n      this.setSelection(range[0]);\n\n      if (deletingIntoPreviousBlock || selectionSpansBlocks) {\n        return false;\n      }\n    }\n  }\n\n  moveTextFromRange(range) {\n    const [position] = Array.from(this.getSelectedRange());\n    this.setDocument(this.document.moveTextFromRangeToPosition(range, position));\n    return this.setSelection(position);\n  }\n\n  removeAttachment(attachment) {\n    const range = this.document.getRangeOfAttachment(attachment);\n\n    if (range) {\n      this.stopEditingAttachment();\n      this.setDocument(this.document.removeTextAtRange(range));\n      return this.setSelection(range[0]);\n    }\n  }\n\n  removeLastBlockAttribute() {\n    const [startPosition, endPosition] = Array.from(this.getSelectedRange());\n    const block = this.document.getBlockAtPosition(endPosition);\n    this.removeCurrentAttribute(block.getLastAttribute());\n    return this.setSelection(startPosition);\n  }\n\n  insertPlaceholder() {\n    this.placeholderPosition = this.getPosition();\n    return this.insertString(PLACEHOLDER);\n  }\n\n  selectPlaceholder() {\n    if (this.placeholderPosition != null) {\n      this.setSelectedRange([this.placeholderPosition, this.placeholderPosition + PLACEHOLDER.length]);\n      return this.getSelectedRange();\n    }\n  }\n\n  forgetPlaceholder() {\n    this.placeholderPosition = null;\n  } // Current attributes\n\n\n  hasCurrentAttribute(attributeName) {\n    const value = this.currentAttributes[attributeName];\n    return value != null && value !== false;\n  }\n\n  toggleCurrentAttribute(attributeName) {\n    const value = !this.currentAttributes[attributeName];\n\n    if (value) {\n      return this.setCurrentAttribute(attributeName, value);\n    } else {\n      return this.removeCurrentAttribute(attributeName);\n    }\n  }\n\n  canSetCurrentAttribute(attributeName) {\n    if (getBlockConfig(attributeName)) {\n      return this.canSetCurrentBlockAttribute(attributeName);\n    } else {\n      return this.canSetCurrentTextAttribute(attributeName);\n    }\n  }\n\n  canSetCurrentTextAttribute(attributeName) {\n    const document = this.getSelectedDocument();\n    if (!document) return;\n\n    for (const attachment of Array.from(document.getAttachments())) {\n      if (!attachment.hasContent()) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  canSetCurrentBlockAttribute(attributeName) {\n    const block = this.getBlock();\n    if (!block) return;\n    return !block.isTerminalBlock();\n  }\n\n  setCurrentAttribute(attributeName, value) {\n    if (getBlockConfig(attributeName)) {\n      return this.setBlockAttribute(attributeName, value);\n    } else {\n      this.setTextAttribute(attributeName, value);\n      this.currentAttributes[attributeName] = value;\n      return this.notifyDelegateOfCurrentAttributesChange();\n    }\n  }\n\n  setTextAttribute(attributeName, value) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    const [startPosition, endPosition] = Array.from(selectedRange);\n\n    if (startPosition === endPosition) {\n      if (attributeName === \"href\") {\n        const text = Text.textForStringWithAttributes(value, {\n          href: value\n        });\n        return this.insertText(text);\n      }\n    } else {\n      return this.setDocument(this.document.addAttributeAtRange(attributeName, value, selectedRange));\n    }\n  }\n\n  setBlockAttribute(attributeName, value) {\n    const selectedRange = this.getSelectedRange();\n\n    if (this.canSetCurrentAttribute(attributeName)) {\n      this.setDocument(this.document.applyBlockAttributeAtRange(attributeName, value, selectedRange));\n      return this.setSelection(selectedRange);\n    }\n  }\n\n  removeCurrentAttribute(attributeName) {\n    if (getBlockConfig(attributeName)) {\n      this.removeBlockAttribute(attributeName);\n      return this.updateCurrentAttributes();\n    } else {\n      this.removeTextAttribute(attributeName);\n      delete this.currentAttributes[attributeName];\n      return this.notifyDelegateOfCurrentAttributesChange();\n    }\n  }\n\n  removeTextAttribute(attributeName) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n  }\n\n  removeBlockAttribute(attributeName) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n  }\n\n  canDecreaseNestingLevel() {\n    var _this$getBlock;\n\n    return ((_this$getBlock = this.getBlock()) === null || _this$getBlock === void 0 ? void 0 : _this$getBlock.getNestingLevel()) > 0;\n  }\n\n  canIncreaseNestingLevel() {\n    var _getBlockConfig;\n\n    const block = this.getBlock();\n    if (!block) return;\n\n    if ((_getBlockConfig = getBlockConfig(block.getLastNestableAttribute())) !== null && _getBlockConfig !== void 0 && _getBlockConfig.listAttribute) {\n      const previousBlock = this.getPreviousBlock();\n\n      if (previousBlock) {\n        return arrayStartsWith(previousBlock.getListItemAttributes(), block.getListItemAttributes());\n      }\n    } else {\n      return block.getNestingLevel() > 0;\n    }\n  }\n\n  decreaseNestingLevel() {\n    const block = this.getBlock();\n    if (!block) return;\n    return this.setDocument(this.document.replaceBlock(block, block.decreaseNestingLevel()));\n  }\n\n  increaseNestingLevel() {\n    const block = this.getBlock();\n    if (!block) return;\n    return this.setDocument(this.document.replaceBlock(block, block.increaseNestingLevel()));\n  }\n\n  canDecreaseBlockAttributeLevel() {\n    var _this$getBlock2;\n\n    return ((_this$getBlock2 = this.getBlock()) === null || _this$getBlock2 === void 0 ? void 0 : _this$getBlock2.getAttributeLevel()) > 0;\n  }\n\n  decreaseBlockAttributeLevel() {\n    var _this$getBlock3;\n\n    const attribute = (_this$getBlock3 = this.getBlock()) === null || _this$getBlock3 === void 0 ? void 0 : _this$getBlock3.getLastAttribute();\n\n    if (attribute) {\n      return this.removeCurrentAttribute(attribute);\n    }\n  }\n\n  decreaseListLevel() {\n    let [startPosition] = Array.from(this.getSelectedRange());\n    const {\n      index\n    } = this.document.locationFromPosition(startPosition);\n    let endIndex = index;\n    const attributeLevel = this.getBlock().getAttributeLevel();\n    let block = this.document.getBlockAtIndex(endIndex + 1);\n\n    while (block) {\n      if (!block.isListItem() || block.getAttributeLevel() <= attributeLevel) {\n        break;\n      }\n\n      endIndex++;\n      block = this.document.getBlockAtIndex(endIndex + 1);\n    }\n\n    startPosition = this.document.positionFromLocation({\n      index,\n      offset: 0\n    });\n    const endPosition = this.document.positionFromLocation({\n      index: endIndex,\n      offset: 0\n    });\n    return this.setDocument(this.document.removeLastListAttributeAtRange([startPosition, endPosition]));\n  }\n\n  updateCurrentAttributes() {\n    const selectedRange = this.getSelectedRange({\n      ignoreLock: true\n    });\n\n    if (selectedRange) {\n      const currentAttributes = this.document.getCommonAttributesAtRange(selectedRange);\n      Array.from(getAllAttributeNames()).forEach(attributeName => {\n        if (!currentAttributes[attributeName]) {\n          if (!this.canSetCurrentAttribute(attributeName)) {\n            currentAttributes[attributeName] = false;\n          }\n        }\n      });\n\n      if (!objectsAreEqual(currentAttributes, this.currentAttributes)) {\n        this.currentAttributes = currentAttributes;\n        return this.notifyDelegateOfCurrentAttributesChange();\n      }\n    }\n  }\n\n  getCurrentAttributes() {\n    return extend.call({}, this.currentAttributes);\n  }\n\n  getCurrentTextAttributes() {\n    const attributes = {};\n\n    for (const key in this.currentAttributes) {\n      const value = this.currentAttributes[key];\n\n      if (value !== false) {\n        if (getTextConfig(key)) {\n          attributes[key] = value;\n        }\n      }\n    }\n\n    return attributes;\n  } // Selection freezing\n\n\n  freezeSelection() {\n    return this.setCurrentAttribute(\"frozen\", true);\n  }\n\n  thawSelection() {\n    return this.removeCurrentAttribute(\"frozen\");\n  }\n\n  hasFrozenSelection() {\n    return this.hasCurrentAttribute(\"frozen\");\n  }\n\n  setSelection(selectedRange) {\n    var _this$delegate5;\n\n    const locationRange = this.document.locationRangeFromRange(selectedRange);\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.compositionDidRequestChangingSelectionToLocationRange(locationRange);\n  }\n\n  getSelectedRange() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.rangeFromLocationRange(locationRange);\n    }\n  }\n\n  setSelectedRange(selectedRange) {\n    const locationRange = this.document.locationRangeFromRange(selectedRange);\n    return this.getSelectionManager().setLocationRange(locationRange);\n  }\n\n  getPosition() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.positionFromLocation(locationRange[0]);\n    }\n  }\n\n  getLocationRange(options) {\n    if (this.targetLocationRange) {\n      return this.targetLocationRange;\n    } else {\n      return this.getSelectionManager().getLocationRange(options) || normalizeRange({\n        index: 0,\n        offset: 0\n      });\n    }\n  }\n\n  withTargetLocationRange(locationRange, fn) {\n    let result;\n    this.targetLocationRange = locationRange;\n\n    try {\n      result = fn();\n    } finally {\n      this.targetLocationRange = null;\n    }\n\n    return result;\n  }\n\n  withTargetRange(range, fn) {\n    const locationRange = this.document.locationRangeFromRange(range);\n    return this.withTargetLocationRange(locationRange, fn);\n  }\n\n  withTargetDOMRange(domRange, fn) {\n    const locationRange = this.createLocationRangeFromDOMRange(domRange, {\n      strict: false\n    });\n    return this.withTargetLocationRange(locationRange, fn);\n  }\n\n  getExpandedRangeInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let [startPosition, endPosition] = Array.from(this.getSelectedRange());\n\n    if (direction === \"backward\") {\n      if (length) {\n        startPosition -= length;\n      } else {\n        startPosition = this.translateUTF16PositionFromOffset(startPosition, -1);\n      }\n    } else {\n      if (length) {\n        endPosition += length;\n      } else {\n        endPosition = this.translateUTF16PositionFromOffset(endPosition, 1);\n      }\n    }\n\n    return normalizeRange([startPosition, endPosition]);\n  }\n\n  shouldManageMovingCursorInDirection(direction) {\n    if (this.editingAttachment) {\n      return true;\n    }\n\n    const range = this.getExpandedRangeInDirection(direction);\n    return this.getAttachmentAtRange(range) != null;\n  }\n\n  moveCursorInDirection(direction) {\n    let canEditAttachment, range;\n\n    if (this.editingAttachment) {\n      range = this.document.getRangeOfAttachment(this.editingAttachment);\n    } else {\n      const selectedRange = this.getSelectedRange();\n      range = this.getExpandedRangeInDirection(direction);\n      canEditAttachment = !rangesAreEqual(selectedRange, range);\n    }\n\n    if (direction === \"backward\") {\n      this.setSelectedRange(range[0]);\n    } else {\n      this.setSelectedRange(range[1]);\n    }\n\n    if (canEditAttachment) {\n      const attachment = this.getAttachmentAtRange(range);\n\n      if (attachment) {\n        return this.editAttachment(attachment);\n      }\n    }\n  }\n\n  expandSelectionInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const range = this.getExpandedRangeInDirection(direction, {\n      length\n    });\n    return this.setSelectedRange(range);\n  }\n\n  expandSelectionForEditing() {\n    if (this.hasCurrentAttribute(\"href\")) {\n      return this.expandSelectionAroundCommonAttribute(\"href\");\n    }\n  }\n\n  expandSelectionAroundCommonAttribute(attributeName) {\n    const position = this.getPosition();\n    const range = this.document.getRangeOfCommonAttributeAtPosition(attributeName, position);\n    return this.setSelectedRange(range);\n  }\n\n  selectionContainsAttachments() {\n    var _this$getSelectedAtta;\n\n    return ((_this$getSelectedAtta = this.getSelectedAttachments()) === null || _this$getSelectedAtta === void 0 ? void 0 : _this$getSelectedAtta.length) > 0;\n  }\n\n  selectionIsInCursorTarget() {\n    return this.editingAttachment || this.positionIsCursorTarget(this.getPosition());\n  }\n\n  positionIsCursorTarget(position) {\n    const location = this.document.locationFromPosition(position);\n\n    if (location) {\n      return this.locationIsCursorTarget(location);\n    }\n  }\n\n  positionIsBlockBreak(position) {\n    var _this$document$getPie;\n\n    return (_this$document$getPie = this.document.getPieceAtPosition(position)) === null || _this$document$getPie === void 0 ? void 0 : _this$document$getPie.isBlockBreak();\n  }\n\n  getSelectedDocument() {\n    const selectedRange = this.getSelectedRange();\n\n    if (selectedRange) {\n      return this.document.getDocumentAtRange(selectedRange);\n    }\n  }\n\n  getSelectedAttachments() {\n    var _this$getSelectedDocu;\n\n    return (_this$getSelectedDocu = this.getSelectedDocument()) === null || _this$getSelectedDocu === void 0 ? void 0 : _this$getSelectedDocu.getAttachments();\n  } // Attachments\n\n\n  getAttachments() {\n    return this.attachments.slice(0);\n  }\n\n  refreshAttachments() {\n    const attachments = this.document.getAttachments();\n    const {\n      added,\n      removed\n    } = summarizeArrayChange(this.attachments, attachments);\n    this.attachments = attachments;\n    Array.from(removed).forEach(attachment => {\n      var _this$delegate6, _this$delegate6$compo;\n\n      attachment.delegate = null;\n      (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionDidRemoveAttachment) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6, attachment);\n    });\n    return (() => {\n      const result = [];\n      Array.from(added).forEach(attachment => {\n        var _this$delegate7, _this$delegate7$compo;\n\n        attachment.delegate = this;\n        result.push((_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionDidAddAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment));\n      });\n      return result;\n    })();\n  } // Attachment delegate\n\n\n  attachmentDidChangeAttributes(attachment) {\n    var _this$delegate8, _this$delegate8$compo;\n\n    this.revision++;\n    return (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionDidEditAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n  }\n\n  attachmentDidChangePreviewURL(attachment) {\n    var _this$delegate9, _this$delegate9$compo;\n\n    this.revision++;\n    return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionDidChangeAttachmentPreviewURL) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n  } // Attachment editing\n\n\n  editAttachment(attachment, options) {\n    var _this$delegate10, _this$delegate10$comp;\n\n    if (attachment === this.editingAttachment) return;\n    this.stopEditingAttachment();\n    this.editingAttachment = attachment;\n    return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionDidStartEditingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, this.editingAttachment, options);\n  }\n\n  stopEditingAttachment() {\n    var _this$delegate11, _this$delegate11$comp;\n\n    if (!this.editingAttachment) return;\n    (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : (_this$delegate11$comp = _this$delegate11.compositionDidStopEditingAttachment) === null || _this$delegate11$comp === void 0 ? void 0 : _this$delegate11$comp.call(_this$delegate11, this.editingAttachment);\n    this.editingAttachment = null;\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    return this.setDocument(this.document.updateAttributesForAttachment(attributes, attachment));\n  }\n\n  removeAttributeForAttachment(attribute, attachment) {\n    return this.setDocument(this.document.removeAttributeForAttachment(attribute, attachment));\n  } // Private\n\n\n  breakFormattedBlock(insertion) {\n    let {\n      document\n    } = insertion;\n    const {\n      block\n    } = insertion;\n    let position = insertion.startPosition;\n    let range = [position - 1, position];\n\n    if (block.getBlockBreakPosition() === insertion.startLocation.offset) {\n      if (block.breaksOnReturn() && insertion.nextCharacter === \"\\n\") {\n        position += 1;\n      } else {\n        document = document.removeTextAtRange(range);\n      }\n\n      range = [position, position];\n    } else if (insertion.nextCharacter === \"\\n\") {\n      if (insertion.previousCharacter === \"\\n\") {\n        range = [position - 1, position + 1];\n      } else {\n        range = [position, position + 1];\n        position += 1;\n      }\n    } else if (insertion.startLocation.offset - 1 !== 0) {\n      position += 1;\n    }\n\n    const newDocument = new Document([block.removeLastAttribute().copyWithoutText()]);\n    this.setDocument(document.insertDocumentAtRange(newDocument, range));\n    return this.setSelection(position);\n  }\n\n  getPreviousBlock() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      const {\n        index\n      } = locationRange[0];\n\n      if (index > 0) {\n        return this.document.getBlockAtIndex(index - 1);\n      }\n    }\n  }\n\n  getBlock() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.getBlockAtIndex(locationRange[0].index);\n    }\n  }\n\n  getAttachmentAtRange(range) {\n    const document = this.document.getDocumentAtRange(range);\n\n    if (document.toString() === \"\".concat(OBJECT_REPLACEMENT_CHARACTER, \"\\n\")) {\n      return document.getAttachments()[0];\n    }\n  }\n\n  notifyDelegateOfCurrentAttributesChange() {\n    var _this$delegate12, _this$delegate12$comp;\n\n    return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : (_this$delegate12$comp = _this$delegate12.compositionDidChangeCurrentAttributes) === null || _this$delegate12$comp === void 0 ? void 0 : _this$delegate12$comp.call(_this$delegate12, this.currentAttributes);\n  }\n\n  notifyDelegateOfInsertionAtRange(range) {\n    var _this$delegate13, _this$delegate13$comp;\n\n    return (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : (_this$delegate13$comp = _this$delegate13.compositionDidPerformInsertionAtRange) === null || _this$delegate13$comp === void 0 ? void 0 : _this$delegate13$comp.call(_this$delegate13, range);\n  }\n\n  translateUTF16PositionFromOffset(position, offset) {\n    const utf16string = this.document.toUTF16String();\n    const utf16position = utf16string.offsetFromUCS2Offset(position);\n    return utf16string.offsetToUCS2Offset(utf16position + offset);\n  }\n\n}\nComposition.proxyMethod(\"getSelectionManager().getPointRange\");\nComposition.proxyMethod(\"getSelectionManager().setLocationRangeFromPointRange\");\nComposition.proxyMethod(\"getSelectionManager().createLocationRangeFromDOMRange\");\nComposition.proxyMethod(\"getSelectionManager().locationIsCursorTarget\");\nComposition.proxyMethod(\"getSelectionManager().selectionIsExpanded\");\nComposition.proxyMethod(\"delegate?.getSelectionManager\");\n\nclass UndoManager extends BasicObject {\n  constructor(composition) {\n    super(...arguments);\n    this.composition = composition;\n    this.undoEntries = [];\n    this.redoEntries = [];\n  }\n\n  recordUndoEntry(description) {\n    let {\n      context,\n      consolidatable\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const previousEntry = this.undoEntries.slice(-1)[0];\n\n    if (!consolidatable || !entryHasDescriptionAndContext(previousEntry, description, context)) {\n      const undoEntry = this.createEntry({\n        description,\n        context\n      });\n      this.undoEntries.push(undoEntry);\n      this.redoEntries = [];\n    }\n  }\n\n  undo() {\n    const undoEntry = this.undoEntries.pop();\n\n    if (undoEntry) {\n      const redoEntry = this.createEntry(undoEntry);\n      this.redoEntries.push(redoEntry);\n      return this.composition.loadSnapshot(undoEntry.snapshot);\n    }\n  }\n\n  redo() {\n    const redoEntry = this.redoEntries.pop();\n\n    if (redoEntry) {\n      const undoEntry = this.createEntry(redoEntry);\n      this.undoEntries.push(undoEntry);\n      return this.composition.loadSnapshot(redoEntry.snapshot);\n    }\n  }\n\n  canUndo() {\n    return this.undoEntries.length > 0;\n  }\n\n  canRedo() {\n    return this.redoEntries.length > 0;\n  } // Private\n\n\n  createEntry() {\n    let {\n      description,\n      context\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return {\n      description: description === null || description === void 0 ? void 0 : description.toString(),\n      context: JSON.stringify(context),\n      snapshot: this.composition.getSnapshot()\n    };\n  }\n\n}\n\nconst entryHasDescriptionAndContext = (entry, description, context) => (entry === null || entry === void 0 ? void 0 : entry.description) === (description === null || description === void 0 ? void 0 : description.toString()) && (entry === null || entry === void 0 ? void 0 : entry.context) === JSON.stringify(context);\n\nconst attachmentGalleryFilter = function (snapshot) {\n  const filter = new Filter(snapshot);\n  filter.perform();\n  return filter.getSnapshot();\n};\nconst BLOCK_ATTRIBUTE_NAME = \"attachmentGallery\";\nconst TEXT_ATTRIBUTE_NAME = \"presentation\";\nconst TEXT_ATTRIBUTE_VALUE = \"gallery\";\n\nclass Filter {\n  constructor(snapshot) {\n    this.document = snapshot.document;\n    this.selectedRange = snapshot.selectedRange;\n  }\n\n  perform() {\n    this.removeBlockAttribute();\n    return this.applyBlockAttribute();\n  }\n\n  getSnapshot() {\n    return {\n      document: this.document,\n      selectedRange: this.selectedRange\n    };\n  } // Private\n\n\n  removeBlockAttribute() {\n    return this.findRangesOfBlocks().map(range => this.document = this.document.removeAttributeAtRange(BLOCK_ATTRIBUTE_NAME, range));\n  }\n\n  applyBlockAttribute() {\n    let offset = 0;\n    this.findRangesOfPieces().forEach(range => {\n      if (range[1] - range[0] > 1) {\n        range[0] += offset;\n        range[1] += offset;\n\n        if (this.document.getCharacterAtPosition(range[1]) !== \"\\n\") {\n          this.document = this.document.insertBlockBreakAtRange(range[1]);\n\n          if (range[1] < this.selectedRange[1]) {\n            this.moveSelectedRangeForward();\n          }\n\n          range[1]++;\n          offset++;\n        }\n\n        if (range[0] !== 0) {\n          if (this.document.getCharacterAtPosition(range[0] - 1) !== \"\\n\") {\n            this.document = this.document.insertBlockBreakAtRange(range[0]);\n\n            if (range[0] < this.selectedRange[0]) {\n              this.moveSelectedRangeForward();\n            }\n\n            range[0]++;\n            offset++;\n          }\n        }\n\n        this.document = this.document.applyBlockAttributeAtRange(BLOCK_ATTRIBUTE_NAME, true, range);\n      }\n    });\n  }\n\n  findRangesOfBlocks() {\n    return this.document.findRangesForBlockAttribute(BLOCK_ATTRIBUTE_NAME);\n  }\n\n  findRangesOfPieces() {\n    return this.document.findRangesForTextAttribute(TEXT_ATTRIBUTE_NAME, {\n      withValue: TEXT_ATTRIBUTE_VALUE\n    });\n  }\n\n  moveSelectedRangeForward() {\n    this.selectedRange[0] += 1;\n    this.selectedRange[1] += 1;\n  }\n\n}\n\nconst DEFAULT_FILTERS = [attachmentGalleryFilter];\nclass Editor {\n  constructor(composition, selectionManager, element) {\n    this.insertFiles = this.insertFiles.bind(this);\n    this.composition = composition;\n    this.selectionManager = selectionManager;\n    this.element = element;\n    this.undoManager = new UndoManager(this.composition);\n    this.filters = DEFAULT_FILTERS.slice(0);\n  }\n\n  loadDocument(document) {\n    return this.loadSnapshot({\n      document,\n      selectedRange: [0, 0]\n    });\n  }\n\n  loadHTML() {\n    let html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    const document = HTMLParser.parse(html, {\n      referenceElement: this.element\n    }).getDocument();\n    return this.loadDocument(document);\n  }\n\n  loadJSON(_ref) {\n    let {\n      document,\n      selectedRange\n    } = _ref;\n    document = Document.fromJSON(document);\n    return this.loadSnapshot({\n      document,\n      selectedRange\n    });\n  }\n\n  loadSnapshot(snapshot) {\n    this.undoManager = new UndoManager(this.composition);\n    return this.composition.loadSnapshot(snapshot);\n  }\n\n  getDocument() {\n    return this.composition.document;\n  }\n\n  getSelectedDocument() {\n    return this.composition.getSelectedDocument();\n  }\n\n  getSnapshot() {\n    return this.composition.getSnapshot();\n  }\n\n  toJSON() {\n    return this.getSnapshot();\n  } // Document manipulation\n\n\n  deleteInDirection(direction) {\n    return this.composition.deleteInDirection(direction);\n  }\n\n  insertAttachment(attachment) {\n    return this.composition.insertAttachment(attachment);\n  }\n\n  insertAttachments(attachments) {\n    return this.composition.insertAttachments(attachments);\n  }\n\n  insertDocument(document) {\n    return this.composition.insertDocument(document);\n  }\n\n  insertFile(file) {\n    return this.composition.insertFile(file);\n  }\n\n  insertFiles(files) {\n    return this.composition.insertFiles(files);\n  }\n\n  insertHTML(html) {\n    return this.composition.insertHTML(html);\n  }\n\n  insertString(string) {\n    return this.composition.insertString(string);\n  }\n\n  insertText(text) {\n    return this.composition.insertText(text);\n  }\n\n  insertLineBreak() {\n    return this.composition.insertLineBreak();\n  } // Selection\n\n\n  getSelectedRange() {\n    return this.composition.getSelectedRange();\n  }\n\n  getPosition() {\n    return this.composition.getPosition();\n  }\n\n  getClientRectAtPosition(position) {\n    const locationRange = this.getDocument().locationRangeFromRange([position, position + 1]);\n    return this.selectionManager.getClientRectAtLocationRange(locationRange);\n  }\n\n  expandSelectionInDirection(direction) {\n    return this.composition.expandSelectionInDirection(direction);\n  }\n\n  moveCursorInDirection(direction) {\n    return this.composition.moveCursorInDirection(direction);\n  }\n\n  setSelectedRange(selectedRange) {\n    return this.composition.setSelectedRange(selectedRange);\n  } // Attributes\n\n\n  activateAttribute(name) {\n    let value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    return this.composition.setCurrentAttribute(name, value);\n  }\n\n  attributeIsActive(name) {\n    return this.composition.hasCurrentAttribute(name);\n  }\n\n  canActivateAttribute(name) {\n    return this.composition.canSetCurrentAttribute(name);\n  }\n\n  deactivateAttribute(name) {\n    return this.composition.removeCurrentAttribute(name);\n  } // Nesting level\n\n\n  canDecreaseNestingLevel() {\n    return this.composition.canDecreaseNestingLevel();\n  }\n\n  canIncreaseNestingLevel() {\n    return this.composition.canIncreaseNestingLevel();\n  }\n\n  decreaseNestingLevel() {\n    if (this.canDecreaseNestingLevel()) {\n      return this.composition.decreaseNestingLevel();\n    }\n  }\n\n  increaseNestingLevel() {\n    if (this.canIncreaseNestingLevel()) {\n      return this.composition.increaseNestingLevel();\n    }\n  } // Undo/redo\n\n\n  canRedo() {\n    return this.undoManager.canRedo();\n  }\n\n  canUndo() {\n    return this.undoManager.canUndo();\n  }\n\n  recordUndoEntry(description) {\n    let {\n      context,\n      consolidatable\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.undoManager.recordUndoEntry(description, {\n      context,\n      consolidatable\n    });\n  }\n\n  redo() {\n    if (this.canRedo()) {\n      return this.undoManager.redo();\n    }\n  }\n\n  undo() {\n    if (this.canUndo()) {\n      return this.undoManager.undo();\n    }\n  }\n\n}\n\n/* eslint-disable\n    no-var,\n    prefer-const,\n*/\nclass LocationMapper {\n  constructor(element) {\n    this.element = element;\n  }\n\n  findLocationFromContainerAndOffset(container, offset) {\n    let {\n      strict\n    } = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n      strict: true\n    };\n    let childIndex = 0;\n    let foundBlock = false;\n    const location = {\n      index: 0,\n      offset: 0\n    };\n    const attachmentElement = this.findAttachmentElementParentForNode(container);\n\n    if (attachmentElement) {\n      container = attachmentElement.parentNode;\n      offset = findChildIndexOfNode(attachmentElement);\n    }\n\n    const walker = walkTree(this.element, {\n      usingFilter: rejectAttachmentContents\n    });\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      if (node === container && nodeIsTextNode(container)) {\n        if (!nodeIsCursorTarget(node)) {\n          location.offset += offset;\n        }\n\n        break;\n      } else {\n        if (node.parentNode === container) {\n          if (childIndex++ === offset) {\n            break;\n          }\n        } else if (!elementContainsNode(container, node)) {\n          if (childIndex > 0) {\n            break;\n          }\n        }\n\n        if (nodeIsBlockStart(node, {\n          strict\n        })) {\n          if (foundBlock) {\n            location.index++;\n          }\n\n          location.offset = 0;\n          foundBlock = true;\n        } else {\n          location.offset += nodeLength(node);\n        }\n      }\n    }\n\n    return location;\n  }\n\n  findContainerAndOffsetFromLocation(location) {\n    let container, offset;\n\n    if (location.index === 0 && location.offset === 0) {\n      container = this.element;\n      offset = 0;\n\n      while (container.firstChild) {\n        container = container.firstChild;\n\n        if (nodeIsBlockContainer(container)) {\n          offset = 1;\n          break;\n        }\n      }\n\n      return [container, offset];\n    }\n\n    let [node, nodeOffset] = this.findNodeAndOffsetFromLocation(location);\n    if (!node) return;\n\n    if (nodeIsTextNode(node)) {\n      if (nodeLength(node) === 0) {\n        container = node.parentNode.parentNode;\n        offset = findChildIndexOfNode(node.parentNode);\n\n        if (nodeIsCursorTarget(node, {\n          name: \"right\"\n        })) {\n          offset++;\n        }\n      } else {\n        container = node;\n        offset = location.offset - nodeOffset;\n      }\n    } else {\n      container = node.parentNode;\n\n      if (!nodeIsBlockStart(node.previousSibling)) {\n        if (!nodeIsBlockContainer(container)) {\n          while (node === container.lastChild) {\n            node = container;\n            container = container.parentNode;\n\n            if (nodeIsBlockContainer(container)) {\n              break;\n            }\n          }\n        }\n      }\n\n      offset = findChildIndexOfNode(node);\n\n      if (location.offset !== 0) {\n        offset++;\n      }\n    }\n\n    return [container, offset];\n  }\n\n  findNodeAndOffsetFromLocation(location) {\n    let node, nodeOffset;\n    let offset = 0;\n\n    for (const currentNode of this.getSignificantNodesForIndex(location.index)) {\n      const length = nodeLength(currentNode);\n\n      if (location.offset <= offset + length) {\n        if (nodeIsTextNode(currentNode)) {\n          node = currentNode;\n          nodeOffset = offset;\n\n          if (location.offset === nodeOffset && nodeIsCursorTarget(node)) {\n            break;\n          }\n        } else if (!node) {\n          node = currentNode;\n          nodeOffset = offset;\n        }\n      }\n\n      offset += length;\n\n      if (offset > location.offset) {\n        break;\n      }\n    }\n\n    return [node, nodeOffset];\n  } // Private\n\n\n  findAttachmentElementParentForNode(node) {\n    while (node && node !== this.element) {\n      if (nodeIsAttachmentElement(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n  }\n\n  getSignificantNodesForIndex(index) {\n    const nodes = [];\n    const walker = walkTree(this.element, {\n      usingFilter: acceptSignificantNodes\n    });\n    let recordingNodes = false;\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      if (nodeIsBlockStartComment(node)) {\n        var blockIndex;\n\n        if (blockIndex != null) {\n          blockIndex++;\n        } else {\n          blockIndex = 0;\n        }\n\n        if (blockIndex === index) {\n          recordingNodes = true;\n        } else if (recordingNodes) {\n          break;\n        }\n      } else if (recordingNodes) {\n        nodes.push(node);\n      }\n    }\n\n    return nodes;\n  }\n\n}\n\nconst nodeLength = function (node) {\n  if (node.nodeType === Node.TEXT_NODE) {\n    if (nodeIsCursorTarget(node)) {\n      return 0;\n    } else {\n      const string = node.textContent;\n      return string.length;\n    }\n  } else if (tagName(node) === \"br\" || nodeIsAttachmentElement(node)) {\n    return 1;\n  } else {\n    return 0;\n  }\n};\n\nconst acceptSignificantNodes = function (node) {\n  if (rejectEmptyTextNodes(node) === NodeFilter.FILTER_ACCEPT) {\n    return rejectAttachmentContents(node);\n  } else {\n    return NodeFilter.FILTER_REJECT;\n  }\n};\n\nconst rejectEmptyTextNodes = function (node) {\n  if (nodeIsEmptyTextNode(node)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n\nconst rejectAttachmentContents = function (node) {\n  if (nodeIsAttachmentElement(node.parentNode)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n\n/* eslint-disable\n    id-length,\n    no-empty,\n*/\nclass PointMapper {\n  createDOMRangeFromPoint(_ref) {\n    let {\n      x,\n      y\n    } = _ref;\n    let domRange;\n\n    if (document.caretPositionFromPoint) {\n      const {\n        offsetNode,\n        offset\n      } = document.caretPositionFromPoint(x, y);\n      domRange = document.createRange();\n      domRange.setStart(offsetNode, offset);\n      return domRange;\n    } else if (document.caretRangeFromPoint) {\n      return document.caretRangeFromPoint(x, y);\n    } else if (document.body.createTextRange) {\n      const originalDOMRange = getDOMRange();\n\n      try {\n        // IE 11 throws \"Unspecified error\" when using moveToPoint\n        // during a drag-and-drop operation.\n        const textRange = document.body.createTextRange();\n        textRange.moveToPoint(x, y);\n        textRange.select();\n      } catch (error) {}\n\n      domRange = getDOMRange();\n      setDOMRange(originalDOMRange);\n      return domRange;\n    }\n  }\n\n  getClientRectsForDOMRange(domRange) {\n    const array = Array.from(domRange.getClientRects());\n    const start = array[0];\n    const end = array[array.length - 1];\n    return [start, end];\n  }\n\n}\n\n/* eslint-disable\n*/\nclass SelectionManager extends BasicObject {\n  constructor(element) {\n    super(...arguments);\n    this.didMouseDown = this.didMouseDown.bind(this);\n    this.selectionDidChange = this.selectionDidChange.bind(this);\n    this.element = element;\n    this.locationMapper = new LocationMapper(this.element);\n    this.pointMapper = new PointMapper();\n    this.lockCount = 0;\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      withCallback: this.didMouseDown\n    });\n  }\n\n  getLocationRange() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (options.strict === false) {\n      return this.createLocationRangeFromDOMRange(getDOMRange());\n    } else if (options.ignoreLock) {\n      return this.currentLocationRange;\n    } else if (this.lockedLocationRange) {\n      return this.lockedLocationRange;\n    } else {\n      return this.currentLocationRange;\n    }\n  }\n\n  setLocationRange(locationRange) {\n    if (this.lockedLocationRange) return;\n    locationRange = normalizeRange(locationRange);\n    const domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n    if (domRange) {\n      setDOMRange(domRange);\n      this.updateCurrentLocationRange(locationRange);\n    }\n  }\n\n  setLocationRangeFromPointRange(pointRange) {\n    pointRange = normalizeRange(pointRange);\n    const startLocation = this.getLocationAtPoint(pointRange[0]);\n    const endLocation = this.getLocationAtPoint(pointRange[1]);\n    this.setLocationRange([startLocation, endLocation]);\n  }\n\n  getClientRectAtLocationRange(locationRange) {\n    const domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n    if (domRange) {\n      return this.getClientRectsForDOMRange(domRange)[1];\n    }\n  }\n\n  locationIsCursorTarget(location) {\n    const node = Array.from(this.findNodeAndOffsetFromLocation(location))[0];\n    return nodeIsCursorTarget(node);\n  }\n\n  lock() {\n    if (this.lockCount++ === 0) {\n      this.updateCurrentLocationRange();\n      this.lockedLocationRange = this.getLocationRange();\n    }\n  }\n\n  unlock() {\n    if (--this.lockCount === 0) {\n      const {\n        lockedLocationRange\n      } = this;\n      this.lockedLocationRange = null;\n\n      if (lockedLocationRange != null) {\n        return this.setLocationRange(lockedLocationRange);\n      }\n    }\n  }\n\n  clearSelection() {\n    var _getDOMSelection;\n\n    return (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.removeAllRanges();\n  }\n\n  selectionIsCollapsed() {\n    var _getDOMRange;\n\n    return ((_getDOMRange = getDOMRange()) === null || _getDOMRange === void 0 ? void 0 : _getDOMRange.collapsed) === true;\n  }\n\n  selectionIsExpanded() {\n    return !this.selectionIsCollapsed();\n  }\n\n  createLocationRangeFromDOMRange(domRange, options) {\n    if (domRange == null || !this.domRangeWithinElement(domRange)) return;\n    const start = this.findLocationFromContainerAndOffset(domRange.startContainer, domRange.startOffset, options);\n    if (!start) return;\n    const end = domRange.collapsed ? undefined : this.findLocationFromContainerAndOffset(domRange.endContainer, domRange.endOffset, options);\n    return normalizeRange([start, end]);\n  }\n\n  didMouseDown() {\n    return this.pauseTemporarily();\n  }\n\n  pauseTemporarily() {\n    let resumeHandlers;\n    this.paused = true;\n\n    const resume = () => {\n      this.paused = false;\n      clearTimeout(resumeTimeout);\n      Array.from(resumeHandlers).forEach(handler => {\n        handler.destroy();\n      });\n\n      if (elementContainsNode(document, this.element)) {\n        return this.selectionDidChange();\n      }\n    };\n\n    const resumeTimeout = setTimeout(resume, 200);\n    resumeHandlers = [\"mousemove\", \"keydown\"].map(eventName => handleEvent(eventName, {\n      onElement: document,\n      withCallback: resume\n    }));\n  }\n\n  selectionDidChange() {\n    if (!this.paused && !innerElementIsActive(this.element)) {\n      return this.updateCurrentLocationRange();\n    }\n  }\n\n  updateCurrentLocationRange(locationRange) {\n    if (locationRange != null ? locationRange : locationRange = this.createLocationRangeFromDOMRange(getDOMRange())) {\n      if (!rangesAreEqual(locationRange, this.currentLocationRange)) {\n        var _this$delegate, _this$delegate$locati;\n\n        this.currentLocationRange = locationRange;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$locati = _this$delegate.locationRangeDidChange) === null || _this$delegate$locati === void 0 ? void 0 : _this$delegate$locati.call(_this$delegate, this.currentLocationRange.slice(0));\n      }\n    }\n  }\n\n  createDOMRangeFromLocationRange(locationRange) {\n    const rangeStart = this.findContainerAndOffsetFromLocation(locationRange[0]);\n    const rangeEnd = rangeIsCollapsed(locationRange) ? rangeStart : this.findContainerAndOffsetFromLocation(locationRange[1]) || rangeStart;\n\n    if (rangeStart != null && rangeEnd != null) {\n      const domRange = document.createRange();\n      domRange.setStart(...Array.from(rangeStart || []));\n      domRange.setEnd(...Array.from(rangeEnd || []));\n      return domRange;\n    }\n  }\n\n  getLocationAtPoint(point) {\n    const domRange = this.createDOMRangeFromPoint(point);\n\n    if (domRange) {\n      var _this$createLocationR;\n\n      return (_this$createLocationR = this.createLocationRangeFromDOMRange(domRange)) === null || _this$createLocationR === void 0 ? void 0 : _this$createLocationR[0];\n    }\n  }\n\n  domRangeWithinElement(domRange) {\n    if (domRange.collapsed) {\n      return elementContainsNode(this.element, domRange.startContainer);\n    } else {\n      return elementContainsNode(this.element, domRange.startContainer) && elementContainsNode(this.element, domRange.endContainer);\n    }\n  }\n\n}\nSelectionManager.proxyMethod(\"locationMapper.findLocationFromContainerAndOffset\");\nSelectionManager.proxyMethod(\"locationMapper.findContainerAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"locationMapper.findNodeAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"pointMapper.createDOMRangeFromPoint\");\nSelectionManager.proxyMethod(\"pointMapper.getClientRectsForDOMRange\");\n\nvar models = {\n  Attachment,\n  AttachmentManager,\n  AttachmentPiece,\n  Block,\n  Composition,\n  Cocument: Document,\n  Editor,\n  HTMLParser,\n  HTMLSanitizer,\n  LineBreakInsertion,\n  LocationMapper,\n  ManagedAttachment,\n  Piece,\n  PointMapper,\n  SelectionManager,\n  SplittableList,\n  StringPiece,\n  Text,\n  UndoManager\n};\n\nconst Trix = {\n  VERSION: version,\n  config\n};\nObject.assign(Trix, models);\nwindow.Trix = Trix;\n\nclass ObjectGroup {\n  static groupObjects() {\n    let ungroupedObjects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      depth,\n      asTree\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let group;\n\n    if (asTree) {\n      if (depth == null) {\n        depth = 0;\n      }\n    }\n\n    const objects = [];\n    Array.from(ungroupedObjects).forEach(object => {\n      var _object$canBeGrouped2;\n\n      if (group) {\n        var _object$canBeGrouped, _group$canBeGroupedWi, _group;\n\n        if ((_object$canBeGrouped = object.canBeGrouped) !== null && _object$canBeGrouped !== void 0 && _object$canBeGrouped.call(object, depth) && (_group$canBeGroupedWi = (_group = group[group.length - 1]).canBeGroupedWith) !== null && _group$canBeGroupedWi !== void 0 && _group$canBeGroupedWi.call(_group, object, depth)) {\n          group.push(object);\n          return;\n        } else {\n          objects.push(new this(group, {\n            depth,\n            asTree\n          }));\n          group = null;\n        }\n      }\n\n      if ((_object$canBeGrouped2 = object.canBeGrouped) !== null && _object$canBeGrouped2 !== void 0 && _object$canBeGrouped2.call(object, depth)) {\n        group = [object];\n      } else {\n        objects.push(object);\n      }\n    });\n\n    if (group) {\n      objects.push(new this(group, {\n        depth,\n        asTree\n      }));\n    }\n\n    return objects;\n  }\n\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      depth,\n      asTree\n    } = arguments.length > 1 ? arguments[1] : undefined;\n    this.objects = objects;\n\n    if (asTree) {\n      this.depth = depth;\n      this.objects = this.constructor.groupObjects(this.objects, {\n        asTree,\n        depth: this.depth + 1\n      });\n    }\n  }\n\n  getObjects() {\n    return this.objects;\n  }\n\n  getDepth() {\n    return this.depth;\n  }\n\n  getCacheKey() {\n    const keys = [\"objectGroup\"];\n    Array.from(this.getObjects()).forEach(object => {\n      keys.push(object.getCacheKey());\n    });\n    return keys.join(\"/\");\n  }\n\n}\n\nclass ElementStore {\n  constructor(elements) {\n    this.reset(elements);\n  }\n\n  add(element) {\n    const key = getKey(element);\n    this.elements[key] = element;\n  }\n\n  remove(element) {\n    const key = getKey(element);\n    const value = this.elements[key];\n\n    if (value) {\n      delete this.elements[key];\n      return value;\n    }\n  }\n\n  reset() {\n    let elements = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    this.elements = {};\n    Array.from(elements).forEach(element => {\n      this.add(element);\n    });\n    return elements;\n  }\n\n}\n\nconst getKey = element => element.dataset.trixStoreKey;\n\nclass ObjectView extends BasicObject {\n  constructor(object) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.object = object;\n    this.options = options;\n    this.childViews = [];\n    this.rootView = this;\n  }\n\n  getNodes() {\n    if (!this.nodes) {\n      this.nodes = this.createNodes();\n    }\n\n    return this.nodes.map(node => node.cloneNode(true));\n  }\n\n  invalidate() {\n    var _this$parentView;\n\n    this.nodes = null;\n    this.childViews = [];\n    return (_this$parentView = this.parentView) === null || _this$parentView === void 0 ? void 0 : _this$parentView.invalidate();\n  }\n\n  invalidateViewForObject(object) {\n    var _this$findViewForObje;\n\n    return (_this$findViewForObje = this.findViewForObject(object)) === null || _this$findViewForObje === void 0 ? void 0 : _this$findViewForObje.invalidate();\n  }\n\n  findOrCreateCachedChildView(viewClass, object, options) {\n    let view = this.getCachedViewForObject(object);\n\n    if (view) {\n      this.recordChildView(view);\n    } else {\n      view = this.createChildView(...arguments);\n      this.cacheViewForObject(view, object);\n    }\n\n    return view;\n  }\n\n  createChildView(viewClass, object) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (object instanceof ObjectGroup) {\n      options.viewClass = viewClass;\n      viewClass = ObjectGroupView;\n    }\n\n    const view = new viewClass(object, options);\n    return this.recordChildView(view);\n  }\n\n  recordChildView(view) {\n    view.parentView = this;\n    view.rootView = this.rootView;\n    this.childViews.push(view);\n    return view;\n  }\n\n  getAllChildViews() {\n    let views = [];\n    this.childViews.forEach(childView => {\n      views.push(childView);\n      views = views.concat(childView.getAllChildViews());\n    });\n    return views;\n  }\n\n  findElement() {\n    return this.findElementForObject(this.object);\n  }\n\n  findElementForObject(object) {\n    const id = object === null || object === void 0 ? void 0 : object.id;\n\n    if (id) {\n      return this.rootView.element.querySelector(\"[data-trix-id='\".concat(id, \"']\"));\n    }\n  }\n\n  findViewForObject(object) {\n    for (const view of this.getAllChildViews()) {\n      if (view.object === object) {\n        return view;\n      }\n    }\n  }\n\n  getViewCache() {\n    if (this.rootView === this) {\n      if (this.isViewCachingEnabled()) {\n        if (!this.viewCache) {\n          this.viewCache = {};\n        }\n\n        return this.viewCache;\n      }\n    } else {\n      return this.rootView.getViewCache();\n    }\n  }\n\n  isViewCachingEnabled() {\n    return this.shouldCacheViews !== false;\n  }\n\n  enableViewCaching() {\n    this.shouldCacheViews = true;\n  }\n\n  disableViewCaching() {\n    this.shouldCacheViews = false;\n  }\n\n  getCachedViewForObject(object) {\n    var _this$getViewCache;\n\n    return (_this$getViewCache = this.getViewCache()) === null || _this$getViewCache === void 0 ? void 0 : _this$getViewCache[object.getCacheKey()];\n  }\n\n  cacheViewForObject(view, object) {\n    const cache = this.getViewCache();\n\n    if (cache) {\n      cache[object.getCacheKey()] = view;\n    }\n  }\n\n  garbageCollectCachedViews() {\n    const cache = this.getViewCache();\n\n    if (cache) {\n      const views = this.getAllChildViews().concat(this);\n      const objectKeys = views.map(view => view.object.getCacheKey());\n\n      for (const key in cache) {\n        if (!objectKeys.includes(key)) {\n          delete cache[key];\n        }\n      }\n    }\n  }\n\n}\nclass ObjectGroupView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.objectGroup = this.object;\n    this.viewClass = this.options.viewClass;\n    delete this.options.viewClass;\n  }\n\n  getChildViews() {\n    if (!this.childViews.length) {\n      Array.from(this.objectGroup.getObjects()).forEach(object => {\n        this.findOrCreateCachedChildView(this.viewClass, object, this.options);\n      });\n    }\n\n    return this.childViews;\n  }\n\n  createNodes() {\n    const element = this.createContainerElement();\n    this.getChildViews().forEach(view => {\n      Array.from(view.getNodes()).forEach(node => {\n        element.appendChild(node);\n      });\n    });\n    return [element];\n  }\n\n  createContainerElement() {\n    let depth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.objectGroup.getDepth();\n    return this.getChildViews()[0].createContainerElement(depth);\n  }\n\n}\n\nconst {\n  css: css$2\n} = config;\nclass AttachmentView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.attachment = this.object;\n    this.attachment.uploadProgressDelegate = this;\n    this.attachmentPiece = this.options.piece;\n  }\n\n  createContentNodes() {\n    return [];\n  }\n\n  createNodes() {\n    let innerElement;\n    const figure = innerElement = makeElement({\n      tagName: \"figure\",\n      className: this.getClassName(),\n      data: this.getData(),\n      editable: false\n    });\n    const href = this.getHref();\n\n    if (href) {\n      innerElement = makeElement({\n        tagName: \"a\",\n        editable: false,\n        attributes: {\n          href,\n          tabindex: -1\n        }\n      });\n      figure.appendChild(innerElement);\n    }\n\n    if (this.attachment.hasContent()) {\n      innerElement.innerHTML = this.attachment.getContent();\n    } else {\n      this.createContentNodes().forEach(node => {\n        innerElement.appendChild(node);\n      });\n    }\n\n    innerElement.appendChild(this.createCaptionElement());\n\n    if (this.attachment.isPending()) {\n      this.progressElement = makeElement({\n        tagName: \"progress\",\n        attributes: {\n          class: css$2.attachmentProgress,\n          value: this.attachment.getUploadProgress(),\n          max: 100\n        },\n        data: {\n          trixMutable: true,\n          trixStoreKey: [\"progressElement\", this.attachment.id].join(\"/\")\n        }\n      });\n      figure.appendChild(this.progressElement);\n    }\n\n    return [createCursorTarget(\"left\"), figure, createCursorTarget(\"right\")];\n  }\n\n  createCaptionElement() {\n    const figcaption = makeElement({\n      tagName: \"figcaption\",\n      className: css$2.attachmentCaption\n    });\n    const caption = this.attachmentPiece.getCaption();\n\n    if (caption) {\n      figcaption.classList.add(\"\".concat(css$2.attachmentCaption, \"--edited\"));\n      figcaption.textContent = caption;\n    } else {\n      let name, size;\n      const captionConfig = this.getCaptionConfig();\n\n      if (captionConfig.name) {\n        name = this.attachment.getFilename();\n      }\n\n      if (captionConfig.size) {\n        size = this.attachment.getFormattedFilesize();\n      }\n\n      if (name) {\n        const nameElement = makeElement({\n          tagName: \"span\",\n          className: css$2.attachmentName,\n          textContent: name\n        });\n        figcaption.appendChild(nameElement);\n      }\n\n      if (size) {\n        if (name) {\n          figcaption.appendChild(document.createTextNode(\" \"));\n        }\n\n        const sizeElement = makeElement({\n          tagName: \"span\",\n          className: css$2.attachmentSize,\n          textContent: size\n        });\n        figcaption.appendChild(sizeElement);\n      }\n    }\n\n    return figcaption;\n  }\n\n  getClassName() {\n    const names = [css$2.attachment, \"\".concat(css$2.attachment, \"--\").concat(this.attachment.getType())];\n    const extension = this.attachment.getExtension();\n\n    if (extension) {\n      names.push(\"\".concat(css$2.attachment, \"--\").concat(extension));\n    }\n\n    return names.join(\" \");\n  }\n\n  getData() {\n    const data = {\n      trixAttachment: JSON.stringify(this.attachment),\n      trixContentType: this.attachment.getContentType(),\n      trixId: this.attachment.id\n    };\n    const {\n      attributes\n    } = this.attachmentPiece;\n\n    if (!attributes.isEmpty()) {\n      data.trixAttributes = JSON.stringify(attributes);\n    }\n\n    if (this.attachment.isPending()) {\n      data.trixSerialize = false;\n    }\n\n    return data;\n  }\n\n  getHref() {\n    if (!htmlContainsTagName(this.attachment.getContent(), \"a\")) {\n      return this.attachment.getHref();\n    }\n  }\n\n  getCaptionConfig() {\n    var _config$attachments$t;\n\n    const type = this.attachment.getType();\n    const captionConfig = copyObject((_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.caption);\n\n    if (type === \"file\") {\n      captionConfig.name = true;\n    }\n\n    return captionConfig;\n  }\n\n  findProgressElement() {\n    var _this$findElement;\n\n    return (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"progress\");\n  } // Attachment delegate\n\n\n  attachmentDidChangeUploadProgress() {\n    const value = this.attachment.getUploadProgress();\n    const progressElement = this.findProgressElement();\n\n    if (progressElement) {\n      progressElement.value = value;\n    }\n  }\n\n}\n\nconst createCursorTarget = name => makeElement({\n  tagName: \"span\",\n  textContent: ZERO_WIDTH_SPACE,\n  data: {\n    trixCursorTarget: name,\n    trixSerialize: false\n  }\n});\n\nconst htmlContainsTagName = function (html, tagName) {\n  const div = makeElement(\"div\");\n  div.innerHTML = html || \"\";\n  return div.querySelector(tagName);\n};\n\nclass PreviewableAttachmentView extends AttachmentView {\n  constructor() {\n    super(...arguments);\n    this.attachment.previewDelegate = this;\n  }\n\n  createContentNodes() {\n    this.image = makeElement({\n      tagName: \"img\",\n      attributes: {\n        src: \"\"\n      },\n      data: {\n        trixMutable: true\n      }\n    });\n    this.refresh(this.image);\n    return [this.image];\n  }\n\n  createCaptionElement() {\n    const figcaption = super.createCaptionElement(...arguments);\n\n    if (!figcaption.textContent) {\n      figcaption.setAttribute(\"data-trix-placeholder\", config.lang.captionPlaceholder);\n    }\n\n    return figcaption;\n  }\n\n  refresh(image) {\n    if (!image) {\n      var _this$findElement;\n\n      image = (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"img\");\n    }\n\n    if (image) {\n      return this.updateAttributesForImage(image);\n    }\n  }\n\n  updateAttributesForImage(image) {\n    const url = this.attachment.getURL();\n    const previewURL = this.attachment.getPreviewURL();\n    image.src = previewURL || url;\n\n    if (previewURL === url) {\n      image.removeAttribute(\"data-trix-serialized-attributes\");\n    } else {\n      const serializedAttributes = JSON.stringify({\n        src: url\n      });\n      image.setAttribute(\"data-trix-serialized-attributes\", serializedAttributes);\n    }\n\n    const width = this.attachment.getWidth();\n    const height = this.attachment.getHeight();\n\n    if (width != null) {\n      image.width = width;\n    }\n\n    if (height != null) {\n      image.height = height;\n    }\n\n    const storeKey = [\"imageElement\", this.attachment.id, image.src, image.width, image.height].join(\"/\");\n    image.dataset.trixStoreKey = storeKey;\n  } // Attachment delegate\n\n\n  attachmentDidChangeAttributes() {\n    this.refresh(this.image);\n    return this.refresh();\n  }\n\n}\n\n/* eslint-disable\n    no-useless-escape,\n    no-var,\n*/\nclass PieceView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.piece = this.object;\n    this.attributes = this.piece.getAttributes();\n    this.textConfig = this.options.textConfig;\n    this.context = this.options.context;\n\n    if (this.piece.attachment) {\n      this.attachment = this.piece.attachment;\n    } else {\n      this.string = this.piece.toString();\n    }\n  }\n\n  createNodes() {\n    let nodes = this.attachment ? this.createAttachmentNodes() : this.createStringNodes();\n    const element = this.createElement();\n\n    if (element) {\n      const innerElement = findInnerElement(element);\n      Array.from(nodes).forEach(node => {\n        innerElement.appendChild(node);\n      });\n      nodes = [element];\n    }\n\n    return nodes;\n  }\n\n  createAttachmentNodes() {\n    const constructor = this.attachment.isPreviewable() ? PreviewableAttachmentView : AttachmentView;\n    const view = this.createChildView(constructor, this.piece.attachment, {\n      piece: this.piece\n    });\n    return view.getNodes();\n  }\n\n  createStringNodes() {\n    var _this$textConfig;\n\n    if ((_this$textConfig = this.textConfig) !== null && _this$textConfig !== void 0 && _this$textConfig.plaintext) {\n      return [document.createTextNode(this.string)];\n    } else {\n      const nodes = [];\n      const iterable = this.string.split(\"\\n\");\n\n      for (let index = 0; index < iterable.length; index++) {\n        const substring = iterable[index];\n\n        if (index > 0) {\n          const element = makeElement(\"br\");\n          nodes.push(element);\n        }\n\n        if (substring.length) {\n          const node = document.createTextNode(this.preserveSpaces(substring));\n          nodes.push(node);\n        }\n      }\n\n      return nodes;\n    }\n  }\n\n  createElement() {\n    let element, key, value;\n    const styles = {};\n\n    for (key in this.attributes) {\n      value = this.attributes[key];\n      const config = getTextConfig(key);\n\n      if (config) {\n        if (config.tagName) {\n          var innerElement;\n          const pendingElement = makeElement(config.tagName);\n\n          if (innerElement) {\n            innerElement.appendChild(pendingElement);\n            innerElement = pendingElement;\n          } else {\n            element = innerElement = pendingElement;\n          }\n        }\n\n        if (config.styleProperty) {\n          styles[config.styleProperty] = value;\n        }\n\n        if (config.style) {\n          for (key in config.style) {\n            value = config.style[key];\n            styles[key] = value;\n          }\n        }\n      }\n    }\n\n    if (Object.keys(styles).length) {\n      if (!element) {\n        element = makeElement(\"span\");\n      }\n\n      for (key in styles) {\n        value = styles[key];\n        element.style[key] = value;\n      }\n    }\n\n    return element;\n  }\n\n  createContainerElement() {\n    for (const key in this.attributes) {\n      const value = this.attributes[key];\n      const config = getTextConfig(key);\n\n      if (config) {\n        if (config.groupTagName) {\n          const attributes = {};\n          attributes[key] = value;\n          return makeElement(config.groupTagName, attributes);\n        }\n      }\n    }\n  }\n\n  preserveSpaces(string) {\n    if (this.context.isLast) {\n      string = string.replace(/\\ $/, NON_BREAKING_SPACE);\n    }\n\n    string = string.replace(/(\\S)\\ {3}(\\S)/g, \"$1 \".concat(NON_BREAKING_SPACE, \" $2\")).replace(/\\ {2}/g, \"\".concat(NON_BREAKING_SPACE, \" \")).replace(/\\ {2}/g, \" \".concat(NON_BREAKING_SPACE));\n\n    if (this.context.isFirst || this.context.followsWhitespace) {\n      string = string.replace(/^\\ /, NON_BREAKING_SPACE);\n    }\n\n    return string;\n  }\n\n}\n\n/* eslint-disable\n    no-var,\n*/\nclass TextView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.text = this.object;\n    this.textConfig = this.options.textConfig;\n  }\n\n  createNodes() {\n    const nodes = [];\n    const pieces = ObjectGroup.groupObjects(this.getPieces());\n    const lastIndex = pieces.length - 1;\n\n    for (let index = 0; index < pieces.length; index++) {\n      const piece = pieces[index];\n      const context = {};\n\n      if (index === 0) {\n        context.isFirst = true;\n      }\n\n      if (index === lastIndex) {\n        context.isLast = true;\n      }\n\n      if (endsWithWhitespace(previousPiece)) {\n        context.followsWhitespace = true;\n      }\n\n      const view = this.findOrCreateCachedChildView(PieceView, piece, {\n        textConfig: this.textConfig,\n        context\n      });\n      nodes.push(...Array.from(view.getNodes() || []));\n      var previousPiece = piece;\n    }\n\n    return nodes;\n  }\n\n  getPieces() {\n    return Array.from(this.text.getPieces()).filter(piece => !piece.hasAttribute(\"blockBreak\"));\n  }\n\n}\n\nconst endsWithWhitespace = piece => /\\s$/.test(piece === null || piece === void 0 ? void 0 : piece.toString());\n\nconst {\n  css: css$1\n} = config;\nclass BlockView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.block = this.object;\n    this.attributes = this.block.getAttributes();\n  }\n\n  createNodes() {\n    const comment = document.createComment(\"block\");\n    const nodes = [comment];\n\n    if (this.block.isEmpty()) {\n      nodes.push(makeElement(\"br\"));\n    } else {\n      var _getBlockConfig;\n\n      const textConfig = (_getBlockConfig = getBlockConfig(this.block.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.text;\n      const textView = this.findOrCreateCachedChildView(TextView, this.block.text, {\n        textConfig\n      });\n      nodes.push(...Array.from(textView.getNodes() || []));\n\n      if (this.shouldAddExtraNewlineElement()) {\n        nodes.push(makeElement(\"br\"));\n      }\n    }\n\n    if (this.attributes.length) {\n      return nodes;\n    } else {\n      let attributes;\n      const {\n        tagName\n      } = config.blockAttributes.default;\n\n      if (this.block.isRTL()) {\n        attributes = {\n          dir: \"rtl\"\n        };\n      }\n\n      const element = makeElement({\n        tagName,\n        attributes\n      });\n      nodes.forEach(node => element.appendChild(node));\n      return [element];\n    }\n  }\n\n  createContainerElement(depth) {\n    let attributes, className;\n    const attributeName = this.attributes[depth];\n    const {\n      tagName\n    } = getBlockConfig(attributeName);\n\n    if (depth === 0 && this.block.isRTL()) {\n      attributes = {\n        dir: \"rtl\"\n      };\n    }\n\n    if (attributeName === \"attachmentGallery\") {\n      const size = this.block.getBlockBreakPosition();\n      className = \"\".concat(css$1.attachmentGallery, \" \").concat(css$1.attachmentGallery, \"--\").concat(size);\n    }\n\n    return makeElement({\n      tagName,\n      className,\n      attributes\n    });\n  } // A single <br> at the end of a block element has no visual representation\n  // so add an extra one.\n\n\n  shouldAddExtraNewlineElement() {\n    return /\\n\\n$/.test(this.block.toString());\n  }\n\n}\n\nclass DocumentView extends ObjectView {\n  static render(document) {\n    const element = makeElement(\"div\");\n    const view = new this(document, {\n      element\n    });\n    view.render();\n    view.sync();\n    return element;\n  }\n\n  constructor() {\n    super(...arguments);\n    this.element = this.options.element;\n    this.elementStore = new ElementStore();\n    this.setDocument(this.object);\n  }\n\n  setDocument(document) {\n    if (!document.isEqualTo(this.document)) {\n      this.document = this.object = document;\n    }\n  }\n\n  render() {\n    this.childViews = [];\n    this.shadowElement = makeElement(\"div\");\n\n    if (!this.document.isEmpty()) {\n      const objects = ObjectGroup.groupObjects(this.document.getBlocks(), {\n        asTree: true\n      });\n      Array.from(objects).forEach(object => {\n        const view = this.findOrCreateCachedChildView(BlockView, object);\n        Array.from(view.getNodes()).map(node => this.shadowElement.appendChild(node));\n      });\n    }\n  }\n\n  isSynced() {\n    return elementsHaveEqualHTML(this.shadowElement, this.element);\n  }\n\n  sync() {\n    const fragment = this.createDocumentFragmentForSync();\n\n    while (this.element.lastChild) {\n      this.element.removeChild(this.element.lastChild);\n    }\n\n    this.element.appendChild(fragment);\n    return this.didSync();\n  } // Private\n\n\n  didSync() {\n    this.elementStore.reset(findStoredElements(this.element));\n    return defer(() => this.garbageCollectCachedViews());\n  }\n\n  createDocumentFragmentForSync() {\n    const fragment = document.createDocumentFragment();\n    Array.from(this.shadowElement.childNodes).forEach(node => {\n      fragment.appendChild(node.cloneNode(true));\n    });\n    Array.from(findStoredElements(fragment)).forEach(element => {\n      const storedElement = this.elementStore.remove(element);\n\n      if (storedElement) {\n        element.parentNode.replaceChild(storedElement, element);\n      }\n    });\n    return fragment;\n  }\n\n}\n\nconst findStoredElements = element => element.querySelectorAll(\"[data-trix-store-key]\");\n\nconst elementsHaveEqualHTML = (element, otherElement) => ignoreSpaces(element.innerHTML) === ignoreSpaces(otherElement.innerHTML);\n\nconst ignoreSpaces = html => html.replace(/&nbsp;/g, \" \");\n\n/* eslint-disable\n    no-empty,\n*/\nconst unserializableElementSelector = \"[data-trix-serialize=false]\";\nconst unserializableAttributeNames = [\"contenteditable\", \"data-trix-id\", \"data-trix-store-key\", \"data-trix-mutable\", \"data-trix-placeholder\", \"tabindex\"];\nconst serializedAttributesAttribute = \"data-trix-serialized-attributes\";\nconst serializedAttributesSelector = \"[\".concat(serializedAttributesAttribute, \"]\");\nconst blockCommentPattern = new RegExp(\"<!--block-->\", \"g\");\nconst serializers = {\n  \"application/json\": function (serializable) {\n    let document;\n\n    if (serializable instanceof Document) {\n      document = serializable;\n    } else if (serializable instanceof HTMLElement) {\n      document = HTMLParser.parse(serializable.innerHTML).getDocument();\n    } else {\n      throw new Error(\"unserializable object\");\n    }\n\n    return document.toSerializableDocument().toJSONString();\n  },\n  \"text/html\": function (serializable) {\n    let element;\n\n    if (serializable instanceof Document) {\n      element = DocumentView.render(serializable);\n    } else if (serializable instanceof HTMLElement) {\n      element = serializable.cloneNode(true);\n    } else {\n      throw new Error(\"unserializable object\");\n    } // Remove unserializable elements\n\n\n    Array.from(element.querySelectorAll(unserializableElementSelector)).forEach(el => {\n      removeNode(el);\n    }); // Remove unserializable attributes\n\n    unserializableAttributeNames.forEach(attribute => {\n      Array.from(element.querySelectorAll(\"[\".concat(attribute, \"]\"))).forEach(el => {\n        el.removeAttribute(attribute);\n      });\n    }); // Rewrite elements with serialized attribute overrides\n\n    Array.from(element.querySelectorAll(serializedAttributesSelector)).forEach(el => {\n      try {\n        const attributes = JSON.parse(el.getAttribute(serializedAttributesAttribute));\n        el.removeAttribute(serializedAttributesAttribute);\n\n        for (const name in attributes) {\n          const value = attributes[name];\n          el.setAttribute(name, value);\n        }\n      } catch (error) {}\n    });\n    return element.innerHTML.replace(blockCommentPattern, \"\");\n  }\n};\nconst deserializers = {\n  \"application/json\": function (string) {\n    return Document.fromJSONString(string);\n  },\n  \"text/html\": function (string) {\n    return HTMLParser.parse(string).getDocument();\n  }\n};\nconst serializeToContentType = function (serializable, contentType) {\n  const serializer = serializers[contentType];\n\n  if (serializer) {\n    return serializer(serializable);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\nconst deserializeFromContentType = function (string, contentType) {\n  const deserializer = deserializers[contentType];\n\n  if (deserializer) {\n    return deserializer(string);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\n\nconst mutableAttributeName = \"data-trix-mutable\";\nconst mutableSelector = \"[\".concat(mutableAttributeName, \"]\");\nconst options = {\n  attributes: true,\n  childList: true,\n  characterData: true,\n  characterDataOldValue: true,\n  subtree: true\n};\nclass MutationObserver extends BasicObject {\n  constructor(element) {\n    super(element);\n    this.didMutate = this.didMutate.bind(this);\n    this.element = element;\n    this.observer = new window.MutationObserver(this.didMutate);\n    this.start();\n  }\n\n  start() {\n    this.reset();\n    return this.observer.observe(this.element, options);\n  }\n\n  stop() {\n    return this.observer.disconnect();\n  }\n\n  didMutate(mutations) {\n    this.mutations.push(...Array.from(this.findSignificantMutations(mutations) || []));\n\n    if (this.mutations.length) {\n      var _this$delegate, _this$delegate$elemen;\n\n      (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$elemen = _this$delegate.elementDidMutate) === null || _this$delegate$elemen === void 0 ? void 0 : _this$delegate$elemen.call(_this$delegate, this.getMutationSummary());\n      return this.reset();\n    }\n  } // Private\n\n\n  reset() {\n    this.mutations = [];\n  }\n\n  findSignificantMutations(mutations) {\n    return mutations.filter(mutation => {\n      return this.mutationIsSignificant(mutation);\n    });\n  }\n\n  mutationIsSignificant(mutation) {\n    if (this.nodeIsMutable(mutation.target)) {\n      return false;\n    }\n\n    for (const node of Array.from(this.nodesModifiedByMutation(mutation))) {\n      if (this.nodeIsSignificant(node)) return true;\n    }\n\n    return false;\n  }\n\n  nodeIsSignificant(node) {\n    return node !== this.element && !this.nodeIsMutable(node) && !nodeIsEmptyTextNode(node);\n  }\n\n  nodeIsMutable(node) {\n    return findClosestElementFromNode(node, {\n      matchingSelector: mutableSelector\n    });\n  }\n\n  nodesModifiedByMutation(mutation) {\n    const nodes = [];\n\n    switch (mutation.type) {\n      case \"attributes\":\n        if (mutation.attributeName !== mutableAttributeName) {\n          nodes.push(mutation.target);\n        }\n\n        break;\n\n      case \"characterData\":\n        // Changes to text nodes should consider the parent element\n        nodes.push(mutation.target.parentNode);\n        nodes.push(mutation.target);\n        break;\n\n      case \"childList\":\n        // Consider each added or removed node\n        nodes.push(...Array.from(mutation.addedNodes || []));\n        nodes.push(...Array.from(mutation.removedNodes || []));\n        break;\n    }\n\n    return nodes;\n  }\n\n  getMutationSummary() {\n    return this.getTextMutationSummary();\n  }\n\n  getTextMutationSummary() {\n    const {\n      additions,\n      deletions\n    } = this.getTextChangesFromCharacterData();\n    const textChanges = this.getTextChangesFromChildList();\n    Array.from(textChanges.additions).forEach(addition => {\n      if (!Array.from(additions).includes(addition)) {\n        additions.push(addition);\n      }\n    });\n    deletions.push(...Array.from(textChanges.deletions || []));\n    const summary = {};\n    const added = additions.join(\"\");\n\n    if (added) {\n      summary.textAdded = added;\n    }\n\n    const deleted = deletions.join(\"\");\n\n    if (deleted) {\n      summary.textDeleted = deleted;\n    }\n\n    return summary;\n  }\n\n  getMutationsByType(type) {\n    return Array.from(this.mutations).filter(mutation => mutation.type === type);\n  }\n\n  getTextChangesFromChildList() {\n    let textAdded, textRemoved;\n    const addedNodes = [];\n    const removedNodes = [];\n    Array.from(this.getMutationsByType(\"childList\")).forEach(mutation => {\n      addedNodes.push(...Array.from(mutation.addedNodes || []));\n      removedNodes.push(...Array.from(mutation.removedNodes || []));\n    });\n    const singleBlockCommentRemoved = addedNodes.length === 0 && removedNodes.length === 1 && nodeIsBlockStartComment(removedNodes[0]);\n\n    if (singleBlockCommentRemoved) {\n      textAdded = [];\n      textRemoved = [\"\\n\"];\n    } else {\n      textAdded = getTextForNodes(addedNodes);\n      textRemoved = getTextForNodes(removedNodes);\n    }\n\n    const additions = textAdded.filter((text, index) => text !== textRemoved[index]).map(normalizeSpaces);\n    const deletions = textRemoved.filter((text, index) => text !== textAdded[index]).map(normalizeSpaces);\n    return {\n      additions,\n      deletions\n    };\n  }\n\n  getTextChangesFromCharacterData() {\n    let added, removed;\n    const characterMutations = this.getMutationsByType(\"characterData\");\n\n    if (characterMutations.length) {\n      const startMutation = characterMutations[0],\n            endMutation = characterMutations[characterMutations.length - 1];\n      const oldString = normalizeSpaces(startMutation.oldValue);\n      const newString = normalizeSpaces(endMutation.target.data);\n      const summarized = summarizeStringChange(oldString, newString);\n      added = summarized.added;\n      removed = summarized.removed;\n    }\n\n    return {\n      additions: added ? [added] : [],\n      deletions: removed ? [removed] : []\n    };\n  }\n\n}\n\nconst getTextForNodes = function () {\n  let nodes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  const text = [];\n\n  for (const node of Array.from(nodes)) {\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        text.push(node.data);\n        break;\n\n      case Node.ELEMENT_NODE:\n        if (tagName(node) === \"br\") {\n          text.push(\"\\n\");\n        } else {\n          text.push(...Array.from(getTextForNodes(node.childNodes) || []));\n        }\n\n        break;\n    }\n  }\n\n  return text;\n};\n\nclass Controller extends BasicObject {}\n\n/* eslint-disable\n    no-empty,\n*/\nclass FileVerificationOperation extends Operation {\n  constructor(file) {\n    super(...arguments);\n    this.file = file;\n  }\n\n  perform(callback) {\n    const reader = new FileReader();\n\n    reader.onerror = () => callback(false);\n\n    reader.onload = () => {\n      reader.onerror = null;\n\n      try {\n        reader.abort();\n      } catch (error) {}\n\n      return callback(true, this.file);\n    };\n\n    return reader.readAsArrayBuffer(this.file);\n  }\n\n}\n\nclass InputController extends BasicObject {\n  constructor(element) {\n    super(...arguments);\n    this.element = element;\n    this.mutationObserver = new MutationObserver(this.element);\n    this.mutationObserver.delegate = this;\n\n    for (const eventName in this.constructor.events) {\n      handleEvent(eventName, {\n        onElement: this.element,\n        withCallback: this.handlerFor(eventName)\n      });\n    }\n  }\n\n  elementDidMutate(mutationSummary) {}\n\n  editorWillSyncDocumentView() {\n    return this.mutationObserver.stop();\n  }\n\n  editorDidSyncDocumentView() {\n    return this.mutationObserver.start();\n  }\n\n  requestRender() {\n    var _this$delegate, _this$delegate$inputC;\n\n    return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidRequestRender) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n  }\n\n  requestReparse() {\n    var _this$delegate2, _this$delegate2$input;\n\n    (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$input = _this$delegate2.inputControllerDidRequestReparse) === null || _this$delegate2$input === void 0 ? void 0 : _this$delegate2$input.call(_this$delegate2);\n    return this.requestRender();\n  }\n\n  attachFiles(files) {\n    const operations = Array.from(files).map(file => new FileVerificationOperation(file));\n    return Promise.all(operations).then(files => {\n      this.handleInput(function () {\n        var _this$delegate3, _this$responder;\n\n        (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.inputControllerWillAttachFiles();\n        (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertFiles(files);\n        return this.requestRender();\n      });\n    });\n  } // Private\n\n\n  handlerFor(eventName) {\n    return event => {\n      if (!event.defaultPrevented) {\n        this.handleInput(() => {\n          if (!innerElementIsActive(this.element)) {\n            this.eventName = eventName;\n            this.constructor.events[eventName].call(this, event);\n          }\n        });\n      }\n    };\n  }\n\n  handleInput(callback) {\n    try {\n      var _this$delegate4;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillHandleInput();\n      callback.call(this);\n    } finally {\n      var _this$delegate5;\n\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerDidHandleInput();\n    }\n  }\n\n  createLinkHTML(href, text) {\n    const link = document.createElement(\"a\");\n    link.href = href;\n    link.textContent = text ? text : href;\n    return link.outerHTML;\n  }\n\n}\n\n_defineProperty(InputController, \"events\", {});\n\nvar _$codePointAt, _;\nconst {\n  browser,\n  keyNames: keyNames$1\n} = config;\nlet pastedFileCount = 0;\nclass Level0InputController extends InputController {\n  constructor() {\n    super(...arguments);\n    this.resetInputSummary();\n  }\n\n  setInputSummary() {\n    let summary = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.inputSummary.eventName = this.eventName;\n\n    for (const key in summary) {\n      const value = summary[key];\n      this.inputSummary[key] = value;\n    }\n\n    return this.inputSummary;\n  }\n\n  resetInputSummary() {\n    this.inputSummary = {};\n  }\n\n  reset() {\n    this.resetInputSummary();\n    return selectionChangeObserver.reset();\n  } // Mutation observer delegate\n\n\n  elementDidMutate(mutationSummary) {\n    if (this.isComposing()) {\n      var _this$delegate, _this$delegate$inputC;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n    } else {\n      return this.handleInput(function () {\n        if (this.mutationIsSignificant(mutationSummary)) {\n          if (this.mutationIsExpected(mutationSummary)) {\n            this.requestRender();\n          } else {\n            this.requestReparse();\n          }\n        }\n\n        return this.reset();\n      });\n    }\n  }\n\n  mutationIsExpected(_ref) {\n    let {\n      textAdded,\n      textDeleted\n    } = _ref;\n\n    if (this.inputSummary.preferDocument) {\n      return true;\n    }\n\n    const mutationAdditionMatchesSummary = textAdded != null ? textAdded === this.inputSummary.textAdded : !this.inputSummary.textAdded;\n    const mutationDeletionMatchesSummary = textDeleted != null ? this.inputSummary.didDelete : !this.inputSummary.didDelete;\n    const unexpectedNewlineAddition = [\"\\n\", \" \\n\"].includes(textAdded) && !mutationAdditionMatchesSummary;\n    const unexpectedNewlineDeletion = textDeleted === \"\\n\" && !mutationDeletionMatchesSummary;\n    const singleUnexpectedNewline = unexpectedNewlineAddition && !unexpectedNewlineDeletion || unexpectedNewlineDeletion && !unexpectedNewlineAddition;\n\n    if (singleUnexpectedNewline) {\n      const range = this.getSelectedRange();\n\n      if (range) {\n        var _this$responder;\n\n        const offset = unexpectedNewlineAddition ? textAdded.replace(/\\n$/, \"\").length || -1 : (textAdded === null || textAdded === void 0 ? void 0 : textAdded.length) || 1;\n\n        if ((_this$responder = this.responder) !== null && _this$responder !== void 0 && _this$responder.positionIsBlockBreak(range[1] + offset)) {\n          return true;\n        }\n      }\n    }\n\n    return mutationAdditionMatchesSummary && mutationDeletionMatchesSummary;\n  }\n\n  mutationIsSignificant(mutationSummary) {\n    var _this$compositionInpu;\n\n    const textChanged = Object.keys(mutationSummary).length > 0;\n    const composedEmptyString = ((_this$compositionInpu = this.compositionInput) === null || _this$compositionInpu === void 0 ? void 0 : _this$compositionInpu.getEndData()) === \"\";\n    return textChanged || !composedEmptyString;\n  } // Private\n\n\n  getCompositionInput() {\n    if (this.isComposing()) {\n      return this.compositionInput;\n    } else {\n      this.compositionInput = new CompositionInput(this);\n    }\n  }\n\n  isComposing() {\n    return this.compositionInput && !this.compositionInput.isEnded();\n  }\n\n  deleteInDirection(direction, event) {\n    var _this$responder2;\n\n    if (((_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.deleteInDirection(direction)) === false) {\n      if (event) {\n        event.preventDefault();\n        return this.requestRender();\n      }\n    } else {\n      return this.setInputSummary({\n        didDelete: true\n      });\n    }\n  }\n\n  serializeSelectionToDataTransfer(dataTransfer) {\n    var _this$responder3;\n\n    if (!dataTransferIsWritable(dataTransfer)) return;\n    const document = (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.getSelectedDocument().toSerializableDocument();\n    dataTransfer.setData(\"application/x-trix-document\", JSON.stringify(document));\n    dataTransfer.setData(\"text/html\", DocumentView.render(document).innerHTML);\n    dataTransfer.setData(\"text/plain\", document.toString().replace(/\\n$/, \"\"));\n    return true;\n  }\n\n  canAcceptDataTransfer(dataTransfer) {\n    const types = {};\n    Array.from((dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.types) || []).forEach(type => {\n      types[type] = true;\n    });\n    return types.Files || types[\"application/x-trix-document\"] || types[\"text/html\"] || types[\"text/plain\"];\n  }\n\n  getPastedHTMLUsingHiddenElement(callback) {\n    const selectedRange = this.getSelectedRange();\n    const style = {\n      position: \"absolute\",\n      left: \"\".concat(window.pageXOffset, \"px\"),\n      top: \"\".concat(window.pageYOffset, \"px\"),\n      opacity: 0\n    };\n    const element = makeElement({\n      style,\n      tagName: \"div\",\n      editable: true\n    });\n    document.body.appendChild(element);\n    element.focus();\n    return requestAnimationFrame(() => {\n      const html = element.innerHTML;\n      removeNode(element);\n      this.setSelectedRange(selectedRange);\n      return callback(html);\n    });\n  }\n\n}\n\n_defineProperty(Level0InputController, \"events\", {\n  keydown(event) {\n    if (!this.isComposing()) {\n      this.resetInputSummary();\n    }\n\n    this.inputSummary.didInput = true;\n    const keyName = keyNames$1[event.keyCode];\n\n    if (keyName) {\n      var _context2;\n\n      let context = this.keys;\n      [\"ctrl\", \"alt\", \"shift\", \"meta\"].forEach(modifier => {\n        if (event[\"\".concat(modifier, \"Key\")]) {\n          var _context;\n\n          if (modifier === \"ctrl\") {\n            modifier = \"control\";\n          }\n\n          context = (_context = context) === null || _context === void 0 ? void 0 : _context[modifier];\n        }\n      });\n\n      if (((_context2 = context) === null || _context2 === void 0 ? void 0 : _context2[keyName]) != null) {\n        this.setInputSummary({\n          keyName\n        });\n        selectionChangeObserver.reset();\n        context[keyName].call(this, event);\n      }\n    }\n\n    if (keyEventIsKeyboardCommand(event)) {\n      const character = String.fromCharCode(event.keyCode).toLowerCase();\n\n      if (character) {\n        var _this$delegate3;\n\n        const keys = [\"alt\", \"shift\"].map(modifier => {\n          if (event[\"\".concat(modifier, \"Key\")]) {\n            return modifier;\n          }\n        }).filter(key => key);\n        keys.push(character);\n\n        if ((_this$delegate3 = this.delegate) !== null && _this$delegate3 !== void 0 && _this$delegate3.inputControllerDidReceiveKeyboardCommand(keys)) {\n          event.preventDefault();\n        }\n      }\n    }\n  },\n\n  keypress(event) {\n    if (this.inputSummary.eventName != null) return;\n    if (event.metaKey) return;\n    if (event.ctrlKey && !event.altKey) return;\n    const string = stringFromKeyEvent(event);\n\n    if (string) {\n      var _this$delegate4, _this$responder9;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n      (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.insertString(string);\n      return this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n    }\n  },\n\n  textInput(event) {\n    // Handle autocapitalization\n    const {\n      data\n    } = event;\n    const {\n      textAdded\n    } = this.inputSummary;\n\n    if (textAdded && textAdded !== data && textAdded.toUpperCase() === data) {\n      var _this$responder10;\n\n      const range = this.getSelectedRange();\n      this.setSelectedRange([range[0], range[1] + textAdded.length]);\n      (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.insertString(data);\n      this.setInputSummary({\n        textAdded: data\n      });\n      return this.setSelectedRange(range);\n    }\n  },\n\n  dragenter(event) {\n    event.preventDefault();\n  },\n\n  dragstart(event) {\n    var _this$delegate5, _this$delegate5$input;\n\n    this.serializeSelectionToDataTransfer(event.dataTransfer);\n    this.draggedRange = this.getSelectedRange();\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$input = _this$delegate5.inputControllerDidStartDrag) === null || _this$delegate5$input === void 0 ? void 0 : _this$delegate5$input.call(_this$delegate5);\n  },\n\n  dragover(event) {\n    if (this.draggedRange || this.canAcceptDataTransfer(event.dataTransfer)) {\n      event.preventDefault();\n      const draggingPoint = {\n        x: event.clientX,\n        y: event.clientY\n      };\n\n      if (!objectsAreEqual(draggingPoint, this.draggingPoint)) {\n        var _this$delegate6, _this$delegate6$input;\n\n        this.draggingPoint = draggingPoint;\n        return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$input = _this$delegate6.inputControllerDidReceiveDragOverPoint) === null || _this$delegate6$input === void 0 ? void 0 : _this$delegate6$input.call(_this$delegate6, this.draggingPoint);\n      }\n    }\n  },\n\n  dragend(event) {\n    var _this$delegate7, _this$delegate7$input;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$input = _this$delegate7.inputControllerDidCancelDrag) === null || _this$delegate7$input === void 0 ? void 0 : _this$delegate7$input.call(_this$delegate7);\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n\n  drop(event) {\n    var _event$dataTransfer, _this$responder11;\n\n    event.preventDefault();\n    const files = (_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.files;\n    const documentJSON = event.dataTransfer.getData(\"application/x-trix-document\");\n    const point = {\n      x: event.clientX,\n      y: event.clientY\n    };\n    (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.setLocationRangeFromPointRange(point);\n\n    if (files !== null && files !== void 0 && files.length) {\n      this.attachFiles(files);\n    } else if (this.draggedRange) {\n      var _this$delegate8, _this$responder12;\n\n      (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.inputControllerWillMoveText();\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.moveTextFromRange(this.draggedRange);\n      this.draggedRange = null;\n      this.requestRender();\n    } else if (documentJSON) {\n      var _this$responder13;\n\n      const document = Document.fromJSONString(documentJSON);\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.insertDocument(document);\n      this.requestRender();\n    }\n\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n\n  cut(event) {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.selectionIsExpanded()) {\n      var _this$delegate9;\n\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillCutText();\n      this.deleteInDirection(\"backward\");\n\n      if (event.defaultPrevented) {\n        return this.requestRender();\n      }\n    }\n  },\n\n  copy(event) {\n    var _this$responder15;\n\n    if ((_this$responder15 = this.responder) !== null && _this$responder15 !== void 0 && _this$responder15.selectionIsExpanded()) {\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n    }\n  },\n\n  paste(event) {\n    const clipboard = event.clipboardData || event.testClipboardData;\n    const paste = {\n      clipboard\n    };\n\n    if (!clipboard || pasteEventIsCrippledSafariHTMLPaste(event)) {\n      this.getPastedHTMLUsingHiddenElement(html => {\n        var _this$delegate10, _this$responder16, _this$delegate11;\n\n        paste.type = \"text/html\";\n        paste.html = html;\n        (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerWillPaste(paste);\n        (_this$responder16 = this.responder) === null || _this$responder16 === void 0 ? void 0 : _this$responder16.insertHTML(paste.html);\n        this.requestRender();\n        return (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerDidPaste(paste);\n      });\n      return;\n    }\n\n    const href = clipboard.getData(\"URL\");\n    const html = clipboard.getData(\"text/html\");\n    const name = clipboard.getData(\"public.url-name\");\n\n    if (href) {\n      var _this$delegate12, _this$responder17, _this$delegate13;\n\n      let string;\n      paste.type = \"text/html\";\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerDidPaste(paste);\n    } else if (dataTransferIsPlainText(clipboard)) {\n      var _this$delegate14, _this$responder18, _this$delegate15;\n\n      paste.type = \"text/plain\";\n      paste.string = clipboard.getData(\"text/plain\");\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: paste.string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder18 = this.responder) === null || _this$responder18 === void 0 ? void 0 : _this$responder18.insertString(paste.string);\n      this.requestRender();\n      (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerDidPaste(paste);\n    } else if (html) {\n      var _this$delegate16, _this$responder19, _this$delegate17;\n\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPaste(paste);\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerDidPaste(paste);\n    } else if (Array.from(clipboard.types).includes(\"Files\")) {\n      var _clipboard$items, _clipboard$items$, _clipboard$items$$get;\n\n      const file = (_clipboard$items = clipboard.items) === null || _clipboard$items === void 0 ? void 0 : (_clipboard$items$ = _clipboard$items[0]) === null || _clipboard$items$ === void 0 ? void 0 : (_clipboard$items$$get = _clipboard$items$.getAsFile) === null || _clipboard$items$$get === void 0 ? void 0 : _clipboard$items$$get.call(_clipboard$items$);\n\n      if (file) {\n        var _this$delegate18, _this$responder20, _this$delegate19;\n\n        const extension = extensionForFile(file);\n\n        if (!file.name && extension) {\n          file.name = \"pasted-file-\".concat(++pastedFileCount, \".\").concat(extension);\n        }\n\n        paste.type = \"File\";\n        paste.file = file;\n        (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillAttachFiles();\n        (_this$responder20 = this.responder) === null || _this$responder20 === void 0 ? void 0 : _this$responder20.insertFile(paste.file);\n        this.requestRender();\n        (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      }\n    }\n\n    event.preventDefault();\n  },\n\n  compositionstart(event) {\n    return this.getCompositionInput().start(event.data);\n  },\n\n  compositionupdate(event) {\n    return this.getCompositionInput().update(event.data);\n  },\n\n  compositionend(event) {\n    return this.getCompositionInput().end(event.data);\n  },\n\n  beforeinput(event) {\n    this.inputSummary.didInput = true;\n  },\n\n  input(event) {\n    this.inputSummary.didInput = true;\n    return event.stopPropagation();\n  }\n\n});\n\n_defineProperty(Level0InputController, \"keys\", {\n  backspace(event) {\n    var _this$delegate20;\n\n    (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"backward\", event);\n  },\n\n  delete(event) {\n    var _this$delegate21;\n\n    (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"forward\", event);\n  },\n\n  return(event) {\n    var _this$delegate22, _this$responder21;\n\n    this.setInputSummary({\n      preferDocument: true\n    });\n    (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPerformTyping();\n    return (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.insertLineBreak();\n  },\n\n  tab(event) {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canIncreaseNestingLevel()) {\n      var _this$responder23;\n\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.increaseNestingLevel();\n      this.requestRender();\n      event.preventDefault();\n    }\n  },\n\n  left(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder24;\n\n      event.preventDefault();\n      return (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.moveCursorInDirection(\"backward\");\n    }\n  },\n\n  right(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder25;\n\n      event.preventDefault();\n      return (_this$responder25 = this.responder) === null || _this$responder25 === void 0 ? void 0 : _this$responder25.moveCursorInDirection(\"forward\");\n    }\n  },\n\n  control: {\n    d(event) {\n      var _this$delegate23;\n\n      (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"forward\", event);\n    },\n\n    h(event) {\n      var _this$delegate24;\n\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"backward\", event);\n    },\n\n    o(event) {\n      var _this$delegate25, _this$responder26;\n\n      event.preventDefault();\n      (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerWillPerformTyping();\n      (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.insertString(\"\\n\", {\n        updatePosition: false\n      });\n      return this.requestRender();\n    }\n\n  },\n  shift: {\n    return(event) {\n      var _this$delegate26, _this$responder27;\n\n      (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n      (_this$responder27 = this.responder) === null || _this$responder27 === void 0 ? void 0 : _this$responder27.insertString(\"\\n\");\n      this.requestRender();\n      event.preventDefault();\n    },\n\n    tab(event) {\n      var _this$responder28;\n\n      if ((_this$responder28 = this.responder) !== null && _this$responder28 !== void 0 && _this$responder28.canDecreaseNestingLevel()) {\n        var _this$responder29;\n\n        (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.decreaseNestingLevel();\n        this.requestRender();\n        event.preventDefault();\n      }\n    },\n\n    left(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"backward\");\n      }\n    },\n\n    right(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"forward\");\n      }\n    }\n\n  },\n  alt: {\n    backspace(event) {\n      var _this$delegate27;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate27 = this.delegate) === null || _this$delegate27 === void 0 ? void 0 : _this$delegate27.inputControllerWillPerformTyping();\n    }\n\n  },\n  meta: {\n    backspace(event) {\n      var _this$delegate28;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate28 = this.delegate) === null || _this$delegate28 === void 0 ? void 0 : _this$delegate28.inputControllerWillPerformTyping();\n    }\n\n  }\n});\n\nLevel0InputController.proxyMethod(\"responder?.getSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.setSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.expandSelectionInDirection\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsInCursorTarget\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsExpanded\");\n\nconst extensionForFile = file => {\n  var _file$type, _file$type$match;\n\n  return (_file$type = file.type) === null || _file$type === void 0 ? void 0 : (_file$type$match = _file$type.match(/\\/(\\w+)$/)) === null || _file$type$match === void 0 ? void 0 : _file$type$match[1];\n};\n\nconst hasStringCodePointAt = !!((_$codePointAt = (_ = \" \").codePointAt) !== null && _$codePointAt !== void 0 && _$codePointAt.call(_, 0));\n\nconst stringFromKeyEvent = function (event) {\n  if (event.key && hasStringCodePointAt && event.key.codePointAt(0) === event.keyCode) {\n    return event.key;\n  } else {\n    let code;\n\n    if (event.which === null) {\n      code = event.keyCode;\n    } else if (event.which !== 0 && event.charCode !== 0) {\n      code = event.charCode;\n    }\n\n    if (code != null && keyNames$1[code] !== \"escape\") {\n      return UTF16String.fromCodepoints([code]).toString();\n    }\n  }\n};\n\nconst pasteEventIsCrippledSafariHTMLPaste = function (event) {\n  const paste = event.clipboardData;\n\n  if (paste) {\n    if (paste.types.includes(\"text/html\")) {\n      // Answer is yes if there's any possibility of Paste and Match Style in Safari,\n      // which is nearly impossible to detect confidently: https://bugs.webkit.org/show_bug.cgi?id=174165\n      for (const type of paste.types) {\n        const hasPasteboardFlavor = /^CorePasteboardFlavorType/.test(type);\n        const hasReadableDynamicData = /^dyn\\./.test(type) && paste.getData(type);\n        const mightBePasteAndMatchStyle = hasPasteboardFlavor || hasReadableDynamicData;\n\n        if (mightBePasteAndMatchStyle) {\n          return true;\n        }\n      }\n\n      return false;\n    } else {\n      const isExternalHTMLPaste = paste.types.includes(\"com.apple.webarchive\");\n      const isExternalRichTextPaste = paste.types.includes(\"com.apple.flat-rtfd\");\n      return isExternalHTMLPaste || isExternalRichTextPaste;\n    }\n  }\n};\n\nclass CompositionInput extends BasicObject {\n  constructor(inputController) {\n    super(...arguments);\n    this.inputController = inputController;\n    this.responder = this.inputController.responder;\n    this.delegate = this.inputController.delegate;\n    this.inputSummary = this.inputController.inputSummary;\n    this.data = {};\n  }\n\n  start(data) {\n    this.data.start = data;\n\n    if (this.isSignificant()) {\n      var _this$responder5;\n\n      if (this.inputSummary.eventName === \"keypress\" && this.inputSummary.textAdded) {\n        var _this$responder4;\n\n        (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(\"left\");\n      }\n\n      if (!this.selectionIsExpanded()) {\n        this.insertPlaceholder();\n        this.requestRender();\n      }\n\n      this.range = (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.getSelectedRange();\n    }\n  }\n\n  update(data) {\n    this.data.update = data;\n\n    if (this.isSignificant()) {\n      const range = this.selectPlaceholder();\n\n      if (range) {\n        this.forgetPlaceholder();\n        this.range = range;\n      }\n    }\n  }\n\n  end(data) {\n    this.data.end = data;\n\n    if (this.isSignificant()) {\n      this.forgetPlaceholder();\n\n      if (this.canApplyToDocument()) {\n        var _this$delegate2, _this$responder6, _this$responder7, _this$responder8;\n\n        this.setInputSummary({\n          preferDocument: true,\n          didInput: false\n        });\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.inputControllerWillPerformTyping();\n        (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.setSelectedRange(this.range);\n        (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertString(this.data.end);\n        return (_this$responder8 = this.responder) === null || _this$responder8 === void 0 ? void 0 : _this$responder8.setSelectedRange(this.range[0] + this.data.end.length);\n      } else if (this.data.start != null || this.data.update != null) {\n        this.requestReparse();\n        return this.inputController.reset();\n      }\n    } else {\n      return this.inputController.reset();\n    }\n  }\n\n  getEndData() {\n    return this.data.end;\n  }\n\n  isEnded() {\n    return this.getEndData() != null;\n  }\n\n  isSignificant() {\n    if (browser.composesExistingText) {\n      return this.inputSummary.didInput;\n    } else {\n      return true;\n    }\n  } // Private\n\n\n  canApplyToDocument() {\n    var _this$data$start, _this$data$end;\n\n    return ((_this$data$start = this.data.start) === null || _this$data$start === void 0 ? void 0 : _this$data$start.length) === 0 && ((_this$data$end = this.data.end) === null || _this$data$end === void 0 ? void 0 : _this$data$end.length) > 0 && this.range;\n  }\n\n}\n\nCompositionInput.proxyMethod(\"inputController.setInputSummary\");\nCompositionInput.proxyMethod(\"inputController.requestRender\");\nCompositionInput.proxyMethod(\"inputController.requestReparse\");\nCompositionInput.proxyMethod(\"responder?.selectionIsExpanded\");\nCompositionInput.proxyMethod(\"responder?.insertPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.selectPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.forgetPlaceholder\");\n\nclass Level2InputController extends InputController {\n  constructor() {\n    super(...arguments);\n    this.render = this.render.bind(this);\n  }\n\n  elementDidMutate() {\n    if (this.scheduledRender) {\n      if (this.composing) {\n        var _this$delegate, _this$delegate$inputC;\n\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n      }\n    } else {\n      return this.reparse();\n    }\n  }\n\n  scheduleRender() {\n    return this.scheduledRender ? this.scheduledRender : this.scheduledRender = requestAnimationFrame(this.render);\n  }\n\n  render() {\n    var _this$afterRender;\n\n    cancelAnimationFrame(this.scheduledRender);\n    this.scheduledRender = null;\n\n    if (!this.composing) {\n      var _this$delegate2;\n\n      (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.render();\n    }\n\n    (_this$afterRender = this.afterRender) === null || _this$afterRender === void 0 ? void 0 : _this$afterRender.call(this);\n    this.afterRender = null;\n  }\n\n  reparse() {\n    var _this$delegate3;\n\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.reparse();\n  } // Responder helpers\n\n\n  insertString() {\n    var _this$delegate4;\n\n    let string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    let options = arguments.length > 1 ? arguments[1] : undefined;\n    (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder;\n\n      return (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertString(string, options);\n    });\n  }\n\n  toggleAttributeIfSupported(attributeName) {\n    if (getAllAttributeNames().includes(attributeName)) {\n      var _this$delegate5;\n\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerWillPerformFormatting(attributeName);\n      return this.withTargetDOMRange(function () {\n        var _this$responder2;\n\n        return (_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.toggleCurrentAttribute(attributeName);\n      });\n    }\n  }\n\n  activateAttributeIfSupported(attributeName, value) {\n    if (getAllAttributeNames().includes(attributeName)) {\n      var _this$delegate6;\n\n      (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.inputControllerWillPerformFormatting(attributeName);\n      return this.withTargetDOMRange(function () {\n        var _this$responder3;\n\n        return (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.setCurrentAttribute(attributeName, value);\n      });\n    }\n  }\n\n  deleteInDirection(direction) {\n    let {\n      recordUndoEntry\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      recordUndoEntry: true\n    };\n\n    if (recordUndoEntry) {\n      var _this$delegate7;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.inputControllerWillPerformTyping();\n    }\n\n    const perform = () => {\n      var _this$responder4;\n\n      return (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(direction);\n    };\n\n    const domRange = this.getTargetDOMRange({\n      minLength: 2\n    });\n\n    if (domRange) {\n      return this.withTargetDOMRange(domRange, perform);\n    } else {\n      return perform();\n    }\n  } // Selection helpers\n\n\n  withTargetDOMRange(domRange, fn) {\n    if (typeof domRange === \"function\") {\n      fn = domRange;\n      domRange = this.getTargetDOMRange();\n    }\n\n    if (domRange) {\n      var _this$responder5;\n\n      return (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.withTargetDOMRange(domRange, fn.bind(this));\n    } else {\n      selectionChangeObserver.reset();\n      return fn.call(this);\n    }\n  }\n\n  getTargetDOMRange() {\n    var _this$event$getTarget, _this$event;\n\n    let {\n      minLength\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      minLength: 0\n    };\n    const targetRanges = (_this$event$getTarget = (_this$event = this.event).getTargetRanges) === null || _this$event$getTarget === void 0 ? void 0 : _this$event$getTarget.call(_this$event);\n\n    if (targetRanges) {\n      if (targetRanges.length) {\n        const domRange = staticRangeToRange(targetRanges[0]);\n\n        if (minLength === 0 || domRange.toString().length >= minLength) {\n          return domRange;\n        }\n      }\n    }\n  }\n\n  withEvent(event, fn) {\n    let result;\n    this.event = event;\n\n    try {\n      result = fn.call(this);\n    } finally {\n      this.event = null;\n    }\n\n    return result;\n  }\n\n}\n\n_defineProperty(Level2InputController, \"events\", {\n  keydown(event) {\n    if (keyEventIsKeyboardCommand(event)) {\n      var _this$delegate8;\n\n      const command = keyboardCommandFromKeyEvent(event);\n\n      if ((_this$delegate8 = this.delegate) !== null && _this$delegate8 !== void 0 && _this$delegate8.inputControllerDidReceiveKeyboardCommand(command)) {\n        event.preventDefault();\n      }\n    } else {\n      let name = event.key;\n\n      if (event.altKey) {\n        name += \"+Alt\";\n      }\n\n      if (event.shiftKey) {\n        name += \"+Shift\";\n      }\n\n      const handler = this.constructor.keys[name];\n\n      if (handler) {\n        return this.withEvent(event, handler);\n      }\n    }\n  },\n\n  // Handle paste event to work around beforeinput.insertFromPaste browser bugs.\n  // Safe to remove each condition once fixed upstream.\n  paste(event) {\n    var _event$clipboardData;\n\n    // https://bugs.webkit.org/show_bug.cgi?id=194921\n    let paste;\n    const href = (_event$clipboardData = event.clipboardData) === null || _event$clipboardData === void 0 ? void 0 : _event$clipboardData.getData(\"URL\");\n\n    if (pasteEventHasFilesOnly(event)) {\n      event.preventDefault();\n      return this.attachFiles(event.clipboardData.files); // https://bugs.chromium.org/p/chromium/issues/detail?id=934448\n    } else if (pasteEventHasPlainTextOnly(event)) {\n      var _this$delegate9, _this$responder6, _this$delegate10;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/plain\",\n        string: event.clipboardData.getData(\"text/plain\")\n      };\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillPaste(paste);\n      (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.insertString(paste.string);\n      this.render();\n      return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerDidPaste(paste); // https://bugs.webkit.org/show_bug.cgi?id=196702\n    } else if (href) {\n      var _this$delegate11, _this$responder7, _this$delegate12;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/html\",\n        html: this.createLinkHTML(href)\n      };\n      (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerWillPaste(paste);\n      (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertHTML(paste.html);\n      this.render();\n      return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerDidPaste(paste);\n    }\n  },\n\n  beforeinput(event) {\n    const handler = this.constructor.inputTypes[event.inputType];\n\n    if (handler) {\n      this.withEvent(event, handler);\n      return this.scheduleRender();\n    }\n  },\n\n  input(event) {\n    return selectionChangeObserver.reset();\n  },\n\n  dragstart(event) {\n    var _this$responder8;\n\n    if ((_this$responder8 = this.responder) !== null && _this$responder8 !== void 0 && _this$responder8.selectionContainsAttachments()) {\n      var _this$responder9;\n\n      event.dataTransfer.setData(\"application/x-trix-dragging\", true);\n      this.dragging = {\n        range: (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.getSelectedRange(),\n        point: pointFromEvent(event)\n      };\n    }\n  },\n\n  dragenter(event) {\n    if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n\n  dragover(event) {\n    if (this.dragging) {\n      event.preventDefault();\n      const point = pointFromEvent(event);\n\n      if (!objectsAreEqual(point, this.dragging.point)) {\n        var _this$responder10;\n\n        this.dragging.point = point;\n        return (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.setLocationRangeFromPointRange(point);\n      }\n    } else if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n\n  drop(event) {\n    if (this.dragging) {\n      var _this$delegate13, _this$responder11;\n\n      event.preventDefault();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerWillMoveText();\n      (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.moveTextFromRange(this.dragging.range);\n      this.dragging = null;\n      return this.scheduleRender();\n    } else if (dragEventHasFiles(event)) {\n      var _this$responder12;\n\n      event.preventDefault();\n      const point = pointFromEvent(event);\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.setLocationRangeFromPointRange(point);\n      return this.attachFiles(event.dataTransfer.files);\n    }\n  },\n\n  dragend() {\n    if (this.dragging) {\n      var _this$responder13;\n\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.setSelectedRange(this.dragging.range);\n      this.dragging = null;\n    }\n  },\n\n  compositionend(event) {\n    if (this.composing) {\n      this.composing = false;\n      return this.scheduleRender();\n    }\n  }\n\n});\n\n_defineProperty(Level2InputController, \"keys\", {\n  ArrowLeft() {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.shouldManageMovingCursorInDirection(\"backward\")) {\n      var _this$responder15;\n\n      this.event.preventDefault();\n      return (_this$responder15 = this.responder) === null || _this$responder15 === void 0 ? void 0 : _this$responder15.moveCursorInDirection(\"backward\");\n    }\n  },\n\n  ArrowRight() {\n    var _this$responder16;\n\n    if ((_this$responder16 = this.responder) !== null && _this$responder16 !== void 0 && _this$responder16.shouldManageMovingCursorInDirection(\"forward\")) {\n      var _this$responder17;\n\n      this.event.preventDefault();\n      return (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.moveCursorInDirection(\"forward\");\n    }\n  },\n\n  Backspace() {\n    var _this$responder18;\n\n    if ((_this$responder18 = this.responder) !== null && _this$responder18 !== void 0 && _this$responder18.shouldManageDeletingInDirection(\"backward\")) {\n      var _this$delegate14, _this$responder19;\n\n      this.event.preventDefault();\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPerformTyping();\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.deleteInDirection(\"backward\");\n      return this.render();\n    }\n  },\n\n  Tab() {\n    var _this$responder20;\n\n    if ((_this$responder20 = this.responder) !== null && _this$responder20 !== void 0 && _this$responder20.canIncreaseNestingLevel()) {\n      var _this$responder21;\n\n      this.event.preventDefault();\n      (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.increaseNestingLevel();\n      return this.render();\n    }\n  },\n\n  \"Tab+Shift\"() {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canDecreaseNestingLevel()) {\n      var _this$responder23;\n\n      this.event.preventDefault();\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.decreaseNestingLevel();\n      return this.render();\n    }\n  }\n\n});\n\n_defineProperty(Level2InputController, \"inputTypes\", {\n  deleteByComposition() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n\n  deleteByCut() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteByDrag() {\n    this.event.preventDefault();\n    return this.withTargetDOMRange(function () {\n      var _this$responder24;\n\n      this.deleteByDragRange = (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.getSelectedRange();\n    });\n  },\n\n  deleteCompositionText() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n\n  deleteContent() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteContentBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteContentForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteEntireSoftLine() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteHardLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteHardLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteSoftLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteSoftLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteWordBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteWordForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  formatBackColor() {\n    return this.activateAttributeIfSupported(\"backgroundColor\", this.event.data);\n  },\n\n  formatBold() {\n    return this.toggleAttributeIfSupported(\"bold\");\n  },\n\n  formatFontColor() {\n    return this.activateAttributeIfSupported(\"color\", this.event.data);\n  },\n\n  formatFontName() {\n    return this.activateAttributeIfSupported(\"font\", this.event.data);\n  },\n\n  formatIndent() {\n    var _this$responder25;\n\n    if ((_this$responder25 = this.responder) !== null && _this$responder25 !== void 0 && _this$responder25.canIncreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder26;\n\n        return (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.increaseNestingLevel();\n      });\n    }\n  },\n\n  formatItalic() {\n    return this.toggleAttributeIfSupported(\"italic\");\n  },\n\n  formatJustifyCenter() {\n    return this.toggleAttributeIfSupported(\"justifyCenter\");\n  },\n\n  formatJustifyFull() {\n    return this.toggleAttributeIfSupported(\"justifyFull\");\n  },\n\n  formatJustifyLeft() {\n    return this.toggleAttributeIfSupported(\"justifyLeft\");\n  },\n\n  formatJustifyRight() {\n    return this.toggleAttributeIfSupported(\"justifyRight\");\n  },\n\n  formatOutdent() {\n    var _this$responder27;\n\n    if ((_this$responder27 = this.responder) !== null && _this$responder27 !== void 0 && _this$responder27.canDecreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder28;\n\n        return (_this$responder28 = this.responder) === null || _this$responder28 === void 0 ? void 0 : _this$responder28.decreaseNestingLevel();\n      });\n    }\n  },\n\n  formatRemove() {\n    this.withTargetDOMRange(function () {\n      for (const attributeName in (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.getCurrentAttributes()) {\n        var _this$responder29, _this$responder30;\n\n        (_this$responder30 = this.responder) === null || _this$responder30 === void 0 ? void 0 : _this$responder30.removeCurrentAttribute(attributeName);\n      }\n    });\n  },\n\n  formatSetBlockTextDirection() {\n    return this.activateAttributeIfSupported(\"blockDir\", this.event.data);\n  },\n\n  formatSetInlineTextDirection() {\n    return this.activateAttributeIfSupported(\"textDir\", this.event.data);\n  },\n\n  formatStrikeThrough() {\n    return this.toggleAttributeIfSupported(\"strike\");\n  },\n\n  formatSubscript() {\n    return this.toggleAttributeIfSupported(\"sub\");\n  },\n\n  formatSuperscript() {\n    return this.toggleAttributeIfSupported(\"sup\");\n  },\n\n  formatUnderline() {\n    return this.toggleAttributeIfSupported(\"underline\");\n  },\n\n  historyRedo() {\n    var _this$delegate15;\n\n    return (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerWillPerformRedo();\n  },\n\n  historyUndo() {\n    var _this$delegate16;\n\n    return (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPerformUndo();\n  },\n\n  insertCompositionText() {\n    this.composing = true;\n    return this.insertString(this.event.data);\n  },\n\n  insertFromComposition() {\n    this.composing = false;\n    return this.insertString(this.event.data);\n  },\n\n  insertFromDrop() {\n    const range = this.deleteByDragRange;\n\n    if (range) {\n      var _this$delegate17;\n\n      this.deleteByDragRange = null;\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerWillMoveText();\n      return this.withTargetDOMRange(function () {\n        var _this$responder31;\n\n        return (_this$responder31 = this.responder) === null || _this$responder31 === void 0 ? void 0 : _this$responder31.moveTextFromRange(range);\n      });\n    }\n  },\n\n  insertFromPaste() {\n    var _dataTransfer$files;\n\n    const {\n      dataTransfer\n    } = this.event;\n    const paste = {\n      dataTransfer\n    };\n    const href = dataTransfer.getData(\"URL\");\n    const html = dataTransfer.getData(\"text/html\");\n\n    if (href) {\n      var _this$delegate18;\n\n      let string;\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      const name = dataTransfer.getData(\"public.url-name\");\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder32;\n\n        return (_this$responder32 = this.responder) === null || _this$responder32 === void 0 ? void 0 : _this$responder32.insertHTML(paste.html);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate19;\n\n        return (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      };\n    } else if (dataTransferIsPlainText(dataTransfer)) {\n      var _this$delegate20;\n\n      paste.type = \"text/plain\";\n      paste.string = dataTransfer.getData(\"text/plain\");\n      (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder33;\n\n        return (_this$responder33 = this.responder) === null || _this$responder33 === void 0 ? void 0 : _this$responder33.insertString(paste.string);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate21;\n\n        return (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerDidPaste(paste);\n      };\n    } else if (html) {\n      var _this$delegate22;\n\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder34;\n\n        return (_this$responder34 = this.responder) === null || _this$responder34 === void 0 ? void 0 : _this$responder34.insertHTML(paste.html);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate23;\n\n        return (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerDidPaste(paste);\n      };\n    } else if ((_dataTransfer$files = dataTransfer.files) !== null && _dataTransfer$files !== void 0 && _dataTransfer$files.length) {\n      var _this$delegate24;\n\n      paste.type = \"File\";\n      paste.file = dataTransfer.files[0];\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder35;\n\n        return (_this$responder35 = this.responder) === null || _this$responder35 === void 0 ? void 0 : _this$responder35.insertFile(paste.file);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate25;\n\n        return (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerDidPaste(paste);\n      };\n    }\n  },\n\n  insertFromYank() {\n    return this.insertString(this.event.data);\n  },\n\n  insertLineBreak() {\n    return this.insertString(\"\\n\");\n  },\n\n  insertLink() {\n    return this.activateAttributeIfSupported(\"href\", this.event.data);\n  },\n\n  insertOrderedList() {\n    return this.toggleAttributeIfSupported(\"number\");\n  },\n\n  insertParagraph() {\n    var _this$delegate26;\n\n    (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder36;\n\n      return (_this$responder36 = this.responder) === null || _this$responder36 === void 0 ? void 0 : _this$responder36.insertLineBreak();\n    });\n  },\n\n  insertReplacementText() {\n    return this.insertString(this.event.dataTransfer.getData(\"text/plain\"), {\n      updatePosition: false\n    });\n  },\n\n  insertText() {\n    var _this$event$dataTrans;\n\n    return this.insertString(this.event.data || ((_this$event$dataTrans = this.event.dataTransfer) === null || _this$event$dataTrans === void 0 ? void 0 : _this$event$dataTrans.getData(\"text/plain\")));\n  },\n\n  insertTranspose() {\n    return this.insertString(this.event.data);\n  },\n\n  insertUnorderedList() {\n    return this.toggleAttributeIfSupported(\"bullet\");\n  }\n\n});\n\nconst staticRangeToRange = function (staticRange) {\n  const range = document.createRange();\n  range.setStart(staticRange.startContainer, staticRange.startOffset);\n  range.setEnd(staticRange.endContainer, staticRange.endOffset);\n  return range;\n}; // Event helpers\n\n\nconst dragEventHasFiles = event => {\n  var _event$dataTransfer;\n\n  return Array.from(((_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.types) || []).includes(\"Files\");\n};\n\nconst pasteEventHasFilesOnly = function (event) {\n  const clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"Files\") && clipboard.types.length === 1 && clipboard.files.length >= 1;\n  }\n};\n\nconst pasteEventHasPlainTextOnly = function (event) {\n  const clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"text/plain\") && clipboard.types.length === 1;\n  }\n};\n\nconst keyboardCommandFromKeyEvent = function (event) {\n  const command = [];\n\n  if (event.altKey) {\n    command.push(\"alt\");\n  }\n\n  if (event.shiftKey) {\n    command.push(\"shift\");\n  }\n\n  command.push(event.key);\n  return command;\n};\n\nconst pointFromEvent = event => ({\n  x: event.clientX,\n  y: event.clientY\n});\n\nconst {\n  lang,\n  css,\n  keyNames\n} = config;\n\nconst undoable = function (fn) {\n  return function () {\n    const commands = fn.apply(this, arguments);\n    commands.do();\n\n    if (!this.undos) {\n      this.undos = [];\n    }\n\n    this.undos.push(commands.undo);\n  };\n};\n\nclass AttachmentEditorController extends BasicObject {\n  constructor(attachmentPiece, _element, container) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    super(...arguments);\n\n    _defineProperty(this, \"makeElementMutable\", undoable(() => {\n      return {\n        do: () => {\n          this.element.dataset.trixMutable = true;\n        },\n        undo: () => delete this.element.dataset.trixMutable\n      };\n    }));\n\n    _defineProperty(this, \"addToolbar\", undoable(() => {\n      // <div class=\"#{css.attachmentMetadataContainer}\" data-trix-mutable=\"true\">\n      //   <div class=\"trix-button-row\">\n      //     <span class=\"trix-button-group trix-button-group--actions\">\n      //       <button type=\"button\" class=\"trix-button trix-button--remove\" title=\"#{lang.remove}\" data-trix-action=\"remove\">#{lang.remove}</button>\n      //     </span>\n      //   </div>\n      // </div>\n      const element = makeElement({\n        tagName: \"div\",\n        className: css.attachmentToolbar,\n        data: {\n          trixMutable: true\n        },\n        childNodes: makeElement({\n          tagName: \"div\",\n          className: \"trix-button-row\",\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: \"trix-button-group trix-button-group--actions\",\n            childNodes: makeElement({\n              tagName: \"button\",\n              className: \"trix-button trix-button--remove\",\n              textContent: lang.remove,\n              attributes: {\n                title: lang.remove\n              },\n              data: {\n                trixAction: \"remove\"\n              }\n            })\n          })\n        })\n      });\n\n      if (this.attachment.isPreviewable()) {\n        // <div class=\"#{css.attachmentMetadataContainer}\">\n        //   <span class=\"#{css.attachmentMetadata}\">\n        //     <span class=\"#{css.attachmentName}\" title=\"#{name}\">#{name}</span>\n        //     <span class=\"#{css.attachmentSize}\">#{size}</span>\n        //   </span>\n        // </div>\n        element.appendChild(makeElement({\n          tagName: \"div\",\n          className: css.attachmentMetadataContainer,\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: css.attachmentMetadata,\n            childNodes: [makeElement({\n              tagName: \"span\",\n              className: css.attachmentName,\n              textContent: this.attachment.getFilename(),\n              attributes: {\n                title: this.attachment.getFilename()\n              }\n            }), makeElement({\n              tagName: \"span\",\n              className: css.attachmentSize,\n              textContent: this.attachment.getFormattedFilesize()\n            })]\n          })\n        }));\n      }\n\n      handleEvent(\"click\", {\n        onElement: element,\n        withCallback: this.didClickToolbar\n      });\n      handleEvent(\"click\", {\n        onElement: element,\n        matchingSelector: \"[data-trix-action]\",\n        withCallback: this.didClickActionButton\n      });\n      return {\n        do: () => this.element.appendChild(element),\n        undo: () => removeNode(element)\n      };\n    }));\n\n    _defineProperty(this, \"installCaptionEditor\", undoable(() => {\n      const textarea = makeElement({\n        tagName: \"textarea\",\n        className: css.attachmentCaptionEditor,\n        attributes: {\n          placeholder: lang.captionPlaceholder\n        },\n        data: {\n          trixMutable: true\n        }\n      });\n      textarea.value = this.attachmentPiece.getCaption();\n      const textareaClone = textarea.cloneNode();\n      textareaClone.classList.add(\"trix-autoresize-clone\");\n      textareaClone.tabIndex = -1;\n\n      const autoresize = function () {\n        textareaClone.value = textarea.value;\n        textarea.style.height = textareaClone.scrollHeight + \"px\";\n      };\n\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: autoresize\n      });\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: this.didInputCaption\n      });\n      handleEvent(\"keydown\", {\n        onElement: textarea,\n        withCallback: this.didKeyDownCaption\n      });\n      handleEvent(\"change\", {\n        onElement: textarea,\n        withCallback: this.didChangeCaption\n      });\n      handleEvent(\"blur\", {\n        onElement: textarea,\n        withCallback: this.didBlurCaption\n      });\n      const figcaption = this.element.querySelector(\"figcaption\");\n      const editingFigcaption = figcaption.cloneNode();\n      return {\n        do: () => {\n          figcaption.style.display = \"none\";\n          editingFigcaption.appendChild(textarea);\n          editingFigcaption.appendChild(textareaClone);\n          editingFigcaption.classList.add(\"\".concat(css.attachmentCaption, \"--editing\"));\n          figcaption.parentElement.insertBefore(editingFigcaption, figcaption);\n          autoresize();\n\n          if (this.options.editCaption) {\n            return defer(() => textarea.focus());\n          }\n        },\n\n        undo() {\n          removeNode(editingFigcaption);\n          figcaption.style.display = null;\n        }\n\n      };\n    }));\n\n    this.didClickToolbar = this.didClickToolbar.bind(this);\n    this.didClickActionButton = this.didClickActionButton.bind(this);\n    this.didKeyDownCaption = this.didKeyDownCaption.bind(this);\n    this.didInputCaption = this.didInputCaption.bind(this);\n    this.didChangeCaption = this.didChangeCaption.bind(this);\n    this.didBlurCaption = this.didBlurCaption.bind(this);\n    this.attachmentPiece = attachmentPiece;\n    this.element = _element;\n    this.container = container;\n    this.options = options;\n    this.attachment = this.attachmentPiece.attachment;\n\n    if (tagName(this.element) === \"a\") {\n      this.element = this.element.firstChild;\n    }\n\n    this.install();\n  }\n\n  install() {\n    this.makeElementMutable();\n    this.addToolbar();\n\n    if (this.attachment.isPreviewable()) {\n      this.installCaptionEditor();\n    }\n  }\n\n  uninstall() {\n    var _this$delegate;\n\n    let undo = this.undos.pop();\n    this.savePendingCaption();\n\n    while (undo) {\n      undo();\n      undo = this.undos.pop();\n    }\n\n    (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.didUninstallAttachmentEditor(this);\n  } // Private\n\n\n  savePendingCaption() {\n    if (this.pendingCaption) {\n      const caption = this.pendingCaption;\n      this.pendingCaption = null;\n\n      if (caption) {\n        var _this$delegate2, _this$delegate2$attac;\n\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentEditorDidRequestUpdatingAttributesForAttachment) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, {\n          caption\n        }, this.attachment);\n      } else {\n        var _this$delegate3, _this$delegate3$attac;\n\n        (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$attac = _this$delegate3.attachmentEditorDidRequestRemovingAttributeForAttachment) === null || _this$delegate3$attac === void 0 ? void 0 : _this$delegate3$attac.call(_this$delegate3, \"caption\", this.attachment);\n      }\n    }\n  } // Installing and uninstalling\n\n\n  // Event handlers\n  didClickToolbar(event) {\n    event.preventDefault();\n    return event.stopPropagation();\n  }\n\n  didClickActionButton(event) {\n    var _this$delegate4;\n\n    const action = event.target.getAttribute(\"data-trix-action\");\n\n    switch (action) {\n      case \"remove\":\n        return (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.attachmentEditorDidRequestRemovalOfAttachment(this.attachment);\n    }\n  }\n\n  didKeyDownCaption(event) {\n    if (keyNames[event.keyCode] === \"return\") {\n      var _this$delegate5, _this$delegate5$attac;\n\n      event.preventDefault();\n      this.savePendingCaption();\n      return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$attac = _this$delegate5.attachmentEditorDidRequestDeselectingAttachment) === null || _this$delegate5$attac === void 0 ? void 0 : _this$delegate5$attac.call(_this$delegate5, this.attachment);\n    }\n  }\n\n  didInputCaption(event) {\n    this.pendingCaption = event.target.value.replace(/\\s/g, \" \").trim();\n  }\n\n  didChangeCaption(event) {\n    return this.savePendingCaption();\n  }\n\n  didBlurCaption(event) {\n    return this.savePendingCaption();\n  }\n\n}\n\nclass CompositionController extends BasicObject {\n  constructor(element, composition) {\n    super(...arguments);\n    this.didFocus = this.didFocus.bind(this);\n    this.didBlur = this.didBlur.bind(this);\n    this.didClickAttachment = this.didClickAttachment.bind(this);\n    this.element = element;\n    this.composition = composition;\n    this.documentView = new DocumentView(this.composition.document, {\n      element: this.element\n    });\n    handleEvent(\"focus\", {\n      onElement: this.element,\n      withCallback: this.didFocus\n    });\n    handleEvent(\"blur\", {\n      onElement: this.element,\n      withCallback: this.didBlur\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: \"a[contenteditable=false]\",\n      preventDefault: true\n    });\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: attachmentSelector,\n      withCallback: this.didClickAttachment\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: \"a\".concat(attachmentSelector),\n      preventDefault: true\n    });\n  }\n\n  didFocus(event) {\n    var _this$blurPromise;\n\n    const perform = () => {\n      if (!this.focused) {\n        var _this$delegate, _this$delegate$compos;\n\n        this.focused = true;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionControllerDidFocus) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate);\n      }\n    };\n\n    return ((_this$blurPromise = this.blurPromise) === null || _this$blurPromise === void 0 ? void 0 : _this$blurPromise.then(perform)) || perform();\n  }\n\n  didBlur(event) {\n    this.blurPromise = new Promise(resolve => {\n      return defer(() => {\n        if (!innerElementIsActive(this.element)) {\n          var _this$delegate2, _this$delegate2$compo;\n\n          this.focused = null;\n          (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionControllerDidBlur) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n        }\n\n        this.blurPromise = null;\n        return resolve();\n      });\n    });\n  }\n\n  didClickAttachment(event, target) {\n    var _this$delegate3, _this$delegate3$compo;\n\n    const attachment = this.findAttachmentForElement(target);\n    const editCaption = !!findClosestElementFromNode(event.target, {\n      matchingSelector: \"figcaption\"\n    });\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionControllerDidSelectAttachment) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3, attachment, {\n      editCaption\n    });\n  }\n\n  getSerializableElement() {\n    if (this.isEditingAttachment()) {\n      return this.documentView.shadowElement;\n    } else {\n      return this.element;\n    }\n  }\n\n  render() {\n    var _this$delegate6, _this$delegate6$compo;\n\n    if (this.revision !== this.composition.revision) {\n      this.documentView.setDocument(this.composition.document);\n      this.documentView.render();\n      this.revision = this.composition.revision;\n    }\n\n    if (this.canSyncDocumentView() && !this.documentView.isSynced()) {\n      var _this$delegate4, _this$delegate4$compo, _this$delegate5, _this$delegate5$compo;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : (_this$delegate4$compo = _this$delegate4.compositionControllerWillSyncDocumentView) === null || _this$delegate4$compo === void 0 ? void 0 : _this$delegate4$compo.call(_this$delegate4);\n      this.documentView.sync();\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$compo = _this$delegate5.compositionControllerDidSyncDocumentView) === null || _this$delegate5$compo === void 0 ? void 0 : _this$delegate5$compo.call(_this$delegate5);\n    }\n\n    return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionControllerDidRender) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6);\n  }\n\n  rerenderViewForObject(object) {\n    this.invalidateViewForObject(object);\n    return this.render();\n  }\n\n  invalidateViewForObject(object) {\n    return this.documentView.invalidateViewForObject(object);\n  }\n\n  isViewCachingEnabled() {\n    return this.documentView.isViewCachingEnabled();\n  }\n\n  enableViewCaching() {\n    return this.documentView.enableViewCaching();\n  }\n\n  disableViewCaching() {\n    return this.documentView.disableViewCaching();\n  }\n\n  refreshViewCache() {\n    return this.documentView.garbageCollectCachedViews();\n  } // Attachment editor management\n\n\n  isEditingAttachment() {\n    return !!this.attachmentEditor;\n  }\n\n  installAttachmentEditorForAttachment(attachment, options) {\n    var _this$attachmentEdito;\n\n    if (((_this$attachmentEdito = this.attachmentEditor) === null || _this$attachmentEdito === void 0 ? void 0 : _this$attachmentEdito.attachment) === attachment) return;\n    const element = this.documentView.findElementForObject(attachment);\n    if (!element) return;\n    this.uninstallAttachmentEditor();\n    const attachmentPiece = this.composition.document.getAttachmentPieceForAttachment(attachment);\n    this.attachmentEditor = new AttachmentEditorController(attachmentPiece, element, this.element, options);\n    this.attachmentEditor.delegate = this;\n  }\n\n  uninstallAttachmentEditor() {\n    var _this$attachmentEdito2;\n\n    return (_this$attachmentEdito2 = this.attachmentEditor) === null || _this$attachmentEdito2 === void 0 ? void 0 : _this$attachmentEdito2.uninstall();\n  } // Attachment controller delegate\n\n\n  didUninstallAttachmentEditor() {\n    this.attachmentEditor = null;\n    return this.render();\n  }\n\n  attachmentEditorDidRequestUpdatingAttributesForAttachment(attributes, attachment) {\n    var _this$delegate7, _this$delegate7$compo;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionControllerWillUpdateAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment);\n    return this.composition.updateAttributesForAttachment(attributes, attachment);\n  }\n\n  attachmentEditorDidRequestRemovingAttributeForAttachment(attribute, attachment) {\n    var _this$delegate8, _this$delegate8$compo;\n\n    (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionControllerWillUpdateAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n    return this.composition.removeAttributeForAttachment(attribute, attachment);\n  }\n\n  attachmentEditorDidRequestRemovalOfAttachment(attachment) {\n    var _this$delegate9, _this$delegate9$compo;\n\n    return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionControllerDidRequestRemovalOfAttachment) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n  }\n\n  attachmentEditorDidRequestDeselectingAttachment(attachment) {\n    var _this$delegate10, _this$delegate10$comp;\n\n    return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionControllerDidRequestDeselectingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, attachment);\n  } // Private\n\n\n  canSyncDocumentView() {\n    return !this.isEditingAttachment();\n  }\n\n  findAttachmentForElement(element) {\n    return this.composition.document.getAttachmentById(parseInt(element.dataset.trixId, 10));\n  }\n\n}\n\nconst attributeButtonSelector = \"[data-trix-attribute]\";\nconst actionButtonSelector = \"[data-trix-action]\";\nconst toolbarButtonSelector = \"\".concat(attributeButtonSelector, \", \").concat(actionButtonSelector);\nconst dialogSelector = \"[data-trix-dialog]\";\nconst activeDialogSelector = \"\".concat(dialogSelector, \"[data-trix-active]\");\nconst dialogButtonSelector = \"\".concat(dialogSelector, \" [data-trix-method]\");\nconst dialogInputSelector = \"\".concat(dialogSelector, \" [data-trix-input]\");\n\nconst getInputForDialog = (element, attributeName) => {\n  if (!attributeName) {\n    attributeName = getAttributeName(element);\n  }\n\n  return element.querySelector(\"[data-trix-input][name='\".concat(attributeName, \"']\"));\n};\n\nconst getActionName = element => element.getAttribute(\"data-trix-action\");\n\nconst getAttributeName = element => {\n  return element.getAttribute(\"data-trix-attribute\") || element.getAttribute(\"data-trix-dialog-attribute\");\n};\n\nconst getDialogName = element => element.getAttribute(\"data-trix-dialog\");\n\nclass ToolbarController extends BasicObject {\n  constructor(element) {\n    super(element);\n    this.didClickActionButton = this.didClickActionButton.bind(this);\n    this.didClickAttributeButton = this.didClickAttributeButton.bind(this);\n    this.didClickDialogButton = this.didClickDialogButton.bind(this);\n    this.didKeyDownDialogInput = this.didKeyDownDialogInput.bind(this);\n    this.element = element;\n    this.attributes = {};\n    this.actions = {};\n    this.resetDialogInputs();\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: actionButtonSelector,\n      withCallback: this.didClickActionButton\n    });\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: attributeButtonSelector,\n      withCallback: this.didClickAttributeButton\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: toolbarButtonSelector,\n      preventDefault: true\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: dialogButtonSelector,\n      withCallback: this.didClickDialogButton\n    });\n    handleEvent(\"keydown\", {\n      onElement: this.element,\n      matchingSelector: dialogInputSelector,\n      withCallback: this.didKeyDownDialogInput\n    });\n  } // Event handlers\n\n\n  didClickActionButton(event, element) {\n    var _this$delegate;\n\n    (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.toolbarDidClickButton();\n    event.preventDefault();\n    const actionName = getActionName(element);\n\n    if (this.getDialog(actionName)) {\n      return this.toggleDialog(actionName);\n    } else {\n      var _this$delegate2;\n\n      return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.toolbarDidInvokeAction(actionName);\n    }\n  }\n\n  didClickAttributeButton(event, element) {\n    var _this$delegate3;\n\n    (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.toolbarDidClickButton();\n    event.preventDefault();\n    const attributeName = getAttributeName(element);\n\n    if (this.getDialog(attributeName)) {\n      this.toggleDialog(attributeName);\n    } else {\n      var _this$delegate4;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.toolbarDidToggleAttribute(attributeName);\n    }\n\n    return this.refreshAttributeButtons();\n  }\n\n  didClickDialogButton(event, element) {\n    const dialogElement = findClosestElementFromNode(element, {\n      matchingSelector: dialogSelector\n    });\n    const method = element.getAttribute(\"data-trix-method\");\n    return this[method].call(this, dialogElement);\n  }\n\n  didKeyDownDialogInput(event, element) {\n    if (event.keyCode === 13) {\n      // Enter key\n      event.preventDefault();\n      const attribute = element.getAttribute(\"name\");\n      const dialog = this.getDialog(attribute);\n      this.setAttribute(dialog);\n    }\n\n    if (event.keyCode === 27) {\n      // Escape key\n      event.preventDefault();\n      return this.hideDialog();\n    }\n  } // Action buttons\n\n\n  updateActions(actions) {\n    this.actions = actions;\n    return this.refreshActionButtons();\n  }\n\n  refreshActionButtons() {\n    return this.eachActionButton((element, actionName) => {\n      element.disabled = this.actions[actionName] === false;\n    });\n  }\n\n  eachActionButton(callback) {\n    return Array.from(this.element.querySelectorAll(actionButtonSelector)).map(element => callback(element, getActionName(element)));\n  } // Attribute buttons\n\n\n  updateAttributes(attributes) {\n    this.attributes = attributes;\n    return this.refreshAttributeButtons();\n  }\n\n  refreshAttributeButtons() {\n    return this.eachAttributeButton((element, attributeName) => {\n      element.disabled = this.attributes[attributeName] === false;\n\n      if (this.attributes[attributeName] || this.dialogIsVisible(attributeName)) {\n        element.setAttribute(\"data-trix-active\", \"\");\n        return element.classList.add(\"trix-active\");\n      } else {\n        element.removeAttribute(\"data-trix-active\");\n        return element.classList.remove(\"trix-active\");\n      }\n    });\n  }\n\n  eachAttributeButton(callback) {\n    return Array.from(this.element.querySelectorAll(attributeButtonSelector)).map(element => callback(element, getAttributeName(element)));\n  }\n\n  applyKeyboardCommand(keys) {\n    const keyString = JSON.stringify(keys.sort());\n\n    for (const button of Array.from(this.element.querySelectorAll(\"[data-trix-key]\"))) {\n      const buttonKeys = button.getAttribute(\"data-trix-key\").split(\"+\");\n      const buttonKeyString = JSON.stringify(buttonKeys.sort());\n\n      if (buttonKeyString === keyString) {\n        triggerEvent(\"mousedown\", {\n          onElement: button\n        });\n        return true;\n      }\n    }\n\n    return false;\n  } // Dialogs\n\n\n  dialogIsVisible(dialogName) {\n    const element = this.getDialog(dialogName);\n\n    if (element) {\n      return element.hasAttribute(\"data-trix-active\");\n    }\n  }\n\n  toggleDialog(dialogName) {\n    if (this.dialogIsVisible(dialogName)) {\n      return this.hideDialog();\n    } else {\n      return this.showDialog(dialogName);\n    }\n  }\n\n  showDialog(dialogName) {\n    var _this$delegate5, _this$delegate6;\n\n    this.hideDialog();\n    (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.toolbarWillShowDialog();\n    const element = this.getDialog(dialogName);\n    element.setAttribute(\"data-trix-active\", \"\");\n    element.classList.add(\"trix-active\");\n    Array.from(element.querySelectorAll(\"input[disabled]\")).forEach(disabledInput => {\n      disabledInput.removeAttribute(\"disabled\");\n    });\n    const attributeName = getAttributeName(element);\n\n    if (attributeName) {\n      const input = getInputForDialog(element, dialogName);\n\n      if (input) {\n        input.value = this.attributes[attributeName] || \"\";\n        input.select();\n      }\n    }\n\n    return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.toolbarDidShowDialog(dialogName);\n  }\n\n  setAttribute(dialogElement) {\n    const attributeName = getAttributeName(dialogElement);\n    const input = getInputForDialog(dialogElement, attributeName);\n\n    if (input.willValidate && !input.checkValidity()) {\n      input.setAttribute(\"data-trix-validate\", \"\");\n      input.classList.add(\"trix-validate\");\n      return input.focus();\n    } else {\n      var _this$delegate7;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.toolbarDidUpdateAttribute(attributeName, input.value);\n      return this.hideDialog();\n    }\n  }\n\n  removeAttribute(dialogElement) {\n    var _this$delegate8;\n\n    const attributeName = getAttributeName(dialogElement);\n    (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.toolbarDidRemoveAttribute(attributeName);\n    return this.hideDialog();\n  }\n\n  hideDialog() {\n    const element = this.element.querySelector(activeDialogSelector);\n\n    if (element) {\n      var _this$delegate9;\n\n      element.removeAttribute(\"data-trix-active\");\n      element.classList.remove(\"trix-active\");\n      this.resetDialogInputs();\n      return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.toolbarDidHideDialog(getDialogName(element));\n    }\n  }\n\n  resetDialogInputs() {\n    Array.from(this.element.querySelectorAll(dialogInputSelector)).forEach(input => {\n      input.setAttribute(\"disabled\", \"disabled\");\n      input.removeAttribute(\"data-trix-validate\");\n      input.classList.remove(\"trix-validate\");\n    });\n  }\n\n  getDialog(dialogName) {\n    return this.element.querySelector(\"[data-trix-dialog=\".concat(dialogName, \"]\"));\n  }\n\n}\n\nconst snapshotsAreEqual = (a, b) => rangesAreEqual(a.selectedRange, b.selectedRange) && a.document.isEqualTo(b.document);\n\nclass EditorController extends Controller {\n  constructor(_ref) {\n    let {\n      editorElement,\n      document,\n      html\n    } = _ref;\n    super(...arguments);\n    this.editorElement = editorElement;\n    this.selectionManager = new SelectionManager(this.editorElement);\n    this.selectionManager.delegate = this;\n    this.composition = new Composition();\n    this.composition.delegate = this;\n    this.attachmentManager = new AttachmentManager(this.composition.getAttachments());\n    this.attachmentManager.delegate = this;\n    this.inputController = config.input.getLevel() === 2 ? new Level2InputController(this.editorElement) : new Level0InputController(this.editorElement);\n    this.inputController.delegate = this;\n    this.inputController.responder = this.composition;\n    this.compositionController = new CompositionController(this.editorElement, this.composition);\n    this.compositionController.delegate = this;\n    this.toolbarController = new ToolbarController(this.editorElement.toolbarElement);\n    this.toolbarController.delegate = this;\n    this.editor = new Editor(this.composition, this.selectionManager, this.editorElement);\n\n    if (document) {\n      this.editor.loadDocument(document);\n    } else {\n      this.editor.loadHTML(html);\n    }\n  }\n\n  registerSelectionManager() {\n    return selectionChangeObserver.registerSelectionManager(this.selectionManager);\n  }\n\n  unregisterSelectionManager() {\n    return selectionChangeObserver.unregisterSelectionManager(this.selectionManager);\n  }\n\n  render() {\n    return this.compositionController.render();\n  }\n\n  reparse() {\n    return this.composition.replaceHTML(this.editorElement.innerHTML);\n  } // Composition delegate\n\n\n  compositionDidChangeDocument(document) {\n    this.notifyEditorElement(\"document-change\");\n\n    if (!this.handlingInput) {\n      return this.render();\n    }\n  }\n\n  compositionDidChangeCurrentAttributes(currentAttributes) {\n    this.currentAttributes = currentAttributes;\n    this.toolbarController.updateAttributes(this.currentAttributes);\n    this.updateCurrentActions();\n    return this.notifyEditorElement(\"attributes-change\", {\n      attributes: this.currentAttributes\n    });\n  }\n\n  compositionDidPerformInsertionAtRange(range) {\n    if (this.pasting) {\n      this.pastedRange = range;\n    }\n  }\n\n  compositionShouldAcceptFile(file) {\n    return this.notifyEditorElement(\"file-accept\", {\n      file\n    });\n  }\n\n  compositionDidAddAttachment(attachment) {\n    const managedAttachment = this.attachmentManager.manageAttachment(attachment);\n    return this.notifyEditorElement(\"attachment-add\", {\n      attachment: managedAttachment\n    });\n  }\n\n  compositionDidEditAttachment(attachment) {\n    this.compositionController.rerenderViewForObject(attachment);\n    const managedAttachment = this.attachmentManager.manageAttachment(attachment);\n    this.notifyEditorElement(\"attachment-edit\", {\n      attachment: managedAttachment\n    });\n    return this.notifyEditorElement(\"change\");\n  }\n\n  compositionDidChangeAttachmentPreviewURL(attachment) {\n    this.compositionController.invalidateViewForObject(attachment);\n    return this.notifyEditorElement(\"change\");\n  }\n\n  compositionDidRemoveAttachment(attachment) {\n    const managedAttachment = this.attachmentManager.unmanageAttachment(attachment);\n    return this.notifyEditorElement(\"attachment-remove\", {\n      attachment: managedAttachment\n    });\n  }\n\n  compositionDidStartEditingAttachment(attachment, options) {\n    this.attachmentLocationRange = this.composition.document.getLocationRangeOfAttachment(attachment);\n    this.compositionController.installAttachmentEditorForAttachment(attachment, options);\n    return this.selectionManager.setLocationRange(this.attachmentLocationRange);\n  }\n\n  compositionDidStopEditingAttachment(attachment) {\n    this.compositionController.uninstallAttachmentEditor();\n    this.attachmentLocationRange = null;\n  }\n\n  compositionDidRequestChangingSelectionToLocationRange(locationRange) {\n    if (this.loadingSnapshot && !this.isFocused()) return;\n    this.requestedLocationRange = locationRange;\n    this.compositionRevisionWhenLocationRangeRequested = this.composition.revision;\n\n    if (!this.handlingInput) {\n      return this.render();\n    }\n  }\n\n  compositionWillLoadSnapshot() {\n    this.loadingSnapshot = true;\n  }\n\n  compositionDidLoadSnapshot() {\n    this.compositionController.refreshViewCache();\n    this.render();\n    this.loadingSnapshot = false;\n  }\n\n  getSelectionManager() {\n    return this.selectionManager;\n  } // Attachment manager delegate\n\n\n  attachmentManagerDidRequestRemovalOfAttachment(attachment) {\n    return this.removeAttachment(attachment);\n  } // Document controller delegate\n\n\n  compositionControllerWillSyncDocumentView() {\n    this.inputController.editorWillSyncDocumentView();\n    this.selectionManager.lock();\n    return this.selectionManager.clearSelection();\n  }\n\n  compositionControllerDidSyncDocumentView() {\n    this.inputController.editorDidSyncDocumentView();\n    this.selectionManager.unlock();\n    this.updateCurrentActions();\n    return this.notifyEditorElement(\"sync\");\n  }\n\n  compositionControllerDidRender() {\n    if (this.requestedLocationRange) {\n      if (this.compositionRevisionWhenLocationRangeRequested === this.composition.revision) {\n        this.selectionManager.setLocationRange(this.requestedLocationRange);\n      }\n\n      this.requestedLocationRange = null;\n      this.compositionRevisionWhenLocationRangeRequested = null;\n    }\n\n    if (this.renderedCompositionRevision !== this.composition.revision) {\n      this.runEditorFilters();\n      this.composition.updateCurrentAttributes();\n      this.notifyEditorElement(\"render\");\n    }\n\n    this.renderedCompositionRevision = this.composition.revision;\n  }\n\n  compositionControllerDidFocus() {\n    if (this.isFocusedInvisibly()) {\n      this.setLocationRange({\n        index: 0,\n        offset: 0\n      });\n    }\n\n    this.toolbarController.hideDialog();\n    return this.notifyEditorElement(\"focus\");\n  }\n\n  compositionControllerDidBlur() {\n    return this.notifyEditorElement(\"blur\");\n  }\n\n  compositionControllerDidSelectAttachment(attachment, options) {\n    this.toolbarController.hideDialog();\n    return this.composition.editAttachment(attachment, options);\n  }\n\n  compositionControllerDidRequestDeselectingAttachment(attachment) {\n    const locationRange = this.attachmentLocationRange || this.composition.document.getLocationRangeOfAttachment(attachment);\n    return this.selectionManager.setLocationRange(locationRange[1]);\n  }\n\n  compositionControllerWillUpdateAttachment(attachment) {\n    return this.editor.recordUndoEntry(\"Edit Attachment\", {\n      context: attachment.id,\n      consolidatable: true\n    });\n  }\n\n  compositionControllerDidRequestRemovalOfAttachment(attachment) {\n    return this.removeAttachment(attachment);\n  } // Input controller delegate\n\n\n  inputControllerWillHandleInput() {\n    this.handlingInput = true;\n    this.requestedRender = false;\n  }\n\n  inputControllerDidRequestRender() {\n    this.requestedRender = true;\n  }\n\n  inputControllerDidHandleInput() {\n    this.handlingInput = false;\n\n    if (this.requestedRender) {\n      this.requestedRender = false;\n      return this.render();\n    }\n  }\n\n  inputControllerDidAllowUnhandledInput() {\n    return this.notifyEditorElement(\"change\");\n  }\n\n  inputControllerDidRequestReparse() {\n    return this.reparse();\n  }\n\n  inputControllerWillPerformTyping() {\n    return this.recordTypingUndoEntry();\n  }\n\n  inputControllerWillPerformFormatting(attributeName) {\n    return this.recordFormattingUndoEntry(attributeName);\n  }\n\n  inputControllerWillCutText() {\n    return this.editor.recordUndoEntry(\"Cut\");\n  }\n\n  inputControllerWillPaste(paste) {\n    this.editor.recordUndoEntry(\"Paste\");\n    this.pasting = true;\n    return this.notifyEditorElement(\"before-paste\", {\n      paste\n    });\n  }\n\n  inputControllerDidPaste(paste) {\n    paste.range = this.pastedRange;\n    this.pastedRange = null;\n    this.pasting = null;\n    return this.notifyEditorElement(\"paste\", {\n      paste\n    });\n  }\n\n  inputControllerWillMoveText() {\n    return this.editor.recordUndoEntry(\"Move\");\n  }\n\n  inputControllerWillAttachFiles() {\n    return this.editor.recordUndoEntry(\"Drop Files\");\n  }\n\n  inputControllerWillPerformUndo() {\n    return this.editor.undo();\n  }\n\n  inputControllerWillPerformRedo() {\n    return this.editor.redo();\n  }\n\n  inputControllerDidReceiveKeyboardCommand(keys) {\n    return this.toolbarController.applyKeyboardCommand(keys);\n  }\n\n  inputControllerDidStartDrag() {\n    this.locationRangeBeforeDrag = this.selectionManager.getLocationRange();\n  }\n\n  inputControllerDidReceiveDragOverPoint(point) {\n    return this.selectionManager.setLocationRangeFromPointRange(point);\n  }\n\n  inputControllerDidCancelDrag() {\n    this.selectionManager.setLocationRange(this.locationRangeBeforeDrag);\n    this.locationRangeBeforeDrag = null;\n  } // Selection manager delegate\n\n\n  locationRangeDidChange(locationRange) {\n    this.composition.updateCurrentAttributes();\n    this.updateCurrentActions();\n\n    if (this.attachmentLocationRange && !rangesAreEqual(this.attachmentLocationRange, locationRange)) {\n      this.composition.stopEditingAttachment();\n    }\n\n    return this.notifyEditorElement(\"selection-change\");\n  } // Toolbar controller delegate\n\n\n  toolbarDidClickButton() {\n    if (!this.getLocationRange()) {\n      return this.setLocationRange({\n        index: 0,\n        offset: 0\n      });\n    }\n  }\n\n  toolbarDidInvokeAction(actionName) {\n    return this.invokeAction(actionName);\n  }\n\n  toolbarDidToggleAttribute(attributeName) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.toggleCurrentAttribute(attributeName);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarDidUpdateAttribute(attributeName, value) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.setCurrentAttribute(attributeName, value);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarDidRemoveAttribute(attributeName) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.removeCurrentAttribute(attributeName);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarWillShowDialog(dialogElement) {\n    this.composition.expandSelectionForEditing();\n    return this.freezeSelection();\n  }\n\n  toolbarDidShowDialog(dialogName) {\n    return this.notifyEditorElement(\"toolbar-dialog-show\", {\n      dialogName\n    });\n  }\n\n  toolbarDidHideDialog(dialogName) {\n    this.thawSelection();\n    this.editorElement.focus();\n    return this.notifyEditorElement(\"toolbar-dialog-hide\", {\n      dialogName\n    });\n  } // Selection\n\n\n  freezeSelection() {\n    if (!this.selectionFrozen) {\n      this.selectionManager.lock();\n      this.composition.freezeSelection();\n      this.selectionFrozen = true;\n      return this.render();\n    }\n  }\n\n  thawSelection() {\n    if (this.selectionFrozen) {\n      this.composition.thawSelection();\n      this.selectionManager.unlock();\n      this.selectionFrozen = false;\n      return this.render();\n    }\n  }\n\n  canInvokeAction(actionName) {\n    if (this.actionIsExternal(actionName)) {\n      return true;\n    } else {\n      var _this$actions$actionN, _this$actions$actionN2;\n\n      return !!((_this$actions$actionN = this.actions[actionName]) !== null && _this$actions$actionN !== void 0 && (_this$actions$actionN2 = _this$actions$actionN.test) !== null && _this$actions$actionN2 !== void 0 && _this$actions$actionN2.call(this));\n    }\n  }\n\n  invokeAction(actionName) {\n    if (this.actionIsExternal(actionName)) {\n      return this.notifyEditorElement(\"action-invoke\", {\n        actionName\n      });\n    } else {\n      var _this$actions$actionN3, _this$actions$actionN4;\n\n      return (_this$actions$actionN3 = this.actions[actionName]) === null || _this$actions$actionN3 === void 0 ? void 0 : (_this$actions$actionN4 = _this$actions$actionN3.perform) === null || _this$actions$actionN4 === void 0 ? void 0 : _this$actions$actionN4.call(this);\n    }\n  }\n\n  actionIsExternal(actionName) {\n    return /^x-./.test(actionName);\n  }\n\n  getCurrentActions() {\n    const result = {};\n\n    for (const actionName in this.actions) {\n      result[actionName] = this.canInvokeAction(actionName);\n    }\n\n    return result;\n  }\n\n  updateCurrentActions() {\n    const currentActions = this.getCurrentActions();\n\n    if (!objectsAreEqual(currentActions, this.currentActions)) {\n      this.currentActions = currentActions;\n      this.toolbarController.updateActions(this.currentActions);\n      return this.notifyEditorElement(\"actions-change\", {\n        actions: this.currentActions\n      });\n    }\n  } // Editor filters\n\n\n  runEditorFilters() {\n    let snapshot = this.composition.getSnapshot();\n    Array.from(this.editor.filters).forEach(filter => {\n      const {\n        document,\n        selectedRange\n      } = snapshot;\n      snapshot = filter.call(this.editor, snapshot) || {};\n\n      if (!snapshot.document) {\n        snapshot.document = document;\n      }\n\n      if (!snapshot.selectedRange) {\n        snapshot.selectedRange = selectedRange;\n      }\n    });\n\n    if (!snapshotsAreEqual(snapshot, this.composition.getSnapshot())) {\n      return this.composition.loadSnapshot(snapshot);\n    }\n  } // Private\n\n\n  updateInputElement() {\n    const element = this.compositionController.getSerializableElement();\n    const value = serializeToContentType(element, \"text/html\");\n    return this.editorElement.setInputElementValue(value);\n  }\n\n  notifyEditorElement(message, data) {\n    switch (message) {\n      case \"document-change\":\n        this.documentChangedSinceLastRender = true;\n        break;\n\n      case \"render\":\n        if (this.documentChangedSinceLastRender) {\n          this.documentChangedSinceLastRender = false;\n          this.notifyEditorElement(\"change\");\n        }\n\n        break;\n\n      case \"change\":\n      case \"attachment-add\":\n      case \"attachment-edit\":\n      case \"attachment-remove\":\n        this.updateInputElement();\n        break;\n    }\n\n    return this.editorElement.notify(message, data);\n  }\n\n  removeAttachment(attachment) {\n    this.editor.recordUndoEntry(\"Delete Attachment\");\n    this.composition.removeAttachment(attachment);\n    return this.render();\n  }\n\n  recordFormattingUndoEntry(attributeName) {\n    const blockConfig = getBlockConfig(attributeName);\n    const locationRange = this.selectionManager.getLocationRange();\n\n    if (blockConfig || !rangeIsCollapsed(locationRange)) {\n      return this.editor.recordUndoEntry(\"Formatting\", {\n        context: this.getUndoContext(),\n        consolidatable: true\n      });\n    }\n  }\n\n  recordTypingUndoEntry() {\n    return this.editor.recordUndoEntry(\"Typing\", {\n      context: this.getUndoContext(this.currentAttributes),\n      consolidatable: true\n    });\n  }\n\n  getUndoContext() {\n    for (var _len = arguments.length, context = new Array(_len), _key = 0; _key < _len; _key++) {\n      context[_key] = arguments[_key];\n    }\n\n    return [this.getLocationContext(), this.getTimeContext(), ...Array.from(context)];\n  }\n\n  getLocationContext() {\n    const locationRange = this.selectionManager.getLocationRange();\n\n    if (rangeIsCollapsed(locationRange)) {\n      return locationRange[0].index;\n    } else {\n      return locationRange;\n    }\n  }\n\n  getTimeContext() {\n    if (config.undoInterval > 0) {\n      return Math.floor(new Date().getTime() / config.undoInterval);\n    } else {\n      return 0;\n    }\n  }\n\n  isFocused() {\n    var _this$editorElement$o;\n\n    return this.editorElement === ((_this$editorElement$o = this.editorElement.ownerDocument) === null || _this$editorElement$o === void 0 ? void 0 : _this$editorElement$o.activeElement);\n  } // Detect \"Cursor disappears sporadically\" Firefox bug.\n  // - https://bugzilla.mozilla.org/show_bug.cgi?id=226301\n\n\n  isFocusedInvisibly() {\n    return this.isFocused() && !this.getLocationRange();\n  }\n\n  get actions() {\n    return this.constructor.actions;\n  }\n\n}\n\n_defineProperty(EditorController, \"actions\", {\n  undo: {\n    test() {\n      return this.editor.canUndo();\n    },\n\n    perform() {\n      return this.editor.undo();\n    }\n\n  },\n  redo: {\n    test() {\n      return this.editor.canRedo();\n    },\n\n    perform() {\n      return this.editor.redo();\n    }\n\n  },\n  link: {\n    test() {\n      return this.editor.canActivateAttribute(\"href\");\n    }\n\n  },\n  increaseNestingLevel: {\n    test() {\n      return this.editor.canIncreaseNestingLevel();\n    },\n\n    perform() {\n      return this.editor.increaseNestingLevel() && this.render();\n    }\n\n  },\n  decreaseNestingLevel: {\n    test() {\n      return this.editor.canDecreaseNestingLevel();\n    },\n\n    perform() {\n      return this.editor.decreaseNestingLevel() && this.render();\n    }\n\n  },\n  attachFiles: {\n    test() {\n      return true;\n    },\n\n    perform() {\n      return config.input.pickFiles(this.editor.insertFiles);\n    }\n\n  }\n});\n\nEditorController.proxyMethod(\"getSelectionManager().setLocationRange\");\nEditorController.proxyMethod(\"getSelectionManager().getLocationRange\");\n\ninstallDefaultCSSForTagName(\"trix-toolbar\", \"%t {\\n  display: block;\\n}\\n\\n%t {\\n  white-space: nowrap;\\n}\\n\\n%t [data-trix-dialog] {\\n  display: none;\\n}\\n\\n%t [data-trix-dialog][data-trix-active] {\\n  display: block;\\n}\\n\\n%t [data-trix-dialog] [data-trix-validate]:invalid {\\n  background-color: #ffdddd;\\n}\");\nclass TrixToolbarElement extends HTMLElement {\n  // Element lifecycle\n  connectedCallback() {\n    if (this.innerHTML === \"\") {\n      this.innerHTML = config.toolbar.getDefaultHTML();\n    }\n  }\n\n}\nwindow.customElements.define(\"trix-toolbar\", TrixToolbarElement);\n\nlet id = 0; // Contenteditable support helpers\n\nconst autofocus = function (element) {\n  if (!document.querySelector(\":focus\")) {\n    if (element.hasAttribute(\"autofocus\") && document.querySelector(\"[autofocus]\") === element) {\n      return element.focus();\n    }\n  }\n};\n\nconst makeEditable = function (element) {\n  if (element.hasAttribute(\"contenteditable\")) {\n    return;\n  }\n\n  element.setAttribute(\"contenteditable\", \"\");\n  return handleEventOnce(\"focus\", {\n    onElement: element,\n\n    withCallback() {\n      return configureContentEditable(element);\n    }\n\n  });\n};\n\nconst configureContentEditable = function (element) {\n  disableObjectResizing(element);\n  return setDefaultParagraphSeparator(element);\n};\n\nconst disableObjectResizing = function (element) {\n  var _document$queryComman, _document;\n\n  if ((_document$queryComman = (_document = document).queryCommandSupported) !== null && _document$queryComman !== void 0 && _document$queryComman.call(_document, \"enableObjectResizing\")) {\n    document.execCommand(\"enableObjectResizing\", false, false);\n    return handleEvent(\"mscontrolselect\", {\n      onElement: element,\n      preventDefault: true\n    });\n  }\n};\n\nconst setDefaultParagraphSeparator = function (element) {\n  var _document$queryComman2, _document2;\n\n  if ((_document$queryComman2 = (_document2 = document).queryCommandSupported) !== null && _document$queryComman2 !== void 0 && _document$queryComman2.call(_document2, \"DefaultParagraphSeparator\")) {\n    const {\n      tagName\n    } = config.blockAttributes.default;\n\n    if ([\"div\", \"p\"].includes(tagName)) {\n      return document.execCommand(\"DefaultParagraphSeparator\", false, tagName);\n    }\n  }\n}; // Accessibility helpers\n\n\nconst addAccessibilityRole = function (element) {\n  if (element.hasAttribute(\"role\")) {\n    return;\n  }\n\n  return element.setAttribute(\"role\", \"textbox\");\n};\n\nconst ensureAriaLabel = function (element) {\n  if (element.hasAttribute(\"aria-label\") || element.hasAttribute(\"aria-labelledby\")) {\n    return;\n  }\n\n  const update = function () {\n    const texts = Array.from(element.labels).map(label => {\n      if (!label.contains(element)) return label.textContent;\n    }).filter(text => text);\n    const text = texts.join(\" \");\n\n    if (text) {\n      return element.setAttribute(\"aria-label\", text);\n    } else {\n      return element.removeAttribute(\"aria-label\");\n    }\n  };\n\n  update();\n  return handleEvent(\"focus\", {\n    onElement: element,\n    withCallback: update\n  });\n}; // Style\n\n\nconst cursorTargetStyles = function () {\n  if (config.browser.forcesObjectResizing) {\n    return {\n      display: \"inline\",\n      width: \"auto\"\n    };\n  } else {\n    return {\n      display: \"inline-block\",\n      width: \"1px\"\n    };\n  }\n}();\n\ninstallDefaultCSSForTagName(\"trix-editor\", \"%t {\\n    display: block;\\n}\\n\\n%t:empty:not(:focus)::before {\\n    content: attr(placeholder);\\n    color: graytext;\\n    cursor: text;\\n    pointer-events: none;\\n    white-space: pre-line;\\n}\\n\\n%t a[contenteditable=false] {\\n    cursor: text;\\n}\\n\\n%t img {\\n    max-width: 100%;\\n    height: auto;\\n}\\n\\n%t \".concat(attachmentSelector, \" figcaption textarea {\\n    resize: none;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption textarea.trix-autoresize-clone {\\n    position: absolute;\\n    left: -9999px;\\n    max-height: 0px;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption[data-trix-placeholder]:empty::before {\\n    content: attr(data-trix-placeholder);\\n    color: graytext;\\n}\\n\\n%t [data-trix-cursor-target] {\\n    display: \").concat(cursorTargetStyles.display, \" !important;\\n    width: \").concat(cursorTargetStyles.width, \" !important;\\n    padding: 0 !important;\\n    margin: 0 !important;\\n    border: none !important;\\n}\\n\\n%t [data-trix-cursor-target=left] {\\n    vertical-align: top !important;\\n    margin-left: -1px !important;\\n}\\n\\n%t [data-trix-cursor-target=right] {\\n    vertical-align: bottom !important;\\n    margin-right: -1px !important;\\n}\"));\nclass TrixEditorElement extends HTMLElement {\n  // Properties\n  get trixId() {\n    if (this.hasAttribute(\"trix-id\")) {\n      return this.getAttribute(\"trix-id\");\n    } else {\n      this.setAttribute(\"trix-id\", ++id);\n      return this.trixId;\n    }\n  }\n\n  get labels() {\n    const labels = [];\n\n    if (this.id && this.ownerDocument) {\n      labels.push(...Array.from(this.ownerDocument.querySelectorAll(\"label[for='\".concat(this.id, \"']\")) || []));\n    }\n\n    const label = findClosestElementFromNode(this, {\n      matchingSelector: \"label\"\n    });\n\n    if (label) {\n      if ([this, null].includes(label.control)) {\n        labels.push(label);\n      }\n    }\n\n    return labels;\n  }\n\n  get toolbarElement() {\n    if (this.hasAttribute(\"toolbar\")) {\n      var _this$ownerDocument;\n\n      return (_this$ownerDocument = this.ownerDocument) === null || _this$ownerDocument === void 0 ? void 0 : _this$ownerDocument.getElementById(this.getAttribute(\"toolbar\"));\n    } else if (this.parentNode) {\n      const toolbarId = \"trix-toolbar-\".concat(this.trixId);\n      this.setAttribute(\"toolbar\", toolbarId);\n      const element = makeElement(\"trix-toolbar\", {\n        id: toolbarId\n      });\n      this.parentNode.insertBefore(element, this);\n      return element;\n    } else {\n      return undefined;\n    }\n  }\n\n  get form() {\n    var _this$inputElement;\n\n    return (_this$inputElement = this.inputElement) === null || _this$inputElement === void 0 ? void 0 : _this$inputElement.form;\n  }\n\n  get inputElement() {\n    if (this.hasAttribute(\"input\")) {\n      var _this$ownerDocument2;\n\n      return (_this$ownerDocument2 = this.ownerDocument) === null || _this$ownerDocument2 === void 0 ? void 0 : _this$ownerDocument2.getElementById(this.getAttribute(\"input\"));\n    } else if (this.parentNode) {\n      const inputId = \"trix-input-\".concat(this.trixId);\n      this.setAttribute(\"input\", inputId);\n      const element = makeElement(\"input\", {\n        type: \"hidden\",\n        id: inputId\n      });\n      this.parentNode.insertBefore(element, this.nextElementSibling);\n      return element;\n    } else {\n      return undefined;\n    }\n  }\n\n  get editor() {\n    var _this$editorControlle;\n\n    return (_this$editorControlle = this.editorController) === null || _this$editorControlle === void 0 ? void 0 : _this$editorControlle.editor;\n  }\n\n  get name() {\n    var _this$inputElement2;\n\n    return (_this$inputElement2 = this.inputElement) === null || _this$inputElement2 === void 0 ? void 0 : _this$inputElement2.name;\n  }\n\n  get value() {\n    var _this$inputElement3;\n\n    return (_this$inputElement3 = this.inputElement) === null || _this$inputElement3 === void 0 ? void 0 : _this$inputElement3.value;\n  }\n\n  set value(defaultValue) {\n    var _this$editor;\n\n    this.defaultValue = defaultValue;\n    (_this$editor = this.editor) === null || _this$editor === void 0 ? void 0 : _this$editor.loadHTML(this.defaultValue);\n  } // Controller delegate methods\n\n\n  notify(message, data) {\n    if (this.editorController) {\n      return triggerEvent(\"trix-\".concat(message), {\n        onElement: this,\n        attributes: data\n      });\n    }\n  }\n\n  setInputElementValue(value) {\n    if (this.inputElement) {\n      this.inputElement.value = value;\n    }\n  } // Element lifecycle\n\n\n  connectedCallback() {\n    if (!this.hasAttribute(\"data-trix-internal\")) {\n      makeEditable(this);\n      addAccessibilityRole(this);\n      ensureAriaLabel(this);\n\n      if (!this.editorController) {\n        triggerEvent(\"trix-before-initialize\", {\n          onElement: this\n        });\n        this.editorController = new EditorController({\n          editorElement: this,\n          html: this.defaultValue = this.value\n        });\n        requestAnimationFrame(() => triggerEvent(\"trix-initialize\", {\n          onElement: this\n        }));\n      }\n\n      this.editorController.registerSelectionManager();\n      this.registerResetListener();\n      this.registerClickListener();\n      autofocus(this);\n    }\n  }\n\n  disconnectedCallback() {\n    var _this$editorControlle2;\n\n    (_this$editorControlle2 = this.editorController) === null || _this$editorControlle2 === void 0 ? void 0 : _this$editorControlle2.unregisterSelectionManager();\n    this.unregisterResetListener();\n    return this.unregisterClickListener();\n  } // Form support\n\n\n  registerResetListener() {\n    this.resetListener = this.resetBubbled.bind(this);\n    return window.addEventListener(\"reset\", this.resetListener, false);\n  }\n\n  unregisterResetListener() {\n    return window.removeEventListener(\"reset\", this.resetListener, false);\n  }\n\n  registerClickListener() {\n    this.clickListener = this.clickBubbled.bind(this);\n    return window.addEventListener(\"click\", this.clickListener, false);\n  }\n\n  unregisterClickListener() {\n    return window.removeEventListener(\"click\", this.clickListener, false);\n  }\n\n  resetBubbled(event) {\n    if (event.defaultPrevented) return;\n    if (event.target !== this.form) return;\n    return this.reset();\n  }\n\n  clickBubbled(event) {\n    if (event.defaultPrevented) return;\n    if (this.contains(event.target)) return;\n    const label = findClosestElementFromNode(event.target, {\n      matchingSelector: \"label\"\n    });\n    if (!label) return;\n    if (!Array.from(this.labels).includes(label)) return;\n    return this.focus();\n  }\n\n  reset() {\n    this.value = this.defaultValue;\n  }\n\n}\nwindow.customElements.define(\"trix-editor\", TrixEditorElement);\n\nexport { Trix as default };\n"]},"metadata":{},"sourceType":"module"}