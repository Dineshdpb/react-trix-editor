{"ast":null,"code":"import _classCallCheck from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nvar _jsxFileName = \"/Users/pravin/Desktop/dinesh-web/react-trix-editor/src/Editor.jsx\";\nimport React, { Component } from \"react\";\nimport Trix from \"trix\";\nimport \"trix/dist/trix\";\nimport \"trix/dist/trix.css\";\nimport \"tributejs/tribute.css\";\nimport Tribute from \"tributejs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar Editor = /*#__PURE__*/function (_React$Component) {\n  _inherits(Editor, _React$Component);\n\n  var _super = _createSuper(Editor);\n\n  function Editor(props) {\n    var _this;\n\n    _classCallCheck(this, Editor);\n\n    _this = _super.call(this, props);\n    _this.ediotrInput = /*#__PURE__*/React.createRef();\n    _this.tribute = /*#__PURE__*/React.createRef();\n    _this.observer = new MutationObserver(function (mutations) {\n      mutations.forEach(function (_ref) {\n        var type = _ref.type,\n            target = _ref.target,\n            attributeName = _ref.attributeName;\n\n        // If the parent is a figure with an img target\n        if (target.parentNode.tagName === 'FIGURE' && target.nodeName === 'IMG') {\n          if (type === 'attributes') {\n            switch (attributeName) {\n              // If we have attribute width\n              case 'width':\n                // Remove attribute width\n                target.removeAttribute('width'); // Add img-fluid only once\n\n                target.classList.add('img-fluid');\n                break;\n              // If we have attribute height\n\n              case 'height':\n                // Remove attribute height\n                target.removeAttribute('height');\n                break;\n            }\n          } // Render images HTML code\n          // renderHtmlOutput();\n\n        }\n      });\n    });\n    return _this;\n  }\n\n  _createClass(Editor, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var editor = document.querySelector('trix-editor');\n      this.observer.observe(editor, {\n        attributes: true,\n        childList: true,\n        subtree: true\n      });\n      this.ediotrInput.current.addEventListener('trix-before-initialize', function (e) {\n        var currentEditor = textEditor.current;\n        this.tribute.current = new Tribute({\n          values: [{\n            key: \"schniz\",\n            value: \"Gal Schlezinger\"\n          }, {\n            key: \"deanshub\",\n            value: \"Dean Shub\"\n          }]\n        });\n        this.tribute.current.attach(currentEditor);\n      });\n      this.ediotrInput.current.addEventListener(\"trix-change\", function (event) {\n        _this2.props.onChange(event.target.innerHTML); //calling custom event\n\n\n        var reff = _this2.ediotrInput.current.editor;\n        console.log(reff.getDocument().toString());\n        console.log(reff.selectionManager.selectionDidChange()); // var attachment = new Trix.Attachment({ content: '<span class=\"mention\">@trix</span>' })\n        // reff.insertAttachment(attachment)\n        // console.log(reff)\n        // debugger\n        // debugger\n      });\n      this.ediotrInput.current.addEventListener(\"trix-attachment-add\", function (event) {\n        console.log(event.attachment);\n\n        if (event.attachment.file) {\n          setContent(event.attachment, event.attachment.file); // uploadFileAttachment(event.attachment)\n        }\n      });\n      this.ediotrInput.current.addEventListener(\"trix-attachment-remove\", function (event) {\n        console.log(event);\n      });\n      this.ediotrInput.current.addEventListener(\"trix-file-accept\", function (event) {\n        console.log(event);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"hidden\",\n          id: \"trix\",\n          value: this.props.value\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"trix-editor\", {\n          input: \"trix\",\n          ref: this.ediotrInput\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return Editor;\n}(React.Component);\n\nexport default Editor;\n\nfunction uploadFileAttachment(attachment) {\n  uploadFile(attachment.file, setProgress, setAttributes);\n\n  function setProgress(progress) {\n    attachment.setUploadProgress(progress);\n  }\n\n  function setAttributes(attributes) {\n    attachment.setAttributes(attributes);\n  }\n}\n\nfunction setContent(attachment, data) {\n  var file = attachment.file;\n  var imageUrl = 'https://picsum.photos/200/300';\n  var attributes = {\n    previewable: false,\n    url: data.url,\n    href: data.url\n  };\n\n  if (!data.mime) {\n    data.mime = \"application/file\";\n  }\n\n  if (data.mime.includes(\"image\")) {\n    // image\n    attributes[\"content\"] = \"\\n          <span class=\\\"trix-preview-image\\\" data-url=\\\"\".concat(imageUrl, \"\\\"  data-name=\\\"\").concat(file.name, \"\\\" >\\n              <img src=\\\"\").concat(imageUrl, \"\\\" /> \\n          <span>\\n      \");\n  } else if (data.mime.includes(\"video\")) {\n    // video\n    attributes[\"content\"] = \"\\n          <span class=\\\"trix-preview-video\\\"  data-url=\\\"\".concat(data.url, \"\\\"  data-name=\\\"\").concat(file.name, \"\\\" >\\n              <video width=\\\"100%\\\" height=\\\"auto\\\" controls>\\n                  <source src=\\\"\").concat(data.url, \"\\\" type=\\\"\").concat(data.mime, \"\\\">\\n              </video>\\n          <span>\\n      \");\n  } else {\n    // other\n    attributes[\"content\"] = \"\\n          <span class=\\\"trix-preview-file\\\" data-url=\\\"\".concat(data.url, \"\\\"  data-name=\\\"\").concat(file.name, \"\\\" >\\n              \").concat(file.name, \"\\n          <span>\\n      \");\n  }\n\n  attachment.setUploadProgress(100);\n  attachment.setAttributes(attributes);\n}\n\nfunction uploadFile(file, progressCallback, successCallback) {\n  var key = createStorageKey(file);\n  var formData = createFormData(key, file);\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", HOST, true);\n  xhr.upload.addEventListener(\"progress\", function (event) {\n    var progress = event.loaded / event.total * 100;\n    progressCallback(progress);\n  });\n  xhr.addEventListener(\"load\", function (event) {\n    if (xhr.status == 204) {\n      var attributes = {\n        url: HOST + key,\n        href: HOST + key + \"?content-disposition=attachment\"\n      };\n      successCallback(attributes);\n    }\n  });\n  xhr.send(formData);\n}\n\nfunction createStorageKey(file) {\n  var date = new Date();\n  var day = date.toISOString().slice(0, 10);\n  var name = date.getTime() + \"-\" + file.name;\n  return [\"tmp\", day, name].join(\"/\");\n}\n\nfunction createFormData(key, file) {\n  var data = new FormData();\n  data.append(\"key\", key);\n  data.append(\"Content-Type\", file.type);\n  data.append(\"file\", file);\n  return data;\n} // //  oninti\n// this.ediotrInput.current.addEventListener('trix-initialize', function(e) {\n//   let editor  = e.target;\n//   let toolbar = editor.toolbarElement;\n//   let ttools  = toolbar.querySelector(\".trix-button-group--text-tools\");\n//   let dialogs = toolbar.querySelector(\".trix-dialogs\");\n//   let trixId  = editor.trixId;\n//   let buttonContent = `\n//     <button type=\"button\"\n//       class=\"trix-button trix-button--icon trix-button--icon-attach\"\n//       data-trix-attribute=\"attach\"\n//       data-trix-key=\"+\" title=\"Attach file\" tabindex=\"-1\">\n//     </button>\n//   `;\n//   let dialogContent = `\n//     <div class=\"trix-dialog trix-dialog--attach\" data-trix-dialog=\"attach\" data-trix-dialog-attribute=\"attach\">\n//       <div class=\"trix-dialog__attach-fields\">\n//         <input type=\"file\" class=\"trix-input trix-input--dialog\">\n//         <div class=\"trix-button-group\">\n//           <input type=\"button\" class=\"trix-button trix-button--dialog\"\n//             onclick=\"\n//               var trix = document.querySelector('trix-editor[trix-id=\\\\'${trixId}\\\\']');\n//               var fileElm = this.parentElement.parentElement.querySelector('input[type=\\\\'file\\\\']');\n//               if ( fileElm.files.length == 0 ) {\n//                 console.log('nothing selected');\n//                 return;\n//               }\n//               var file = fileElm.files[0];\n//               trix.editor.insertFile(file);\n//             \"\n//             value=\"Attach\" data-trix-method=\"removeAttribute\">\n//           <input type=\"button\" class=\"trix-button trix-button--dialog\" value=\"Cancel\" data-trix-method=\"removeAttribute\">\n//         </div>\n//       </div>\n//     </div>\n//   `;\n//   // add attach icon button\n//   ttools.insertAdjacentHTML(\"beforeend\", buttonContent);\n//   // add dialog\n//   dialogs.insertAdjacentHTML(\"beforeend\", dialogContent);\n// });","map":{"version":3,"sources":["/Users/pravin/Desktop/dinesh-web/react-trix-editor/src/Editor.jsx"],"names":["React","Component","Trix","Tribute","Editor","props","ediotrInput","createRef","tribute","observer","MutationObserver","mutations","forEach","type","target","attributeName","parentNode","tagName","nodeName","removeAttribute","classList","add","editor","document","querySelector","observe","attributes","childList","subtree","current","addEventListener","e","currentEditor","textEditor","values","key","value","attach","event","onChange","innerHTML","reff","console","log","getDocument","toString","selectionManager","selectionDidChange","attachment","file","setContent","uploadFileAttachment","uploadFile","setProgress","setAttributes","progress","setUploadProgress","data","imageUrl","previewable","url","href","mime","includes","name","progressCallback","successCallback","createStorageKey","formData","createFormData","xhr","XMLHttpRequest","open","HOST","upload","loaded","total","status","send","date","Date","day","toISOString","slice","getTime","join","FormData","append"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Trix from \"trix\";\nimport \"trix/dist/trix\";\nimport \"trix/dist/trix.css\";\nimport \"tributejs/tribute.css\";\nimport Tribute from \"tributejs\";\nclass Editor extends React.Component {\n  constructor(props) {\n    super(props);\n    this.ediotrInput = React.createRef();\n    this.tribute = React.createRef();\n    this.observer = new MutationObserver(function (mutations) {\n  mutations.forEach(({ type, target, attributeName }) => {\n    \n    // If the parent is a figure with an img target\n    if (target.parentNode.tagName === 'FIGURE' && \n        target.nodeName === 'IMG')\n    {\n      if (type === 'attributes') {\n        switch(attributeName) {\n\n          // If we have attribute width\n          case 'width':\n            // Remove attribute width\n            target.removeAttribute('width');\n            // Add img-fluid only once\n            target.classList.add('img-fluid');\n            break;\n\n          // If we have attribute height\n          case 'height':\n            // Remove attribute height\n            target.removeAttribute('height');\n            break;\n        }\n      }\n\n      // Render images HTML code\n      // renderHtmlOutput();\n    }\n\n  });\n});\n  }\n  \n  componentDidMount() {\n    const editor = document.querySelector('trix-editor');\n\n    this.observer.observe(editor, {\n  attributes: true,\n  childList: true,\n  subtree: true\n});\n    this.ediotrInput.current.addEventListener('trix-before-initialize', function(e) {\n      const currentEditor = textEditor.current;\n      this.tribute.current=new Tribute({\n        values: [\n          { key: \"schniz\", value: \"Gal Schlezinger\" },\n          { key: \"deanshub\", value: \"Dean Shub\" }\n        ]\n      })\n      this.tribute.current.attach(currentEditor)\n\n    })\n    \n    this.ediotrInput.current.addEventListener(\"trix-change\", (event) => {\n      this.props.onChange(event.target.innerHTML); //calling custom event\n      let reff=this.ediotrInput.current.editor\n      console.log(reff.getDocument().toString())\n      console.log(reff.selectionManager.selectionDidChange())\n      // var attachment = new Trix.Attachment({ content: '<span class=\"mention\">@trix</span>' })\n      // reff.insertAttachment(attachment)\n      // console.log(reff)\n      // debugger\n\n\n\n      // debugger\n    });\n    this.ediotrInput.current.addEventListener(\"trix-attachment-add\",(event) => {\n        console.log(event.attachment);\n        if(event.attachment.file){\n          \n          setContent( event.attachment, event.attachment.file); \n          \n          // uploadFileAttachment(event.attachment)\n        }\n    });\n    this.ediotrInput.current.addEventListener(\"trix-attachment-remove\",(event)=>{\n      console.log(event)\n    })\n    this.ediotrInput.current.addEventListener(\"trix-file-accept\",(event)=>{\n      console.log(event)\n    })\n  }\n\n  render() {\n    return (\n      <div>\n        <input type=\"hidden\" id=\"trix\" value={this.props.value} />\n        <trix-editor input=\"trix\" ref={this.ediotrInput} />\n      </div>\n    );\n  \n\n}\n\n}\nexport default Editor;\n\nfunction uploadFileAttachment(attachment) {\n  uploadFile(attachment.file, setProgress, setAttributes)\n \n  function setProgress(progress) {\n    attachment.setUploadProgress(progress)\n  }\n \n  function setAttributes(attributes) {\n    attachment.setAttributes(attributes)\n  }\n }\n function setContent( attachment, data ) {\n \n  let file = attachment.file;\n  let imageUrl='https://picsum.photos/200/300'\n  let attributes ={\n    previewable: false,\n                url: data.url,\n                href: data.url\n  };\n \n  if (!data.mime ){ \n      data.mime = \"application/file\";\n  }\n  if ( data.mime.includes(\"image\") ) { // image\n      attributes[\"content\"] = `\n          <span class=\"trix-preview-image\" data-url=\"${imageUrl}\"  data-name=\"${file.name}\" >\n              <img src=\"${imageUrl}\" /> \n          <span>\n      `;\n  } else if ( data.mime.includes(\"video\") ) { // video\n      attributes[\"content\"] = `\n          <span class=\"trix-preview-video\"  data-url=\"${data.url}\"  data-name=\"${file.name}\" >\n              <video width=\"100%\" height=\"auto\" controls>\n                  <source src=\"${data.url}\" type=\"${data.mime}\">\n              </video>\n          <span>\n      `;\n \n  } else {  // other\n      attributes[\"content\"] = `\n          <span class=\"trix-preview-file\" data-url=\"${data.url}\"  data-name=\"${file.name}\" >\n              ${file.name}\n          <span>\n      `;\n  }\n attachment.setUploadProgress(100)\n  attachment.setAttributes(attributes);\n }  \n \n function uploadFile(file, progressCallback, successCallback) {\n  var key = createStorageKey(file)\n  var formData = createFormData(key, file)\n  var xhr = new XMLHttpRequest()\n \n  xhr.open(\"POST\", HOST, true)\n \n  xhr.upload.addEventListener(\"progress\", function(event) {\n    var progress = event.loaded / event.total * 100\n    progressCallback(progress)\n  })\n \n  xhr.addEventListener(\"load\", function(event) {\n    if (xhr.status == 204) {\n      var attributes = {\n        url: HOST + key,\n        href: HOST + key + \"?content-disposition=attachment\"\n      }\n      successCallback(attributes)\n    }\n  })\n \n  xhr.send(formData)\n }\n \n function createStorageKey(file) {\n  var date = new Date()\n  var day = date.toISOString().slice(0,10)\n  var name = date.getTime() + \"-\" + file.name\n  return [ \"tmp\", day, name ].join(\"/\")\n }\n \n function createFormData(key, file) {\n  var data = new FormData()\n  data.append(\"key\", key)\n  data.append(\"Content-Type\", file.type)\n  data.append(\"file\", file)\n  return data\n }\n\n\n// //  oninti\n// this.ediotrInput.current.addEventListener('trix-initialize', function(e) {\n//   let editor  = e.target;\n//   let toolbar = editor.toolbarElement;\n//   let ttools  = toolbar.querySelector(\".trix-button-group--text-tools\");\n//   let dialogs = toolbar.querySelector(\".trix-dialogs\");\n//   let trixId  = editor.trixId;\n\n//   let buttonContent = `\n//     <button type=\"button\"\n//       class=\"trix-button trix-button--icon trix-button--icon-attach\"\n//       data-trix-attribute=\"attach\"\n//       data-trix-key=\"+\" title=\"Attach file\" tabindex=\"-1\">\n//     </button>\n//   `;\n\n//   let dialogContent = `\n//     <div class=\"trix-dialog trix-dialog--attach\" data-trix-dialog=\"attach\" data-trix-dialog-attribute=\"attach\">\n//       <div class=\"trix-dialog__attach-fields\">\n//         <input type=\"file\" class=\"trix-input trix-input--dialog\">\n//         <div class=\"trix-button-group\">\n//           <input type=\"button\" class=\"trix-button trix-button--dialog\"\n//             onclick=\"\n//               var trix = document.querySelector('trix-editor[trix-id=\\\\'${trixId}\\\\']');\n//               var fileElm = this.parentElement.parentElement.querySelector('input[type=\\\\'file\\\\']');\n//               if ( fileElm.files.length == 0 ) {\n//                 console.log('nothing selected');\n//                 return;\n//               }\n//               var file = fileElm.files[0];\n//               trix.editor.insertFile(file);\n//             \"\n//             value=\"Attach\" data-trix-method=\"removeAttribute\">\n//           <input type=\"button\" class=\"trix-button trix-button--dialog\" value=\"Cancel\" data-trix-method=\"removeAttribute\">\n//         </div>\n//       </div>\n//     </div>\n//   `;\n//   // add attach icon button\n//   ttools.insertAdjacentHTML(\"beforeend\", buttonContent);\n//   // add dialog\n//   dialogs.insertAdjacentHTML(\"beforeend\", dialogContent);\n// });"]},"metadata":{},"sourceType":"module"}